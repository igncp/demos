{"version":3,"sources":["webpack://demos/./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","webpack://demos/./src/demos/trend-line/trend-line.js","webpack://demos/./src/pages/d3js/trend-line.js"],"names":["asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","this","args","arguments","apply","err","undefined","margin","height","animationTime","getInterpolation","data","line","interpolate","d3","scale","quantile","domain","range","length","t","interpolatedLine","slice","renderGraph","rootElId","width","document","getElementById","getBoundingClientRect","timeFormat","time","format","parse","forEach","d","occurred","renderContent","zoomed","select","checked","svg","text","append","attr","x","y","d3next","xAxis","axis","orient","yAxis","extent","min","call","datum","transition","duration","attrTween","lr","n","sumX","sumY","sumXY","sumXX","sumYY","getTime","slope","intercept","r2","Math","pow","sqrt","linearRegression","regressionLine","tmp","delay","style","toExponential","selectAll","on","ROOT_PATH","demoInfo","pageContext","main","scripts","defaultChecked","name","type","className","id"],"mappings":"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","file":"component---src-pages-d-3-js-trend-line-js-cb2581cb76ef29cc9d02.js","sourcesContent":["function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}","import * as d3next from \"d3\"\n\nconst fetchData = () => d3next.tsv(`${ROOT_PATH}data/d3js/trend-line/data.tsv`)\n\nconst margin = {\n  bottom: 50,\n  left: 50,\n  right: 50,\n  top: 50,\n}\n\nconst height = 500 - margin.top - margin.bottom\n\nconst animationTime = 2000\n\nconst getInterpolation = function (data, line) {\n  const interpolate = d3.scale\n    .quantile()\n    .domain([0, 1])\n    .range(d3.range(1, data.length + 1))\n\n  return function (t) {\n    const interpolatedLine = data.slice(0, interpolate(t))\n\n    return line(interpolatedLine)\n  }\n}\n\nconst linearRegression = function (data) {\n  const lr = {}\n  const n = data.length\n\n  let sumX = 0\n  let sumY = 0\n  let sumXY = 0\n  let sumXX = 0\n  let sumYY = 0\n\n  data.forEach((d) => {\n    sumX += d.occurred.getTime()\n    sumY += d.value\n    sumXX += d.occurred.getTime() * d.occurred.getTime()\n    sumYY += d.value * d.value\n    sumXY += d.occurred.getTime() * d.value\n  })\n  lr.slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX)\n  lr.intercept = (sumY - lr.slope * sumX) / n\n  lr.r2 = Math.pow(\n    (n * sumXY - sumX * sumY) /\n      Math.sqrt((n * sumXX - sumX * sumX) * (n * sumYY - sumY * sumY)),\n    2\n  )\n\n  return lr\n}\n\nconst renderGraph = ({ data, rootElId }) => {\n  const width =\n    document.getElementById(rootElId).getBoundingClientRect().width -\n    margin.left -\n    margin.right\n\n  const timeFormat = d3.time.format(\"%Y-%m-%d\").parse\n\n  data.forEach((d) => {\n    d.occurred = timeFormat(d.occurred)\n    d.value = +d.value\n  })\n\n  const renderContent = () => {\n    const zoomed = d3.select('input[value=\"zoom\"]')[0][0].checked\n\n    const svg = d3\n      .select(`#${rootElId}`)\n      .text(\"\")\n      .append(\"svg\")\n      .attr(\"height\", height + margin.top + margin.bottom)\n      .attr(\"width\", width + margin.left + margin.right)\n      .append(\"g\")\n      .attr(\"transform\", `translate(${margin.left},${margin.right})`)\n\n    const x = d3.time.scale().range([0, width])\n    const y = d3next.scaleLinear().range([height, 0])\n    const xAxis = d3.svg.axis().scale(x).orient(\"bottom\")\n    const yAxis = d3.svg.axis().scale(y).orient(\"left\")\n\n    const line = d3.svg\n      .line()\n      .x((d) => x(d.occurred))\n      .y((d) => y(d.value))\n\n    x.domain(d3.extent(data, (d) => d.occurred))\n    y.domain([\n      (function () {\n        if (zoomed) {\n          return d3.min(data, (d) => d.value)\n        }\n\n        return 0\n      })(),\n      d3next.max(data, (d) => d.value),\n    ])\n\n    svg\n      .append(\"g\")\n      .attr(\"class\", \"x axis\")\n      .attr(\"transform\", `translate(0,${height})`)\n      .call(xAxis)\n    svg.append(\"g\").attr(\"class\", \"y axis\").call(yAxis)\n    svg\n      .append(\"path\")\n      .datum(data)\n      .transition()\n      .duration(animationTime)\n      .attrTween(\"d\", () => getInterpolation(data, line))\n      .attr(\"class\", \"line\")\n\n    const lr = linearRegression(data)\n\n    const regressionLine = d3.svg\n      .line()\n      .x((d) => x(d.occurred))\n      .y((d) => {\n        const tmp = lr.intercept + lr.slope * d.occurred\n\n        return y(tmp)\n      })\n\n    svg\n      .append(\"path\")\n      .datum(data)\n      .transition()\n      .delay(animationTime)\n      .duration(animationTime)\n      .attrTween(\"d\", () => getInterpolation(data, regressionLine))\n      .attr(\"class\", \"rline\")\n\n    svg\n      .append(\"text\")\n      .attr(\"transform\", `translate(${width * 0.7},${height * 0.7})`)\n      .style(\"opacity\", 0)\n      .transition(1000)\n      .delay(animationTime * 2)\n      .text(`Slope: ${lr.slope.toExponential(3)}`)\n      .style(\"opacity\", 1)\n  }\n\n  renderContent()\n\n  d3.selectAll('input[name=\"mode\"]').on(\"change\", renderContent)\n}\n\nconst main = async () => {\n  const rootElId = \"chart\"\n  const data = await fetchData()\n\n  renderGraph({\n    data,\n    rootElId,\n  })\n}\n\nexport default main\n","import React from \"react\"\n\nimport Demo from \"@/components/demo\"\n\nimport main from \"@/demos/trend-line/trend-line\"\n\nimport \"@/demos/trend-line/trend-line.styl\"\n\nconst TrendLine = ({ pageContext: { demoInfo } }) => (\n  <Demo demoInfo={demoInfo} main={main} scripts={[\"/vendors/d3/d3.min.js\"]}>\n    <form>\n      <label>\n        <input defaultChecked name=\"mode\" type=\"radio\" value=\"zoom\" /> Zoom\n      </label>\n      <label>\n        <input name=\"mode\" type=\"radio\" value=\"normal\" /> Normal\n      </label>\n    </form>\n    <div className=\"trend-line-chart\" id=\"chart\" />\n  </Demo>\n)\n\nexport default TrendLine\n"],"sourceRoot":""}