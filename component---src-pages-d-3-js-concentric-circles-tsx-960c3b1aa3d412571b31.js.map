{"version":3,"file":"component---src-pages-d-3-js-concentric-circles-tsx-960c3b1aa3d412571b31.js","mappings":"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","sources":["webpack://demos/./src/common.ts","webpack://demos/./src/demos/concentric-circles/concentric-circles.ts","webpack://demos/./src/pages/d3js/concentric-circles.tsx","webpack://demos/./node_modules/gatsby/node_modules/@babel/runtime/regenerator/index.js","webpack://demos/./node_modules/gatsby/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"],"sourcesContent":["type DocName = string\ntype DocLink = string\n\nexport type Meta = {\n  description: string\n}\n\nexport type DemoBase = {\n  dataFiles: string[]\n  docs: Array<[DocName, DocLink]>\n  isCompleted: boolean\n  name: string\n  notes: string[]\n  sources: string[]\n  summary: string[]\n}\n\ntype DemoFile = {\n  content: string\n  fileName: string\n}\n\nexport type DemoInfo = DemoBase & {\n  category: string\n  files: {\n    demoCSS: DemoFile[]\n    demoTS: DemoFile[]\n    page: {\n      content: string\n      type: string\n    }\n  }\n  key: string\n}\n\nexport type DemoSummary = {\n  category: string\n  key: string\n  name: DemoBase[\"name\"]\n  route: string\n}\n\nexport type IndexPageProps = {\n  pageContext: {\n    groupedDemos: DemoSummary[][]\n    meta: Meta\n    numberPerGroup: number\n  }\n}\n\nexport type DemoPageProps = {\n  pageContext: {\n    demoInfo: DemoInfo\n    meta: Meta\n  }\n}\n\nexport const STORYBOOK_DEMO_KEY = \"storybook\"\n\nexport const JQUERYUI = {\n  SCRIPT: \"/vendors/jquery-ui/jquery-ui.min.js\",\n  STYLE: \"/vendors/jquery-ui/themes/base/jquery-ui.min.css\",\n}\n","import {\n  Selection,\n  csv,\n  extent,\n  max,\n  range,\n  scaleLinear,\n  scalePow,\n  select,\n} from \"d3\"\n\nconst CONTAINER_ID = \"chart\"\n\ntype NamesMetric = {\n  count: string\n  name: string\n  sex: string\n  year: string\n}\ntype NamesMetrics = NamesMetric[]\ntype SVG = Selection<SVGGElement, unknown, HTMLElement, unknown>\n\nconst fetchData = async (): Promise<NamesMetrics> => {\n  const response = await csv(\n    `${ROOT_PATH}data/d3js/concentric-circles/data.csv`\n  )\n\n  return response as unknown as NamesMetrics\n}\n\nconst colours = [\"#7C7CC9\", \"#52D552\", \"#337233\", \"#323247\"]\n\nconst margin = {\n  bottom: 20,\n  left: 20,\n  right: 20,\n  top: 20,\n}\nconst strokeWidth = \"2px\"\n\nconst addFilter = (svg: SVG) => {\n  const defs = svg.append(\"defs\")\n  const filter = defs.append(\"filter\")\n\n  filter.attr(\"id\", \"drop-shadow\")\n  filter\n    .append(\"feGaussianBlur\")\n    .attr(\"in\", \"SourceAlpha\")\n    .attr(\"stdDeviation\", 9)\n  filter.append(\"feOffset\").attr(\"dx\", 5).attr(\"dy\", 5)\n  filter\n    .append(\"feComponentTransfer\")\n    .append(\"feFuncA\")\n    .attr(\"slope\", \".3\")\n    .attr(\"type\", \"linear\")\n\n  const feMerge = filter.append(\"feMerge\")\n\n  feMerge.append(\"feMergeNode\")\n  feMerge.append(\"feMergeNode\").attr(\"in\", \"SourceGraphic\")\n}\n\ntype AddDescription = (options: {\n  height: number\n  svg: SVG\n  width: number\n}) => void\n\nconst addDescription: AddDescription = ({ height, svg, width }) => {\n  svg\n    .append(\"text\")\n    .text(\n      \"Circles radius are proportional to the count of times the name appears\"\n    )\n    .attr(\"transform\", `translate(${width / 2},${height - 10})`)\n    .attr(\"width\", \"20px\")\n}\n\ntype RenderChart = (chartConfig: {\n  namesMetrics: NamesMetrics\n  rootElId: string\n}) => void\n\nconst renderChart: RenderChart = ({ namesMetrics, rootElId }) => {\n  const c = scaleLinear()\n    .domain(\n      extent(namesMetrics, (namesMetric) => +namesMetric.count) as [\n        number,\n        number\n      ]\n    )\n    .range([0, 1])\n\n  const heatmapColour = scaleLinear<string>()\n    .domain(range(0, 1, 1.0 / colours.length))\n    .range(colours)\n\n  const colorize = (namesMetric: NamesMetric) => {\n    const colorNormalized = c(+namesMetric.count)\n\n    return heatmapColour(colorNormalized)\n  }\n\n  const rootEl = document.getElementById(rootElId) as HTMLElement\n  const { width: elWidth } = rootEl.getBoundingClientRect()\n\n  const width = elWidth - margin.left - margin.right\n  const height =\n    (max(namesMetrics, (namesMetric) => +namesMetric.count) as number) * 2.5\n\n  const svg: SVG = select(`#${rootElId}`)\n    .append(\"svg\")\n    .attr(\"width\", width + margin.left + margin.right)\n    .attr(\"height\", height + margin.left + margin.right)\n    .append(\"g\")\n\n  addFilter(svg)\n\n  const circleGroup = svg\n    .selectAll<SVGGElement, NamesMetric>(\"g\")\n    .data(namesMetrics, (namesMetric: NamesMetric) => namesMetric.name)\n    .enter()\n    .append(\"g\")\n\n  const circles = circleGroup.append<SVGCircleElement>(\"svg:circle\")\n  const rScale = scalePow()\n    .exponent(0.9)\n    .range([5, 300])\n    .domain(\n      extent(namesMetrics, (namesMetric) => +namesMetric.count) as [\n        number,\n        number\n      ]\n    )\n\n  const getTitle = (namesMetric: NamesMetrics[number]) =>\n    `${namesMetric.name}: ${namesMetric.count}`\n  const dataMax = max(\n    namesMetrics,\n    (namesMetric) => +namesMetric.count\n  ) as number\n\n  circles\n    .attr(\"cx\", width / 2)\n    .attr(\"cy\", height / 2)\n    .attr(\"r\", (namesMetric) => rScale(+namesMetric.count))\n    .attr(\"class\", \"name-circle\")\n    .attr(\"title\", getTitle)\n    .style(\"fill\", \"#fff\")\n    .style(\"stroke\", (namesMetric) => colorize(namesMetric))\n    .style(\"stroke-width\", strokeWidth)\n    .style(\"filter\", (namesMetric) => {\n      if (+namesMetric.count > dataMax / 2.5) {\n        return \"url(#drop-shadow)\"\n      }\n\n      return \"\"\n    })\n    .on(\"mouseover\", function () {\n      select(this).style(\"stroke\", \"#D88021\").style(\"stroke-width\", \"10px\")\n    })\n    .on(\"mouseleave\", function () {\n      select<SVGCircleElement, NamesMetric>(this)\n        .style(\"stroke\", (namesMetric) => colorize(namesMetric))\n        .style(\"stroke-width\", strokeWidth)\n    })\n\n  $(\".name-circle\").tooltip({\n    track: true,\n  })\n\n  addDescription({\n    height,\n    svg,\n    width,\n  })\n}\n\nconst main = async () => {\n  const namesMetrics = await fetchData()\n\n  renderChart({\n    namesMetrics,\n    rootElId: CONTAINER_ID,\n  })\n}\n\nexport { CONTAINER_ID }\n\nexport default main\n","import React from \"react\"\n\nimport { DemoPageProps, JQUERYUI } from \"@/common\"\n\nimport Demo from \"@/components/demo\"\n\nimport main, {\n  CONTAINER_ID,\n} from \"@/demos/concentric-circles/concentric-circles\"\n\nconst ConcentricCircles = ({ pageContext }: DemoPageProps) => (\n  <Demo\n    links={[JQUERYUI.STYLE]}\n    main={main}\n    pageContext={pageContext}\n    scripts={[JQUERYUI.SCRIPT]}\n  >\n    <div id={CONTAINER_ID} />\n  </Demo>\n)\n\nexport default ConcentricCircles\n","module.exports = require(\"regenerator-runtime\");\n","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}"],"names":["STORYBOOK_DEMO_KEY","JQUERYUI","SCRIPT","STYLE","CONTAINER_ID","fetchData","csv","ROOT_PATH","response","colours","margin","renderChart","namesMetrics","rootElId","c","scaleLinear","domain","extent","namesMetric","count","range","heatmapColour","length","colorize","colorNormalized","width","document","getElementById","getBoundingClientRect","height","max","svg","select","append","attr","filter","feMerge","addFilter","circles","selectAll","data","name","enter","rScale","scalePow","exponent","dataMax","style","on","this","$","tooltip","track","text","addDescription","pageContext","links","main","scripts","id","module","exports","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined"],"sourceRoot":""}