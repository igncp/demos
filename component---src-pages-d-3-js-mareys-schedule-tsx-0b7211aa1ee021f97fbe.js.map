{"version":3,"sources":["webpack://demos/./src/demos/_utils/d3nextutils.ts","webpack://demos/./src/demos/mareys-schedule/mareys-schedule.ts","webpack://demos/./src/pages/d3js/mareys-schedule.tsx","webpack://demos/./node_modules/lodash/_arrayEach.js","webpack://demos/./node_modules/lodash/_baseEach.js","webpack://demos/./node_modules/lodash/_baseForOwn.js","webpack://demos/./node_modules/lodash/_baseKeys.js","webpack://demos/./node_modules/lodash/_castFunction.js","webpack://demos/./node_modules/lodash/_createBaseEach.js","webpack://demos/./node_modules/lodash/_nativeKeys.js","webpack://demos/./node_modules/lodash/each.js","webpack://demos/./node_modules/lodash/forEach.js","webpack://demos/./node_modules/lodash/keys.js","webpack://demos/./node_modules/lodash/last.js"],"names":["d3utils","colorsScale","colors","extent","c","d3","domain","range","colorScale","length","p","filterBlackOpacity","id","svg","deviation","slope","filter","append","attr","feMerge","filterColor","extra","middleTitle","width","text","top","String","style","selector","height","margin","bottom","left","right","tooltip","customOpts","opts","merge","elementSelector","followElement","followMouse","leftOffst","tOpts","container","viewport","topOffst","$","hover","e","css","pageX","pageY","position","fetchData","ROOT_PATH","data","stations","trains","map","train","trainIndex","key","test","stopFragments","split","push","distance","name","zone","direction","index","number","stops","station","time","parseTime","type","getTrainTitle","trainData","last","getFormatTime","timeStr","timeDate","formatTime","getHours","setDate","getDate","renderChart","rootElId","rootEl","document","getElementById","classList","add","getBoundingClientRect","redraw","timeRange","x","y","xAxisTop","ticks","tickFormat","xAxisBottom","selectAll","enter","d","call","on","_e","select","line","date","hours","ampm","minutes","getMinutes","toString","formatAMPM","refresh","limits","times","each","limit","wholeMinutes","fragment","Math","floor","minutesStr","finalTime","refreshOnHourChange","slider","change","demoInfo","pageContext","links","main","scripts","className","module","exports","array","iteratee","baseForOwn","baseEach","createBaseEach","baseFor","keys","object","isPrototype","nativeKeys","hasOwnProperty","Object","prototype","result","identity","value","isArrayLike","eachFunc","fromRight","collection","iterable","overArg","arrayEach","castFunction","isArray","arrayLikeKeys","baseKeys","undefined"],"mappings":"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","file":"component---src-pages-d-3-js-mareys-schedule-tsx-0b7211aa1ee021f97fbe.js","sourcesContent":["import * as d3 from \"d3\"\nimport merge from \"lodash/merge\"\n\ntype Margin = {\n  bottom: number\n  left: number\n  right: number\n  top: number\n}\n\ntype SVG = d3.Selection<SVGGElement, unknown, HTMLElement, unknown>\n\n// @TODO: rename this file when all files using utils have been ported to use this\n// @TODO: types\n\nconst d3utils = {\n  colorsScale<P extends number = any>(colors: any, extent: any) {\n    const c = d3.scaleLinear().domain(extent).range([0, 1])\n    const colorScale = d3\n      .scaleLinear()\n      .domain(d3.range(0, 1, 1.0 / colors.length))\n      .range(colors)\n\n    return function (p: P) {\n      return colorScale(c(p))\n    }\n  },\n  filterBlackOpacity(id: string, svg: SVG, deviation: number, slope: number) {\n    const defs = svg.append(\"defs\")\n    const filter = defs\n      .append(\"filter\")\n      .attr(\"height\", \"500%\")\n      .attr(\"id\", `drop-shadow-${id}`)\n      .attr(\"width\", \"500%\")\n      .attr(\"x\", \"-200%\")\n      .attr(\"y\", \"-200%\")\n\n    filter\n      .append(\"feGaussianBlur\")\n      .attr(\"in\", \"SourceAlpha\")\n      .attr(\"stdDeviation\", deviation)\n\n    filter.append(\"feOffset\").attr(\"dx\", 1).attr(\"dy\", 1)\n    filter\n      .append(\"feComponentTransfer\")\n      .append(\"feFuncA\")\n      .attr(\"slope\", slope)\n      .attr(\"type\", \"linear\")\n\n    const feMerge = filter.append(\"feMerge\")\n\n    feMerge.append(\"feMergeNode\")\n\n    return feMerge.append(\"feMergeNode\").attr(\"in\", \"SourceGraphic\")\n  },\n  filterColor(\n    id: string,\n    svg: SVG,\n    deviation: number,\n    slope: number,\n    extra?: any\n  ) {\n    if (extra == null) {\n      extra = false\n    }\n\n    const defs = svg.append(\"defs\")\n    const filter = defs.append(\"filter\").attr(\"id\", `drop-shadow-${id}`)\n\n    if (extra) {\n      filter\n        .attr(\"height\", \"500%\")\n        .attr(\"width\", \"500%\")\n        .attr(\"x\", \"-200%\")\n        .attr(\"y\", \"-200%\")\n    }\n\n    filter\n      .append(\"feOffset\")\n      .attr(\"dx\", 0.5)\n      .attr(\"dy\", 0.5)\n      .attr(\"in\", \"SourceGraphic\")\n      .attr(\"result\", \"offOut\")\n\n    filter\n      .append(\"feGaussianBlur\")\n      .attr(\"in\", \"offOut\")\n      .attr(\"result\", \"blurOut\")\n      .attr(\"stdDeviation\", deviation)\n\n    filter\n      .append(\"feBlend\")\n      .attr(\"in\", \"SourceGraphic\")\n      .attr(\"in2\", \"blurOut\")\n      .attr(\"mode\", \"normal\")\n\n    return filter\n      .append(\"feComponentTransfer\")\n      .append(\"feFuncA\")\n      .attr(\"slope\", slope)\n      .attr(\"type\", \"linear\")\n  },\n\n  middleTitle(svg: SVG, width: number, text: string, top: number | null) {\n    if (top == null) {\n      top = -15\n    }\n\n    svg\n      .append(\"text\")\n      .attr(\"class\", \"chart-title\")\n      .attr(\"text-anchor\", \"middle\")\n      .attr(\"transform\", `translate(${String(width / 2)},${top})`)\n      .text(text)\n      .style(\"font-weight\", \"bold\")\n  },\n  svg(selector: string, width: number, height: number, margin: Margin) {\n    return d3\n      .select(selector)\n      .text(\"\")\n      .append(\"svg\")\n      .attr(\"height\", height + margin.top + margin.bottom)\n      .attr(\"width\", width + margin.left + margin.right)\n      .append(\"g\")\n      .attr(\"transform\", `translate(${margin.left},${margin.top})`)\n  },\n  tooltip(selector: string, customOpts: any) {\n    if (customOpts == null) {\n      customOpts = {}\n    }\n\n    const defaultOpts = {\n      elementSelector: \"\",\n      followElement: false,\n      followMouse: false,\n      leftOffst: 60,\n      tOpts: {\n        container: \"body\",\n        viewport: {\n          selector: \"#chart svg\",\n        },\n      },\n      topOffst: 40,\n    }\n\n    const opts = merge(defaultOpts, customOpts)\n\n    const sel: any = $(selector)\n\n    sel.tooltip(opts.tOpts)\n\n    if (opts.followMouse) {\n      $(selector).hover((e) =>\n        $(\".tooltip\").css({\n          left: `${String(e.pageX - opts.leftOffst)}px`,\n          top: `${String(e.pageY - opts.topOffst)}px`,\n        })\n      )\n    } else if (opts.followElement) {\n      $(selector).hover(() =>\n        $(\".tooltip\").css({\n          left: `${String(\n            $(opts.elementSelector).position().left - opts.leftOffst\n          )}px`,\n          top: `${String(\n            $(opts.elementSelector).position().top - opts.topOffst\n          )}px`,\n        })\n      )\n    }\n  },\n}\n\nexport default d3utils\n","import * as d3 from \"d3\"\nimport each from \"lodash/each\"\nimport last from \"lodash/last\"\n\nimport d3utils from \"@/demos/_utils/d3nextutils\"\n\ntype RawDataItem = {\n  direction: string\n  number: string\n  type: string\n  [stop: string]: string\n}\n\ntype Station = {\n  distance: number\n  key: string\n  name: string\n  zone: number\n}\n\ntype Stop = {\n  station: Station\n  time: Date | null\n  trainIndex: number // eslint-disable-line camelcase\n}\n\ntype Train = {\n  direction: string\n  index: number\n  number: string\n  stops: Stop[]\n  type: string\n}\n\ntype Data = {\n  stations: Station[]\n  trains: Train[]\n}\n\ntype Limits = [number, number]\ntype LimitsStr = [string, string]\n\ntype Redraw = (range: LimitsStr) => void\n\nconst fetchData = async (): Promise<Data> => {\n  const data = ((await d3.tsv(\n    `${ROOT_PATH}data/d3js/mareys-schedule/data.tsv`\n  )) as unknown) as RawDataItem[]\n\n  const stations: Station[] = []\n\n  const trains: Train[] = data.map((train, trainIndex) => {\n    if (trainIndex === 0) {\n      for (const key in train) {\n        if (/^stop\\|/.test(key)) {\n          const stopFragments = key.split(\"|\")\n\n          stations.push({\n            distance: +stopFragments[2],\n            key,\n            name: stopFragments[1],\n            zone: +stopFragments[3],\n          })\n        }\n      }\n    }\n\n    return {\n      direction: train.direction,\n      index: trainIndex,\n      number: train.number,\n      stops: stations\n        .map((station) => ({\n          station,\n          time: parseTime(train[station.key]),\n          trainIndex,\n        }))\n        .filter((station) => station.time !== null),\n      type: train.type,\n    }\n  })\n\n  return {\n    stations,\n    trains,\n  }\n}\n\nconst getTrainTitle = (trainData: Train) => {\n  if (trainData.direction === \"S\") {\n    return `${trainData.stops[0].station.name} -> ${\n      last(trainData.stops)!.station.name\n    }`\n  }\n\n  return `${last(trainData.stops)!.station.name} -> ${\n    trainData.stops[0].station.name\n  }`\n}\n\nconst refreshOnHourChange = ({\n  limits,\n  redraw,\n}: {\n  limits: Limits\n  redraw: Redraw\n}) => {\n  const times: string[] = []\n\n  each(limits, (limit) => {\n    const wholeMinutes = (limit / 100) * 1200\n\n    let fragment = \"AM\"\n    let hours = Math.floor(wholeMinutes / 60)\n    let minutes = Math.floor(wholeMinutes % 60)\n\n    if (minutes > 30) {\n      minutes = minutes - 30\n      hours = hours + 1\n    } else {\n      minutes = minutes + 30\n    }\n\n    hours = hours + 4\n\n    if (hours > 23) {\n      if (hours === 24) {\n        hours = hours - 12\n      } else {\n        hours = hours - 24\n      }\n    } else if (hours > 11) {\n      fragment = \"PM\"\n\n      if (hours !== 12) {\n        hours = hours - 12\n      }\n    }\n\n    const minutesStr = minutes < 10 ? `0${String(minutes)}` : minutes.toString()\n\n    const finalTime = `${String(hours)}:${minutesStr}${fragment}`\n\n    return times.push(finalTime)\n  })\n\n  redraw(times as LimitsStr)\n}\n\nconst getFormatTime = () => d3.timeParse(\"%I:%M%p\")\n\nconst parseTime = (timeStr: string) => {\n  const formatTime = getFormatTime()\n  const timeDate = formatTime(timeStr)\n\n  if (timeDate !== null && timeDate.getHours() < 3) {\n    timeDate.setDate(timeDate.getDate() + 1)\n  }\n\n  return timeDate\n}\n\nconst formatAMPM = function (date: Date) {\n  let hours = date.getHours()\n  const ampm = hours >= 12 ? \"PM\" : \"AM\"\n\n  hours = hours % 12\n  hours = hours ? hours : 12\n\n  const minutes = date.getMinutes()\n  const minutesStr = minutes < 10 ? `0${minutes}` : minutes.toString()\n\n  return `${hours}:${minutesStr} ${ampm}`\n}\n\nconst margin = {\n  bottom: 50,\n  left: 120,\n  right: 50,\n  top: 80,\n}\n\nconst height = 600 - margin.top - margin.bottom\n\nconst renderChart = ({ rootElId, data }: { rootElId: string; data: Data }) => {\n  const { stations, trains } = data\n  const rootEl = document.getElementById(rootElId) as HTMLElement\n\n  rootEl.classList.add(\"mareys-schedule-chart\")\n\n  const width =\n    rootEl.getBoundingClientRect().width - margin.left - margin.right\n\n  const redraw: Redraw = (timeRange) => {\n    const x = d3\n      .scaleTime()\n      .domain([parseTime(timeRange[0])!, parseTime(timeRange[1])!])\n      .range([0, width])\n    const y = d3.scaleLinear().range([0, height])\n    const formatTime = getFormatTime()\n    const xAxisTop = d3\n      .axisTop(x)\n      .ticks(8)\n      .tickFormat(formatTime as any)\n    const xAxisBottom = d3\n      .axisBottom(x)\n      .ticks(8)\n      .tickFormat(formatTime as any)\n\n    const svg = d3utils.svg(`#${rootElId}`, width, height, margin)\n\n    d3utils.middleTitle(\n      svg,\n      width,\n      \"E.J. Marey’s graphical train schedule \" + \" (4:30AM - 1:30AM)\",\n      -40\n    )\n    d3utils.filterBlackOpacity(\"trains\", svg, 2, 0.2)\n    svg\n      .append(\"defs\")\n      .append(\"clipPath\")\n      .attr(\"id\", \"clip\")\n      .append(\"rect\")\n      .attr(\"y\", -margin.top)\n      .attr(\"width\", width)\n      .attr(\"height\", height + margin.top + margin.bottom)\n\n    y.domain(d3.extent(stations, (station) => station.distance) as Limits)\n\n    const station = svg\n      .append(\"g\")\n      .attr(\"class\", \"station\")\n      .selectAll(\"g\")\n      .data(stations)\n      .enter()\n      .append(\"g\")\n      .attr(\"transform\", (d) => `translate(0,${y(d.distance)})`)\n\n    station\n      .append(\"text\")\n      .attr(\"x\", -6)\n      .attr(\"dy\", \".35em\")\n      .text((d) => d.name)\n    station.append(\"line\").attr(\"x2\", width)\n    svg.append(\"g\").attr(\"class\", \"x top axis\").call(xAxisTop)\n    svg\n      .append(\"g\")\n      .attr(\"class\", \"x bottom axis\")\n      .attr(\"transform\", `translate(0,${height})`)\n      .call(xAxisBottom)\n\n    const mouseover = function (_e: unknown, d: Train) {\n      d3.select(`.train-${d.index}`).select(\"path\").style(\"stroke-width\", \"5px\")\n    }\n\n    const mouseleave = function (_e: unknown, d: Train) {\n      d3.select(`.train-${d.index}`)\n        .select(\"path\")\n        .style(\"stroke-width\", \"2.5px\")\n    }\n\n    const train = svg\n      .append(\"g\")\n      .attr(\"class\", \"train\")\n      .attr(\"clip-path\", \"url(#clip)\")\n      .selectAll(\"g\")\n      .data(trains.filter((d) => /[NLB]/.test(d.type)))\n      .enter()\n      .append(\"g\")\n      .attr(\"class\", (d) => `${d.type} train-${d.index}`)\n      .on(\"mouseover\", mouseover)\n      .on(\"mouseleave\", mouseleave)\n\n    const line = d3\n      .line<Stop>()\n      .x((d) => x(d.time!))\n      .y((d) => y(d.station.distance))\n\n    train\n      .append(\"path\")\n      .attr(\"d\", (d) => line(d.stops))\n      .append(\"title\")\n      .text((d) => getTrainTitle(d))\n\n    train\n      .selectAll(\"circle\")\n      .data((d) => d.stops)\n      .enter()\n      .append(\"circle\")\n      .attr(\n        \"transform\",\n        (d) => `translate(${x(d.time!)},${y(d.station.distance)})`\n      )\n      .style(\"filter\", \"url(#drop-shadow-trains)\")\n      .attr(\"r\", \"5px\")\n      .append(\"title\")\n      .text(\n        (d) =>\n          `${getTrainTitle(trains[d.trainIndex])}\\n${\n            d.station.name\n          } at ${formatAMPM(d.time!)}`\n      )\n  }\n\n  return {\n    refresh: (limits: [number, number]) => {\n      refreshOnHourChange({\n        limits,\n        redraw,\n      })\n    },\n  }\n}\n\nconst main = async () => {\n  const rootElId = \"chart\"\n\n  const data = await fetchData()\n\n  const { refresh } = renderChart({\n    data,\n    rootElId,\n  })\n\n  const slider: any = $(\".slider\")\n\n  slider.slider({\n    change: () => {\n      const limits: Limits = slider.slider(\"values\")\n\n      refresh(limits)\n    },\n    range: true,\n  })\n\n  slider.slider(\"values\", [10, 50])\n}\n\nexport default main\n","import React from \"react\"\n\nimport { DemoPageProps } from \"@/common\"\n\nimport Demo from \"@/components/demo\"\n\n// @ts-ignore\nimport main from \"@/demos/mareys-schedule/mareys-schedule\"\n\nimport \"@/demos/mareys-schedule/mareys-schedule.styl\"\n\nconst MareysSchedule = ({ pageContext: { demoInfo } }: DemoPageProps) => (\n  <Demo\n    demoInfo={demoInfo}\n    links={[\n      \"/vendors/jquery-ui/themes/base/theme.css\",\n      \"/vendors/jquery-ui/themes/base/slider.css\",\n    ]}\n    main={main}\n    scripts={[\n      \"/vendors/jquery-ui/jquery-ui.min.js\",\n      \"/vendors/jquery-ui/ui/slider.js\",\n    ]}\n  >\n    <div>\n      <div className=\"slider\" />\n    </div>\n    <div id=\"chart\" />\n  </Demo>\n)\n\nexport default MareysSchedule\n","/**\n * A specialized version of `_.forEach` for arrays without support for\n * iteratee shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns `array`.\n */\nfunction arrayEach(array, iteratee) {\n  var index = -1,\n      length = array == null ? 0 : array.length;\n\n  while (++index < length) {\n    if (iteratee(array[index], index, array) === false) {\n      break;\n    }\n  }\n  return array;\n}\n\nmodule.exports = arrayEach;\n","var baseForOwn = require('./_baseForOwn'),\n    createBaseEach = require('./_createBaseEach');\n\n/**\n * The base implementation of `_.forEach` without support for iteratee shorthands.\n *\n * @private\n * @param {Array|Object} collection The collection to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array|Object} Returns `collection`.\n */\nvar baseEach = createBaseEach(baseForOwn);\n\nmodule.exports = baseEach;\n","var baseFor = require('./_baseFor'),\n    keys = require('./keys');\n\n/**\n * The base implementation of `_.forOwn` without support for iteratee shorthands.\n *\n * @private\n * @param {Object} object The object to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Object} Returns `object`.\n */\nfunction baseForOwn(object, iteratee) {\n  return object && baseFor(object, iteratee, keys);\n}\n\nmodule.exports = baseForOwn;\n","var isPrototype = require('./_isPrototype'),\n    nativeKeys = require('./_nativeKeys');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction baseKeys(object) {\n  if (!isPrototype(object)) {\n    return nativeKeys(object);\n  }\n  var result = [];\n  for (var key in Object(object)) {\n    if (hasOwnProperty.call(object, key) && key != 'constructor') {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nmodule.exports = baseKeys;\n","var identity = require('./identity');\n\n/**\n * Casts `value` to `identity` if it's not a function.\n *\n * @private\n * @param {*} value The value to inspect.\n * @returns {Function} Returns cast function.\n */\nfunction castFunction(value) {\n  return typeof value == 'function' ? value : identity;\n}\n\nmodule.exports = castFunction;\n","var isArrayLike = require('./isArrayLike');\n\n/**\n * Creates a `baseEach` or `baseEachRight` function.\n *\n * @private\n * @param {Function} eachFunc The function to iterate over a collection.\n * @param {boolean} [fromRight] Specify iterating from right to left.\n * @returns {Function} Returns the new base function.\n */\nfunction createBaseEach(eachFunc, fromRight) {\n  return function(collection, iteratee) {\n    if (collection == null) {\n      return collection;\n    }\n    if (!isArrayLike(collection)) {\n      return eachFunc(collection, iteratee);\n    }\n    var length = collection.length,\n        index = fromRight ? length : -1,\n        iterable = Object(collection);\n\n    while ((fromRight ? index-- : ++index < length)) {\n      if (iteratee(iterable[index], index, iterable) === false) {\n        break;\n      }\n    }\n    return collection;\n  };\n}\n\nmodule.exports = createBaseEach;\n","var overArg = require('./_overArg');\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeKeys = overArg(Object.keys, Object);\n\nmodule.exports = nativeKeys;\n","module.exports = require('./forEach');\n","var arrayEach = require('./_arrayEach'),\n    baseEach = require('./_baseEach'),\n    castFunction = require('./_castFunction'),\n    isArray = require('./isArray');\n\n/**\n * Iterates over elements of `collection` and invokes `iteratee` for each element.\n * The iteratee is invoked with three arguments: (value, index|key, collection).\n * Iteratee functions may exit iteration early by explicitly returning `false`.\n *\n * **Note:** As with other \"Collections\" methods, objects with a \"length\"\n * property are iterated like arrays. To avoid this behavior use `_.forIn`\n * or `_.forOwn` for object iteration.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @alias each\n * @category Collection\n * @param {Array|Object} collection The collection to iterate over.\n * @param {Function} [iteratee=_.identity] The function invoked per iteration.\n * @returns {Array|Object} Returns `collection`.\n * @see _.forEachRight\n * @example\n *\n * _.forEach([1, 2], function(value) {\n *   console.log(value);\n * });\n * // => Logs `1` then `2`.\n *\n * _.forEach({ 'a': 1, 'b': 2 }, function(value, key) {\n *   console.log(key);\n * });\n * // => Logs 'a' then 'b' (iteration order is not guaranteed).\n */\nfunction forEach(collection, iteratee) {\n  var func = isArray(collection) ? arrayEach : baseEach;\n  return func(collection, castFunction(iteratee));\n}\n\nmodule.exports = forEach;\n","var arrayLikeKeys = require('./_arrayLikeKeys'),\n    baseKeys = require('./_baseKeys'),\n    isArrayLike = require('./isArrayLike');\n\n/**\n * Creates an array of the own enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects. See the\n * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n * for more details.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keys(new Foo);\n * // => ['a', 'b'] (iteration order is not guaranteed)\n *\n * _.keys('hi');\n * // => ['0', '1']\n */\nfunction keys(object) {\n  return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);\n}\n\nmodule.exports = keys;\n","/**\n * Gets the last element of `array`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Array\n * @param {Array} array The array to query.\n * @returns {*} Returns the last element of `array`.\n * @example\n *\n * _.last([1, 2, 3]);\n * // => 3\n */\nfunction last(array) {\n  var length = array == null ? 0 : array.length;\n  return length ? array[length - 1] : undefined;\n}\n\nmodule.exports = last;\n"],"sourceRoot":""}