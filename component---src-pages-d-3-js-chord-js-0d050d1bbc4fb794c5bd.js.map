{"version":3,"sources":["webpack://demos/./src/demos/chord/chord.js","webpack://demos/./src/pages/d3js/chord.js"],"names":["height","width","$","innerWidth","margin","r1","Math","min","r0","format","d3","debits","credits","arc","svg","innerRadius","outerRadius","chord","radius","charts","select","selectAll","data","enter","append","style","attr","String","leftChart","filter","_d","i","rightChart","setLabel","chart","label","text","csv","countries","array","n","country","d","id","name","value","this","amount","forEach","creditor","debtor","risk","valueOf","_i","j","_j","layout","sortGroups","descending","sortSubgroups","sortChords","padding","addDropShadowFilter","deviation","slope","dx","dy","in","result","stdDeviation","in2","mode","type","colours","c","scale","linear","domain","extent","range","heatmapColour","length","fill","each","matrix","jj","svgComp","chords","target","index","rgb","darker","source","g","groups","demoInfo","pageContext","main","scripts","className"],"mappings":"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","file":"component---src-pages-d-3-js-chord-js-0d050d1bbc4fb794c5bd.js","sourcesContent":["const main = () => {\n  const height = 500\n  const width = $(\"#chart\").innerWidth() / 2 - 20\n  const margin = {\n    bottom: 20,\n    top: 50,\n  }\n\n  const r1 = Math.min(width, height) / 2 - 4\n  const r0 = r1 - 20\n  const format = d3.format(\",.3r\")\n  const debits = []\n  const credits = []\n\n  const arc = d3.svg.arc().innerRadius(r0).outerRadius(r1)\n  const chord = d3.svg.chord().radius(r0)\n  const svg = d3.select(\"#chart\")\n\n  const charts = svg\n    .selectAll(\"div\")\n    .data([debits, credits])\n    .enter()\n    .append(\"div\")\n    .style(\"display\", \"inline-block\")\n    .style(\"width\", `${width}px`)\n    .style(\"height\", `${height + margin.top + margin.bottom}px`)\n    .append(\"svg:svg\")\n    .attr(\"width\", width)\n    .attr(\"height\", height + margin.top + margin.bottom)\n    .append(\"svg:g\")\n    .attr(\n      \"transform\",\n      `translate(${width / 2},${String(height / 2 + margin.top)})`\n    )\n\n  const leftChart = charts.filter((_d, i) => i === 0)\n  const rightChart = charts.filter((_d, i) => i === 1)\n\n  const setLabel = function (chart, label) {\n    return chart\n      .append(\"text\")\n      .text(label)\n      .attr(\"transform\", `translate(0,${(-1 * height) / 2 - 10})`)\n      .attr(\"class\", \"chart-title\")\n      .attr(\"text-anchor\", \"middle\")\n  }\n\n  setLabel(leftChart, \"Debits\")\n  setLabel(rightChart, \"Credits\")\n\n  d3.csv(\"/data/d3js/chord/data.csv\", (data) => {\n    const countries = {}\n    const array = []\n\n    let n = 0\n\n    const country = function (d) {\n      if (!countries[d]) {\n        countries[d] = {\n          id: n++,\n          name: d,\n        }\n      }\n\n      return countries[d]\n    }\n\n    const value = function () {\n      return +this.amount\n    }\n\n    data.forEach((d) => {\n      d.creditor = country(d.creditor)\n      d.debtor = country(d.debtor)\n      d.debtor.risk = d.risk\n      d.valueOf = value\n    })\n\n    for (\n      let i = 0, _i = 0;\n      0 <= n ? _i < n : _i > n;\n      i = 0 <= n ? ++_i : --_i\n    ) {\n      debits[i] = []\n      credits[i] = []\n\n      for (\n        let j = 0, _j = 0;\n        0 <= n ? _j < n : _j > n;\n        j = 0 <= n ? ++_j : --_j\n      ) {\n        debits[i][j] = 0\n        credits[i][j] = 0\n      }\n    }\n\n    data.forEach((d) => {\n      debits[d.creditor.id][d.debtor.id] = d\n      credits[d.debtor.id][d.creditor.id] = d\n      array[d.creditor.id] = d.creditor\n      array[d.debtor.id] = d.debtor\n    })\n\n    const layout = d3.layout\n      .chord()\n      .sortGroups(d3.descending)\n      .sortSubgroups(d3.descending)\n      .sortChords(d3.descending)\n      .padding(0.04)\n\n    const addDropShadowFilter = function (id, deviation, slope) {\n      const defs = charts.append(\"defs\")\n      const filter = defs.append(\"filter\").attr(\"id\", `drop-shadow-${id}`)\n\n      filter.append(\"feOffset\").attr({\n        dx: 0.5,\n        dy: 0.5,\n        in: \"SourceGraphic\",\n        result: \"offOut\",\n      })\n\n      filter.append(\"feGaussianBlur\").attr({\n        in: \"offOut\",\n        result: \"blurOut\",\n        stdDeviation: deviation,\n      })\n\n      filter.append(\"feBlend\").attr({\n        in: \"SourceGraphic\",\n        in2: \"blurOut\",\n        mode: \"normal\",\n      })\n\n      filter.append(\"feComponentTransfer\").append(\"feFuncA\").attr({\n        slope,\n        type: \"linear\",\n      })\n    }\n\n    addDropShadowFilter(\"chords\", 2, 0.4)\n    addDropShadowFilter(\"headings\", 3, 0.5)\n\n    const colours = [\n      \"#39B347\",\n      \"#C92E47\",\n      \"#DB704D\",\n      \"#FFA22C\",\n      \"#5E92AA\",\n      \"#F8EDD3\",\n    ]\n\n    const c = d3.scale\n      .linear()\n      .domain(d3.extent([0, n - 1]))\n      .range([0, 1])\n\n    const heatmapColour = d3.scale\n      .linear()\n      .domain(d3.range(0, 1, 1.0 / colours.length))\n      .range(colours)\n\n    const fill = function (d) {\n      return heatmapColour(c(d))\n    }\n\n    return charts.each(function (matrix, jj) {\n      const svgComp = d3.select(this)\n\n      layout.matrix(matrix)\n\n      svgComp\n        .selectAll(\"path.chord\")\n        .data(layout.chords)\n        .enter()\n        .append(\"svg:path\")\n        .attr(\"class\", \"chord\")\n        .style(\"fill\", (d) => fill(d.target.index))\n        .style(\"filter\", \"url(#drop-shadow-chords)\")\n        .style(\"stroke\", (d) => d3.rgb(fill(d.target.index)).darker())\n        .style(\"stroke-width\", 2)\n        .attr(\"d\", chord)\n        .append(\"svg:title\")\n        .text(\n          (d) =>\n            `${d.source.value.debtor.name} owes ${\n              d.source.value.creditor.name\n            } $${format(d.source.value)}B.`\n        )\n\n      const g = svgComp\n        .selectAll(\"g.group\")\n        .data(layout.groups)\n        .enter()\n        .append(\"svg:g\")\n        .attr(\"class\", \"group\")\n\n      g.append(\"svg:path\")\n        .style(\"fill\", (d) => fill(d.index))\n        .attr(\"id\", (d) => `group${d.index}-${jj}`)\n        .attr(\"d\", arc)\n        .style(\"filter\", () => \"url(#drop-shadow-headings)\")\n        .append(\"svg:title\")\n        .text(\n          (d) =>\n            `${array[d.index].name} ${jj ? \"owes\" : \"is owed\"} $${format(\n              d.value\n            )}B.`\n        )\n\n      g.append(\"svg:text\")\n        .attr(\"x\", 6)\n        .attr(\"dy\", 15)\n        .filter((d) => d.value > 150)\n        .append(\"svg:textPath\")\n        .attr(\"xlink:href\", (d) => `#group${d.index}-${jj}`)\n        .text((d) => array[d.index].name)\n        .attr(\"class\", \"heading-title\")\n    })\n  })\n}\n\nexport default main\n","import React from \"react\"\n\nimport Demo from \"@/components/demo\"\n\nimport main from \"@/demos/chord/chord\"\n\nimport \"@/demos/chord/chord.styl\"\n\nconst Chord = ({ pageContext: { demoInfo } }) => (\n  <Demo demoInfo={demoInfo} main={main} scripts={[\"/vendors/d3/d3.min.js\"]}>\n    <div className=\"chord-chart\" id=\"chart\" />\n  </Demo>\n)\n\nexport default Chord\n"],"sourceRoot":""}