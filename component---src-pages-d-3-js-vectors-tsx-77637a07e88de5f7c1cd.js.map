{"version":3,"sources":["webpack://demos/./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","webpack://demos/./src/demos/vectors/vectors.ts","webpack://demos/./src/pages/d3js/vectors.tsx"],"names":["asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","this","args","arguments","apply","err","undefined","settings","renderGraph","rootElId","data","nodes","links","rootEl","document","getElementById","classList","add","width","getBoundingClientRect","lastNodeId","charCodeAt","mousedownLink","mousedownNode","mouseupNode","simulation","d3","force","strength","height","distance","on","updateLinks","updateNodes","svg","append","attr","setupSVG","selectAll","enter","_d","i","linksEls","merge","d","deltaX","target","x","source","deltaY","y","dist","Math","sqrt","normX","normY","sourcePadding","left","targetPadding","right","exit","remove","nodesEls","textsEls","each","_ev","index","style","call","dragstarted","dragged","dragended","text","id","event","active","alphaTarget","restart","fx","fy","evt","classed","ctrlKey","dim","clientX","clientY","top","node","String","fromCharCode","length","reflexive","vx","vy","push","alpha","console","log","window","addEventListener","demoInfo","pageContext","main","scripts"],"mappings":"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","file":"component---src-pages-d-3-js-vectors-tsx-77637a07e88de5f7c1cd.js","sourcesContent":["function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}","import * as d3 from \"d3\"\n\nimport \"./vectors.styl\"\n\n// missing:\n// - connect nodes\n// - drag node\n// - keys handling\n// old one is in ./vectors-old/vectors-old.js, remove when completed\n\ntype Node = {\n  id: string\n  reflexive: boolean\n} & d3.SimulationNodeDatum\n\ntype Link = {\n  left: boolean\n  right: boolean\n  source: Node\n  target: Node\n}\n\ntype Data = {\n  links: Link[]\n  nodes: Node[]\n}\n\nconst getInitialData = (): Data => {\n  const nodes = [\n    {\n      id: \"A\",\n      reflexive: false,\n    },\n    {\n      id: \"B\",\n      reflexive: false,\n    },\n    {\n      id: \"C\",\n      reflexive: false,\n    },\n  ]\n  const links = [\n    {\n      left: false,\n      right: true,\n      source: nodes[0],\n      target: nodes[1],\n    },\n    {\n      left: false,\n      right: true,\n      source: nodes[1],\n      target: nodes[2],\n    },\n  ]\n\n  return {\n    links,\n    nodes,\n  }\n}\n\nconst setupSVG = (\n  svg: d3.Selection<SVGSVGElement, unknown, HTMLElement, unknown>\n) => {\n  svg\n    .append(\"svg:defs\")\n    .append(\"svg:marker\")\n    .attr(\"id\", \"end-arrow\")\n    .attr(\"viewBox\", \"0 -5 10 10\")\n    .attr(\"refX\", 6)\n    .attr(\"markerWidth\", 3)\n    .attr(\"markerHeight\", 3)\n    .attr(\"orient\", \"auto\")\n    .append(\"svg:path\")\n    .attr(\"d\", \"M0,-5L10,0L0,5\")\n    .attr(\"fill\", \"#000\")\n\n  svg\n    .append(\"svg:defs\")\n    .append(\"svg:marker\")\n    .attr(\"id\", \"start-arrow\")\n    .attr(\"viewBox\", \"0 -5 10 10\")\n    .attr(\"refX\", 4)\n    .attr(\"markerWidth\", 3)\n    .attr(\"markerHeight\", 3)\n    .attr(\"orient\", \"auto\")\n    .append(\"svg:path\")\n    .attr(\"d\", \"M10,-5L0,0L10,5\")\n    .attr(\"fill\", \"#000\")\n}\n\ntype CustomDragEvent = DragEvent & { active: boolean }\n\nconst settings = {\n  circleRadius: 5,\n  defaultTextOpacity: 0.5,\n  strength: -5000,\n  textDY: 5,\n}\n\nconst height = 600\n\ntype RenderGraph = (o: { rootElId: string; data: Data }) => void\n\nconst renderGraph: RenderGraph = ({ rootElId, data }) => {\n  const { nodes, links } = data\n\n  const rootEl = document.getElementById(rootElId) as HTMLElement\n\n  rootEl.classList.add(\"vectors-chart\")\n\n  const { width } = rootEl.getBoundingClientRect()\n\n  // @TODO\n  let lastNodeId = \"C\".charCodeAt(0)\n\n  const ticked = () => {\n    updateLinks()\n    updateNodes()\n  }\n\n  let mousedownLink: any = null\n  let mousedownNode: any = null\n  let mouseupNode: any = null\n\n  const resetMouseVars = () => {\n    mousedownNode = null\n    mouseupNode = null\n    mousedownLink = null\n  }\n\n  const simulation = d3\n    .forceSimulation(nodes)\n    .force(\"charge\", d3.forceManyBody().strength(-50))\n    .force(\"center\", d3.forceCenter(width / 2, height / 2))\n    .force(\"link\", d3.forceLink().links(links).distance(100))\n    .on(\"tick\", ticked)\n\n  const svg = d3\n    .select(`#${rootElId}`)\n    .append(\"svg\")\n    .attr(\"width\", width)\n    .attr(\"height\", height)\n\n  setupSVG(svg)\n\n  svg\n    .selectAll(\".link\")\n    .data(links)\n    .enter()\n    .append(\"svg:path\")\n    .attr(\"class\", \"link\")\n    .attr(\"marker-end\", \"url(#end)\")\n    .attr(\"id\", (_d, i) => `link-${i}`)\n\n  const updateLinks = () => {\n    const linksEls = svg\n      .selectAll<SVGPathElement, Data[\"links\"]>(\".link\")\n      .data(links)\n\n    linksEls\n      .enter()\n      .append<SVGPathElement>(\"path\")\n      .merge(linksEls)\n      .attr(\"d\", (d) => {\n        const deltaX = d.target.x! - d.source.x!\n        const deltaY = d.target.y! - d.source.y!\n        const dist = Math.sqrt(deltaX * deltaX + deltaY * deltaY)\n        const normX = deltaX / dist\n        const normY = deltaY / dist\n        const sourcePadding = d.left ? 17 : 12\n        const targetPadding = d.right ? 17 : 12\n        const sourceX = d.source.x! + sourcePadding * normX\n        const sourceY = d.source.y! + sourcePadding * normY\n        const targetX = d.target.x! - targetPadding * normX\n        const targetY = d.target.y! - targetPadding * normY\n\n        return `M${sourceX},${sourceY}L${targetX},${targetY}`\n      })\n      .attr(\"class\", \"link dragline\")\n\n    linksEls.exit().remove()\n  }\n\n  const updateNodes = () => {\n    const nodesEls = svg\n      .selectAll<SVGCircleElement, Data[\"nodes\"]>(\"circle\")\n      .data(nodes)\n    const textsEls = svg\n      .selectAll<SVGTextElement, Data[\"nodes\"]>(\"text\")\n      .data(nodes)\n\n    nodesEls\n      .enter()\n      .append(\"circle\")\n      .merge(nodesEls)\n      .attr(\"cx\", (d) => d.x!)\n      .attr(\"cy\", (d) => d.y!)\n      .attr(\"r\", () => settings.circleRadius)\n      .attr(\"fill\", \"#fff\")\n      .each(function () {\n        d3.select<SVGCircleElement, Data[\"nodes\"][0]>(this)\n          .on(\"mouseover\", (_ev, d) => {\n            d3.select(`#node-text-${d.index}`).style(\"opacity\", 1)\n          })\n          .on(\"mouseleave\", (_ev, d) => {\n            d3.select(`#node-text-${d.index}`).style(\n              \"opacity\",\n              settings.defaultTextOpacity\n            )\n          })\n      })\n      .call(\n        d3\n          .drag<SVGCircleElement, Data[\"nodes\"][0]>()\n          .on(\"start\", dragstarted)\n          .on(\"drag\", dragged)\n          .on(\"end\", dragended)\n      )\n\n    textsEls\n      .enter()\n      .append(\"text\")\n      .merge(textsEls)\n      .text((d) => d.id)\n      .attr(\"x\", (d) => d.x!)\n      .attr(\"y\", (d) => d.y!)\n      .attr(\"class\", \"id\")\n\n    nodesEls.exit().remove()\n    textsEls.exit().remove()\n  }\n\n  const dragstarted = (event: CustomDragEvent, d: Node) => {\n    if (!event.active) simulation.alphaTarget(0.3).restart()\n    d.fx = d.x\n    d.fy = d.y\n  }\n\n  const dragged = (event: CustomDragEvent, d: Node) => {\n    d.fx = event.x\n    d.fy = event.y\n  }\n\n  const dragended = (event: CustomDragEvent, d: Node) => {\n    if (!event.active) simulation.alphaTarget(0)\n    d.fx = null\n    d.fy = null\n  }\n\n  const keydown = function () {\n    console.log(\"keydown\") // eslint-disable-line no-console\n  }\n\n  const keyup = function () {\n    console.log(\"keyup\") // eslint-disable-line no-console\n  }\n\n  const mousedownSVG = (evt: any) => {\n    svg.classed(\"active\", true)\n\n    if (evt.ctrlKey || mousedownNode || mousedownLink) {\n      return\n    }\n\n    const e = evt.target\n\n    const dim = e.getBoundingClientRect()\n    const x = evt.clientX - dim.left\n    const y = evt.clientY - dim.top\n\n    const node = {\n      id: String.fromCharCode(++lastNodeId),\n      index: nodes.length,\n      reflexive: false,\n      vx: 0,\n      vy: 0,\n      x,\n      y,\n    }\n\n    nodes.push(node)\n\n    simulation.nodes(nodes)\n    simulation.alpha(0.5).restart()\n  }\n\n  const mousemoveSVG = () => {\n    console.log(\"mousemoveSVG\") // eslint-disable-line no-console\n  }\n\n  const mouseupSVG = () => {\n    console.log(\"mouseupSVG\", mouseupNode) // eslint-disable-line no-console\n    resetMouseVars()\n  }\n\n  svg\n    .on(\"mousedown\", mousedownSVG)\n    .on(\"mousemove\", mousemoveSVG)\n    .on(\"mouseup\", mouseupSVG)\n\n  window.addEventListener(\"keyup\", keyup)\n  window.addEventListener(\"keydown\", keydown)\n}\n\nconst main = async () => {\n  const data = getInitialData()\n\n  renderGraph({\n    data,\n    rootElId: \"chart\",\n  })\n}\n\nexport default main\n","import React from \"react\"\n\nimport { DemoPageProps } from \"@/common\"\n\nimport Demo from \"@/components/demo\"\n\nimport main from \"@/demos/vectors/vectors\"\n\nconst Vectors = ({ pageContext: { demoInfo } }: DemoPageProps) => (\n  <Demo demoInfo={demoInfo} main={main} scripts={[\"/vendors/d3/d3.min.js\"]}>\n    <div id=\"chart\" />\n  </Demo>\n)\n\nexport default Vectors\n"],"sourceRoot":""}