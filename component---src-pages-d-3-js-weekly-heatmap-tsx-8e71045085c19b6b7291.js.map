{"version":3,"sources":["webpack://demos/./src/demos/_utils/d3nextutils.ts","webpack://demos/./src/demos/weekly-heatmap/weekly-heatmap.ts","webpack://demos/./src/pages/d3js/weekly-heatmap.tsx"],"names":["d3utils","colorsScale","colors","extent","c","d3","domain","range","colorScale","length","p","filterBlackOpacity","id","svg","deviation","slope","filter","append","attr","feMerge","filterColor","extra","middleTitle","width","text","top","String","style","selector","height","margin","bottom","left","right","tooltip","customOpts","opts","merge","elementSelector","followElement","followMouse","leftOffst","tOpts","container","viewport","topOffst","$","hover","e","css","pageX","pageY","position","days","times","fetchData","values","d","day","hour","value","ROOT_PATH","data","map","renderChart","rootElId","rootEl","document","getElementById","classList","add","getBoundingClientRect","Math","ceil","gridSize","floor","legendElementWidth","max","buckets","selectAll","enter","_d","i","heatMap","transition","duration","delay","hide","show","legend","concat","quantiles","toFixed","demoInfo","pageContext","main"],"mappings":"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","file":"component---src-pages-d-3-js-weekly-heatmap-tsx-8e71045085c19b6b7291.js","sourcesContent":["import * as d3 from \"d3\"\nimport merge from \"lodash/merge\"\n\ntype Margin = {\n  bottom: number\n  left: number\n  right: number\n  top: number\n}\n\ntype SVG = d3.Selection<SVGGElement, unknown, HTMLElement, unknown>\n\n// @TODO: rename this file when all files using utils have been ported to use this\n// @TODO: types\n\nconst d3utils = {\n  colorsScale<P extends number = any>(colors: any, extent: any) {\n    const c = d3.scaleLinear().domain(extent).range([0, 1])\n    const colorScale = d3\n      .scaleLinear()\n      .domain(d3.range(0, 1, 1.0 / colors.length))\n      .range(colors)\n\n    return function (p: P) {\n      return colorScale(c(p))\n    }\n  },\n  filterBlackOpacity(id: string, svg: SVG, deviation: number, slope: number) {\n    const defs = svg.append(\"defs\")\n    const filter = defs\n      .append(\"filter\")\n      .attr(\"height\", \"500%\")\n      .attr(\"id\", `drop-shadow-${id}`)\n      .attr(\"width\", \"500%\")\n      .attr(\"x\", \"-200%\")\n      .attr(\"y\", \"-200%\")\n\n    filter\n      .append(\"feGaussianBlur\")\n      .attr(\"in\", \"SourceAlpha\")\n      .attr(\"stdDeviation\", deviation)\n\n    filter.append(\"feOffset\").attr(\"dx\", 1).attr(\"dy\", 1)\n    filter\n      .append(\"feComponentTransfer\")\n      .append(\"feFuncA\")\n      .attr(\"slope\", slope)\n      .attr(\"type\", \"linear\")\n\n    const feMerge = filter.append(\"feMerge\")\n\n    feMerge.append(\"feMergeNode\")\n\n    return feMerge.append(\"feMergeNode\").attr(\"in\", \"SourceGraphic\")\n  },\n  filterColor(\n    id: string,\n    svg: SVG,\n    deviation: number,\n    slope: number,\n    extra?: any\n  ) {\n    if (extra == null) {\n      extra = false\n    }\n\n    const defs = svg.append(\"defs\")\n    const filter = defs.append(\"filter\").attr(\"id\", `drop-shadow-${id}`)\n\n    if (extra) {\n      filter\n        .attr(\"height\", \"500%\")\n        .attr(\"width\", \"500%\")\n        .attr(\"x\", \"-200%\")\n        .attr(\"y\", \"-200%\")\n    }\n\n    filter\n      .append(\"feOffset\")\n      .attr(\"dx\", 0.5)\n      .attr(\"dy\", 0.5)\n      .attr(\"in\", \"SourceGraphic\")\n      .attr(\"result\", \"offOut\")\n\n    filter\n      .append(\"feGaussianBlur\")\n      .attr(\"in\", \"offOut\")\n      .attr(\"result\", \"blurOut\")\n      .attr(\"stdDeviation\", deviation)\n\n    filter\n      .append(\"feBlend\")\n      .attr(\"in\", \"SourceGraphic\")\n      .attr(\"in2\", \"blurOut\")\n      .attr(\"mode\", \"normal\")\n\n    return filter\n      .append(\"feComponentTransfer\")\n      .append(\"feFuncA\")\n      .attr(\"slope\", slope)\n      .attr(\"type\", \"linear\")\n  },\n\n  middleTitle(svg: SVG, width: number, text: string, top: number | null) {\n    if (top == null) {\n      top = -15\n    }\n\n    svg\n      .append(\"text\")\n      .attr(\"class\", \"chart-title\")\n      .attr(\"text-anchor\", \"middle\")\n      .attr(\"transform\", `translate(${String(width / 2)},${top})`)\n      .text(text)\n      .style(\"font-weight\", \"bold\")\n  },\n  svg(selector: string, width: number, height: number, margin: Margin) {\n    return d3\n      .select(selector)\n      .text(\"\")\n      .append(\"svg\")\n      .attr(\"height\", height + margin.top + margin.bottom)\n      .attr(\"width\", width + margin.left + margin.right)\n      .append(\"g\")\n      .attr(\"transform\", `translate(${margin.left},${margin.top})`)\n  },\n  tooltip(selector: string, customOpts: any) {\n    if (customOpts == null) {\n      customOpts = {}\n    }\n\n    const defaultOpts = {\n      elementSelector: \"\",\n      followElement: false,\n      followMouse: false,\n      leftOffst: 60,\n      tOpts: {\n        container: \"body\",\n        viewport: {\n          selector: \"#chart svg\",\n        },\n      },\n      topOffst: 40,\n    }\n\n    const opts = merge(defaultOpts, customOpts)\n\n    const sel: any = $(selector)\n\n    sel.tooltip(opts.tOpts)\n\n    if (opts.followMouse) {\n      $(selector).hover((e) =>\n        $(\".tooltip\").css({\n          left: `${String(e.pageX - opts.leftOffst)}px`,\n          top: `${String(e.pageY - opts.topOffst)}px`,\n        })\n      )\n    } else if (opts.followElement) {\n      $(selector).hover(() =>\n        $(\".tooltip\").css({\n          left: `${String(\n            $(opts.elementSelector).position().left - opts.leftOffst\n          )}px`,\n          top: `${String(\n            $(opts.elementSelector).position().top - opts.topOffst\n          )}px`,\n        })\n      )\n    }\n  },\n}\n\nexport default d3utils\n","import * as d3 from \"d3\"\nimport d3utils from \"@/demos/_utils/d3nextutils\"\n\ntype DataItem = {\n  day: number\n  hour: number\n  value: number\n}\n\nconst buckets = 9\nconst colors = [\n  \"#ffffd9\",\n  \"#edf8b1\",\n  \"#c7e9b4\",\n  \"#7fcdbb\",\n  \"#41b6c4\",\n  \"#1d91c0\",\n  \"#225ea8\",\n  \"#253494\",\n  \"#081d58\",\n]\n\nconst days = [\"Mo\", \"Tu\", \"We\", \"Th\", \"Fr\", \"Sa\", \"Su\"]\nconst times = [\n  \"1 am\",\n  \"2 am\",\n  \"3 am\",\n  \"4 am\",\n  \"5 am\",\n  \"6 am\",\n  \"7 am\",\n  \"8 am\",\n  \"9 am\",\n  \"10 am\",\n  \"11 am\",\n  \"12 am\",\n  \"1 pm\",\n  \"2 pm\",\n  \"3 pm\",\n  \"4 pm\",\n  \"5 pm\",\n  \"6 pm\",\n  \"7 pm\",\n  \"8 pm\",\n  \"9 pm\",\n  \"10 pm\",\n  \"11 pm\",\n  \"12 pm\",\n]\n\nconst fetchData = async (): Promise<DataItem[]> => {\n  const values = function (d: DataItem) {\n    return {\n      day: +d.day,\n      hour: +d.hour,\n      value: +d.value,\n    }\n  }\n\n  const data: any = await d3.tsv(\n    `${ROOT_PATH}data/d3js/weekly-heatmap/data.tsv`\n  )\n\n  return data.map(values)\n}\n\nconst margin = {\n  bottom: 100,\n  left: 50,\n  right: 50,\n  top: 50,\n}\n\nconst renderChart = async ({\n  data,\n  rootElId,\n}: {\n  data: DataItem[]\n  rootElId: string\n}) => {\n  const rootEl = document.getElementById(rootElId) as HTMLElement\n\n  rootEl.classList.add(\"weekly-heatmap-chart\")\n\n  const width =\n    rootEl.getBoundingClientRect().width - margin.left - margin.right\n  const height = Math.ceil((width * 10) / 24) - margin.top - margin.bottom + 60\n  const gridSize = Math.floor(width / 24)\n  const legendElementWidth = gridSize * 2\n\n  const max = d3.max(data, (d) => d.value)\n\n  const colorScale = d3\n    .scaleQuantile<string>()\n    .domain([0, buckets - 1, max])\n    .range(colors)\n\n  const svg = d3\n    .select(`#${rootElId}`)\n    .append(\"svg\")\n    .attr(\"height\", height + margin.top + margin.bottom)\n    .attr(\"width\", width + margin.left + margin.right)\n    .append(\"g\")\n    .attr(\"transform\", `translate(${margin.left},${margin.top})`)\n\n  svg\n    .selectAll(\".dayLabel\")\n    .data(days)\n    .enter()\n    .append(\"text\")\n    .text((d) => d)\n    .attr(\"class\", (_d, i) => {\n      if (i >= 0 && i <= 4) {\n        return \"dayLabel mono axis axis-workweek\"\n      }\n\n      return \"dayLabel mono axis\"\n    })\n    .attr(\"transform\", `translate(-6,${gridSize / 1.5})`)\n    .attr(\"x\", 0)\n    .attr(\"y\", (_d, i) => i * gridSize)\n    .style(\"text-anchor\", \"end\")\n\n  svg\n    .selectAll(\".timeLabel\")\n    .data(times)\n    .enter()\n    .append(\"text\")\n    .text((d) => d)\n    .attr(\"class\", (_d, i) => {\n      if (i >= 7 && i <= 16) {\n        return \"timeLabel mono axis axis-worktime\"\n      }\n\n      return \"timeLabel mono axis\"\n    })\n    .attr(\"transform\", `translate(${gridSize / 2}, -6)`)\n    .attr(\"x\", (_d, i) => i * gridSize)\n    .attr(\"y\", 0)\n    .style(\"text-anchor\", \"middle\")\n\n  const heatMap = svg\n    .selectAll(\".hour\")\n    .data(data)\n    .enter()\n    .append(\"rect\")\n    .attr(\"class\", \"hour bordered\")\n    .attr(\"height\", gridSize)\n    .attr(\"rx\", 4)\n    .attr(\"ry\", 4)\n    .attr(\"width\", gridSize)\n    .attr(\"x\", (d) => (d.hour - 1) * gridSize)\n    .attr(\"y\", (d) => (d.day - 1) * gridSize)\n    .style(\"fill\", colors[0])\n\n  heatMap\n    .transition()\n    .duration(6000)\n    .style(\"fill\", (d) => colorScale(d.value))\n\n  heatMap.attr(\"data-title\", (d) => `Value: ${d.value}`)\n\n  d3utils.tooltip(\".hour\", {\n    tOpts: {\n      delay: {\n        hide: 0,\n        show: 500,\n      },\n    },\n  })\n\n  const legend = svg\n    .selectAll(\".legend\")\n    .data<any>([0].concat(colorScale.quantiles()), (d) => d)\n    .enter()\n    .append(\"g\")\n    .attr(\"class\", \"legend\")\n\n  legend\n    .append(\"rect\")\n    .attr(\"x\", (_d, i) => legendElementWidth * i)\n    .attr(\"y\", height)\n    .attr(\"width\", legendElementWidth)\n    .attr(\"height\", gridSize / 2)\n    .style(\"fill\", (_d, i) => colors[i])\n    .style(\"stroke\", \"#CCC\")\n\n  legend\n    .append(\"text\")\n    .attr(\"class\", \"mono\")\n    .text((d) => `≥ ${d.toFixed(2)}`)\n    .attr(\"x\", (_d, i) => legendElementWidth * i)\n    .attr(\"y\", height + gridSize)\n}\n\nconst main = async () => {\n  const data = await fetchData()\n\n  renderChart({ data, rootElId: \"chart\" })\n}\n\nexport default main\n","import React from \"react\"\n\nimport { DemoPageProps } from \"@/common\"\n\nimport Demo from \"@/components/demo\"\n\nimport main from \"@/demos/weekly-heatmap/weekly-heatmap\"\n\nimport \"@/demos/weekly-heatmap/weekly-heatmap.styl\"\n\nconst WeeklyHeatmap = ({ pageContext: { demoInfo } }: DemoPageProps) => (\n  <Demo demoInfo={demoInfo} main={main}>\n    <div id=\"chart\" />\n  </Demo>\n)\n\nexport default WeeklyHeatmap\n"],"sourceRoot":""}