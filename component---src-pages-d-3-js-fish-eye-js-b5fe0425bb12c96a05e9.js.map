{"version":3,"sources":["webpack://demos/./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","webpack://demos/./src/demos/_utils/d3nextutils.ts","webpack://demos/./src/demos/_utils/fish-eye.ts","webpack://demos/./src/demos/fish-eye/fish-eye.ts","webpack://demos/./src/pages/d3js/fish-eye.js"],"names":["asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","this","args","arguments","apply","err","undefined","d3utils","colorsScale","filterBlackOpacity","id","svg","deviation","slope","filter","append","attr","feMerge","filterColor","extra","middleTitle","width","text","top","String","style","selector","height","margin","d3","bottom","left","right","tooltip","customOpts","opts","merge","elementSelector","followElement","followMouse","leftOffst","tOpts","container","viewport","topOffst","$","hover","e","css","pageX","pageY","position","d3Rebind","target","source","method","d3FisheyeScale","scale","d","a","fisheye","_","x","range","min","max","m","Math","abs","distortion","length","focus","copy","nice","ticks","tickFormat","methods","forEach","rebind","circular","radius","k0","k1","dx","dy","y","dd","sqrt","z","k","exp","rescale","scaleType","fetchData","ROOT_PATH","humanizeNumber","initialN","n","toString","n2","replace","FishEyeChart","rootElId","data","setWidth","setVars","setDom","render","setChartTitle","setBackground","setPointer","setFilter","setAxis","setLabels","setDots","setTitles","bindMousemove","bindClick","document","getElementById","getBoundingClientRect","dom","colorScale","domain","radiusScale","xScale","d3Fisheye","yScale","vars","focused","xAxis","tickSize","yAxis","call","dot","income","lifeExpectancy","population","selectAll","enter","region","sort","b","name","zoom","ev","mouse","select","pointer","on","demoInfo","pageContext","main","className"],"mappings":"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","file":"component---src-pages-d-3-js-fish-eye-js-b5fe0425bb12c96a05e9.js","sourcesContent":["function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}","import * as d3 from \"d3\"\nimport merge from \"lodash/merge\"\n\ntype Margin = {\n  bottom: number\n  left: number\n  right: number\n  top: number\n}\n\ntype SVG = d3.Selection<SVGGElement, unknown, HTMLElement, unknown>\n\n// @TODO: rename this file when all files using utils have been ported to use this\n// @TODO: types\n\nconst d3utils = {\n  colorsScale(/*_colors: unknown, _extent: unknown*/) {\n    // const c = d3.scale.linear().domain(extent).range([0, 1])\n    // const colorScale = d3.scale\n    // .linear()\n    // .domain(d3.range(0, 1, 1.0 / colors.length))\n    // .range(colors)\n    // return function (p) {\n    // return colorScale(c(p))\n    // }\n  },\n  filterBlackOpacity(id: string, svg: SVG, deviation: number, slope: number) {\n    const defs = svg.append(\"defs\")\n    const filter = defs\n      .append(\"filter\")\n      .attr(\"height\", \"500%\")\n      .attr(\"id\", `drop-shadow-${id}`)\n      .attr(\"width\", \"500%\")\n      .attr(\"x\", \"-200%\")\n      .attr(\"y\", \"-200%\")\n\n    filter\n      .append(\"feGaussianBlur\")\n      .attr(\"in\", \"SourceAlpha\")\n      .attr(\"stdDeviation\", deviation)\n\n    filter.append(\"feOffset\").attr(\"dx\", 1).attr(\"dy\", 1)\n    filter\n      .append(\"feComponentTransfer\")\n      .append(\"feFuncA\")\n      .attr(\"slope\", slope)\n      .attr(\"type\", \"linear\")\n\n    const feMerge = filter.append(\"feMerge\")\n\n    feMerge.append(\"feMergeNode\")\n\n    return feMerge.append(\"feMergeNode\").attr(\"in\", \"SourceGraphic\")\n  },\n  filterColor(\n    id: string,\n    svg: SVG,\n    deviation: number,\n    slope: number,\n    extra: any\n  ) {\n    if (extra == null) {\n      extra = false\n    }\n\n    const defs = svg.append(\"defs\")\n    const filter = defs.append(\"filter\").attr(\"id\", `drop-shadow-${id}`)\n\n    if (extra) {\n      filter\n        .attr(\"height\", \"500%\")\n        .attr(\"width\", \"500%\")\n        .attr(\"x\", \"-200%\")\n        .attr(\"y\", \"-200%\")\n    }\n\n    filter\n      .append(\"feOffset\")\n      .attr(\"dx\", 0.5)\n      .attr(\"dy\", 0.5)\n      .attr(\"in\", \"SourceGraphic\")\n      .attr(\"result\", \"offOut\")\n\n    filter\n      .append(\"feGaussianBlur\")\n      .attr(\"in\", \"offOut\")\n      .attr(\"result\", \"blurOut\")\n      .attr(\"stdDeviation\", deviation)\n\n    filter\n      .append(\"feBlend\")\n      .attr(\"in\", \"SourceGraphic\")\n      .attr(\"in2\", \"blurOut\")\n      .attr(\"mode\", \"normal\")\n\n    return filter\n      .append(\"feComponentTransfer\")\n      .append(\"feFuncA\")\n      .attr(\"slope\", slope)\n      .attr(\"type\", \"linear\")\n  },\n\n  middleTitle(svg: SVG, width: number, text: string, top: number | null) {\n    if (top == null) {\n      top = -15\n    }\n\n    svg\n      .append(\"text\")\n      .attr(\"class\", \"chart-title\")\n      .attr(\"text-anchor\", \"middle\")\n      .attr(\"transform\", `translate(${String(width / 2)},${top})`)\n      .text(text)\n      .style(\"font-weight\", \"bold\")\n  },\n  svg(selector: string, width: number, height: number, margin: Margin) {\n    return d3\n      .select(selector)\n      .text(\"\")\n      .append(\"svg\")\n      .attr(\"height\", height + margin.top + margin.bottom)\n      .attr(\"width\", width + margin.left + margin.right)\n      .append(\"g\")\n      .attr(\"transform\", `translate(${margin.left},${margin.top})`)\n  },\n  tooltip(selector: string, customOpts: any) {\n    if (customOpts == null) {\n      customOpts = {}\n    }\n\n    const defaultOpts = {\n      elementSelector: \"\",\n      followElement: false,\n      followMouse: false,\n      leftOffst: 60,\n      tOpts: {\n        container: \"body\",\n        viewport: {\n          selector: \"#chart svg\",\n        },\n      },\n      topOffst: 40,\n    }\n\n    const opts = merge(defaultOpts, customOpts)\n\n    const sel: any = $(selector)\n\n    sel.tooltip(opts.tOpts)\n\n    if (opts.followMouse) {\n      $(selector).hover((e) =>\n        $(\".tooltip\").css({\n          left: `${String(e.pageX - opts.leftOffst)}px`,\n          top: `${String(e.pageY - opts.topOffst)}px`,\n        })\n      )\n    } else if (opts.followElement) {\n      $(selector).hover(() =>\n        $(\".tooltip\").css({\n          left: `${String(\n            $(opts.elementSelector).position().left - opts.leftOffst\n          )}px`,\n          top: `${String(\n            $(opts.elementSelector).position().top - opts.topOffst\n          )}px`,\n        })\n      )\n    }\n  },\n}\n\nexport default d3utils\n","import * as d3 from \"d3\"\n\nexport type FishEyeScale = any\n\n// https://github.com/d3/d3/blob/v3.5.17/src/core/rebind.js\nconst rebind = function (target: any, source: any, ...methods: any[]) {\n  methods.forEach((method) => {\n    target[method] = d3Rebind(target, source, source[method])\n  })\n\n  return target\n}\n\nfunction d3Rebind(target: any, source: any, method: any) {\n  return function () {\n    const value = method.apply(source, arguments)\n\n    return value === source ? target : value\n  }\n}\n\n// https://github.com/d3/d3-plugins/blob/master/fisheye/fisheye.js\nconst d3Fisheye = {\n  circular() {\n    let radius = 200\n\n    let distortion = 2\n    let k0: any = null\n    let k1: any = null\n    let focus = [0, 0]\n\n    function fisheye(d: any) {\n      const dx = d.x - focus[0]\n      const dy = d.y - focus[1]\n      const dd = Math.sqrt(dx * dx + dy * dy)\n\n      if (!dd || dd >= radius)\n        return { x: d.x, y: d.y, z: dd >= radius ? 1 : 10 }\n\n      const k = ((k0 * (1 - Math.exp(-dd * k1))) / dd) * 0.75 + 0.25\n\n      return {\n        x: focus[0] + dx * k,\n        y: focus[1] + dy * k,\n        z: Math.min(k, 10),\n      }\n    }\n\n    function rescale() {\n      k0 = Math.exp(distortion)\n      k0 = (k0 / (k0 - 1)) * radius\n      k1 = distortion / radius\n\n      return fisheye\n    }\n\n    fisheye.radius = function (_: any) {\n      if (!arguments.length) return radius\n      radius = +_\n\n      return rescale()\n    }\n\n    fisheye.distortion = function (_: any) {\n      if (!arguments.length) return distortion\n      distortion = +_\n\n      return rescale()\n    }\n\n    fisheye.focus = function (_: any) {\n      if (!arguments.length) return focus\n      focus = _\n\n      return fisheye\n    }\n\n    return rescale()\n  },\n  scale(scaleType: any) {\n    return d3FisheyeScale(scaleType(), 3, 0)\n  },\n}\n\nfunction d3FisheyeScale(scale: any, d: any, a: any) {\n  function fisheye(_: any) {\n    const x = scale(_)\n    const left = x < a\n    const range = d3.extent(scale.range())\n    const min: any = range[0]\n    const max: any = range[1]\n    let m = left ? a - min : max - a\n\n    if (m == 0) m = max - min\n\n    return ((left ? -1 : 1) * m * (d + 1)) / (d + m / Math.abs(x - a)) + a\n  }\n\n  fisheye.distortion = function (_: any) {\n    if (!arguments.length) return d\n    d = +_\n\n    return fisheye\n  }\n\n  fisheye.focus = function (_: any) {\n    if (!arguments.length) return a\n    a = +_\n\n    return fisheye\n  }\n\n  fisheye.copy = function () {\n    return d3FisheyeScale(scale.copy(), d, a)\n  }\n\n  fisheye.nice = scale.nice\n  fisheye.ticks = scale.ticks\n  fisheye.tickFormat = scale.tickFormat\n  fisheye.range = scale.range\n\n  return rebind(fisheye, scale, \"domain\", \"range\")\n}\n\nexport default d3Fisheye\n","import * as d3 from \"d3\"\n\nimport d3Fisheye, { FishEyeScale } from \"@/demos/_utils/fish-eye\"\nimport d3utils from \"@/demos/_utils/d3nextutils\"\n\ntype DataItem = {\n  income: number\n  lifeExpectancy: number\n  name: string\n  population: number\n  region: string\n}\ntype Data = DataItem[]\n\nconst fetchData = async (): Promise<Data | undefined> =>\n  d3.json(`${ROOT_PATH}data/d3js/fish-eye/data.json`)\n\nconst humanizeNumber = (initialN: number): string => {\n  let n = initialN.toString()\n\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    const n2 = n.replace(/(\\d)(\\d{3})($|,|\\.)/g, \"$1,$2$3\")\n\n    if (n === n2) {\n      break\n    }\n\n    n = n2\n  }\n\n  return n\n}\n\nconst margin = {\n  bottom: 70,\n  left: 70,\n  right: 50,\n  top: 80,\n}\nconst height = 700 - margin.top - margin.bottom\n\ntype FishEyeChartOpts = {\n  rootElId: string\n  data: Data\n}\n\nclass FishEyeChart {\n  private rootElId: string\n  private data: Data\n\n  private width!: number\n  private dom!: {\n    svg: d3.Selection<SVGGElement, unknown, HTMLElement, unknown>\n    dot?: d3.Selection<SVGCircleElement, DataItem, SVGGElement, unknown>\n    pointer?: d3.Selection<SVGTextElement, unknown, HTMLElement, unknown>\n    xAxis?: d3.Axis<DataItem[\"income\"]>\n    yAxis?: d3.Axis<DataItem[\"lifeExpectancy\"]>\n  }\n  private vars!: {\n    colorScale: d3.ScaleOrdinal<string, string, never>\n    focused: boolean\n    radiusScale: d3.ScalePower<number, number, never>\n    xScale: FishEyeScale\n    yScale: FishEyeScale\n  }\n\n  public constructor({ rootElId, data }: FishEyeChartOpts) {\n    this.rootElId = rootElId\n    this.data = data\n\n    this.setWidth()\n    this.setVars()\n    this.setDom()\n  }\n\n  public render() {\n    this.setChartTitle()\n    this.setBackground()\n    this.setPointer()\n    this.setFilter()\n    this.setAxis()\n    this.setLabels()\n    this.setDots()\n    this.setTitles()\n    this.bindMousemove()\n    this.bindClick()\n  }\n\n  private setWidth() {\n    this.width =\n      (document.getElementById(\n        this.rootElId\n      ) as HTMLElement).getBoundingClientRect().width -\n      margin.left -\n      margin.right\n  }\n\n  private setDom() {\n    this.dom = {\n      svg: d3\n        .select(`#${this.rootElId}`)\n        .append(\"svg\")\n        .attr(\"width\", this.width + margin.left + margin.right)\n        .attr(\"height\", height + margin.top + margin.bottom)\n        .append(\"g\")\n        .attr(\"transform\", `translate(${margin.left},${margin.top})`),\n    }\n  }\n\n  private setChartTitle() {\n    return d3utils.middleTitle(\n      this.dom.svg,\n      this.width,\n      \"Income Per Capita vs \" +\n        \"Life Expectancy vs Population vs Region - 180 Countries\",\n      -40\n    )\n  }\n\n  private setVars() {\n    const colorScale = d3\n      .scaleOrdinal<string>()\n      .domain([\n        \"Sub-Saharan Africa\",\n        \"South Asia\",\n        \"Middle East & North Africa\",\n        \"America\",\n        \"Europe & Central Asia\",\n        \"East Asia & Pacific\",\n      ])\n      .range(d3.schemePastel2)\n\n    const radiusScale = d3.scaleSqrt().domain([0, 5e8]).range([5, 60])\n    const xScale = d3Fisheye\n      .scale(d3.scaleLog)\n      .domain([300, 1e5])\n      .range([0, this.width])\n    const yScale = d3Fisheye\n      .scale(d3.scaleLinear)\n      .domain([20, 90])\n      .range([height, 0])\n\n    this.vars = {\n      colorScale,\n      focused: false,\n      radiusScale,\n      xScale,\n      yScale,\n    }\n  }\n\n  private setAxis() {\n    this.dom.xAxis = d3\n      .axisBottom<DataItem[\"population\"]>(this.vars.xScale)\n      .tickFormat(d3.format(\",d\"))\n      .tickSize(-height)\n    this.dom.yAxis = d3\n      .axisLeft<DataItem[\"income\"]>(this.vars.yScale)\n      .tickSize(-this.width)\n    this.dom.svg\n      .append(\"g\")\n      .attr(\"class\", \"x axis\")\n      .attr(\"transform\", `translate(0,${height})`)\n      .call(this.dom.xAxis)\n    this.dom.svg.append(\"g\").attr(\"class\", \"y axis\").call(this.dom.yAxis)\n  }\n\n  private setBackground() {\n    return this.dom.svg\n      .append(\"rect\")\n      .attr(\"class\", \"background\")\n      .attr(\"width\", this.width)\n      .attr(\"height\", height)\n  }\n\n  private setLabels() {\n    this.dom.svg\n      .append(\"text\")\n      .attr(\"class\", \"x label\")\n      .attr(\"text-anchor\", \"end\")\n      .attr(\"x\", this.width - 26)\n      .attr(\"y\", height + 26)\n      .text(\"income per capita, inflation-adjusted (dollars)\")\n\n    this.dom.svg\n      .append(\"text\")\n      .attr(\"class\", \"y label\")\n      .attr(\"text-anchor\", \"end\")\n      .attr(\"x\", -26)\n      .attr(\"y\", -40)\n      .attr(\"dy\", \".75em\")\n      .attr(\"transform\", \"rotate(-90)\")\n      .text(\"life expectancy (years)\")\n  }\n\n  private setFilter() {\n    return d3utils.filterColor(\"circles\", this.dom.svg, 1.5, 0.6, true)\n  }\n\n  private position() {\n    this.dom\n      .dot!.attr(\"cx\", (d) => this.vars.xScale(d.income))\n      .attr(\"cy\", (d) => this.vars.yScale(d.lifeExpectancy))\n      .attr(\"r\", (d) => this.vars.radiusScale(d.population))\n  }\n\n  private setDots() {\n    this.dom.dot = this.dom.svg\n      .append(\"g\")\n      .attr(\"class\", \"dots\")\n      .selectAll(\".dot\")\n      .data<DataItem>(this.data)\n      .enter()\n      .append(\"circle\")\n      .attr(\"class\", \"dot\")\n      .style(\"fill\", (d: DataItem) => this.vars.colorScale(d.region))\n      .style(\"filter\", \"url(#drop-shadow-circles)\")\n      .style(\"stroke\", \"black\")\n      .style('\"stroke-width\"', \"1px\")\n      .sort((a, b) => b.population - a.population)\n\n    this.position()\n  }\n\n  private setTitles() {\n    this.dom\n      .dot!.append(\"title\")\n      .text(\n        (d) =>\n          `${d.name}:\\n- Income: ${humanizeNumber(d.income)} $/P.C.\\n` +\n          `- Population: ${humanizeNumber(d.population)}\\n` +\n          `- Life expectancy: ${d.lifeExpectancy} years`\n      )\n  }\n\n  private zoom(ev: Event) {\n    const mouse = d3.pointer(ev)\n\n    this.vars.xScale.distortion(2.5).focus(mouse[0])\n    this.vars.yScale.distortion(2.5).focus(mouse[1])\n    this.position()\n\n    this.dom.svg.select<SVGGElement>(\".x.axis\").call(this.dom.xAxis!)\n    this.dom.svg.select<SVGGElement>(\".y.axis\").call(this.dom.yAxis!)\n  }\n\n  private setPointer() {\n    this.dom.pointer = this.dom.svg\n      .append(\"text\")\n      .text(\"+\")\n      .attr(\"class\", \"pointer\")\n  }\n\n  private bindMousemove() {\n    return this.dom.svg.on(\"mousemove\", (ev) => {\n      if (!this.vars.focused) {\n        this.zoom(ev)\n      }\n    })\n  }\n\n  private bindClick() {\n    this.dom.svg.on(\"click\", (ev: Event) => {\n      this.vars.focused = !this.vars.focused\n\n      if (this.vars.focused) {\n        const pointer = d3.pointer(this)\n\n        this.dom\n          .pointer!.attr(\"x\", pointer[0])\n          .attr(\"y\", pointer[1])\n          .style(\"opacity\", 1)\n\n        return\n      }\n\n      this.dom.pointer!.style(\"opacity\", 0)\n\n      this.zoom(ev)\n    })\n  }\n}\n\nconst main = async () => {\n  const data = await fetchData()\n\n  const chart = new FishEyeChart({\n    data: data as Data,\n    rootElId: \"chart\",\n  })\n\n  chart.render()\n}\n\nexport default main\n","import React from \"react\"\n\nimport Demo from \"@/components/demo\"\n\nimport main from \"@/demos/fish-eye/fish-eye\"\n\nimport \"@/demos/fish-eye/fish-eye.styl\"\n\nconst FishEye = ({ pageContext: { demoInfo } }) => (\n  <Demo demoInfo={demoInfo} main={main}>\n    <div className=\"fish-eye-chart\" id=\"chart\" />\n  </Demo>\n)\n\nexport default FishEye\n"],"sourceRoot":""}