{"version":3,"sources":["webpack://demos/./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","webpack://demos/./src/demos/map-distorsions/map-distorsions.ts","webpack://demos/./src/pages/d3js/map-distorsions.tsx"],"names":["asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","this","args","arguments","apply","err","undefined","DimensionName","margin","height","colors","texts","tooltipText","projectionItem","valuesWithDimension","Acc40","Scale","Areal","Angular","map","dimensionName","Number","toFixed","name","join","renderChart","data","rootElId","rootEl","document","getElementById","classList","add","width","getBoundingClientRect","dimensions","scale","scalePoint","range","type","String","scaleLinear","scaleSqrt","svg","select","append","attr","text","style","x","domain","d","line","lineD3","defined","isNaN","dimension","selectAll","enter","filterColor","sortedData","slice","sort","nameA","nameB","colorFn","colorsScale","length","forEach","dimItem","extent","draw","allPoints","each","dimensionItem","yAxis","axisLeft","call","_d","projectionIndex","moveToFront","parentNode","appendChild","projectionItemIndex","projection","on","_e","overProjection","classed","otherProjection","filter","$","tooltip","track","c","colorScale","p","id","deviation","slope","tsv","ROOT_PATH","demoInfo","pageContext","links","main","scripts"],"mappings":"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","file":"component---src-pages-d-3-js-map-distorsions-tsx-d7d7a93f7b2a04b54267.js","sourcesContent":["function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}","import {\n  axisLeft,\n  extent,\n  line as lineD3,\n  range,\n  scaleLinear,\n  scalePoint,\n  scaleSqrt,\n  select,\n  tsv,\n} from \"d3\"\n\nimport \"./map-distorsions.styl\"\n\ntype ProjectionItem = {\n  \"Acc. 40ยบ 150%\": string\n  Angular: string\n  Areal: string\n  Scale: string\n  name: string\n}\n\nconst fetchData = () =>\n  (tsv(`${ROOT_PATH}data/d3js/map-distorsions/data.tsv`) as unknown) as Promise<\n    ProjectionItem[]\n  >\n\nconst margin = {\n  bottom: 20,\n  left: 200,\n  right: 40,\n  top: 90,\n}\nconst height = 750 - margin.top - margin.bottom\nconst axisYOffset = -9\n\nconst colors = [\"#7C7CC9\", \"#429742\", \"#63BD28\", \"#D14141\"]\n\nconst texts = {\n  title:\n    \"Comparison of 41 map projections by four different types of distortion. Lower is better.\",\n}\n\ntype RenderChart = (o: { data: ProjectionItem[]; rootElId: string }) => void\n\nenum DimensionName {\n  Acc40 = \"Acc. 40ยบ 150%\",\n  Scale = \"Scale\",\n  Areal = \"Areal\",\n  Angular = \"Angular\",\n}\n\nconst tooltipText = function (projectionItem: ProjectionItem) {\n  const dimensionsNames = [\n    DimensionName.Acc40,\n    DimensionName.Scale,\n    DimensionName.Areal,\n    DimensionName.Angular,\n  ] as (keyof ProjectionItem)[]\n  const valuesWithDimension = dimensionsNames.map(\n    (dimensionName) =>\n      `${Number(projectionItem[dimensionName]).toFixed(2)} (${dimensionName})`\n  )\n\n  return `${projectionItem.name}: ${valuesWithDimension.join(\", \")}`\n}\n\ntype Dimension = {\n  name: DimensionName | \"name\"\n  scale: any\n  type: Function\n}\n\nconst renderChart: RenderChart = ({ data, rootElId }) => {\n  const rootEl = document.getElementById(rootElId) as HTMLElement\n\n  rootEl.classList.add(\"map-distorsions-chart\")\n\n  const width =\n    rootEl.getBoundingClientRect().width - margin.left - margin.right\n\n  const dimensions: Dimension[] = [\n    {\n      name: \"name\",\n      scale: scalePoint().range([0, height]),\n      type: String,\n    },\n    {\n      name: DimensionName.Acc40,\n      scale: scaleLinear().range([0, height]),\n      type: Number,\n    },\n    {\n      name: DimensionName.Scale,\n      scale: scaleLinear().range([height, 0]),\n      type: Number,\n    },\n    {\n      name: DimensionName.Areal,\n      scale: scaleSqrt().range([height, 0]),\n      type: Number,\n    },\n    {\n      name: DimensionName.Angular,\n      scale: scaleLinear().range([height, 0]),\n      type: Number,\n    },\n  ]\n\n  const svg = select(`#${rootElId}`)\n    .append(\"svg\")\n    .attr(\"height\", height + margin.top + margin.bottom)\n    .attr(\"width\", width + margin.left + margin.right)\n    .append(\"g\")\n    .attr(\"transform\", `translate(${margin.left},${margin.top})`)\n\n  svg\n    .append(\"text\")\n    .attr(\"class\", \"chart-title\")\n    .attr(\"text-anchor\", \"middle\")\n    .attr(\"transform\", `translate(${width / 2},-60)`)\n    .text(texts.title)\n    .style(\"font-weight\", \"bold\")\n\n  const x = scalePoint()\n    .domain(dimensions.map((d) => d.name))\n    .range([0, width])\n\n  const line = lineD3().defined((d) => !isNaN(d[1]))\n\n  const dimension = svg\n    .selectAll(\".dimension\")\n    .data(dimensions)\n    .enter()\n    .append(\"g\")\n    .attr(\"class\", \"dimension\")\n    .attr(\"transform\", (d) => `translate(${x(d.name)})`)\n\n  filterColor(\"lines\", svg, 2, 0.4)\n\n  const sortedData: ProjectionItem[] = data\n    .slice(0)\n    .sort(({ name: nameA }, { name: nameB }) => {\n      if (nameA === nameB) {\n        return 0\n      }\n\n      return nameA < nameB ? -1 : 1\n    })\n\n  const colorFn = colorsScale([0, sortedData.length - 1])\n\n  dimensions.forEach((dimItem: Dimension) =>\n    dimItem.scale.domain(\n      dimItem.type === Number\n        ? extent(\n            sortedData,\n            (d: ProjectionItem) => +d[dimItem.name as keyof ProjectionItem]\n          )\n        : sortedData\n            .map((d: ProjectionItem) => d[dimItem.name as keyof ProjectionItem])\n            .sort()\n    )\n  )\n\n  const draw = (projectionItem: ProjectionItem) => {\n    const allPoints: [number, number][] = dimensions.map((dimItem) => [\n      x(dimItem.name) as number,\n      dimItem.scale(projectionItem[dimItem.name as keyof ProjectionItem]),\n    ])\n\n    return line(allPoints)\n  }\n\n  svg\n    .append(\"g\")\n    .attr(\"class\", \"background\")\n    .selectAll(\"path\")\n    .data<ProjectionItem>(sortedData)\n    .enter()\n    .append(\"path\")\n    .attr(\"d\", draw)\n    .attr(\"title\", tooltipText)\n\n  svg\n    .append(\"g\")\n    .attr(\"class\", \"foreground\")\n    .selectAll(\"path\")\n    .data(sortedData)\n    .enter()\n    .append(\"path\")\n    .attr(\"d\", draw)\n    .attr(\"data-title\", tooltipText)\n\n  dimension\n    .append(\"g\")\n    .attr(\"class\", \"axis\")\n    .each(function (dimensionItem: Dimension) {\n      const yAxis = axisLeft(dimensionItem.scale)\n\n      return select(this).call(yAxis)\n    })\n    .append(\"text\")\n    .attr(\"class\", \"title\")\n    .attr(\"text-anchor\", \"middle\")\n    .attr(\"y\", axisYOffset)\n    .text((dimensionItem) => dimensionItem.name)\n\n  svg\n    .select(\".axis\")\n    .selectAll<SVGElement, ProjectionItem>(\"text:not(.title)\")\n    .attr(\"class\", \"label\")\n    .data(sortedData, (projectionItem: ProjectionItem) => projectionItem.name)\n    .style(\"fill\", (_d, projectionIndex) => colorFn(projectionIndex))\n\n  const moveToFront = function (this: SVGElement) {\n    const el = this.parentNode as HTMLElement\n\n    el.appendChild(this)\n  }\n\n  const mouseover = (_e: unknown, overProjection: ProjectionItem) => {\n    svg.selectAll(\".foreground path\").style(\"filter\", \"none\")\n    svg.classed(\"active\", true)\n    projection.classed(\n      \"inactive\",\n      (otherProjection: ProjectionItem) =>\n        otherProjection.name !== overProjection.name\n    )\n\n    projection\n      .filter(\n        (otherProjection: ProjectionItem) =>\n          otherProjection.name === overProjection.name\n      )\n      .each(moveToFront)\n  }\n\n  const mouseout = () => {\n    svg.selectAll(\".foreground path\").style(\"filter\", \"url(#drop-shadow-lines)\")\n    svg.classed(\"active\", false)\n    projection.classed(\"inactive\", false)\n  }\n\n  svg\n    .selectAll(\".foreground path\")\n    .style(\"filter\", \"url(#drop-shadow-lines)\")\n    .style(\"stroke\", (_d, projectionItemIndex) => colorFn(projectionItemIndex))\n\n  const projection = svg\n    .selectAll<SVGElement, ProjectionItem>(\n      \".axis text,.background path,.foreground path\"\n    )\n    .on(\"mouseover\", mouseover)\n    .on(\"mouseout\", mouseout)\n\n  $(\".background path, .foreground path\").tooltip({\n    track: true,\n  })\n}\n\nconst colorsScale = <P extends number = any>(domain: [number, number]) => {\n  const c = scaleLinear().domain(domain).range([0, 1])\n  const colorScale = scaleLinear<string>()\n    .domain(range(0, 1, 1.0 / colors.length))\n    .range(colors)\n\n  return function (p: P) {\n    return colorScale(c(p))\n  }\n}\n\nconst filterColor = (\n  id: string,\n  svg: d3.Selection<SVGGElement, unknown, HTMLElement, unknown>,\n  deviation: number,\n  slope: number\n) => {\n  const defs = svg.append(\"defs\")\n  const filter = defs.append(\"filter\").attr(\"id\", `drop-shadow-${id}`)\n\n  filter\n    .append(\"feOffset\")\n    .attr(\"dx\", 0.5)\n    .attr(\"dy\", 0.5)\n    .attr(\"in\", \"SourceGraphic\")\n    .attr(\"result\", \"offOut\")\n\n  filter\n    .append(\"feGaussianBlur\")\n    .attr(\"in\", \"offOut\")\n    .attr(\"result\", \"blurOut\")\n    .attr(\"stdDeviation\", deviation)\n\n  filter\n    .append(\"feBlend\")\n    .attr(\"in\", \"SourceGraphic\")\n    .attr(\"in2\", \"blurOut\")\n    .attr(\"mode\", \"normal\")\n\n  filter\n    .append(\"feComponentTransfer\")\n    .append(\"feFuncA\")\n    .attr(\"slope\", slope)\n    .attr(\"type\", \"linear\")\n}\n\nconst main = async () => {\n  const data = await fetchData()\n  const rootElId = \"chart\"\n\n  renderChart({ data, rootElId })\n}\n\nexport default main\n","import React from \"react\"\n\nimport { DemoPageProps } from \"@/common\"\n\nimport Demo from \"@/components/demo\"\n\nimport main from \"@/demos/map-distorsions/map-distorsions\"\n\nconst MapDistorsions = ({ pageContext: { demoInfo } }: DemoPageProps) => (\n  <Demo\n    demoInfo={demoInfo}\n    links={[\"/vendors/jquery-ui/themes/base/jquery-ui.min.css\"]}\n    main={main}\n    scripts={[\"/vendors/jquery-ui/jquery-ui.min.js\"]}\n  >\n    <div id=\"chart\" />\n  </Demo>\n)\n\nexport default MapDistorsions\n"],"sourceRoot":""}