
  <!DOCTYPE html>
  <html>
    <head>
      <title>icosahedron.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src/demos/icosahedron/icosahedron.ts</td><td class="">100.00%</td><td class="">90%</td><td class="">308</td><td class="">308</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import {
  GeoProjection,
  ScaleOrdinal,
  Selection,
  geoOrthographic,
  polygonArea,
  polygonHull,
  scaleOrdinal,
  schemePastel2,
  select,
  timer,
} from &quot;d3&quot;

import &quot;./icosahedron.styl&quot;

type IcosahedronOpts = {
  rootElId: string
}

type Position = [number, number, number]
type Point2D = [number, number]

type Hull = Point2D[]
type Face = Hull
type Faces = Face[]
type FaceWithPolygon = Face &amp; {
  polygon: Hull
}

type SvgSelection = Selection&lt;
  SVGSVGElement,
  FaceWithPolygon,
  HTMLElement,
  unknown
&gt;

class Icosahedron {
  private rootElId: string

  private config!: {
    color: ScaleOrdinal&lt;string, string, never&gt;
    defaultVelocity: number[]
    height: number
    rotationFactor1: number
    rotationFactor2: number
    t0: number
    width: number
    zeroVelocity: number[]
  }

  private dom!: {
    faces: null | Selection&lt;
      SVGPathElement,
      FaceWithPolygon,
      SVGSVGElement,
      unknown
    &gt;
    projection: GeoProjection
    svg: SvgSelection
  }

  private vars!: {
    velocity: number[] | null
  }

  private static getIcosahedronFaces(): Faces {
    const faces: Faces = []
    const y = (Math.atan2(1, 2) * 180) / Math.PI

    for (let x = 0; x &lt; 360; x += 360 / 5) {
      faces.push(
        [
          [x + 0, -90],
          [x + 0, -y],
          [x + 72, -y],
        ],
        [
          [x + 36, y],
          [x + 72, -y],
          [x + 0, -y],
        ],
        [
          [x + 36, y],
          [x + 0, -y],
          [x - 36, y],
        ],
        [
          [x + 36, y],
          [x - 36, y],
          [x - 36, 90],
        ]
      )
    }

    return faces
  }

  public constructor(opts: IcosahedronOpts) {
    this.rootElId = opts.rootElId
    this.setConfig()
    this.setDom()
    this.setVars()

    const faces = this.dom.svg
      .selectAll(&quot;path&quot;)
      .data(Icosahedron.getIcosahedronFaces() as FaceWithPolygon[])
      .enter()
      .append(&quot;path&quot;)
      .each((d) =&gt; {
        d.polygon = polygonHull(d.map(this.dom.projection) as Faces[0]) as Hull
      })
      .style(&quot;fill&quot;, (_d: unknown, index: number) =&gt; {
        const color = this.config.color(`${index}`)

        return color
      })

    this.dom.faces = faces
    this.vars.velocity = this.config.defaultVelocity
  }

  public start() {
    timer(() =&gt; this.timer())
  }

  private setConfig() {
    const color = scaleOrdinal(schemePastel2)

    this.config = {
      color,
      defaultVelocity: [1, 0.4, 0.07],
      height: 500,
      rotationFactor1: 1 / 1000,
      rotationFactor2: 4,
      t0: Date.now(),
      width: (document.getElementById(
        this.rootElId
      ) as HTMLElement).getBoundingClientRect().width,
      zeroVelocity: [0, 0, 0],
    }
  }

  private setDom() {
    const rootEl = document.getElementById(this.rootElId) as HTMLElement

    rootEl.classList.add(&quot;icosahedron-chart&quot;)

    const projection = geoOrthographic().scale(this.config.height / 2 - 10)
    const svg = select(`#${this.rootElId}`)
      .append(&quot;svg&quot;)
      .attr(&quot;width&quot;, this.config.width)
      .attr(&quot;height&quot;, this.config.height) as SvgSelection

    this.dom = {
      faces: null,
      projection,
      svg,
    }
  }

  private setVars() {
    this.vars = {
      velocity: null,
    }
  }

  private calcNewPosition(time: number, position: Position): Position {
    const { velocity } = this.vars

    return [
      velocity![0] *
        Math.abs(
          Math.sin(time * this.config.rotationFactor1) *
            this.config.rotationFactor2
        ) +
        position[0],
      velocity![1] + position[1],
      position![2] + velocity![2],
    ]
  }

  private timer() {
    const time = Date.now() - this.config.t0
    const originalPos = this.dom.projection.rotate()

    this.dom.projection.rotate(this.calcNewPosition(time, originalPos))
    this.dom
      .faces!.each((d) =&gt;
        d.forEach((p: [number, number], i: number) =&gt; {
          d.polygon[i] = this.dom.projection(p) as Point2D

          return null
        })
      )
      .style(&quot;display&quot;, (d) =&gt; {
        const area = polygonArea(d.polygon)

        if (area &gt; 0) {
          return null
        }

        return &quot;none&quot;
      })
      .attr(&quot;d&quot;, (d) =&gt; `M${d.polygon.join(&quot;L&quot;)}Z`)
      .on(&quot;click&quot;, () =&gt; {
        if (
          this.vars.velocity?.toString() === this.config.zeroVelocity.toString()
        ) {
          this.vars.velocity = this.config.defaultVelocity

          return
        }

        this.vars.velocity = this.config.zeroVelocity
      })

    return null
  }
}

export default () =&gt; {
  const chart = new Icosahedron({
    rootElId: &quot;chart&quot;,
  })

  chart.start()
}
</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Sun, 25 Jul 2021 12:25:55 GMT</p>
    </body>
  </html>
  