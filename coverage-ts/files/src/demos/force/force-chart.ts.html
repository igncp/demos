
  <!DOCTYPE html>
  <html>
    <head>
      <title>force-chart.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src/demos/force/force-chart.ts</td><td class="">100.00%</td><td class="">95%</td><td class="">357</td><td class="">357</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import {
  Selection,
  Simulation,
  drag,
  forceCenter,
  forceLink as forceLinkD3,
  forceManyBody,
  forceSimulation,
  select,
} from &quot;d3&quot;

import * as styles from &quot;./force.module.css&quot;

type Node&lt;NodeData&gt; = NodeData &amp; {
  fx: number | null
  fy: number | null
  index: number // eslint-disable-line id-denylist
  x: number
  y: number
}

type Link&lt;NodeData&gt; = {
  source: Node&lt;NodeData&gt;
  target: Node&lt;NodeData&gt;
}

type ForceData&lt;NodeData&gt; = {
  links: Array&lt;Link&lt;NodeData&gt;&gt;
  nodes: Array&lt;Node&lt;NodeData&gt;&gt;
}

type CustomDragEvent = DragEvent &amp; { active: boolean }

const settings = {
  circleRadius: 5,
  defaultTextOpacity: 0.5,
  strength: -40,
  textDY: 5,
}

type ChartConfig&lt;NodeData&gt; = {
  forceData: ForceData&lt;NodeData&gt;
  getNodeText: (node: Node&lt;NodeData&gt;) =&gt; string
  height: number
  rootElId: string
}

type ChartElements = {
  svg: Selection&lt;SVGSVGElement, unknown, HTMLElement, unknown&gt;
}

class ForceChart&lt;NodeData&gt; {
  private readonly config: ChartConfig&lt;NodeData&gt;
  private readonly simulation: Simulation&lt;Node&lt;NodeData&gt;, undefined&gt;
  private readonly elements: ChartElements

  public constructor(config: ChartConfig&lt;NodeData&gt;) {
    this.config = config

    const { forceData, height, rootElId } = config
    const { links, nodes } = forceData

    const rootEl = document.getElementById(rootElId) as HTMLElement

    rootEl.classList.add(styles.forceChart)

    const { width } = rootEl.getBoundingClientRect()

    const svg = select(`#${rootElId}`)
      .append(&quot;svg&quot;)
      .attr(&quot;width&quot;, width)
      .attr(&quot;height&quot;, height)

    this.elements = { svg }

    this.simulation = forceSimulation(nodes)
      .force(&quot;charge&quot;, forceManyBody().strength(settings.strength))
      .force(&quot;center&quot;, forceCenter(width / 2, height / 2))
      .force(&quot;link&quot;, forceLinkD3().links(links))
      .on(&quot;tick&quot;, () =&gt; {
        this.updateLinks()
        this.updateNodes()
      })
  }

  private updateLinks() {
    const {
      config: { forceData },
      elements: { svg },
    } = this
    const { links } = forceData
    const linksEls = svg
      .selectAll&lt;SVGPathElement, ForceData&lt;NodeData&gt;[&quot;links&quot;]&gt;(
        `.${styles.linkCurved}`
      )
      .data(links)

    linksEls
      .enter()
      .append&lt;SVGPathElement&gt;(&quot;path&quot;)
      .merge(linksEls)
      .attr(&quot;d&quot;, (forceLink) =&gt; {
        const dx = forceLink.target.x - forceLink.source.x
        const dy = forceLink.target.y - forceLink.source.y
        const dr = Math.sqrt(dx * dx + dy * dy) * 1.3

        return `M${forceLink.source.x},${forceLink.source.y}A${dr},${dr} 0 0,1 ${forceLink.target.x},${forceLink.target.y}`
      })
      .attr(&quot;class&quot;, styles.linkCurved)
      .attr(&quot;marker-end&quot;, &quot;url(#end)&quot;)
      .attr(&quot;id&quot;, (...[, forceLinkIndex]) =&gt; `link-${forceLinkIndex}`)

    linksEls.exit().remove()
  }

  private updateNodes() {
    const {
      config: { forceData, getNodeText },
      elements: { svg },
    } = this
    const { nodes } = forceData
    const nodesEls = svg
      .selectAll&lt;SVGCircleElement, ForceData&lt;NodeData&gt;[&quot;nodes&quot;]&gt;(&quot;circle&quot;)
      .data(nodes)
    const textsEls = svg
      .selectAll&lt;SVGTextElement, ForceData&lt;NodeData&gt;[&quot;nodes&quot;]&gt;(&quot;text&quot;)
      .data(nodes)

    const dragstarted = (
      ...[dragEvent, forceNode]: [CustomDragEvent, Node&lt;NodeData&gt;]
    ) =&gt; {
      if (!dragEvent.active) {
        this.simulation.alphaTarget(0.3).restart()
      }

      forceNode.fx = forceNode.x
      forceNode.fy = forceNode.y
    }

    const dragged = (
      ...[dragEvent, forceNode]: [CustomDragEvent, Node&lt;NodeData&gt;]
    ) =&gt; {
      forceNode.fx = dragEvent.x
      forceNode.fy = dragEvent.y
    }

    const dragended = (
      ...[dragEvent, forceNode]: [CustomDragEvent, Node&lt;NodeData&gt;]
    ) =&gt; {
      if (!dragEvent.active) {
        this.simulation.alphaTarget(0)
      }

      forceNode.fx = null
      forceNode.fy = null
    }

    nodesEls
      .enter()
      .append(&quot;circle&quot;)
      .merge(nodesEls)
      .attr(&quot;cx&quot;, (forceNode) =&gt; forceNode.x)
      .attr(&quot;cy&quot;, (forceNode) =&gt; forceNode.y)
      .attr(&quot;r&quot;, () =&gt; settings.circleRadius)
      .attr(&quot;fill&quot;, &quot;black&quot;)
      .each(function setupMouseHandlers() {
        select&lt;SVGCircleElement, ForceData&lt;NodeData&gt;[&quot;nodes&quot;][0]&gt;(this)
          .on(&quot;mouseover&quot;, (...[, forceNode]) =&gt; {
            select(`#node-text-${forceNode.index}`).style(&quot;opacity&quot;, 1)
          })
          .on(&quot;mouseleave&quot;, (...[, forceNode]) =&gt; {
            select(`#node-text-${forceNode.index}`).style(
              &quot;opacity&quot;,
              settings.defaultTextOpacity
            )
          })
      })
      .call(
        drag&lt;SVGCircleElement, ForceData&lt;NodeData&gt;[&quot;nodes&quot;][0]&gt;()
          .on(&quot;start&quot;, dragstarted)
          .on(&quot;drag&quot;, dragged)
          .on(&quot;end&quot;, dragended)
      )

    textsEls
      .enter()
      .append(&quot;text&quot;)
      .merge(textsEls)
      .text(getNodeText)
      .attr(&quot;x&quot;, (forceNode) =&gt; forceNode.x)
      .attr(&quot;y&quot;, (forceNode) =&gt; forceNode.y)
      .attr(&quot;dy&quot;, () =&gt; settings.textDY)
      .attr(&quot;id&quot;, (forceNode) =&gt; `node-text-${forceNode.index}`)
      .style(&quot;opacity&quot;, settings.defaultTextOpacity)

    nodesEls.exit().remove()
    textsEls.exit().remove()
  }
}

export { ChartConfig, ForceChart }
</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Mon, 10 Jan 2022 23:24:52 GMT</p>
    </body>
  </html>
  