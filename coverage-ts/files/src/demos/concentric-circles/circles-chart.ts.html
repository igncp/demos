
  <!DOCTYPE html>
  <html>
    <head>
      <title>circles-chart.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src/demos/concentric-circles/circles-chart.ts</td><td class="">100.00%</td><td class="">95%</td><td class="">302</td><td class="">302</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import { Selection, extent, max, range, scaleLinear, select } from &quot;d3&quot;
import { v1 as uuidv1 } from &quot;uuid&quot;

const colours = [&quot;#7c7cc9&quot;, &quot;#52d552&quot;, &quot;#337233&quot;, &quot;#323247&quot;]

const margin = {
  bottom: 20,
  left: 20,
  right: 20,
  top: 20,
}
const strokeWidth = &quot;2px&quot;

const addFilter = &lt;ChartData&gt;(
  svg: Selection&lt;SVGGElement, ChartData, HTMLElement, unknown&gt;
) =&gt; {
  const defs = svg.append(&quot;defs&quot;)
  const filter = defs.append(&quot;filter&quot;)

  filter.attr(&quot;id&quot;, &quot;drop-shadow&quot;)
  filter
    .append(&quot;feGaussianBlur&quot;)
    .attr(&quot;in&quot;, &quot;SourceAlpha&quot;)
    .attr(&quot;stdDeviation&quot;, 9)
  filter.append(&quot;feOffset&quot;).attr(&quot;dx&quot;, 5).attr(&quot;dy&quot;, 5)
  filter
    .append(&quot;feComponentTransfer&quot;)
    .append(&quot;feFuncA&quot;)
    .attr(&quot;slope&quot;, &quot;.3&quot;)
    .attr(&quot;type&quot;, &quot;linear&quot;)

  const feMerge = filter.append(&quot;feMerge&quot;)

  feMerge.append(&quot;feMergeNode&quot;)
  feMerge.append(&quot;feMergeNode&quot;).attr(&quot;in&quot;, &quot;SourceGraphic&quot;)
}

type ChartConfig&lt;ChartData&gt; = Readonly&lt;{
  chartDescription: string
  getCircleId: (circle: ChartData) =&gt; string
  getCircleTitle: (circle: ChartData) =&gt; string
  getCircleValue: (circle: ChartData) =&gt; number
  getCirclesData: () =&gt; ChartData[]
  rootElId: string
}&gt;

type ChartElements&lt;ChartData&gt; = Readonly&lt;{
  descriptionSel: Selection&lt;SVGTextElement, ChartData, HTMLElement, unknown&gt;
  gSel: Selection&lt;SVGGElement, ChartData, HTMLElement, unknown&gt;
  svgSel: Selection&lt;SVGSVGElement, ChartData, HTMLElement, unknown&gt;
}&gt;

class CirclesChart&lt;ChartData&gt; {
  private readonly config: ChartConfig&lt;ChartData&gt;
  private readonly elements: ChartElements&lt;ChartData&gt;
  private readonly circleClass: string

  private constructor(config: ChartConfig&lt;ChartData&gt;) {
    this.config = config

    const svgSel = select&lt;HTMLElement, ChartData&gt;(`#${config.rootElId}`).append(
      &quot;svg&quot;
    )
    const gSel = svgSel.append(&quot;g&quot;)
    const descriptionSel = gSel
      .append(&quot;text&quot;)
      .attr(&quot;text-anchor&quot;, &quot;middle&quot;)
      .attr(&quot;width&quot;, &quot;20px&quot;)

    this.circleClass = `name-circle-${uuidv1().slice(0, 6)}`

    this.elements = {
      descriptionSel,
      gSel,
      svgSel,
    }

    addFilter&lt;ChartData&gt;(gSel)

    this.render()

    window.addEventListener(&quot;resize&quot;, this.handleResize)
  }

  public static renderChart&lt;ChartData&gt;(config: ChartConfig&lt;ChartData&gt;) {
    return new CirclesChart(config)
  }

  public teardown() {
    window.removeEventListener(&quot;resize&quot;, this.handleResize)
  }

  public refresh() {
    this.render()
  }

  private render() {
    const {
      config: {
        chartDescription,
        getCircleId,
        getCircleTitle,
        getCircleValue,
        getCirclesData,
        rootElId,
      },
      elements,
    } = this

    const circlesData = getCirclesData()

    const colorScale = scaleLinear()
      .domain(extent(circlesData, getCircleValue) as [number, number])
      .range([0, 1])

    const heatmapColour = scaleLinear&lt;string&gt;()
      .domain(range(0, 1, 1.0 / colours.length))
      .range(colours)

    const colorize = (circle: ChartData) =&gt; {
      const circleValue = getCircleValue(circle)
      const colorNormalized = colorScale(circleValue)

      return heatmapColour(colorNormalized)
    }

    const dataMax = max(circlesData, getCircleValue) as number

    const rootEl = document.getElementById(rootElId) as HTMLElement
    const { width: elWidth } = rootEl.getBoundingClientRect()

    const width = elWidth - margin.left - margin.right
    const height = max(circlesData, getCircleValue)! * 2.5

    elements.svgSel
      .attr(&quot;width&quot;, width + margin.left + margin.right)
      .attr(&quot;height&quot;, height + margin.left + margin.right)

    const groupUpdates = elements.gSel
      .selectAll&lt;SVGGElement, ChartData&gt;(&quot;.circle-group&quot;)
      .data(circlesData, getCircleId)

    groupUpdates
      .enter()
      .append(&quot;g&quot;)
      .attr(&quot;class&quot;, &quot;circle-group&quot;)
      .append(&quot;circle&quot;)
      .attr(&quot;class&quot;, this.circleClass)

    groupUpdates.exit().remove()

    elements.gSel
      .selectAll&lt;SVGCircleElement, ChartData&gt;(`.${this.circleClass}`)
      .attr(&quot;cx&quot;, width / 2)
      .attr(&quot;cy&quot;, height / 2)
      .attr(&quot;title&quot;, getCircleTitle)
      .style(&quot;fill&quot;, &quot;none&quot;)
      .style(&quot;stroke&quot;, colorize)
      .style(&quot;stroke-width&quot;, strokeWidth)
      .style(&quot;filter&quot;, (circle) =&gt;
        getCircleValue(circle) &gt; dataMax / 2.5 ? &quot;url(#drop-shadow)&quot; : &quot;&quot;
      )
      .on(&quot;mouseenter&quot;, function onMouseOver() {
        select(this).style(&quot;stroke&quot;, &quot;#D88021&quot;).style(&quot;stroke-width&quot;, &quot;10px&quot;)
      })
      .on(&quot;mouseleave&quot;, function onMouseLeave() {
        select&lt;SVGCircleElement, ChartData&gt;(this)
          .style(&quot;stroke&quot;, colorize)
          .style(&quot;stroke-width&quot;, strokeWidth)
      })
      .attr(&quot;r&quot;, (...[, circleIndex]) =&gt; `${circleIndex / 5}px`)

    $(`.${this.circleClass}`).tooltip({
      track: true,
    })

    elements.descriptionSel
      .text(chartDescription)
      .attr(&quot;transform&quot;, `translate(${width / 2},${height - 10})`)
  }

  private readonly handleResize = () =&gt; {
    this.render()
  }
}

export { CirclesChart, ChartConfig }
</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Fri, 05 Nov 2021 00:36:52 GMT</p>
    </body>
  </html>
  