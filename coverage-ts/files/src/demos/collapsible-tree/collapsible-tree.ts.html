
  <!DOCTYPE html>
  <html>
    <head>
      <title>collapsible-tree.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src/demos/collapsible-tree/collapsible-tree.ts</td><td class="">100.00%</td><td class="">95%</td><td class="">382</td><td class="">382</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import {
  HierarchyNode,
  HierarchyPointLink,
  HierarchyPointNode,
  hierarchy,
  json,
  linkHorizontal,
  select,
  tree as treeD3,
} from &quot;d3&quot;

import * as styles from &quot;./collapsible-tree.module.css&quot;

type DataNode = {
  _children: Array&lt;HierarchyPointNode&lt;DataNode&gt;&gt; | undefined
  children: DataNode[]
  id: number
  name: string
  x: number
  x0: number
  y: number
  y0: number
}
type HierarchyDataNode = HierarchyNode&lt;DataNode&gt;
type TreeNode = HierarchyPointNode&lt;DataNode&gt;
type TreeLink = HierarchyPointLink&lt;DataNode&gt;

type DiagonalNode = { x: number; y: number }
type DiagonalLink = { source: DiagonalNode; target: DiagonalNode }

const fetchData = async (): Promise&lt;DataNode&gt; =&gt;
  json(`${ROOT_PATH}data/d3js/collapsible-tree/data.json`) as Promise&lt;DataNode&gt;

const margin = {
  bottom: 20,
  left: 120,
  right: 120,
  top: 20,
}

const duration = 750
const height = 800 - margin.top - margin.bottom

type RenderChart = (o: { rootData: DataNode; rootElId: string }) =&gt; void

const renderChart: RenderChart = ({ rootData, rootElId }) =&gt; {
  const root = hierarchy&lt;DataNode&gt;(rootData)

  const rootEl = document.getElementById(rootElId) as HTMLElement

  rootEl.classList.add(styles.collapsibleTreeChart)

  const width =
    rootEl.getBoundingClientRect().width - margin.right - margin.left

  root.data.x0 = height / 2
  root.data.y0 = 0

  const tree = treeD3&lt;DataNode&gt;().nodeSize([20, 100])

  const rootTree = tree(root)

  rootTree
    .descendants()
    .forEach((...[treeNode, treeNodeIndex]: [TreeNode, number]) =&gt; {
      treeNode.data.id = treeNodeIndex
      treeNode.data._children = treeNode.children

      if (treeNode.depth) {
        treeNode.children = undefined
      }
    })

  const diagonal = linkHorizontal&lt;DiagonalLink, DiagonalNode&gt;()
    .x((diagonalNode) =&gt; diagonalNode.y)
    .y((diagonalNode) =&gt; diagonalNode.x)

  const svg = select&lt;SVGElement, TreeNode&gt;(`#${rootElId}`)
    .append(&quot;svg&quot;)
    .attr(&quot;width&quot;, width + margin.right + margin.left)
    .attr(&quot;height&quot;, height + margin.top + margin.bottom)
    .append(&quot;g&quot;)
    .attr(&quot;transform&quot;, `translate(${margin.left},${height / 2})`)

  const gLink = svg
    .append(&quot;g&quot;)
    .attr(&quot;fill&quot;, &quot;none&quot;)
    .attr(&quot;stroke&quot;, &quot;#555&quot;)
    .attr(&quot;stroke-opacity&quot;, 0.4)
    .attr(&quot;stroke-width&quot;, 1.5)

  const gNode = svg
    .append(&quot;g&quot;)
    .attr(&quot;cursor&quot;, &quot;pointer&quot;)
    .attr(&quot;pointer-events&quot;, &quot;all&quot;)

  const update = function (source: TreeNode) {
    const nodes = rootTree.descendants().reverse()
    const links = rootTree.links()

    tree(root)

    let left = root
    let right = root

    root.eachBefore((node: HierarchyDataNode) =&gt; {
      if (node.data.x &lt; left.data.x) {
        left = node
      }

      if (node.data.x &gt; right.data.x) {
        right = node
      }
    })

    const node = gNode
      .selectAll&lt;SVGGElement, TreeNode&gt;(&quot;g&quot;)
      .data(nodes, (treeNode) =&gt; treeNode.data.id)

    const nodeEnter = node
      .enter()
      .append(&quot;g&quot;)
      .attr(&quot;transform&quot;, () =&gt; `translate(${source.data.y0},${source.data.x0})`)
      .attr(&quot;fill-opacity&quot;, 0)
      .attr(&quot;stroke-opacity&quot;, 0)
      .on(&quot;click&quot;, (...[, treeNode]) =&gt; {
        treeNode.children = treeNode.children
          ? undefined
          : treeNode.data._children

        update(treeNode)
      })

    nodeEnter
      .append(&quot;circle&quot;)
      .attr(&quot;r&quot;, 2.5)
      .attr(&quot;fill&quot;, (treeNode) =&gt; (treeNode.data._children ? &quot;#555&quot; : &quot;#999&quot;))
      .attr(&quot;stroke-width&quot;, 10)

    nodeEnter
      .append(&quot;text&quot;)
      .attr(&quot;dy&quot;, &quot;0.31em&quot;)
      .attr(&quot;x&quot;, (treeNode) =&gt; (treeNode.data._children ? -6 : 6))
      .attr(&quot;text-anchor&quot;, (treeNode) =&gt;
        treeNode.data._children ? &quot;end&quot; : &quot;start&quot;
      )
      .text((treeNode) =&gt; treeNode.data.name)
      .clone(true)
      .lower()
      .attr(&quot;stroke-linejoin&quot;, &quot;round&quot;)
      .attr(&quot;stroke-width&quot;, 3)
      .attr(&quot;stroke&quot;, &quot;white&quot;)

    node
      .merge(nodeEnter)
      .transition()
      .duration(duration)
      .attr(&quot;transform&quot;, (treeNode) =&gt; `translate(${treeNode.y},${treeNode.x})`)
      .attr(&quot;fill-opacity&quot;, 1)
      .attr(&quot;stroke-opacity&quot;, 1)

    node
      .exit()
      .transition()
      .duration(duration)
      .remove()
      .attr(&quot;transform&quot;, () =&gt; `translate(${source.y},${source.x})`)
      .attr(&quot;fill-opacity&quot;, 0)
      .attr(&quot;stroke-opacity&quot;, 0)

    const link = gLink
      .selectAll&lt;SVGPathElement, TreeLink&gt;(&quot;path&quot;)
      .data(links, (treeLink) =&gt; treeLink.target.data.id)

    const linkEnter = link
      .enter()
      .append(&quot;path&quot;)
      .attr(&quot;d&quot;, () =&gt; {
        const o = {
          x: source.data.x0,
          y: source.data.y0,
        }

        return diagonal({ source: o, target: o })
      })

    link.merge(linkEnter).transition().duration(duration).attr(&quot;d&quot;, diagonal)

    link
      .exit()
      .transition()
      .duration(duration)
      .remove()
      .attr(&quot;d&quot;, () =&gt; {
        const o = { x: source.x, y: source.y }

        return diagonal({ source: o, target: o })
      })

    rootTree.eachBefore((treeNode) =&gt; {
      treeNode.data.x0 = treeNode.x
      treeNode.data.y0 = treeNode.y
    })
  }

  update(rootTree)
}

const main = async () =&gt; {
  const rootElId = &quot;chart&quot;

  const rootData = await fetchData()

  renderChart({
    rootData,
    rootElId,
  })
}

export default main
</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Sun, 29 Aug 2021 14:34:47 GMT</p>
    </body>
  </html>
  