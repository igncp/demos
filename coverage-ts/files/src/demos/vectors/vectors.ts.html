
  <!DOCTYPE html>
  <html>
    <head>
      <title>vectors.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src/demos/vectors/vectors.ts</td><td class="">94.48%</td><td class="">90%</td><td class="">471</td><td class="">445</td><td class="">26</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import {
  Selection,
  SimulationNodeDatum,
  drag,
  forceCenter,
  forceLink,
  forceManyBody,
  forceSimulation,
  select,
} from &quot;d3&quot;

import * as styles from &quot;./vectors.module.css&quot;

// missing:
// - connect nodes
// - drag node
// - keys handling
// old one is in ./vectors-old/vectors-old.js, remove when completed

type Node = SimulationNodeDatum &amp; {
  id: string
  reflexive: boolean
}

type Link = {
  left: boolean
  right: boolean
  source: Node
  target: Node
}

type Data = {
  links: Link[]
  nodes: Node[]
}

const getInitialData = (): Data =&gt; {
  const nodes = [
    {
      id: &quot;A&quot;,
      reflexive: false,
    },
    {
      id: &quot;B&quot;,
      reflexive: false,
    },
    {
      id: &quot;C&quot;,
      reflexive: false,
    },
  ]
  const links = [
    {
      left: false,
      right: true,
      source: nodes[0],
      target: nodes[1],
    },
    {
      left: false,
      right: true,
      source: nodes[1],
      target: nodes[2],
    },
  ]

  return {
    links,
    nodes,
  }
}

const setupSVG = (
  svg: Selection&lt;SVGSVGElement, unknown, HTMLElement, unknown&gt;
) =&gt; {
  svg
    .append(&quot;svg:defs&quot;)
    .append(&quot;svg:marker&quot;)
    .attr(&quot;id&quot;, &quot;end-arrow&quot;)
    .attr(&quot;viewBox&quot;, &quot;0 -5 10 10&quot;)
    .attr(&quot;refX&quot;, 6)
    .attr(&quot;markerWidth&quot;, 3)
    .attr(&quot;markerHeight&quot;, 3)
    .attr(&quot;orient&quot;, &quot;auto&quot;)
    .append(&quot;svg:path&quot;)
    .attr(&quot;d&quot;, &quot;M0,-5L10,0L0,5&quot;)
    .attr(&quot;fill&quot;, &quot;#000&quot;)

  svg
    .append(&quot;svg:defs&quot;)
    .append(&quot;svg:marker&quot;)
    .attr(&quot;id&quot;, &quot;start-arrow&quot;)
    .attr(&quot;viewBox&quot;, &quot;0 -5 10 10&quot;)
    .attr(&quot;refX&quot;, 4)
    .attr(&quot;markerWidth&quot;, 3)
    .attr(&quot;markerHeight&quot;, 3)
    .attr(&quot;orient&quot;, &quot;auto&quot;)
    .append(&quot;svg:path&quot;)
    .attr(&quot;d&quot;, &quot;M10,-5L0,0L10,5&quot;)
    .attr(&quot;fill&quot;, &quot;#000&quot;)
}

type CustomDragEvent = DragEvent &amp; { active: boolean }

const settings = {
  circleRadius: 5,
  defaultTextOpacity: 0.5,
  strength: -5000,
  textDY: 5,
}

const height = 600

type RenderGraph = (o: { data: Data; rootElId: string }) =&gt; void

const renderGraph: RenderGraph = ({ data, rootElId }) =&gt; {
  const { links, nodes } = data

  const rootEl = document.getElementById(rootElId) as HTMLElement

  rootEl.classList.add(styles.vectorsChart)

  const { width } = rootEl.getBoundingClientRect()

  // @TODO
  let lastNodeId = &quot;C&quot;.charCodeAt(0)

  const ticked = () =&gt; {
    updateLinks()
    updateNodes()
  }

  let mousedownLink: any = null
  let mousedownNode: any = null
  let mouseupNode: any = null

  const resetMouseVars = () =&gt; {
    mousedownNode = null
    mouseupNode = null
    mousedownLink = null
  }

  const simulation = forceSimulation(nodes)
    .force(&quot;charge&quot;, forceManyBody().strength(-50))
    .force(&quot;center&quot;, forceCenter(width / 2, height / 2))
    .force(&quot;link&quot;, forceLink().links(links).distance(100))
    .on(&quot;tick&quot;, ticked)

  const svg = select(`#${rootElId}`)
    .append(&quot;svg&quot;)
    .attr(&quot;width&quot;, width)
    .attr(&quot;height&quot;, height)

  setupSVG(svg)

  svg
    .selectAll(`.${styles.link}`)
    .data(links)
    .enter()
    .append(&quot;svg:path&quot;)
    .attr(&quot;class&quot;, styles.link)
    .attr(&quot;marker-end&quot;, &quot;url(#end)&quot;)
    .attr(&quot;id&quot;, (_d, i) =&gt; `link-${i}`)

  const updateLinks = () =&gt; {
    const linksEls = svg
      .selectAll&lt;SVGPathElement, Data[&quot;links&quot;]&gt;(`.${styles.link}`)
      .data(links)

    linksEls
      .enter()
      .append&lt;SVGPathElement&gt;(&quot;path&quot;)
      .merge(linksEls)
      .attr(&quot;d&quot;, (d) =&gt; {
        const deltaX = d.target.x! - d.source.x!
        const deltaY = d.target.y! - d.source.y!
        const dist = Math.sqrt(deltaX * deltaX + deltaY * deltaY)
        const normX = deltaX / dist
        const normY = deltaY / dist
        const sourcePadding = d.left ? 17 : 12
        const targetPadding = d.right ? 17 : 12
        const sourceX = d.source.x! + sourcePadding * normX
        const sourceY = d.source.y! + sourcePadding * normY
        const targetX = d.target.x! - targetPadding * normX
        const targetY = d.target.y! - targetPadding * normY

        return `M${sourceX},${sourceY}L${targetX},${targetY}`
      })
      .attr(&quot;class&quot;, `${styles.link} ${styles.dragline}`)

    linksEls.exit().remove()
  }

  const updateNodes = () =&gt; {
    const nodesEls = svg
      .selectAll&lt;SVGCircleElement, Data[&quot;nodes&quot;]&gt;(&quot;circle&quot;)
      .data(nodes)
    const textsEls = svg
      .selectAll&lt;SVGTextElement, Data[&quot;nodes&quot;]&gt;(&quot;text&quot;)
      .data(nodes)

    nodesEls
      .enter()
      .append(&quot;circle&quot;)
      .merge(nodesEls)
      .attr(&quot;cx&quot;, (d) =&gt; d.x!)
      .attr(&quot;cy&quot;, (d) =&gt; d.y!)
      .attr(&quot;r&quot;, () =&gt; settings.circleRadius)
      .attr(&quot;fill&quot;, &quot;#fff&quot;)
      .each(function () {
        select&lt;SVGCircleElement, Data[&quot;nodes&quot;][0]&gt;(this)
          .on(&quot;mouseover&quot;, (_ev, d) =&gt; {
            select(`#node-text-${d.index}`).style(&quot;opacity&quot;, 1)
          })
          .on(&quot;mouseleave&quot;, (_ev, d) =&gt; {
            select(`#node-text-${d.index}`).style(
              &quot;opacity&quot;,
              settings.defaultTextOpacity
            )
          })
      })
      .call(
        drag&lt;SVGCircleElement, Data[&quot;nodes&quot;][0]&gt;()
          .on(&quot;start&quot;, dragstarted)
          .on(&quot;drag&quot;, dragged)
          .on(&quot;end&quot;, dragended)
      )

    textsEls
      .enter()
      .append(&quot;text&quot;)
      .merge(textsEls)
      .text((d) =&gt; d.id)
      .attr(&quot;x&quot;, (d) =&gt; d.x!)
      .attr(&quot;y&quot;, (d) =&gt; d.y!)
      .attr(&quot;class&quot;, styles.id)

    nodesEls.exit().remove()
    textsEls.exit().remove()
  }

  const dragstarted = (event: CustomDragEvent, d: Node) =&gt; {
    if (!event.active) simulation.alphaTarget(0.3).restart()
    d.fx = d.x
    d.fy = d.y
  }

  const dragged = (event: CustomDragEvent, d: Node) =&gt; {
    d.fx = event.x
    d.fy = event.y
  }

  const dragended = (event: CustomDragEvent, d: Node) =&gt; {
    if (!event.active) simulation.alphaTarget(0)
    d.fx = null
    d.fy = null
  }

  const keydown = function () {
    console.log(&quot;keydown&quot;) // eslint-disable-line no-console
  }

  const keyup = function () {
    console.log(&quot;keyup&quot;) // eslint-disable-line no-console
  }

  const mousedownSVG = (evt: any) =&gt; {
    svg.classed(styles.active, true)

    if (evt.ctrlKey || mousedownNode || mousedownLink) {
      return
    }

    const { target: e } = evt

    const dim = e.getBoundingClientRect()
    const x = evt.clientX - dim.left
    const y = evt.clientY - dim.top

    const node = {
      id: String.fromCharCode(++lastNodeId),
      index: nodes.length,
      reflexive: false,
      vx: 0,
      vy: 0,
      x,
      y,
    }

    nodes.push(node)

    simulation.nodes(nodes)
    simulation.alpha(0.5).restart()
  }

  const mousemoveSVG = () =&gt; {
    console.log(&quot;mousemoveSVG&quot;) // eslint-disable-line no-console
  }

  const mouseupSVG = () =&gt; {
    console.log(&quot;mouseupSVG&quot;, mouseupNode) // eslint-disable-line no-console
    resetMouseVars()
  }

  svg
    .on(&quot;mousedown&quot;, mousedownSVG)
    .on(&quot;mousemove&quot;, mousemoveSVG)
    .on(&quot;mouseup&quot;, mouseupSVG)

  window.addEventListener(&quot;keyup&quot;, keyup)
  window.addEventListener(&quot;keydown&quot;, keydown)
}

const main = () =&gt; {
  const data = getInitialData()

  renderGraph({
    data,
    rootElId: &quot;chart&quot;,
  })

  return Promise.resolve()
}

export default main
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:132,&quot;character&quot;:6,&quot;text&quot;:&quot;mousedownLink&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:133,&quot;character&quot;:6,&quot;text&quot;:&quot;mousedownNode&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:134,&quot;character&quot;:6,&quot;text&quot;:&quot;mouseupNode&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:137,&quot;character&quot;:4,&quot;text&quot;:&quot;mousedownNode&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:138,&quot;character&quot;:4,&quot;text&quot;:&quot;mouseupNode&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:139,&quot;character&quot;:4,&quot;text&quot;:&quot;mousedownLink&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:211,&quot;character&quot;:28,&quot;text&quot;:&quot;_ev&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:214,&quot;character&quot;:29,&quot;text&quot;:&quot;_ev&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:266,&quot;character&quot;:24,&quot;text&quot;:&quot;evt&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:269,&quot;character&quot;:8,&quot;text&quot;:&quot;evt&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:269,&quot;character&quot;:12,&quot;text&quot;:&quot;ctrlKey&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:269,&quot;character&quot;:23,&quot;text&quot;:&quot;mousedownNode&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:269,&quot;character&quot;:40,&quot;text&quot;:&quot;mousedownLink&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:273,&quot;character&quot;:20,&quot;text&quot;:&quot;e&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:275,&quot;character&quot;:10,&quot;text&quot;:&quot;dim&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:275,&quot;character&quot;:16,&quot;text&quot;:&quot;e&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:275,&quot;character&quot;:18,&quot;text&quot;:&quot;getBoundingClientRect&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:276,&quot;character&quot;:14,&quot;text&quot;:&quot;evt&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:276,&quot;character&quot;:18,&quot;text&quot;:&quot;clientX&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:276,&quot;character&quot;:28,&quot;text&quot;:&quot;dim&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:276,&quot;character&quot;:32,&quot;text&quot;:&quot;left&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:277,&quot;character&quot;:14,&quot;text&quot;:&quot;evt&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:277,&quot;character&quot;:18,&quot;text&quot;:&quot;clientY&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:277,&quot;character&quot;:28,&quot;text&quot;:&quot;dim&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:277,&quot;character&quot;:32,&quot;text&quot;:&quot;top&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/vectors/vectors.ts&quot;,&quot;line&quot;:300,&quot;character&quot;:30,&quot;text&quot;:&quot;mouseupNode&quot;,&quot;kind&quot;:1}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Wed, 04 Aug 2021 07:35:59 GMT</p>
    </body>
  </html>
  