
  <!DOCTYPE html>
  <html>
    <head>
      <title>map-distorsions.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src/demos/map-distorsions/map-distorsions.ts</td><td class="">97.21%</td><td class="">90%</td><td class="">359</td><td class="">349</td><td class="">10</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import * as d3 from &quot;d3&quot;
import sortBy from &quot;lodash/sortBy&quot;

import d3utils from &quot;@/demos/_utils/d3utils&quot;

import &quot;./map-distorsions.styl&quot;

type Data = {
  &quot;Acc. 40ยบ 150%&quot;: string
  Angular: string
  Areal: string
  Scale: string
  name: string
}

const fetchData = (): Promise&lt;Data[]&gt; =&gt;
  d3.tsv(`${ROOT_PATH}data/d3js/map-distorsions/data.tsv`) as Promise&lt;any&gt;

const margin = {
  bottom: 20,
  left: 200,
  right: 40,
  top: 90,
}
const height = 750 - margin.top - margin.bottom

const colors = [&quot;#7C7CC9&quot;, &quot;#429742&quot;, &quot;#63BD28&quot;, &quot;#D14141&quot;]

const texts = {
  title:
    &quot;Comparison of 41 map projections by four different types of distortion. Lower is better.&quot;,
}

type RenderChart = (o: { data: Data[]; rootElId: string }) =&gt; void

type Dimension = {
  name: string
  scale: any
  type: Function
}

const renderChart: RenderChart = ({ data, rootElId }) =&gt; {
  const rootEl = document.getElementById(rootElId) as HTMLElement

  rootEl.classList.add(&quot;map-distorsions-chart&quot;)

  const width =
    rootEl.getBoundingClientRect().width - margin.left - margin.right

  const dimensions: Dimension[] = [
    {
      name: &quot;name&quot;,
      scale: d3.scalePoint().range([0, height]),
      type: String,
    },
    {
      name: &quot;Acc. 40ยบ 150%&quot;,
      scale: d3.scaleLinear().range([0, height]),
      type: Number,
    },
    {
      name: &quot;Scale&quot;,
      scale: d3.scaleLinear().range([height, 0]),
      type: Number,
    },
    {
      name: &quot;Areal&quot;,
      scale: d3.scaleSqrt().range([height, 0]),
      type: Number,
    },
    {
      name: &quot;Angular&quot;,
      scale: d3.scaleLinear().range([height, 0]),
      type: Number,
    },
  ]

  const svg = d3utils.svg(`#${rootElId}`, width, height, margin)

  d3utils.middleTitle(svg, width, texts.title, -60)

  const x = d3
    .scalePoint()
    .domain(dimensions.map((d) =&gt; d.name))
    .range([0, width])

  const line = d3.line().defined((d) =&gt; !isNaN(d[1]))

  const dimension = svg
    .selectAll(&quot;.dimension&quot;)
    .data(dimensions)
    .enter()
    .append(&quot;g&quot;)
    .attr(&quot;class&quot;, &quot;dimension&quot;)
    .attr(&quot;transform&quot;, (d) =&gt; `translate(${x(d.name)})`)

  d3utils.filterColor(&quot;lines&quot;, svg, 2, 0.4)

  const sortedData: Data[] = sortBy&lt;Data&gt;(data, &quot;name&quot;)
  const colorFn = d3utils.colorsScale(colors, [0, sortedData.length - 1])

  dimensions.forEach((dimItem: Dimension) =&gt;
    dimItem.scale.domain(
      dimItem.type === Number
        ? d3.extent(sortedData, (d: Data) =&gt; +d[dimItem.name as keyof Data])
        : sortedData.map((d: Data) =&gt; d[dimItem.name as keyof Data]).sort()
    )
  )

  const draw = function (d: any) {
    return line(
      dimensions.map((dimItem) =&gt; [
        x(dimItem.name),
        dimItem.scale(d[dimItem.name]),
      ]) as any
    )
  }

  const tooltipText = function (d: Data) {
    const keys = [
      &quot;Acc. 40ยบ 150%&quot;,
      &quot;Scale&quot;,
      &quot;Areal&quot;,
      &quot;Angular&quot;,
    ] as (keyof Data)[]
    const vals = keys.map((item) =&gt; String(Number(d[item]).toFixed(2)))

    return `${d.name}:  ${vals.join(&quot; - &quot;)}`
  }

  svg
    .append(&quot;g&quot;)
    .attr(&quot;class&quot;, &quot;background&quot;)
    .selectAll(&quot;path&quot;)
    .data&lt;Data&gt;(sortedData)
    .enter()
    .append(&quot;path&quot;)
    .attr(&quot;d&quot;, draw)
    .attr(&quot;data-title&quot;, tooltipText)

  svg
    .append(&quot;g&quot;)
    .attr(&quot;class&quot;, &quot;foreground&quot;)
    .selectAll(&quot;path&quot;)
    .data(sortedData)
    .enter()
    .append(&quot;path&quot;)
    .attr(&quot;d&quot;, draw)
    .attr(&quot;data-title&quot;, tooltipText)

  dimension
    .append(&quot;g&quot;)
    .attr(&quot;class&quot;, &quot;axis&quot;)
    .each(function (d: Dimension) {
      const yAxis = d3.axisLeft(d.scale)

      return d3.select(this).call(yAxis)
    })
    .append(&quot;text&quot;)
    .attr(&quot;class&quot;, &quot;title&quot;)
    .attr(&quot;text-anchor&quot;, &quot;middle&quot;)
    .attr(&quot;y&quot;, -9)
    .text((d) =&gt; d.name)

  svg
    .select(&quot;.axis&quot;)
    .selectAll&lt;SVGElement, Data&gt;(&quot;text:not(.title)&quot;)
    .attr(&quot;class&quot;, &quot;label&quot;)
    .data(sortedData, (d: any) =&gt; d.name || d)
    .style(&quot;fill&quot;, (_d, i) =&gt; colorFn(i))

  const moveToFront = function (this: SVGElement) {
    const el = this.parentNode as HTMLElement

    el.appendChild(this)
  }

  const mouseover = (_e: unknown, d: Data) =&gt; {
    svg.selectAll(&quot;.foreground path&quot;).style(&quot;filter&quot;, &quot;none&quot;)
    svg.classed(&quot;active&quot;, true)
    projection.classed(&quot;inactive&quot;, (p: Data) =&gt; p.name !== d.name)

    projection.filter((p: Data) =&gt; p.name === d.name).each(moveToFront)
  }

  const mouseout = () =&gt; {
    svg.selectAll(&quot;.foreground path&quot;).style(&quot;filter&quot;, &quot;url(#drop-shadow-lines)&quot;)
    svg.classed(&quot;active&quot;, false)
    projection.classed(&quot;inactive&quot;, false)
  }

  svg
    .selectAll(&quot;.foreground path&quot;)
    .style(&quot;filter&quot;, &quot;url(#drop-shadow-lines)&quot;)
    .style(&quot;stroke&quot;, (_d, i) =&gt; colorFn(i))

  const projection = svg
    .selectAll&lt;SVGElement, Data&gt;(&quot;.axis text,.background path,.foreground path&quot;)
    .on(&quot;mouseover&quot;, mouseover)
    .on(&quot;mouseout&quot;, mouseout)

  d3utils.tooltip(&quot;.background path, .foreground path&quot;, {
    followMouse: true,
    leftOffst: 100,
    topOffst: 50,
  })
}

const main = async () =&gt; {
  const data = await fetchData()
  const rootElId = &quot;chart&quot;

  renderChart({ data, rootElId })
}

export default main
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;src/demos/map-distorsions/map-distorsions.ts&quot;,&quot;line&quot;:37,&quot;character&quot;:2,&quot;text&quot;:&quot;scale&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/map-distorsions/map-distorsions.ts&quot;,&quot;line&quot;:102,&quot;character&quot;:12,&quot;text&quot;:&quot;scale&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/map-distorsions/map-distorsions.ts&quot;,&quot;line&quot;:102,&quot;character&quot;:18,&quot;text&quot;:&quot;domain&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/map-distorsions/map-distorsions.ts&quot;,&quot;line&quot;:109,&quot;character&quot;:25,&quot;text&quot;:&quot;d&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/map-distorsions/map-distorsions.ts&quot;,&quot;line&quot;:113,&quot;character&quot;:16,&quot;text&quot;:&quot;scale&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/map-distorsions/map-distorsions.ts&quot;,&quot;line&quot;:113,&quot;character&quot;:22,&quot;text&quot;:&quot;d&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/map-distorsions/map-distorsions.ts&quot;,&quot;line&quot;:154,&quot;character&quot;:34,&quot;text&quot;:&quot;scale&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/map-distorsions/map-distorsions.ts&quot;,&quot;line&quot;:168,&quot;character&quot;:23,&quot;text&quot;:&quot;d&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/map-distorsions/map-distorsions.ts&quot;,&quot;line&quot;:168,&quot;character&quot;:34,&quot;text&quot;:&quot;d&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/map-distorsions/map-distorsions.ts&quot;,&quot;line&quot;:168,&quot;character&quot;:36,&quot;text&quot;:&quot;name&quot;,&quot;kind&quot;:1}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Sun, 18 Jul 2021 17:48:28 GMT</p>
    </body>
  </html>
  