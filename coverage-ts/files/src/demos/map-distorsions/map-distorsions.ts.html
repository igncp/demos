
  <!DOCTYPE html>
  <html>
    <head>
      <title>map-distorsions.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src/demos/map-distorsions/map-distorsions.ts</td><td class="">99.09%</td><td class="">95%</td><td class="">550</td><td class="">545</td><td class="">5</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import {
  Selection,
  axisLeft,
  extent,
  line as lineD3,
  range,
  scaleLinear,
  scalePoint,
  scaleSqrt,
  select,
  tsv,
} from &quot;d3&quot;
import $ from &quot;jquery&quot;
import &quot;jquery-ui/themes/base/all.css&quot;
import qs from &quot;query-string&quot;

import * as styles from &quot;./map-distorsions.module.css&quot;

if (typeof window !== &quot;undefined&quot;) {
  require(&quot;jquery-ui/ui/widgets/tooltip&quot;)
}

const CONTAINER_ID = &quot;chart&quot;

type ProjectionItem = {
  &quot;Acc. 40ยบ 150%&quot;: string
  &quot;Angular&quot;: string
  &quot;Areal&quot;: string
  &quot;Scale&quot;: string
  &quot;name&quot;: string
}

const fetchData = () =&gt;
  tsv(`${ROOT_PATH}data/d3js/map-distorsions/data.tsv`) as unknown as Promise&lt;
    ProjectionItem[]
  &gt;

const maxNameLength = 20
const getShortName = (name: string) =&gt;
  name.length &gt; maxNameLength ? `${name.slice(0, maxNameLength)}...` : name

const margin = {
  bottom: 20,
  left: 200,
  right: 40,
  top: 90,
}
const height = 750 - margin.top - margin.bottom
const axisYOffset = -9

const colors = [&quot;#7C7CC9&quot;, &quot;#429742&quot;, &quot;#63BD28&quot;, &quot;#D14141&quot;]

const texts = {
  title:
    &quot;Comparison of 41 map projections by four different types of distortion. Lower is better.&quot;,
}

type RenderChart = (chartConfig: {
  mapsDistorsions: ProjectionItem[]
  rootElId: string
}) =&gt; void

enum DimensionName {
  Acc40 = &quot;Acc. 40ยบ 150%&quot;,
  Angular = &quot;Angular&quot;,
  Areal = &quot;Areal&quot;,
  Scale = &quot;Scale&quot;,
}

enum DimensionType {
  Number = &quot;number&quot;,
  String = &quot;string&quot;,
}

const tooltipText = (projectionItem: ProjectionItem) =&gt; {
  const dimensionsNames = [
    DimensionName.Acc40,
    DimensionName.Scale,
    DimensionName.Areal,
    DimensionName.Angular,
  ] as Array&lt;keyof ProjectionItem&gt;
  const valuesWithDimension = dimensionsNames.map(
    (dimensionName) =&gt;
      `${Number(projectionItem[dimensionName]).toFixed(2)} (${dimensionName})`
  )

  return `${projectionItem.name}: ${valuesWithDimension.join(&quot;, &quot;)}`
}

type Dimension = {
  name: DimensionName | &quot;name&quot;
  scale: any // eslint-disable-line @typescript-eslint/no-explicit-any
  type: DimensionType
}

const filterColor = ({
  deviation,
  id,
  slope,
  svg,
}: {
  deviation: number
  id: string
  slope: number
  svg: Selection&lt;SVGGElement, unknown, HTMLElement, unknown&gt;
}) =&gt; {
  const defs = svg.append(&quot;defs&quot;)
  const filter = defs.append(&quot;filter&quot;).attr(&quot;id&quot;, `drop-shadow-${id}`)

  filter
    .append(&quot;feOffset&quot;)
    .attr(&quot;dx&quot;, 0.5)
    .attr(&quot;dy&quot;, 0.5)
    .attr(&quot;in&quot;, &quot;SourceGraphic&quot;)
    .attr(&quot;result&quot;, &quot;offOut&quot;)

  filter
    .append(&quot;feGaussianBlur&quot;)
    .attr(&quot;in&quot;, &quot;offOut&quot;)
    .attr(&quot;result&quot;, &quot;blurOut&quot;)
    .attr(&quot;stdDeviation&quot;, deviation)

  filter
    .append(&quot;feBlend&quot;)
    .attr(&quot;in&quot;, &quot;SourceGraphic&quot;)
    .attr(&quot;in2&quot;, &quot;blurOut&quot;)
    .attr(&quot;mode&quot;, &quot;normal&quot;)

  filter
    .append(&quot;feComponentTransfer&quot;)
    .append(&quot;feFuncA&quot;)
    .attr(&quot;slope&quot;, slope)
    .attr(&quot;type&quot;, &quot;linear&quot;)
}

const colorsScale = &lt;P extends number&gt;(domain: [number, number]) =&gt; {
  const c = scaleLinear().domain(domain).range([0, 1])
  const colorScale = scaleLinear&lt;string&gt;()
    .domain(range(0, 1, 1.0 / colors.length))
    .range(colors)

  return (color: P) =&gt; colorScale(c(color))
}

const renderChart: RenderChart = ({ mapsDistorsions, rootElId }) =&gt; {
  const rootEl = document.getElementById(rootElId) as HTMLElement

  rootEl.classList.add(styles.mapDistorsionsChart)

  const width =
    rootEl.getBoundingClientRect().width - margin.left - margin.right

  const dimensions: Dimension[] = [
    {
      name: &quot;name&quot;,
      scale: scalePoint().range([0, height]),
      type: DimensionType.String,
    },
    {
      name: DimensionName.Acc40,
      scale: scaleLinear().range([0, height]),
      type: DimensionType.Number,
    },
    {
      name: DimensionName.Scale,
      scale: scaleLinear().range([height, 0]),
      type: DimensionType.Number,
    },
    {
      name: DimensionName.Areal,
      scale: scaleSqrt().range([height, 0]),
      type: DimensionType.Number,
    },
    {
      name: DimensionName.Angular,
      scale: scaleLinear().range([height, 0]),
      type: DimensionType.Number,
    },
  ]

  const svg = select(`#${rootElId}`)
    .append(&quot;svg&quot;)
    .attr(&quot;height&quot;, height + margin.top + margin.bottom)
    .attr(&quot;width&quot;, width + margin.left + margin.right)
    .append(&quot;g&quot;)
    .attr(&quot;transform&quot;, `translate(${margin.left},${margin.top})`)

  svg
    .append(&quot;text&quot;)
    .attr(&quot;class&quot;, &quot;chart-title&quot;)
    .attr(&quot;text-anchor&quot;, &quot;middle&quot;)
    .attr(&quot;transform&quot;, `translate(${width / 2},-60)`)
    .text(texts.title)
    .style(&quot;font-weight&quot;, &quot;bold&quot;)

  const x = scalePoint()
    .domain(dimensions.map((dimension) =&gt; dimension.name))
    .range([0, width])

  const line = lineD3().defined((lineData) =&gt; !isNaN(lineData[1]))

  const dimensionSelection = svg
    .selectAll(&quot;.dimension&quot;)
    .data(dimensions)
    .enter()
    .append(&quot;g&quot;)
    .attr(&quot;class&quot;, &quot;dimension&quot;)
    .attr(&quot;transform&quot;, (dimension) =&gt; `translate(${x(dimension.name)})`)

  filterColor({ deviation: 2, id: &quot;lines&quot;, slope: 0.4, svg })

  const sortedData: ProjectionItem[] = mapsDistorsions
    .slice(0)
    .sort((...[{ name: nameA }, { name: nameB }]) =&gt; {
      if (nameA === nameB) {
        return 0
      }

      return nameA &lt; nameB ? -1 : 1
    })

  const colorFn = colorsScale([0, sortedData.length - 1])

  dimensions.forEach((dimItem: Dimension) =&gt;
    dimItem.scale.domain(
      dimItem.type === DimensionType.Number
        ? extent(
            sortedData,
            (projection: ProjectionItem) =&gt;
              +projection[dimItem.name as keyof ProjectionItem]
          )
        : sortedData
            .map((projection: ProjectionItem) =&gt; {
              const { [dimItem.name as keyof ProjectionItem]: name } =
                projection

              return getShortName(name)
            })
            .sort()
    )
  )

  const draw = (projectionItem: ProjectionItem) =&gt; {
    const allPoints: Array&lt;[number, number]&gt; = dimensions.map((dimItem) =&gt; {
      const { [dimItem.name as keyof ProjectionItem]: projectionValue } =
        projectionItem

      return [
        x(dimItem.name) as number,
        dimItem.scale(
          typeof projectionValue === &quot;string&quot;
            ? getShortName(projectionValue)
            : projectionValue
        ),
      ]
    })

    return line(allPoints)
  }

  svg
    .append(&quot;g&quot;)
    .attr(&quot;class&quot;, styles.background)
    .selectAll(&quot;path&quot;)
    .data&lt;ProjectionItem&gt;(sortedData)
    .enter()
    .append(&quot;path&quot;)
    .attr(&quot;d&quot;, draw)
    .style(&quot;cursor&quot;, &quot;pointer&quot;)
    .attr(&quot;title&quot;, tooltipText)
    .on(&quot;click&quot;, (...[, projectionItem]) =&gt; {
      window.open(
        `https://www.google.com/search?${qs.stringify({
          q: `${projectionItem.name} map projection`,
          tbm: &quot;isch&quot;, // Google Images
        })}`
      )
    })

  svg
    .append(&quot;g&quot;)
    .attr(&quot;class&quot;, styles.foreground)
    .selectAll(&quot;path&quot;)
    .data(sortedData)
    .enter()
    .append(&quot;path&quot;)
    .attr(&quot;d&quot;, draw)
    .attr(&quot;data-title&quot;, tooltipText)

  dimensionSelection
    .append(&quot;g&quot;)
    .attr(&quot;class&quot;, styles.axis)
    .each(function setupVerticalAxis(dimensionItem: Dimension) {
      const yAxis = axisLeft(dimensionItem.scale)

      return select(this).call(yAxis)
    })
    .append(&quot;text&quot;)
    .attr(&quot;class&quot;, styles.title)
    .attr(&quot;text-anchor&quot;, &quot;middle&quot;)
    .attr(&quot;y&quot;, axisYOffset)
    .text((dimensionItem) =&gt; dimensionItem.name)

  svg
    .select(`.${styles.axis}`)
    .selectAll&lt;SVGElement, ProjectionItem&gt;(`text:not(.${styles.title})`)
    .attr(&quot;class&quot;, styles.label)
    .data(sortedData, (projectionItem: ProjectionItem) =&gt; projectionItem.name)
    .style(&quot;fill&quot;, (...[, projectionIndex]: [unknown, number]) =&gt;
      colorFn(projectionIndex)
    )

  const moveToFront = function appendOnEnd(this: SVGElement) {
    const parentNode = this.parentNode as HTMLElement

    parentNode.appendChild(this)
  }

  const projection = svg.selectAll&lt;SVGElement, ProjectionItem&gt;(
    `.${styles.axis} text,.${styles.background} path,.${styles.foreground} path`
  )

  const mouseover = (...[, overProjection]: [unknown, ProjectionItem]) =&gt; {
    svg.selectAll(`.${styles.foreground} path`).style(&quot;filter&quot;, &quot;none&quot;)
    svg.classed(styles.active, true)
    projection.classed(
      styles.inactive,
      (otherProjection: ProjectionItem) =&gt;
        otherProjection.name !== overProjection.name
    )

    projection
      .filter(
        (otherProjection: ProjectionItem) =&gt;
          otherProjection.name === overProjection.name
      )
      .each(moveToFront)
  }

  const mouseout = () =&gt; {
    svg
      .selectAll(`.${styles.foreground} path`)
      .style(&quot;filter&quot;, &quot;url(#drop-shadow-lines)&quot;)
    svg.classed(styles.active, false)
    projection.classed(styles.inactive, false)
  }

  svg
    .selectAll(`.${styles.foreground} path`)
    .style(&quot;filter&quot;, &quot;url(#drop-shadow-lines)&quot;)
    .style(&quot;stroke&quot;, (...[, projectionItemIndex]) =&gt;
      colorFn(projectionItemIndex)
    )

  projection.on(&quot;mouseover&quot;, mouseover).on(&quot;mouseout&quot;, mouseout)

  $(`.${styles.background} path, .${styles.foreground} path`).tooltip({
    track: true,
  })
}

const main = async () =&gt; {
  const mapsDistorsions = await fetchData()
  const rootElId = CONTAINER_ID

  renderChart({ mapsDistorsions, rootElId })
}

export { CONTAINER_ID }

export default main
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;src/demos/map-distorsions/map-distorsions.ts&quot;,&quot;line&quot;:91,&quot;character&quot;:2,&quot;text&quot;:&quot;scale&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/map-distorsions/map-distorsions.ts&quot;,&quot;line&quot;:224,&quot;character&quot;:12,&quot;text&quot;:&quot;scale&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/map-distorsions/map-distorsions.ts&quot;,&quot;line&quot;:224,&quot;character&quot;:18,&quot;text&quot;:&quot;domain&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/map-distorsions/map-distorsions.ts&quot;,&quot;line&quot;:249,&quot;character&quot;:16,&quot;text&quot;:&quot;scale&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/demos/map-distorsions/map-distorsions.ts&quot;,&quot;line&quot;:293,&quot;character&quot;:43,&quot;text&quot;:&quot;scale&quot;,&quot;kind&quot;:1}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Sun, 12 Dec 2021 10:45:29 GMT</p>
    </body>
  </html>
  