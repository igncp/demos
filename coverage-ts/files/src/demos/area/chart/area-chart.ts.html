
  <!DOCTYPE html>
  <html>
    <head>
      <title>area-chart.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src/demos/area/chart/area-chart.ts</td><td class="">100.00%</td><td class="">95%</td><td class="">641</td><td class="">641</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import {
  BaseType,
  Selection,
  area as areaD3,
  axisBottom,
  axisLeft,
  format,
  line as lineD3,
  max,
  min,
  scaleLinear,
  scaleQuantize,
  select,
} from &quot;d3&quot;
import $ from &quot;jquery&quot;
import &quot;jquery-ui/themes/base/all.css&quot;
import { v1 as uuidv1 } from &quot;uuid&quot;

import * as styles from &quot;./area-chart.module.css&quot;
import { VoronoiGroup } from &quot;./voronoi-group&quot;

if (typeof window !== &quot;undefined&quot;) {
  require(&quot;jquery-ui/ui/widgets/tooltip&quot;)
}

const filterBlackOpacity = ({
  deviation,
  id,
  slope,
  svg,
}: {
  deviation: number
  id: string
  slope: number
  svg: Selection&lt;SVGGElement, unknown, HTMLElement, unknown&gt;
}) =&gt; {
  const defs = svg.append(&quot;defs&quot;)
  const filter = defs
    .append(&quot;filter&quot;)
    .attr(&quot;height&quot;, &quot;500%&quot;)
    .attr(&quot;id&quot;, `drop-shadow-${id}`)
    .attr(&quot;width&quot;, &quot;500%&quot;)
    .attr(&quot;x&quot;, &quot;-200%&quot;)
    .attr(&quot;y&quot;, &quot;-200%&quot;)

  filter
    .append(&quot;feGaussianBlur&quot;)
    .attr(&quot;in&quot;, &quot;SourceAlpha&quot;)
    .attr(&quot;stdDeviation&quot;, deviation)

  filter.append(&quot;feOffset&quot;).attr(&quot;dx&quot;, 1).attr(&quot;dy&quot;, 1)
  filter
    .append(&quot;feComponentTransfer&quot;)
    .append(&quot;feFuncA&quot;)
    .attr(&quot;slope&quot;, slope)
    .attr(&quot;type&quot;, &quot;linear&quot;)

  const feMerge = filter.append(&quot;feMerge&quot;)

  feMerge.append(&quot;feMergeNode&quot;)

  feMerge.append(&quot;feMergeNode&quot;).attr(&quot;in&quot;, &quot;SourceGraphic&quot;)
}

type ChartConfig&lt;AreaPoint&gt; = {
  areaPoints: AreaPoint[]
  chartTitle: string
  chartTitleShort: string
  getItemId: (areaPoint: AreaPoint) =&gt; number
  getItemTitle: (areaPoint: AreaPoint) =&gt; string
  getItemXValue: (areaPoint: AreaPoint) =&gt; number
  getItemYValue: (areaPoint: AreaPoint) =&gt; number
  rootElId: string
}

interface BaseChart {
  refresh: () =&gt; void
  tearDown: () =&gt; void
  toggleVoronoi: () =&gt; void
}

type CommonSelection&lt;El extends BaseType&gt; = Selection&lt;
  El,
  unknown,
  HTMLElement,
  unknown
&gt;

type ChartElements&lt;AreaPoint&gt; = Readonly&lt;{
  areaSel: CommonSelection&lt;SVGPathElement&gt;
  backgroundBands: CommonSelection&lt;SVGGElement&gt;
  chartTitleSel: CommonSelection&lt;SVGTextElement&gt;
  clipRect: CommonSelection&lt;SVGRectElement&gt;
  clipTopRect: CommonSelection&lt;SVGRectElement&gt;
  lineSel: CommonSelection&lt;SVGPathElement&gt;
  svg: CommonSelection&lt;SVGSVGElement&gt;
  svgG: CommonSelection&lt;SVGGElement&gt;
  voronoiGroup: VoronoiGroup&lt;AreaPoint&gt;
  xAxisSel: CommonSelection&lt;SVGGElement&gt;
  yAxisSel: CommonSelection&lt;SVGGElement&gt;
}&gt;

class AreaChart&lt;AreaPoint&gt; implements BaseChart {
  private readonly config: ChartConfig&lt;AreaPoint&gt;
  private readonly svgOpacityFilter: string
  private readonly elements: ChartElements&lt;AreaPoint&gt;

  private constructor(chartConfig: ChartConfig&lt;AreaPoint&gt;) {
    this.config = chartConfig

    const { rootElId } = chartConfig

    const svg = select(`#${rootElId}`).append(&quot;svg&quot;)
    const svgG = svg.append(&quot;g&quot;).attr(&quot;class&quot;, styles.areaChart)
    const backgroundBands = svgG.append(&quot;g&quot;)
    const chartTitleSel = svgG
      .append(&quot;text&quot;)
      .attr(&quot;class&quot;, styles.chartTitle)
      .attr(&quot;text-anchor&quot;, &quot;middle&quot;)
      .style(&quot;font-weight&quot;, &quot;bold&quot;)
    const xAxisSel = svgG.append(&quot;g&quot;)
    const yAxisSel = svgG.append(&quot;g&quot;)
    const lineSel = svgG.append(&quot;path&quot;)
    const areaSel = svgG.append(&quot;path&quot;)
    const voronoiGroup = new VoronoiGroup&lt;AreaPoint&gt;(svgG)
    const clipRect = svgG.append(&quot;clipPath&quot;).attr(&quot;id&quot;, &quot;clip&quot;).append(&quot;rect&quot;)

    // This is exclusively for clipping the vertical axis
    const clipTopRect = svgG
      .append(&quot;clipPath&quot;)
      .attr(&quot;id&quot;, &quot;clip-top&quot;)
      .append(&quot;rect&quot;)

    this.svgOpacityFilter = `opacity-${uuidv1().slice(0, 6)}`

    filterBlackOpacity({
      deviation: 2,
      id: this.svgOpacityFilter,
      slope: 0.5,
      svg: svgG,
    })

    this.elements = {
      areaSel,
      backgroundBands,
      chartTitleSel,
      clipRect,
      clipTopRect,
      lineSel,
      svg,
      svgG,
      voronoiGroup,
      xAxisSel,
      yAxisSel,
    }

    this.render(true)

    window.addEventListener(&quot;resize&quot;, this.handleWindowResize)
  }

  public static renderChart&lt;AreaPoint&gt;(chartConfig: ChartConfig&lt;AreaPoint&gt;) {
    return new AreaChart(chartConfig)
  }

  public refresh() {
    this.render(false)
  }

  public tearDown() {
    window.removeEventListener(&quot;resize&quot;, this.handleWindowResize)
  }

  public toggleVoronoi() {
    this.elements.voronoiGroup.toggleVoronoi()
  }

  private render(cancelAnimation: boolean) {
    const {
      config: { rootElId },
    } = this
    const { width } = (
      document.getElementById(rootElId) as HTMLElement
    ).getBoundingClientRect()
    const isSmallDevice = width &lt; 500
    const animationDuration = cancelAnimation || isSmallDevice ? 0 : 1000

    const margin = {
      bottom: 50,
      left: isSmallDevice ? 50 : 70,
      right: isSmallDevice ? 10 : 50,
      top: 50,
    }

    const innerWidth = width - margin.left - margin.right
    const height = 400 - margin.top - margin.bottom

    const { config: chartConfig } = this

    const { areaPoints } = chartConfig
    const tooltipItemClass = `tooltip-item-${uuidv1().slice(0, 6)}`
    const pointClassPrefix = `point-${uuidv1().slice(0, 6)}-`

    const titleYOffset = -15
    const axisTickSize = 10

    const {
      elements: {
        areaSel,
        backgroundBands,
        chartTitleSel,
        clipRect,
        clipTopRect,
        lineSel,
        svg,
        svgG,
        voronoiGroup,
        xAxisSel,
        yAxisSel,
      },
    } = this

    svg
      .attr(&quot;height&quot;, height + margin.top + margin.bottom)
      .attr(&quot;width&quot;, innerWidth + margin.left + margin.right)

    svgG.attr(&quot;transform&quot;, `translate(${margin.left},${margin.top})`)

    chartTitleSel
      .attr(
        &quot;transform&quot;,
        `translate(${width / 2 - margin.left},${titleYOffset})`
      )
      .text(() =&gt;
        isSmallDevice ? chartConfig.chartTitleShort : chartConfig.chartTitle
      )

    const xMax = max(areaPoints, chartConfig.getItemXValue) as number
    const xMin = min(areaPoints, chartConfig.getItemXValue) as number

    const yMax = max(areaPoints, chartConfig.getItemYValue) as number
    const yMin = min(areaPoints, chartConfig.getItemYValue) as number

    const xScale = scaleLinear().domain([xMin, xMax]).range([0, innerWidth])
    const yScale = scaleLinear()
      .domain([yMax + 0.05, yMin - 0.05])
      .range([0, height])

    const extractXScale = (areaPoint: AreaPoint) =&gt;
      xScale(chartConfig.getItemXValue(areaPoint))

    const extractYScale = (areaPoint: AreaPoint) =&gt;
      yScale(chartConfig.getItemYValue(areaPoint))

    const getSmallDeviceTicksScale = () =&gt;
      scaleQuantize()
        .domain([0, 500])
        .range(Array.from({ length: 6 }).map((...[, rangeIndex]) =&gt; rangeIndex))

    const ticks = isSmallDevice ? getSmallDeviceTicksScale()(width) : null

    const xAxis = axisBottom(xScale).tickFormat(format(&quot;.0f&quot;)).ticks(ticks)
    const yAxis = axisLeft(yScale)
      .tickFormat(format(&quot;.0%&quot;))
      .tickSize(axisTickSize)

    xAxisSel
      .attr(&quot;class&quot;, `${styles.x} ${styles.axis}`)
      .attr(&quot;transform&quot;, `translate(0,${height})`)
      .call(xAxis)
      .selectAll(&quot;text&quot;)
      .attr(&quot;dy&quot;, &quot;1.25em&quot;)

    yAxisSel
      .attr(&quot;class&quot;, `${styles.y} ${styles.axis}`)
      .attr(&quot;clip-path&quot;, &quot;url(#clip-top)&quot;)
      .transition()
      .duration(animationDuration)
      .call(yAxis)
      .selectAll(&quot;text&quot;)
      .attr(&quot;dx&quot;, &quot;-.25em&quot;)

    const area = areaD3&lt;AreaPoint&gt;()
      .x(extractXScale)
      .y0(height)
      .y1(extractYScale)
    const line = lineD3&lt;AreaPoint&gt;().x(extractXScale).y(extractYScale)

    lineSel
      .datum(areaPoints)
      .attr(&quot;clip-path&quot;, &quot;url(#clip)&quot;)
      .attr(&quot;class&quot;, styles.line)
      .transition()
      .duration(animationDuration)
      .attr(&quot;d&quot;, line)

    clipRect.attr(&quot;height&quot;, height).attr(&quot;width&quot;, innerWidth)

    clipTopRect
      .attr(&quot;height&quot;, height)
      .attr(&quot;width&quot;, innerWidth)
      .attr(&quot;transform&quot;, &quot;translate(-50,-5)&quot;)

    areaSel
      .datum(areaPoints)
      .attr(&quot;class&quot;, styles.area)
      .attr(&quot;clip-path&quot;, &quot;url(#clip)&quot;)
      .transition()
      .duration(animationDuration)
      .attr(&quot;d&quot;, area)

    const mouseenter = (...[, areaPoint]: [unknown, AreaPoint]) =&gt; {
      select(`.${pointClassPrefix}${chartConfig.getItemId(areaPoint)}`).style(
        &quot;display&quot;,
        &quot;block&quot;
      )
    }

    const mouseleave = (...[, areaPoint]: [unknown, AreaPoint]) =&gt; {
      select(`.${pointClassPrefix}${chartConfig.getItemId(areaPoint)}`).style(
        &quot;display&quot;,
        &quot;none&quot;
      )
    }

    const bandsPercentage = 2.5
    const bandsData = Array.from({ length: 100 / bandsPercentage }).map(
      (...[, bandIndex]) =&gt; (bandIndex * bandsPercentage) / 100
    )
    const bandHeight = Math.abs(yScale(bandsPercentage / 100) - yScale(0))

    const bands = backgroundBands.selectAll(&quot;rect&quot;).data(bandsData)

    bands.enter().append(&quot;rect&quot;)
    bands.exit().remove()

    backgroundBands
      .selectAll&lt;SVGRectElement, number&gt;(&quot;rect&quot;)
      .attr(&quot;clip-path&quot;, &quot;url(#clip)&quot;)
      .attr(&quot;x&quot;, 0)
      .attr(&quot;width&quot;, innerWidth)
      .attr(&quot;fill&quot;, (...[, bandIndex]) =&gt;
        bandIndex % 2 ? &quot;#f7f7f7&quot; : &quot;#ffffff&quot;
      )
      .attr(&quot;class&quot;, &quot;backgroundBands&quot;)
      .transition()
      .duration(animationDuration)
      .attr(&quot;height&quot;, bandHeight)
      .attr(&quot;y&quot;, (bandPercentage) =&gt; yScale(bandPercentage))

    const circleData = svgG.selectAll(&quot;circle&quot;).data(areaPoints)

    circleData.enter().append(&quot;circle&quot;)
    circleData.exit().remove()

    svgG
      .selectAll&lt;SVGCircleElement, AreaPoint&gt;(&quot;circle&quot;)
      .attr(&quot;r&quot;, &quot;5px&quot;)
      .style(&quot;filter&quot;, `url(#drop-shadow-${this.svgOpacityFilter})`)
      .attr(
        &quot;transform&quot;,
        (areaPoint: AreaPoint) =&gt;
          `translate(${extractXScale(areaPoint)},${extractYScale(areaPoint)})`
      )
      .attr(
        &quot;class&quot;,
        (areaPoint) =&gt;
          `${
            styles.point
          } ${tooltipItemClass} ${pointClassPrefix}${chartConfig.getItemId(
            areaPoint
          )}`
      )
      .on(&quot;mouseenter&quot;, mouseenter)
      .on(&quot;mouseleave&quot;, mouseleave)
      .attr(&quot;title&quot;, chartConfig.getItemTitle)

    voronoiGroup.render({
      animationDuration,
      boundaries: [
        -margin.left,
        -margin.top,
        innerWidth + margin.right,
        height + margin.bottom,
      ],
      className: tooltipItemClass,
      clipPath: &quot;url(#clip)&quot;,
      extractXScale,
      extractYScale,
      filter: `url(#drop-shadow-${this.svgOpacityFilter})`,
      getItemId: chartConfig.getItemId,
      getTitle: chartConfig.getItemTitle,
      mouseenter,
      mouseleave,
      points: areaPoints,
    })

    $(`.${tooltipItemClass}`).tooltip({
      track: true,
    })
  }

  private readonly handleWindowResize = () =&gt; {
    this.render(true)
  }
}

export { ChartConfig, AreaChart }
</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Tue, 01 Feb 2022 19:55:49 GMT</p>
    </body>
  </html>
  