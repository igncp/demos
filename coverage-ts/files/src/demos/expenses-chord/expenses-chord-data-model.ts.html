
  <!DOCTYPE html>
  <html>
    <head>
      <title>expenses-chord-data-model.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src/demos/expenses-chord/expenses-chord-data-model.ts</td><td class="">100.00%</td><td class="">95%</td><td class="">115</td><td class="">115</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import { json } from &quot;d3&quot;

type DataItem = {
  value: number | null // eslint-disable-line id-denylist
  year: number
}

/**
 * The data types are encapsulated and not shared
 */
type ExpensesData = {
  [country: string]: {
    [region: string]: DataItem[]
  }
}

class Expenses {
  public static ALL_ID = &quot;All&quot;

  private readonly countries: string[]
  private readonly expensesData: ExpensesData
  private readonly names: string[]
  private readonly regions: string[]

  private constructor(expensesData: ExpensesData) {
    const countries = Object.keys(expensesData).sort()

    this.countries = countries
    this.regions = Object.keys(expensesData[countries[0]]).sort()
    this.expensesData = expensesData
    this.names = countries.concat(this.regions)
  }

  public static async fetchAndCreate(): Promise&lt;Expenses&gt; {
    const expensesData = (await (json(
      `${ROOT_PATH}data/d3js/expenses-chord/data.json`
    ) as unknown)) as ExpensesData

    return new Expenses(expensesData)
  }

  public getRelationsMatrix({
    countryFilter,
    regionFilter,
    timeIndexFilter,
  }: {
    countryFilter: string
    regionFilter: string
    timeIndexFilter: number
  }): number[][] {
    const { expensesData, names } = this

    return names.map((maybeCountry) =&gt; {
      if (!expensesData[maybeCountry] as unknown) {
        return names.map(() =&gt; 0)
      }

      if (![Expenses.ALL_ID, maybeCountry].includes(countryFilter)) {
        return names.map(() =&gt; 0)
      }

      return names.map((maybeRegion) =&gt; {
        const {
          [maybeCountry]: { [maybeRegion]: dataItem },
        } = expensesData

        if (!dataItem as unknown) {
          return 0
        }

        if (![Expenses.ALL_ID, maybeRegion].includes(regionFilter)) {
          return 0
        }

        return dataItem[timeIndexFilter].value
      })
    }) as number[][]
  }

  public getTimeFramesNumber(): number {
    const { countries, expensesData, regions } = this

    return expensesData[countries[0]][regions[0]].length - 1
  }

  public getCountriesList(): Expenses[&quot;countries&quot;] {
    return this.countries.slice()
  }

  public getRegionsList(): Expenses[&quot;regions&quot;] {
    return this.regions.slice()
  }

  public getAllNames(): Expenses[&quot;names&quot;] {
    return this.names.slice()
  }
}

export { Expenses }
</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Thu, 23 Sep 2021 23:25:34 GMT</p>
    </body>
  </html>
  