
  <!DOCTYPE html>
  <html>
    <head>
      <title>bars-chart.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src/demos/bars/bars-chart.ts</td><td class="">100.00%</td><td class="">95%</td><td class="">483</td><td class="">483</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import {
  Selection,
  axisBottom,
  axisLeft,
  extent,
  max,
  range,
  scaleLinear,
  select,
} from &quot;d3&quot;
import $ from &quot;jquery&quot;
import &quot;jquery-ui/themes/base/all.css&quot;
import { v1 as uuidv1 } from &quot;uuid&quot;

import { DragModule } from &quot;./bars-chart-drag&quot;
import * as styles from &quot;./bars.module.css&quot;

if (typeof window !== &quot;undefined&quot;) {
  require(&quot;jquery-ui/ui/widgets/tooltip&quot;)
}

type ChartData = {
  id: number
  metric: number
}

const height = 500
const smallMarginWidth = 600

const margin = { left: 160, top: 100 }
const floor = height - margin.top * 2

const barWidth = 30
const barHeight = 7

const colours = [&quot;#323247&quot;, &quot;#7C7CC9&quot;, &quot;#72B66C&quot;, &quot;#429742&quot;]
const barYFn = (barItem: ChartData) =&gt; floor - barHeight * barItem.metric
const barHeightFn = (barItem: ChartData) =&gt; barItem.metric * barHeight

type ChartConfig = {
  bars: ChartData[]
  rootElId: string
}

type ChartElements = {
  chart: Selection&lt;SVGGElement, ChartData, HTMLElement, unknown&gt;
  dragArea: Selection&lt;SVGGElement, ChartData, HTMLElement, unknown&gt;
  svg: Selection&lt;SVGSVGElement, ChartData, HTMLElement, unknown&gt;
  xAxisG: Selection&lt;SVGGElement, ChartData, HTMLElement, unknown&gt;
  xAxisText: Selection&lt;SVGTextElement, ChartData, HTMLElement, unknown&gt;
  yAxisG: Selection&lt;SVGGElement, ChartData, HTMLElement, unknown&gt;
  yAxisText: Selection&lt;SVGTextElement, ChartData, HTMLElement, unknown&gt;
}

type Interval = ReturnType&lt;typeof setInterval&gt;
type ColorFn = (c: ChartData) =&gt; string

class BarsChart {
  private readonly bars: ChartData[]
  private readonly elements: ChartElements
  private readonly rootElId: string
  private readonly barClassName: string
  private readonly dragModule: DragModule&lt;ChartData&gt;
  private color: ColorFn | null
  private readonly state: {
    interval: Interval | null
  } = {
    interval: null,
  }

  public constructor({ bars, rootElId }: ChartConfig) {
    this.bars = bars
    this.rootElId = rootElId
    this.barClassName = `bars-${uuidv1().slice(0, 6)}`

    const svg = select&lt;HTMLElement, ChartData&gt;(`#${rootElId}`).append(&quot;svg&quot;)

    svg
      .append(&quot;g&quot;)
      .append(&quot;filter&quot;)
      .attr(&quot;height&quot;, &quot;300%&quot;)
      .attr(&quot;x&quot;, &quot;-100%&quot;)
      .attr(&quot;y&quot;, &quot;-100%&quot;)
      .attr(&quot;id&quot;, &quot;blur&quot;)
      .attr(&quot;width&quot;, &quot;300%&quot;)
      .append(&quot;feGaussianBlur&quot;)
      .attr(&quot;stdDeviation&quot;, &quot;2 2&quot;)

    const dragArea = svg.append(&quot;g&quot;)
    const chart = dragArea.append(&quot;g&quot;)
    const xAxisG = chart.append(&quot;g&quot;)
    const xAxisText = xAxisG.append(&quot;text&quot;)
    const yAxisG = chart.append(&quot;g&quot;)
    const yAxisText = yAxisG.append(&quot;text&quot;)

    this.elements = {
      chart,
      dragArea,
      svg,
      xAxisG,
      xAxisText,
      yAxisG,
      yAxisText,
    }

    this.dragModule = new DragModule({
      chart,
      dragArea,
      svg,
    })

    this.color = null

    this.render()

    window.addEventListener(&quot;resize&quot;, this.handleResize)
  }

  public addBar(newBar: ChartData) {
    this.bars.push(newBar)
  }

  public getBars(): ChartData[] {
    return this.bars.slice()
  }

  public refresh() {
    this.drawRectangles()
    this.redraw()
  }

  private render() {
    const { bars, rootElId } = this
    const { width } = (
      document.getElementById(rootElId) as HTMLElement
    ).getBoundingClientRect()

    const colorScale = scaleLinear()
      .domain(extent(bars, (bar) =&gt; bar.metric) as [number, number])
      .range([0, 1])
    const heatmapColour = scaleLinear&lt;string&gt;()
      .domain(range(0, 1, 1.0 / colours.length))
      .range(colours)

    const color = (barItem: ChartData) =&gt;
      heatmapColour(colorScale(barItem.metric))

    this.color = color

    const {
      elements: { chart, svg, xAxisG, xAxisText, yAxisG, yAxisText },
    } = this

    svg
      .attr(&quot;height&quot;, height)
      .attr(&quot;width&quot;, width)
      .attr(&quot;class&quot;, styles.barsChart)

    const marginLeft = width &gt; smallMarginWidth ? margin.left : 80

    this.dragModule.setDimensions({
      marginLeft,
      width,
    })

    chart.attr(&quot;transform&quot;, `translate(${marginLeft},${margin.top})`)

    if (this.state.interval) {
      clearInterval(this.state.interval)
    }

    this.state.interval = setInterval(this.getIntervalFn(), 1000)

    const x = scaleLinear()
      .domain([0.5, bars.length + 0.5])
      .range([1, barWidth * bars.length])

    const y = scaleLinear()
      .domain([0, max(bars, (bar) =&gt; bar.metric) as number])
      .rangeRound([
        0,
        -1 * barHeight * (max(bars, (bar) =&gt; bar.metric) as number),
      ])

    xAxisG
      .attr(&quot;class&quot;, `xAxis ${styles.axis}`)
      .attr(&quot;transform&quot;, `translate(0,${floor})`)
      .call(axisBottom(x))

    xAxisText
      .attr(&quot;transform&quot;, `translate(${(barWidth * bars.length) / 2} ,0)`)
      .attr(&quot;class&quot;, &quot;xAxisLabel&quot;)
      .attr(&quot;y&quot;, 40)
      .attr(&quot;font-size&quot;, &quot;1.3em&quot;)
      .attr(&quot;fill&quot;, &quot;black&quot;)
      .style(&quot;text-anchor&quot;, &quot;end&quot;)
      .text(&quot;Number&quot;)

    yAxisG
      .attr(&quot;class&quot;, `yAxis ${styles.axis}`)
      .attr(&quot;transform&quot;, `translate(0,${floor})`)
      .call(axisLeft(y))

    yAxisText
      .attr(&quot;transform&quot;, `translate(-30,${(-1 * (height - 60)) / 2})`)
      .attr(&quot;y&quot;, 40)
      .attr(&quot;font-size&quot;, &quot;1.3em&quot;)
      .attr(&quot;fill&quot;, &quot;black&quot;)
      .style(&quot;text-anchor&quot;, &quot;end&quot;)
      .text(&quot;Value&quot;)

    this.dragModule.reset()
    this.drawRectangles()
  }

  private clearInterval() {
    if (this.state.interval) {
      clearInterval(this.state.interval)
    }
  }

  private getBarsSelection() {
    const {
      elements: { chart },
    } = this

    return chart.selectAll&lt;SVGRectElement, ChartData&gt;(&quot;rect&quot;)
  }

  private drawRectangles() {
    const { bars, color } = this

    this.getBarsSelection()
      .data(bars)
      .enter()
      .append(&quot;rect&quot;)
      .attr(&quot;x&quot;, (...[, barIndex]) =&gt; barWidth * barIndex)
      .attr(&quot;y&quot;, barYFn)
      .attr(&quot;width&quot;, barWidth)
      .attr(&quot;height&quot;, barHeightFn)
      .attr(&quot;class&quot;, this.barClassName)
      .attr(&quot;fill&quot;, (barItem) =&gt; color!(barItem))
      .on(&quot;mouseover&quot;, (...[, mouseBar]) =&gt; {
        this.getBarsSelection().style(&quot;filter&quot;, (bar) =&gt;
          bar.id === mouseBar.id ? null : &quot;url(#blur)&quot;
        )
        this.clearInterval()
      })
      .on(&quot;mouseleave&quot;, () =&gt; {
        this.getBarsSelection().style(&quot;filter&quot;, null)
        this.clearInterval()
        this.state.interval = setInterval(this.getIntervalFn(), 1000)
      })
      .attr(&quot;title&quot;, (bar) =&gt; bar.metric)

    $(`.${this.barClassName}`).tooltip({
      track: true,
    })
  }

  private getIntervalFn() {
    return () =&gt; {
      const { bars } = this

      bars.unshift(bars.pop() as ChartData)

      this.redraw()
    }
  }

  private redraw() {
    const {
      bars,
      color,
      elements: { chart },
    } = this

    const newX = scaleLinear()
      .domain([0.5, bars.length + 0.5])
      .range([1, barWidth * bars.length])

    const newAxis = axisBottom(newX)

    chart.select&lt;SVGGElement&gt;(&quot;.xAxis&quot;).transition().duration(500).call(newAxis)

    chart
      .select(&quot;.xAxisLabel&quot;)
      .transition()
      .duration(500)
      .attr(&quot;transform&quot;, `translate(${(barWidth * bars.length) / 2} ,0)`)

    chart
      .selectAll(&quot;rect&quot;)
      .data(bars)
      .transition()
      .duration(500)
      .attr(&quot;y&quot;, barYFn)
      .attr(&quot;height&quot;, barHeightFn)
      .attr(&quot;fill&quot;, color!)
      .select(&quot;title&quot;)
      .text((barItem) =&gt; barItem.metric)

    this.dragModule.refresh()
  }

  private readonly handleResize = () =&gt; {
    this.render()
  }
}

export { BarsChart, ChartConfig }
</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Sun, 02 Jan 2022 17:10:33 GMT</p>
    </body>
  </html>
  