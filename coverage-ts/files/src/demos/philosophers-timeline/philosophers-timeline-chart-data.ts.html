
  <!DOCTYPE html>
  <html>
    <head>
      <title>philosophers-timeline-chart-data.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src/demos/philosophers-timeline/philosophers-timeline-chart-data.ts</td><td class="">100.00%</td><td class="">95%</td><td class="">207</td><td class="">207</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import { csv, timeParse } from &quot;d3&quot;
import qs from &quot;query-string&quot;

import { ChartConfig, SortOrder } from &quot;./philosophers-timeline-chart&quot;

export type TimeBandItem = {
  end: Date
  instant: boolean
  label: string
  start: Date
  track: number
}

const toYear = (date: Date) =&gt; {
  const bcString = &quot; BC&quot;
  const year = date.getUTCFullYear()

  if (year &gt;= 0) {
    return year.toString()
  }

  return bcString + Math.abs(year)
}

const parseDate = function (dateString: string) {
  const format = timeParse(&quot;%Y-%m-%d&quot;)

  let date = format(dateString)

  if (date !== null) {
    return date
  }

  const year = isNaN(Number(dateString))
    ? -dateString.replace(/[^0-9]/g, &quot;&quot;)
    : +dateString

  if (year &lt; 0 || year &gt; 99) {
    date = new Date(year, 6, 1)
  } else if (year === 0) {
    date = new Date(-1, 6, 1)
  } else {
    date = new Date(year, 6, 1)
    date.setUTCFullYear(year)
  }

  return date
}

const yearMillis = 31622400000

export const fetchData = async (): Promise&lt;TimeBandItem[]&gt; =&gt; {
  const timeBandItems = ((await csv(
    `${ROOT_PATH}data/d3js/philosophers-timeline/data.csv`
  )) as unknown) as TimeBandItem[]
  const today = new Date()
  const instantOffset = 100 * yearMillis

  timeBandItems.forEach((timeBandItem) =&gt; {
    timeBandItem.start = parseDate(timeBandItem.start.toString())

    if ((timeBandItem.end as unknown) === &quot;&quot;) {
      timeBandItem.end = new Date(timeBandItem.start.getTime() + instantOffset)
      timeBandItem.instant = true
    } else {
      timeBandItem.end = parseDate(timeBandItem.end.toString())
      timeBandItem.instant = false
    }

    if (timeBandItem.end &gt; today) {
      timeBandItem.end = today
    }
  })

  return timeBandItems
}

type Config = ChartConfig&lt;TimeBandItem&gt;

const getItemLimitLeft: Config[&quot;getItemLimitLeft&quot;] = (timeBandItem) =&gt;
  timeBandItem.start

const getItemLimitRight: Config[&quot;getItemLimitRight&quot;] = (timeBandItem) =&gt;
  timeBandItem.end

const getSortFn: Config[&quot;getSortFn&quot;] = (sortOrder) =&gt; (
  ...[timeBandItemA, timeBandItemB]: [TimeBandItem, TimeBandItem]
) =&gt; {
  const factor = sortOrder === SortOrder.Ascending ? 1 : -1
  const startDiff = Number(timeBandItemA.start) - Number(timeBandItemB.start)

  if (startDiff !== 0) {
    return startDiff * factor
  }

  return (Number(timeBandItemB.end) - Number(timeBandItemA.end)) * factor
}

const getItemText: Config[&quot;getItemText&quot;] = ({
  chartItem: timeBandItem,
  maxLetters,
}) =&gt; {
  if (timeBandItem.label.length &gt; maxLetters) {
    return `${timeBandItem.label.substr(0, maxLetters - 1)}..`
  }

  return timeBandItem.label
}

const getItemTitle: Config[&quot;getItemTitle&quot;] = (timeBandItem) =&gt; {
  if (timeBandItem.instant) {
    return `${timeBandItem.label}: ${toYear(timeBandItem.start)}`
  }

  return `${timeBandItem.label}: ${toYear(timeBandItem.start)} - ${toYear(
    timeBandItem.end
  )}`
}

const onChartItemClick: Config[&quot;onChartItemClick&quot;] = (timelineChart) =&gt; {
  const query = !timelineChart.instant
    ? `Philosopher ${timelineChart.label} ${
        (timelineChart.end as unknown) ? timelineChart.end.getFullYear() : &quot;&quot;
      }`.trim()
    : timelineChart.label

  window.open(
    `https://www.google.com/search?${qs.stringify({
      q: query,
    })}`
  )
}

export const getChartConfig = (): Config =&gt; ({
  getItemLimitLeft,
  getItemLimitRight,
  getItemText,
  getItemTitle,
  getSortFn,
  onChartItemClick,
  rootElId: &quot;chart&quot;,
})
</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Thu, 26 Aug 2021 22:14:37 GMT</p>
    </body>
  </html>
  