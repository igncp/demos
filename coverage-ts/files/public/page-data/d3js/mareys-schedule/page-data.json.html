
  <!DOCTYPE html>
  <html>
    <head>
      <title>page-data.json</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">public/page-data/d3js/mareys-schedule/page-data.json</td><td class="">100.00%</td><td class="">95%</td><td class="">0</td><td class="">0</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">{&quot;componentChunkName&quot;:&quot;component---src-pages-d-3-js-mareys-schedule-tsx&quot;,&quot;path&quot;:&quot;/d3js/mareys-schedule/&quot;,&quot;result&quot;:{&quot;pageContext&quot;:{&quot;demoInfo&quot;:{&quot;dataFiles&quot;:[&quot;data.tsv&quot;],&quot;docs&quot;:[],&quot;isCompleted&quot;:true,&quot;name&quot;:&quot;Marey&#x27;s Schedule&quot;,&quot;notes&quot;:[&quot;Added titles with information in stops and trains&quot;,&quot;Add box shadow&quot;,&quot;Add range input&quot;],&quot;sources&quot;:[&quot;http://bl.ocks.org/mbostock/5544008&quot;],&quot;summary&quot;:[],&quot;category&quot;:&quot;d3js&quot;,&quot;files&quot;:{&quot;cssModule&quot;:&quot;.mareysScheduleChart {\n  svg {\n    font: 10px sans-serif;\n  }\n\n  .axis path {\n    display: none;\n  }\n\n  .axis line {\n    shape-rendering: crispEdges;\n    stroke: #000;\n  }\n\n  .chartTitle {\n    font-size: 15px;\n  }\n\n  .station line {\n    shape-rendering: crispEdges;\n    stroke: #ddd;\n    stroke-dasharray: 1, 1;\n  }\n\n  .station text {\n    text-anchor: end;\n  }\n\n  .train path {\n    fill: none;\n    stroke-width: 2.5px;\n  }\n\n  .train circle {\n    stroke: #fff;\n  }\n\n  .train .tN path {\n    stroke: rgb(34, 34, 34);\n  }\n\n  .train .tN circle {\n    fill: rgb(34, 34, 34);\n  }\n\n  .train .tL path {\n    stroke: rgb(183, 116, 9);\n  }\n\n  .train .tL circle {\n    fill: rgb(183, 116, 9);\n  }\n\n  .train .tB path {\n    stroke: rgb(192, 62, 29);\n  }\n\n  .train .tB circle {\n    fill: rgb(192, 62, 29);\n  }\n}\n&quot;,&quot;demo&quot;:[{&quot;content&quot;:&quot;import {\n  Selection,\n  axisBottom,\n  axisTop,\n  extent,\n  line as lineD3,\n  scaleLinear,\n  scaleTime,\n  select,\n  timeFormat,\n  timeParse,\n  tsv,\n} from \&quot;d3\&quot;\nimport each from \&quot;lodash/each\&quot;\nimport last from \&quot;lodash/last\&quot;\nimport { v1 as uuid } from \&quot;uuid\&quot;\n\nimport * as styles from \&quot;./mareys-schedule.module.css\&quot;\n\ntype TrainType = \&quot;B\&quot; | \&quot;L\&quot; | \&quot;N\&quot;\n\ntype RawDataItem = {\n  [stop: string]: string\n  direction: string\n  number: string\n  type: TrainType\n}\n\ntype Station = {\n  distance: number\n  key: string\n  name: string\n  zone: number\n}\n\ntype Stop = {\n  station: Station\n  time: Date | null\n  trainIndex: number\n}\n\ntype Train = {\n  direction: string\n  id: number\n  number: string\n  stops: Stop[]\n  type: TrainType\n}\n\ntype SchedulesData = {\n  stations: Station[]\n  trains: Train[]\n}\n\ntype Limits = [number, number]\ntype LimitsStr = [string, string]\n\ntype Redraw = (range: LimitsStr) =&gt; void\n\nconst trainTypeToStyle: { [key in TrainType]: string } = {\n  B: styles.tB,\n  L: styles.tL,\n  N: styles.tN,\n}\n\nconst timeFormatStr = \&quot;%I:%M%p\&quot;\nconst getFormatTime = () =&gt; (date: Date) =&gt; timeFormat(timeFormatStr)(date)\nconst getParseTime = () =&gt; timeParse(timeFormatStr)\n\nconst parseTime = (timeStr: string) =&gt; {\n  const timeDate = getParseTime()(timeStr)\n\n  if (timeDate !== null &amp;&amp; timeDate.getHours() &lt; 3) {\n    timeDate.setDate(timeDate.getDate() + 1)\n  }\n\n  return timeDate\n}\n\nconst fetchData = async (): Promise&lt;SchedulesData&gt; =&gt; {\n  const originalItems = ((await tsv(\n    `${ROOT_PATH}data/d3js/mareys-schedule/data.tsv`\n  )) as unknown) as RawDataItem[]\n\n  const stations: Station[] = []\n\n  const trains: Train[] = originalItems.map((...[train, trainIndex]) =&gt; {\n    if (trainIndex === 0) {\n      for (const key in train) {\n        if (/^stop\\|/.test(key)) {\n          const stopFragments = key.split(\&quot;|\&quot;)\n\n          stations.push({\n            distance: +stopFragments[2],\n            key,\n            name: stopFragments[1],\n            zone: +stopFragments[3],\n          })\n        }\n      }\n    }\n\n    return {\n      direction: train.direction,\n      id: trainIndex,\n      number: train.number,\n      stops: stations\n        .map((station) =&gt; ({\n          station,\n          time: parseTime(train[station.key]),\n          trainIndex,\n        }))\n        .filter((station) =&gt; station.time !== null),\n      type: train.type,\n    }\n  })\n\n  return {\n    stations,\n    trains,\n  }\n}\n\nconst getTrainTitle = (trainData: Train) =&gt; {\n  if (trainData.direction === \&quot;S\&quot;) {\n    return `${trainData.stops[0].station.name} -&gt; ${\n      last(trainData.stops)!.station.name\n    }`\n  }\n\n  return `${last(trainData.stops)!.station.name} -&gt; ${\n    trainData.stops[0].station.name\n  }`\n}\n\nconst refreshOnHourChange = ({\n  limits,\n  redraw,\n}: {\n  limits: Limits\n  redraw: Redraw\n}) =&gt; {\n  const times: string[] = []\n\n  each(limits, (limit) =&gt; {\n    const wholeMinutes = (limit / 100) * 1200\n\n    let fragment = \&quot;AM\&quot;\n    let hours = Math.floor(wholeMinutes / 60)\n    let minutes = Math.floor(wholeMinutes % 60)\n\n    if (minutes &gt; 30) {\n      minutes = minutes - 30\n      hours = hours + 1\n    } else {\n      minutes = minutes + 30\n    }\n\n    hours = hours + 4\n\n    if (hours &gt; 23) {\n      if (hours === 24) {\n        hours = hours - 12\n      } else {\n        hours = hours - 24\n      }\n    } else if (hours &gt; 11) {\n      fragment = \&quot;PM\&quot;\n\n      if (hours !== 12) {\n        hours = hours - 12\n      }\n    }\n\n    const minutesStr = minutes &lt; 10 ? `0${minutes}` : minutes.toString()\n\n    const finalTime = `${hours}:${minutesStr}${fragment}`\n\n    return times.push(finalTime)\n  })\n\n  redraw(times as LimitsStr)\n}\n\nconst formatAMPM = function (date: Date) {\n  let hours = date.getHours()\n  const ampm = hours &gt;= 12 ? \&quot;PM\&quot; : \&quot;AM\&quot;\n\n  hours = hours % 12\n  hours = hours ? hours : 12\n\n  const minutes = date.getMinutes()\n  const minutesStr = minutes &lt; 10 ? `0${minutes}` : minutes.toString()\n\n  return `${hours}:${minutesStr} ${ampm}`\n}\n\nconst filterBlackOpacity = ({\n  deviation,\n  id,\n  slope,\n  svg,\n}: {\n  deviation: number\n  id: string\n  slope: number\n  svg: Selection&lt;SVGGElement, unknown, HTMLElement, unknown&gt;\n}) =&gt; {\n  const defs = svg.append(\&quot;defs\&quot;)\n  const filter = defs\n    .append(\&quot;filter\&quot;)\n    .attr(\&quot;height\&quot;, \&quot;500%\&quot;)\n    .attr(\&quot;id\&quot;, `drop-shadow-${id}`)\n    .attr(\&quot;width\&quot;, \&quot;500%\&quot;)\n    .attr(\&quot;x\&quot;, \&quot;-200%\&quot;)\n    .attr(\&quot;y\&quot;, \&quot;-200%\&quot;)\n\n  filter\n    .append(\&quot;feGaussianBlur\&quot;)\n    .attr(\&quot;in\&quot;, \&quot;SourceAlpha\&quot;)\n    .attr(\&quot;stdDeviation\&quot;, deviation)\n\n  filter.append(\&quot;feOffset\&quot;).attr(\&quot;dx\&quot;, 1).attr(\&quot;dy\&quot;, 1)\n  filter\n    .append(\&quot;feComponentTransfer\&quot;)\n    .append(\&quot;feFuncA\&quot;)\n    .attr(\&quot;slope\&quot;, slope)\n    .attr(\&quot;type\&quot;, \&quot;linear\&quot;)\n\n  const feMerge = filter.append(\&quot;feMerge\&quot;)\n\n  feMerge.append(\&quot;feMergeNode\&quot;)\n\n  feMerge.append(\&quot;feMergeNode\&quot;).attr(\&quot;in\&quot;, \&quot;SourceGraphic\&quot;)\n}\n\nconst margin = {\n  bottom: 50,\n  left: 120,\n  right: 50,\n  top: 80,\n}\n\nconst height = 600 - margin.top - margin.bottom\n\nconst renderChart = ({\n  rootElId,\n  schedulesData,\n}: {\n  rootElId: string\n  schedulesData: SchedulesData\n}) =&gt; {\n  const { stations, trains } = schedulesData\n  const rootEl = document.getElementById(rootElId) as HTMLElement\n\n  rootEl.classList.add(styles.mareysScheduleChart)\n\n  const width =\n    rootEl.getBoundingClientRect().width - margin.left - margin.right\n\n  const trainPathClass = `train-${uuid().slice(0, 6)}`\n  const stopCircleClass = `stop-${uuid().slice(0, 6)}`\n\n  const redraw: Redraw = (timeRange) =&gt; {\n    const x = scaleTime()\n      .domain([parseTime(timeRange[0])!, parseTime(timeRange[1])!])\n      .range([0, width])\n    const y = scaleLinear().range([0, height])\n    const formatTime = getFormatTime()\n    const xAxisTop = axisTop&lt;Date&gt;(x).ticks(8).tickFormat(formatTime)\n    const xAxisBottom = axisBottom&lt;Date&gt;(x).ticks(8).tickFormat(formatTime)\n\n    const svg = select(`#${rootElId}`)\n      .text(\&quot;\&quot;)\n      .append(\&quot;svg\&quot;)\n      .attr(\&quot;height\&quot;, height + margin.top + margin.bottom)\n      .attr(\&quot;width\&quot;, width + margin.left + margin.right)\n      .append(\&quot;g\&quot;)\n      .attr(\&quot;transform\&quot;, `translate(${margin.left},${margin.top})`)\n\n    svg\n      .append(\&quot;text\&quot;)\n      .attr(\&quot;class\&quot;, styles.chartTitle)\n      .attr(\&quot;text-anchor\&quot;, \&quot;middle\&quot;)\n      .attr(\&quot;transform\&quot;, `translate(${width / 2},-40)`)\n      .text(\&quot;E.J. Marey’s graphical train schedule (4:30AM - 1:30AM)\&quot;)\n      .style(\&quot;font-weight\&quot;, \&quot;bold\&quot;)\n\n    filterBlackOpacity({\n      deviation: 2,\n      id: \&quot;trains\&quot;,\n      slope: 0.2,\n      svg,\n    })\n\n    svg\n      .append(\&quot;defs\&quot;)\n      .append(\&quot;clipPath\&quot;)\n      .attr(\&quot;id\&quot;, \&quot;clip\&quot;)\n      .append(\&quot;rect\&quot;)\n      .attr(\&quot;y\&quot;, -margin.top)\n      .attr(\&quot;width\&quot;, width)\n      .attr(\&quot;height\&quot;, height + margin.top + margin.bottom)\n\n    y.domain(extent(stations, (station) =&gt; station.distance) as Limits)\n\n    const stationSelection = svg\n      .append(\&quot;g\&quot;)\n      .attr(\&quot;class\&quot;, styles.station)\n      .selectAll(\&quot;g\&quot;)\n      .data(stations)\n      .enter()\n      .append(\&quot;g\&quot;)\n      .attr(\&quot;transform\&quot;, (station) =&gt; `translate(0,${y(station.distance)})`)\n\n    stationSelection\n      .append(\&quot;text\&quot;)\n      .attr(\&quot;x\&quot;, -6)\n      .attr(\&quot;dy\&quot;, \&quot;.35em\&quot;)\n      .text((station) =&gt; station.name)\n    stationSelection.append(\&quot;line\&quot;).attr(\&quot;x2\&quot;, width)\n    svg.append(\&quot;g\&quot;).attr(\&quot;class\&quot;, `x top ${styles.axis}`).call(xAxisTop)\n    svg\n      .append(\&quot;g\&quot;)\n      .attr(\&quot;class\&quot;, `x bottom ${styles.axis}`)\n      .attr(\&quot;transform\&quot;, `translate(0,${height})`)\n      .call(xAxisBottom)\n\n    const mouseover = (...[, train]: [unknown, Train]) =&gt; {\n      select(`.train-${train.id}`).select(\&quot;path\&quot;).style(\&quot;stroke-width\&quot;, \&quot;5px\&quot;)\n    }\n\n    const mouseleave = (...[, train]: [unknown, Train]) =&gt; {\n      select(`.train-${train.id}`).select(\&quot;path\&quot;).style(\&quot;stroke-width\&quot;, \&quot;2.5px\&quot;)\n    }\n\n    const trainSelection = svg\n      .append(\&quot;g\&quot;)\n      .attr(\&quot;class\&quot;, styles.train)\n      .attr(\&quot;clip-path\&quot;, \&quot;url(#clip)\&quot;)\n      .selectAll(\&quot;g\&quot;)\n      .data(trains.filter((train) =&gt; /[NLB]/.test(train.type)))\n      .enter()\n      .append(\&quot;g\&quot;)\n      .attr(\n        \&quot;class\&quot;,\n        (train) =&gt; `${trainTypeToStyle[train.type]} train-${train.id}`\n      )\n      .on(\&quot;mouseover\&quot;, mouseover)\n      .on(\&quot;mouseleave\&quot;, mouseleave)\n\n    const line = lineD3&lt;Stop&gt;()\n      .x((stop) =&gt; x(stop.time!))\n      .y((stop) =&gt; y(stop.station.distance))\n\n    trainSelection\n      .append(\&quot;path\&quot;)\n      .attr(\&quot;d\&quot;, (train) =&gt; line(train.stops))\n      .attr(\&quot;class\&quot;, trainPathClass)\n      .attr(\&quot;title\&quot;, getTrainTitle)\n\n    trainSelection\n      .selectAll(\&quot;circle\&quot;)\n      .data((train) =&gt; train.stops)\n      .enter()\n      .append(\&quot;circle\&quot;)\n      .attr(\n        \&quot;transform\&quot;,\n        (stop) =&gt; `translate(${x(stop.time!)},${y(stop.station.distance)})`\n      )\n      .style(\&quot;filter\&quot;, \&quot;url(#drop-shadow-trains)\&quot;)\n      .attr(\&quot;r\&quot;, \&quot;5px\&quot;)\n      .attr(\&quot;class\&quot;, stopCircleClass)\n      .attr(\n        \&quot;title\&quot;,\n        (stop) =&gt;\n          `${getTrainTitle(trains[stop.trainIndex])}\\n${\n            stop.station.name\n          } at ${formatAMPM(stop.time!)}`\n      )\n\n    $(`.${trainPathClass}`).tooltip({\n      track: true,\n    })\n    $(`.${stopCircleClass}`).tooltip({\n      track: true,\n    })\n  }\n\n  return {\n    refresh: (limits: [number, number]) =&gt; {\n      refreshOnHourChange({\n        limits,\n        redraw,\n      })\n    },\n  }\n}\n\nconst main = async () =&gt; {\n  const rootElId = \&quot;chart\&quot;\n\n  const schedulesData = await fetchData()\n\n  const { refresh } = renderChart({\n    rootElId,\n    schedulesData,\n  })\n\n  const slider = $(\&quot;.slider\&quot;)\n\n  slider.slider({\n    change: () =&gt; {\n      const limits = slider.slider(\&quot;values\&quot;) as Limits\n\n      refresh(limits)\n    },\n    range: true,\n  })\n\n  slider.slider(\&quot;values\&quot;, [10, 50])\n}\n\nexport default main\n&quot;,&quot;fileName&quot;:&quot;mareys-schedule&quot;}],&quot;page&quot;:{&quot;content&quot;:&quot;import React from \&quot;react\&quot;\n\nimport { DemoPageProps } from \&quot;@/common\&quot;\n\nimport Demo from \&quot;@/components/demo\&quot;\n\nimport main from \&quot;@/demos/mareys-schedule/mareys-schedule\&quot;\n\nconst MareysSchedule = ({ pageContext }: DemoPageProps) =&gt; (\n  &lt;Demo\n    links={[\&quot;/vendors/jquery-ui/themes/base/jquery-ui.min.css\&quot;]}\n    main={main}\n    pageContext={pageContext}\n    scripts={[\&quot;/vendors/jquery-ui/jquery-ui.min.js\&quot;]}\n  &gt;\n    &lt;div&gt;\n      &lt;div className=\&quot;slider\&quot; /&gt;\n    &lt;/div&gt;\n    &lt;div id=\&quot;chart\&quot; /&gt;\n  &lt;/Demo&gt;\n)\n\nexport default MareysSchedule\n&quot;,&quot;type&quot;:&quot;tsx&quot;}},&quot;key&quot;:&quot;mareys-schedule&quot;},&quot;meta&quot;:{&quot;description&quot;:&quot;Trains schedule example using D3.js, with San Francisco as example, and with the addition of a translucent tooltip and a 3D style.&quot;}}},&quot;staticQueryHashes&quot;:[]}</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Wed, 01 Sep 2021 08:00:00 GMT</p>
    </body>
  </html>
  