
  <!DOCTYPE html>
  <html>
    <head>
      <title>page-data.json</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">public/page-data/d3js/meteorites-map/page-data.json</td><td class="">100.00%</td><td class="">95%</td><td class="">0</td><td class="">0</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">{&quot;componentChunkName&quot;:&quot;component---src-pages-d-3-js-meteorites-map-tsx&quot;,&quot;path&quot;:&quot;/d3js/meteorites-map/&quot;,&quot;result&quot;:{&quot;pageContext&quot;:{&quot;demoInfo&quot;:{&quot;dataFiles&quot;:[&quot;meteorites.json&quot;,&quot;world_countries.json&quot;],&quot;docs&quot;:[[&quot;animejs API reference&quot;,&quot;https://animejs.com/documentation/&quot;],[&quot;animejs Types&quot;,&quot;https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/animejs/index.d.ts&quot;],[&quot;d3-zoom API reference&quot;,&quot;https://github.com/d3/d3-zoom#api-reference&quot;],[&quot;d3-zoom Types&quot;,&quot;https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/d3-zoom/index.d.ts&quot;]],&quot;isCompleted&quot;:true,&quot;name&quot;:&quot;Meteorites Map&quot;,&quot;notes&quot;:[&quot;Created this chart with the data and added the interactions&quot;,&quot;Use the mouse wheel to zoom in / out, and use the mouse to pan&quot;],&quot;sources&quot;:[&quot;http://bl.ocks.org/micahstubbs/8e15870eb432a21f0bc4d3d527b2d14f&quot;,&quot;https://github.com/jdorfman/awesome-json-datasets#nasa&quot;],&quot;summary&quot;:[],&quot;category&quot;:&quot;d3js&quot;,&quot;files&quot;:{&quot;cssModule&quot;:&quot;.countryTooltip {\n  background: #ffccfc;\n}\n\n.infoTrigger {\n  cursor: pointer;\n  opacity: 0.7;\n  transition: linear 0.5s opacity;\n\n  circle {\n    fill: #fff;\n    stroke: #ccc;\n  }\n\n  text {\n    fill: white;\n    font-size: 30px;\n    stroke: black;\n    text-anchor: middle;\n    transform: translate(0, 10px);\n  }\n\n  &amp;:hover {\n    opacity: 1;\n\n    text {\n      fill: green;\n    }\n  }\n}\n\n.meteorite {\n  fill: orange;\n\n  &amp;:hover {\n    fill: blue;\n  }\n}\n\n.meteorite.active {\n  fill: red;\n}\n\n.meteorite.moved {\n  fill: green;\n}\n\n.modal {\n  background: #fff;\n  border: 1px solid white;\n  border-radius: 5px;\n  box-shadow: 0 22px 70px 4px rgba(0, 0, 0, 0.56);\n  left: 100px;\n  padding: 15px;\n  position: absolute;\n  z-index: 10;\n}\n&quot;,&quot;demo&quot;:[{&quot;content&quot;:&quot;import anime from \&quot;animejs\&quot;\nimport {\n  GeoProjection,\n  Selection,\n  geoMercator,\n  geoPath,\n  json,\n  select,\n  timeFormat,\n  zoom,\n} from \&quot;d3\&quot;\nimport qs from \&quot;query-string\&quot;\nimport { v1 as uuidv1 } from \&quot;uuid\&quot;\n\nimport * as styles from \&quot;./meteorites-map.module.css\&quot;\n\n// @TODO:\n// - review the checklist for the rest of refactors\n\ntype Point = [number, number]\n\ntype Meteorite = {\n  fall: string\n  geolocation: { coordinates: Point; type: \&quot;Point\&quot; }\n  id: string\n  mass: string\n  name: string\n  nametype: string\n  recclass: string\n  reclat: string\n  reclong: string\n  year: string\n}\ntype MeteoriteGeo = Meteorite &amp; {\n  geometry: Meteorite[\&quot;geolocation\&quot;]\n  type: \&quot;Feature\&quot;\n}\ntype Countries = {\n  features: Array&lt;{\n    geometry: { coordinates: Point[]; type: \&quot;Polygon\&quot; }\n    id: string\n    properties: { name: string }\n    type: \&quot;Feature\&quot;\n  }&gt;\n  type: \&quot;FeatureCollection\&quot;\n}\ntype State = {\n  isDuringAnimation: boolean\n  selectedMeteorite: string | null\n}\n\nconst fetchData = async () =&gt; {\n  const [countries, meteorites] = (await (Promise.all([\n    json(`${ROOT_PATH}data/d3js/meteorites-map/world_countries.json`),\n    json(`${ROOT_PATH}data/d3js/meteorites-map/meteorites.json`),\n  ]) as unknown)) as unknown[]\n\n  return ({\n    countries,\n    meteorites,\n  } as unknown) as { countries: Countries; meteorites: Meteorite[] }\n}\n\nconst margin = {\n  bottom: 0,\n  left: 0,\n  right: 0,\n  top: 0,\n}\n\nconst svgCutBottom = 250 // to remove the south pole which doesn&#x27;t have any in the data\nconst height = 1000 - margin.top - margin.bottom\nconst modalHiddenTop = 250\nconst clickedMeteoriteDistortion = 20\n\nconst removeSelection = ({\n  meteoritesEls,\n  modal,\n  state,\n}: {\n  meteoritesEls: Selection&lt;SVGPathElement, MeteoriteGeo, SVGGElement, unknown&gt;\n  modal: Selection&lt;HTMLDivElement, unknown, HTMLElement, unknown&gt;\n  state: State\n}) =&gt; {\n  if (state.isDuringAnimation) {\n    return\n  }\n\n  state.selectedMeteorite = null\n\n  meteoritesEls.attr(\&quot;class\&quot;, styles.meteorite)\n\n  anime({\n    targets: `.${styles.meteorite}`,\n    translateX: 0,\n    translateY: 0,\n  })\n\n  state.isDuringAnimation = true\n\n  anime({\n    complete: () =&gt; {\n      state.isDuringAnimation = false\n      modal.text(\&quot;\&quot;)\n    },\n    targets: `.${styles.modal}`,\n    translateY: 0,\n  })\n}\n\nconst getNearMeteoritessWithVectors = ({\n  allMeteorites,\n  projectionFn,\n  targetMeteorite,\n}: {\n  allMeteorites: MeteoriteGeo[]\n  projectionFn: GeoProjection\n  targetMeteorite: MeteoriteGeo\n}) =&gt; {\n  const targetProj = projectionFn(targetMeteorite.geometry.coordinates) as [\n    number,\n    number\n  ]\n\n  const nearMeteorites = allMeteorites\n    .slice(0)\n    .filter((otherMeteorite) =&gt; !!(otherMeteorite.geometry as unknown))\n    .map((otherMeteorite) =&gt; {\n      const {\n        geometry: { coordinates: otherMeteoriteCoordinates },\n      } = otherMeteorite\n      const proj = projectionFn(otherMeteoriteCoordinates) as [number, number]\n      const vector = [proj[0] - targetProj[0], proj[1] - targetProj[1]]\n      const vectorLength = Math.sqrt(\n        Math.pow(vector[0], 2) + Math.pow(vector[1], 2)\n      )\n\n      return {\n        ...otherMeteorite,\n        vector,\n        vectorLength,\n      }\n    })\n    .filter(\n      (otherMeteorite) =&gt;\n        otherMeteorite.vectorLength &lt; 20 &amp;&amp; otherMeteorite.vectorLength !== 0\n    )\n    .map((otherMeteorite) =&gt; ({\n      ...otherMeteorite,\n      vectorNormalized: [\n        otherMeteorite.vector[0] / otherMeteorite.vectorLength,\n        otherMeteorite.vector[1] / otherMeteorite.vectorLength,\n      ] as [number, number],\n    }))\n\n  const nearMeteoritesSet = new Set(nearMeteorites.map((a) =&gt; a.id))\n\n  const vectorsMap = nearMeteorites.reduce((acc, nearMeteorite) =&gt; {\n    acc[nearMeteorite.id] = nearMeteorite.vectorNormalized\n\n    return acc\n  }, {} as Record&lt;string, [number, number]&gt;)\n\n  return {\n    nearMeteorites,\n    nearMeteoritesSet,\n    vectorsMap,\n  }\n}\n\nconst texts = {\n  title: \&quot;Meteorite landings in Earth\&quot;,\n}\n\nconst meteoriteClickHandler = ({\n  clickedMeteorite,\n  meteoritesEls,\n  meteoritesGeo,\n  modal,\n  projectionFn,\n  rootElId,\n  state,\n}: {\n  clickedMeteorite: MeteoriteGeo\n  meteoritesEls: Selection&lt;SVGPathElement, MeteoriteGeo, SVGGElement, unknown&gt;\n  meteoritesGeo: MeteoriteGeo[]\n  modal: Selection&lt;HTMLDivElement, unknown, HTMLElement, unknown&gt;\n  projectionFn: GeoProjection\n  rootElId: string\n  state: State\n}) =&gt; {\n  if (state.isDuringAnimation) {\n    return\n  }\n\n  if (state.selectedMeteorite === clickedMeteorite.id) {\n    removeSelection({\n      meteoritesEls,\n      modal,\n      state,\n    })\n\n    return\n  }\n\n  state.selectedMeteorite = clickedMeteorite.id\n\n  const year = timeFormat(\&quot;%Y\&quot;)(new Date(clickedMeteorite.year))\n  const mass = new Intl.NumberFormat().format(+clickedMeteorite.mass)\n\n  modal.html(\n    `\n&lt;h1&gt;${clickedMeteorite.name}&lt;/h1&gt;\n&lt;p&gt;Year: ${year}, Class: &lt;a href=\&quot;https://www.google.com/search?${qs.stringify({\n      q: `${clickedMeteorite.recclass} Meteorite Class`,\n    })}\&quot; target=\&quot;_blank\&quot;&gt;${clickedMeteorite.recclass}&lt;/a&gt;&lt;/p&gt;\n&lt;p&gt;${mass ? `Mass: ${mass}g, ` : \&quot;\&quot;}Name: ${clickedMeteorite.nametype}&lt;/p&gt;\n&lt;p&gt;&lt;a href=\&quot;https://www.google.com/search?${qs.stringify({\n      q: `${clickedMeteorite.name} Meteorite ${year}`,\n    })}\&quot; target=\&quot;_blank\&quot;&gt;Click here to search&lt;/a&gt;&lt;/p&gt;\n`.trim()\n  )\n\n  const { nearMeteoritesSet, vectorsMap } = getNearMeteoritessWithVectors({\n    allMeteorites: meteoritesGeo,\n    projectionFn,\n    targetMeteorite: clickedMeteorite,\n  })\n\n  const getShouldSet0 = (idx: number) =&gt; {\n    const { [idx]: animatedMeteorite } = meteoritesGeo\n\n    return (\n      animatedMeteorite.id === clickedMeteorite.id ||\n      !nearMeteoritesSet.has(animatedMeteorite.id)\n    )\n  }\n\n  meteoritesEls.attr(\&quot;class\&quot;, (meteorite) =&gt; {\n    if (nearMeteoritesSet.has(meteorite.id)) {\n      return `${styles.moved} ${styles.meteorite}`\n    }\n\n    return meteorite.id === clickedMeteorite.id\n      ? `${styles.active} ${styles.meteorite}`\n      : styles.meteorite\n  })\n\n  const getTranslateFn = (coordIdx: number) =&gt; (_el: unknown, idx: number) =&gt; {\n    if (getShouldSet0(idx)) {\n      return 0\n    }\n\n    const { [idx]: animatedMeteorite } = meteoritesGeo\n    const { [animatedMeteorite.id]: vectorNormalized } = vectorsMap\n\n    return vectorNormalized[coordIdx] * clickedMeteoriteDistortion\n  }\n\n  anime({\n    targets: `.${styles.meteorite}`,\n    translateX: getTranslateFn(0),\n    translateY: getTranslateFn(1),\n  })\n\n  const rootEl = document.getElementById(rootElId) as HTMLElement\n  const { top } = rootEl.getBoundingClientRect()\n\n  anime({\n    targets: `.${styles.modal}`,\n    translateY: modalHiddenTop + 50 + top + window.scrollY,\n  })\n}\n\nconst addInfo = ({\n  svg,\n  width,\n}: {\n  svg: Selection&lt;SVGSVGElement, unknown, HTMLElement, unknown&gt;\n  width: number\n}) =&gt; {\n  const dialogId = `dialog-${uuidv1().slice(0, 6)}`\n\n  const group = svg\n    .append(\&quot;g\&quot;)\n    .attr(\&quot;transform\&quot;, `translate(${width - 50},50)`)\n    .attr(\&quot;class\&quot;, styles.infoTrigger)\n\n  svg.append(\&quot;g\&quot;).html(`\n&lt;filter id=\&quot;pulse\&quot; x=\&quot;0\&quot; y=\&quot;0\&quot; width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n  &lt;feTurbulence result=\&quot;cloud\&quot; baseFrequency=\&quot;.01\&quot; seed=\&quot;1\&quot;  type=\&quot;fractalNoise\&quot; numOctaves=\&quot;2\&quot;&gt;\n  &lt;animate attributeName=\&quot;baseFrequency\&quot; calcMode=\&quot;paced\&quot; begin=\&quot;0s\&quot; dur=\&quot;12s\&quot; values=\&quot;.01;.13;.01;\&quot; repeatCount=\&quot;indefinite\&quot;/&gt;\n  &lt;/feTurbulence&gt;\n  &lt;feComposite operator=\&quot;in\&quot; in=\&quot;cloud\&quot; in2=\&quot;SourceGraphic\&quot;/&gt;\n&lt;/filter&gt;\n    `)\n\n  const dialog = select(document.body).append(\&quot;div\&quot;).attr(\&quot;id\&quot;, dialogId).html(\n    `\n&lt;p&gt;The green circles refer to meteorites which were moved in the map to allow seeing the selected meteorite, which is in red.&lt;/p&gt;\n&lt;p&gt;You can find the &lt;a href=\&quot;http://www.meteoritemarket.com/type.htm\&quot;&gt;meteorites classification here&lt;/a&gt;&lt;/p&gt;\n`.trim()\n  )\n\n  $(`#${dialogId}`).dialog({\n    autoOpen: false,\n    modal: true,\n    resizable: false,\n  })\n\n  group.append(\&quot;circle\&quot;).attr(\&quot;r\&quot;, \&quot;20\&quot;).attr(\&quot;filter\&quot;, \&quot;url(#pulse)\&quot;)\n\n  group.append(\&quot;text\&quot;).text(\&quot;?\&quot;)\n\n  group.on(\&quot;click\&quot;, () =&gt; {\n    $(`#${dialogId}`).dialog(\&quot;open\&quot;)\n  })\n\n  return {\n    remove: () =&gt; {\n      dialog.remove()\n    },\n  }\n}\n\nconst zoomed = function (this: SVGSVGElement, e: any) {\n  select(this).transition().duration(500).attr(\&quot;transform\&quot;, e.transform)\n}\n\ntype RenderChart = (o: {\n  countries: Countries\n  meteorites: Meteorite[]\n  rootElId: string\n}) =&gt; void\n\nconst renderChart: RenderChart = ({ countries, meteorites, rootElId }) =&gt; {\n  const rootEl = document.getElementById(rootElId) as HTMLElement\n  const width =\n    rootEl.getBoundingClientRect().width - margin.left - margin.right\n  const projectionFn = geoMercator().translate([width / 2, height / 2])\n  const path = geoPath().projection(projectionFn)\n\n  const state: State = {\n    isDuringAnimation: false,\n    selectedMeteorite: null,\n  }\n\n  const modal = select(`#${rootElId}`)\n    .append(\&quot;div\&quot;)\n    .attr(\&quot;class\&quot;, styles.modal)\n    .style(\&quot;top\&quot;, `${-modalHiddenTop}px`)\n\n  const meteoritesGeo: MeteoriteGeo[] = meteorites.map((a) =&gt; ({\n    ...a,\n    geometry: a.geolocation,\n    type: \&quot;Feature\&quot;,\n  }))\n\n  const removeSelectionFn = () =&gt; {\n    removeSelection({\n      meteoritesEls, // eslint-disable-line @typescript-eslint/no-use-before-define\n      modal,\n      state,\n    })\n  }\n\n  const meteoritessClickHandlerFn = (\n    clickEvent: MouseEvent,\n    clickedMeteorite: MeteoriteGeo\n  ) =&gt; {\n    clickEvent.stopPropagation()\n    meteoriteClickHandler({\n      clickedMeteorite,\n      meteoritesEls, // eslint-disable-line @typescript-eslint/no-use-before-define\n      meteoritesGeo,\n      modal,\n      projectionFn,\n      rootElId,\n      state,\n    })\n  }\n\n  const svg = select(`#${rootElId}`)\n    .append(\&quot;svg\&quot;)\n    .attr(\&quot;width\&quot;, width)\n    .attr(\&quot;height\&quot;, height - svgCutBottom)\n    .style(\&quot;cursor\&quot;, \&quot;pointer\&quot;)\n    .on(\&quot;click\&quot;, removeSelectionFn)\n    .style(\&quot;transform-origin\&quot;, \&quot;top left\&quot;)\n    .call(\n      zoom&lt;SVGSVGElement, unknown&gt;()\n        .extent([\n          [0, 0],\n          [width, height],\n        ])\n        .on(\&quot;end\&quot;, zoomed)\n    )\n\n  const svgMap = svg.append(\&quot;g\&quot;)\n\n  svg\n    .append(\&quot;text\&quot;)\n    .text(texts.title)\n    .attr(\&quot;text-anchor\&quot;, \&quot;middle\&quot;)\n    .style(\&quot;font-size\&quot;, \&quot;20px\&quot;)\n    .attr(\&quot;transform\&quot;, `translate(${width / 2},40)`)\n    .style(\&quot;font-weight\&quot;, \&quot;bold\&quot;)\n\n  addInfo({\n    svg,\n    width,\n  })\n\n  const countryClass = `country-${uuidv1().slice(0, 6)}`\n\n  svgMap\n    .append(\&quot;g\&quot;)\n    .attr(\&quot;class\&quot;, countryClass)\n    .selectAll(\&quot;path\&quot;)\n    .data(countries.features)\n    .enter()\n    .append(\&quot;path\&quot;)\n    .attr(\&quot;d\&quot;, path as any)\n    .attr(\&quot;fill\&quot;, \&quot;#ccc\&quot;)\n    .style(\&quot;stroke\&quot;, \&quot;white\&quot;)\n    .style(\&quot;stroke-width\&quot;, 1.5)\n    .style(\&quot;opacity\&quot;, 0.8)\n    .style(\&quot;stroke\&quot;, \&quot;white\&quot;)\n    .style(\&quot;stroke-width\&quot;, 0.3)\n    .on(\&quot;click\&quot;, removeSelectionFn)\n    .attr(\&quot;title\&quot;, (country) =&gt; country.properties.name)\n\n  const meteoritessWrapper = svgMap.append(\&quot;g\&quot;).on(\&quot;click\&quot;, removeSelectionFn)\n\n  const meteoritesEls = meteoritessWrapper\n    .selectAll(\&quot;path\&quot;)\n    .data(meteoritesGeo)\n    .enter()\n    .append(\&quot;path\&quot;)\n    .attr(\&quot;d\&quot;, path as any)\n    .attr(\&quot;class\&quot;, styles.meteorite)\n    .style(\&quot;stroke\&quot;, \&quot;white\&quot;)\n    .style(\&quot;cursor\&quot;, \&quot;pointer\&quot;)\n    .style(\&quot;stroke-width\&quot;, 1.5)\n    .style(\&quot;opacity\&quot;, 0.8)\n    .attr(\&quot;title\&quot;, (d) =&gt; d.name)\n    .on(\&quot;click\&quot;, meteoritessClickHandlerFn)\n\n  $(`.${styles.meteorite}`).tooltip({\n    track: true,\n  })\n\n  $(`.${countryClass}`).tooltip({\n    tooltipClass: styles.countryTooltip,\n    track: true,\n  })\n}\n\nconst main = async () =&gt; {\n  const { countries, meteorites } = await fetchData()\n\n  renderChart({\n    countries,\n    meteorites,\n    rootElId: \&quot;chart\&quot;,\n  })\n}\n\nexport default main\n&quot;,&quot;fileName&quot;:&quot;meteorites-map&quot;}],&quot;page&quot;:{&quot;content&quot;:&quot;import React from \&quot;react\&quot;\n\nimport { DemoPageProps } from \&quot;@/common\&quot;\n\nimport Demo from \&quot;@/components/demo\&quot;\n\nimport main from \&quot;@/demos/meteorites-map/meteorites-map\&quot;\n\nconst Area = ({ pageContext }: DemoPageProps) =&gt; (\n  &lt;Demo\n    links={[\&quot;/vendors/jquery-ui/themes/base/jquery-ui.min.css\&quot;]}\n    main={main}\n    pageContext={pageContext}\n    scripts={[\&quot;/vendors/jquery-ui/jquery-ui.min.js\&quot;]}\n  &gt;\n    &lt;div id=\&quot;chart\&quot; /&gt;\n  &lt;/Demo&gt;\n)\n\nexport default Area\n&quot;,&quot;type&quot;:&quot;tsx&quot;}},&quot;key&quot;:&quot;meteorites-map&quot;},&quot;meta&quot;:{&quot;description&quot;:&quot;World map chart with information about meteorite landings. It uses D3, animejs and other libraries, and it is highly interactive. It also informs about each meteorite properties like the name or classification.&quot;}}},&quot;staticQueryHashes&quot;:[]}</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Sun, 22 Aug 2021 17:19:54 GMT</p>
    </body>
  </html>
  