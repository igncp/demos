
  <!DOCTYPE html>
  <html>
    <head>
      <title>page-data.json</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">public/page-data/d3js/energy-sankey/page-data.json</td><td class="">100.00%</td><td class="">95%</td><td class="">0</td><td class="">0</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">{&quot;componentChunkName&quot;:&quot;component---src-pages-d-3-js-energy-sankey-tsx&quot;,&quot;path&quot;:&quot;/d3js/energy-sankey/&quot;,&quot;result&quot;:{&quot;pageContext&quot;:{&quot;demoInfo&quot;:{&quot;dataFiles&quot;:[&quot;data.json&quot;],&quot;docs&quot;:[[&quot;d3-sankey API reference&quot;,&quot;https://github.com/d3/d3-sankey#api-reference&quot;],[&quot;d3-sankey Types&quot;,&quot;https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/d3-sankey/index.d.ts&quot;],[&quot;mix-blend-mode CSS property&quot;,&quot;https://developer.mozilla.org/en-US/docs/Web/CSS/mix-blend-mode&quot;],[&quot;gradientUnits SVG attribute&quot;,&quot;https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/gradientUnits&quot;],[&quot;chroma-js API reference&quot;,&quot;https://vis4.net/chromajs/#api&quot;],[&quot;chroma-js Types&quot;,&quot;https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/chroma-js/index.d.ts&quot;],[&quot;animejs API reference&quot;,&quot;https://animejs.com/documentation/&quot;],[&quot;animejs Types&quot;,&quot;https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/animejs/index.d.ts&quot;],[&quot;hotkeys API reference&quot;,&quot;https://github.com/jaywcjlove/hotkeys#api-reference&quot;],[&quot;hotkeys Types&quot;,&quot;https://github.com/jaywcjlove/hotkeys/blob/master/index.d.ts&quot;]],&quot;isCompleted&quot;:true,&quot;name&quot;:&quot;Energy Sankey&quot;,&quot;notes&quot;:[&quot;Added interaction on click&quot;,&quot;You can click a rect while pressing control to Google Search&quot;],&quot;sources&quot;:[&quot;https://observablehq.com/@d3/sankey-diagram&quot;,&quot;https://www.gov.uk/guidance/2050-pathways-analysis&quot;,&quot;https://designmodo.com/animate-svg-gradients/&quot;],&quot;summary&quot;:[],&quot;category&quot;:&quot;d3js&quot;,&quot;files&quot;:{&quot;cssModule&quot;:&quot;.chartNode {\n  cursor: pointer;\n}\n\n.chartLinkG {\n  mix-blend-mode: multiply;\n}\n\n.chartLink {\n  cursor: pointer;\n  stroke-opacity: 0.7;\n\n  &amp;:hover {\n    stroke-opacity: 0.9;\n  }\n}\n&quot;,&quot;demo&quot;:[{&quot;content&quot;:&quot;import hotkeys from \&quot;hotkeys-js\&quot;\nimport qs from \&quot;query-string\&quot;\n\nimport { renderChart } from \&quot;./energy-sankey-chart\&quot;\nimport { createChartConfig, fetchData } from \&quot;./energy-sankey-chart-data\&quot;\n\nconst main = async () =&gt; {\n  hotkeys(\&quot;control\&quot;, () =&gt; {})\n\n  const energySankeyData = await fetchData()\n\n  const chartConfig = createChartConfig({\n    energySankeyData,\n    onNodeClick: (node) =&gt; {\n      if (!hotkeys.isPressed(\&quot;control\&quot;)) {\n        return false\n      }\n\n      window.open(\n        `https://www.google.com/search?${qs.stringify({\n          ie: \&quot;UTF-8\&quot;,\n          q: `Energy ${node.name}`,\n        })}`\n      )\n\n      return true\n    },\n  })\n\n  renderChart(chartConfig)\n}\n\nexport default main\n&quot;,&quot;fileName&quot;:&quot;energy-sankey&quot;},{&quot;content&quot;:&quot;import { format as formatD3, json } from \&quot;d3\&quot;\n\nimport { ChartConfig } from \&quot;./energy-sankey-chart\&quot;\n\ntype EnergyDataLink = {\n  source: string\n  target: string\n  value: number // eslint-disable-line id-denylist\n}\n\ntype EnergyDataNode = {\n  category: string\n  name: string\n}\n\ntype EnergyData = {\n  links: EnergyDataLink[]\n  nodes: EnergyDataNode[]\n  units: string\n}\n\nexport const fetchData = () =&gt;\n  json(`${ROOT_PATH}data/d3js/energy-sankey/data.json`) as Promise&lt;EnergyData&gt;\n\ntype Config = ChartConfig&lt;EnergyDataNode, EnergyDataLink&gt;\n\nconst getNodeId: Config[\&quot;getNodeId\&quot;] = (energyNode) =&gt; energyNode.name\nconst getNodeText: Config[\&quot;getNodeText\&quot;] = (energyNode) =&gt; energyNode.name\n\nexport const createChartConfig = ({\n  energySankeyData,\n  onNodeClick,\n}: {\n  energySankeyData: EnergyData\n  onNodeClick: Config[\&quot;onNodeClick\&quot;]\n}): Config =&gt; {\n  const format = (numberValue: number) =&gt; {\n    const formatFn = formatD3(\&quot;,.0f\&quot;)\n\n    return `${formatFn(numberValue)} ${energySankeyData.units}`\n  }\n\n  const getNodeTitle: Config[\&quot;getNodeTitle\&quot;] = ({ nodeValue, sankeyNode }) =&gt;\n    [\n      sankeyNode.category === sankeyNode.name ? \&quot;\&quot; : sankeyNode.category,\n      sankeyNode.name,\n      format(nodeValue!),\n    ]\n      .filter(Boolean)\n      .join(\&quot;\\n\&quot;)\n\n  const getLinkTitle: Config[\&quot;getLinkTitle\&quot;] = ({\n    sankeyLink,\n    sankeyLinkSource,\n    sankeyLinkTarget,\n  }) =&gt;\n    `${sankeyLinkSource.name} â†’ ${sankeyLinkTarget.name}\\n${format(\n      sankeyLink.value\n    )}`\n\n  return {\n    chartLinks: energySankeyData.links,\n    chartNodes: energySankeyData.nodes,\n    getLinkTitle,\n    getNodeId,\n    getNodeText,\n    getNodeTitle,\n    onNodeClick,\n    rootElId: \&quot;chart\&quot;,\n  }\n}\n&quot;,&quot;fileName&quot;:&quot;energy-sankey-chart-data&quot;},{&quot;content&quot;:&quot;import anime from \&quot;animejs\&quot;\nimport chroma from \&quot;chroma-js\&quot;\nimport { Selection, scaleOrdinal, schemePastel2, select } from \&quot;d3\&quot;\nimport {\n  SankeyLink,\n  SankeyNode,\n  sankey as sankeyD3,\n  sankeyLeft,\n  sankeyLinkHorizontal,\n} from \&quot;d3-sankey\&quot;\n\nimport * as styles from \&quot;./energy-sankey.module.css\&quot;\n\ntype State = {\n  isInTransition: boolean\n  linkSelected: boolean\n  selectedNode: string\n}\n\ntype AddedGradients = { [k: string]: true }\n\nconst getRandomInt = ({ max, min }: { max: number; min: number }): number =&gt; {\n  const minRound = Math.ceil(min)\n  const maxRound = Math.floor(max)\n\n  return Math.floor(Math.random() * (maxRound - minRound + 1)) + minRound\n}\n\nconst createGradients = ({\n  addedGradients,\n  fromColor,\n  svg,\n  toColor,\n}: {\n  addedGradients: AddedGradients\n  fromColor: string\n  svg: Selection&lt;SVGElement, unknown, HTMLElement, unknown&gt;\n  toColor: string\n}): string =&gt; {\n  const id = `link-gradient-${fromColor}-${toColor}`.replace(/#/g, \&quot;\&quot;)\n\n  if (id in addedGradients) {\n    return id\n  }\n\n  const duration = getRandomInt({\n    max: 3,\n    min: 1,\n  })\n  const colorScale = chroma.scale([fromColor, toColor])\n\n  const text = `\n&lt;linearGradient id=\&quot;${id}\&quot;&gt;\n  &lt;stop offset=\&quot;0%\&quot; stop-color=\&quot;${fromColor}\&quot; /&gt;\n  &lt;stop offset=\&quot;50%\&quot; stop-color=\&quot;${colorScale(0.5)}\&quot;&gt;\n    &lt;animate attributeName=\&quot;offset\&quot;\n      values=\&quot;${[5, 6, 7, 8, 9, 8, 7, 6, 5, 4, 3, 2, 3, 4]\n        .map((n) =&gt; `.${n}`)\n        .join(\&quot;;\&quot;)}\&quot;\n      dur=\&quot;${duration}s\&quot;\n      repeatCount=\&quot;indefinite\&quot; /&gt;\n  &lt;/stop&gt;\n  &lt;stop offset=\&quot;100%\&quot; stop-color=\&quot;${toColor}\&quot; /&gt;\n&lt;/linearGradient&gt;\n`.trim()\n\n  svg.append(\&quot;defs\&quot;).html(text)\n\n  addedGradients[id] = true\n\n  return id\n}\n\nconst sankeyHeight = 1000\nconst legendHeight = 0\nconst svgHeight = sankeyHeight + legendHeight\n\nexport type ChartConfig&lt;NodeData, LinkData&gt; = {\n  chartLinks: LinkData[]\n  chartNodes: NodeData[]\n  getLinkTitle: (o: {\n    sankeyLink: LinkData\n    sankeyLinkSource: NodeData\n    sankeyLinkTarget: NodeData\n  }) =&gt; string\n  getNodeId: (node: NodeData) =&gt; string\n  getNodeText: (node: NodeData) =&gt; string\n  getNodeTitle: (o: { nodeValue: number; sankeyNode: NodeData }) =&gt; string\n  onNodeClick?: (node: NodeData) =&gt; boolean\n  rootElId: string\n}\n\nexport const renderChart = &lt;NodeData, LinkData&gt;(\n  chartConfig: ChartConfig&lt;NodeData, LinkData&gt;\n) =&gt; {\n  const {\n    chartLinks,\n    chartNodes,\n    getNodeId,\n    onNodeClick,\n    rootElId,\n  } = chartConfig\n\n  type ChartSankeyNode = SankeyNode&lt;NodeData, LinkData&gt;\n  type ChartSankeyLink = SankeyLink&lt;NodeData, LinkData&gt;\n\n  const state: State = {\n    isInTransition: false,\n    linkSelected: false,\n    selectedNode: \&quot;\&quot;,\n  }\n\n  const container = document.getElementById(rootElId) as HTMLElement\n\n  const color = (() =&gt; {\n    const colorFn = scaleOrdinal(schemePastel2)\n\n    return (sankeyNode: NodeData) =&gt; colorFn(getNodeId(sankeyNode))\n  })()\n\n  const { width } = container.getBoundingClientRect()\n  const svg = select(`#${rootElId}`)\n    .append&lt;SVGElement&gt;(\&quot;svg\&quot;)\n    .attr(\&quot;height\&quot;, svgHeight)\n    .attr(\&quot;width\&quot;, width)\n\n  const sankeyVal = sankeyD3&lt;NodeData, LinkData&gt;()\n    .nodeId(getNodeId)\n    .nodeAlign(sankeyLeft)\n    .nodeWidth(15)\n    .nodePadding(10)\n    .extent([\n      [1, 5],\n      [width - 1, sankeyHeight - 5],\n    ])\n\n  const { links, nodes } = sankeyVal({\n    links: (chartLinks.map((sankeyLink) =&gt;\n      Object.assign({}, sankeyLink)\n    ) as unknown) as Array&lt;SankeyLink&lt;NodeData, LinkData&gt;&gt;,\n    nodes: chartNodes.map((sankeyNode) =&gt;\n      Object.assign({}, sankeyNode)\n    ) as NodeData[],\n  })\n\n  const nodeG = svg.append(\&quot;g\&quot;).attr(\&quot;stroke\&quot;, \&quot;#000\&quot;)\n\n  let lastAnime = () =&gt; {}\n\n  const nodeClickHandler = ({\n    linkPath,\n    sankeyNode,\n  }: {\n    linkPath: Selection&lt;SVGPathElement, ChartSankeyLink, SVGGElement, unknown&gt;\n    sankeyNode: ChartSankeyNode\n  }) =&gt; {\n    if (state.isInTransition) {\n      return\n    }\n\n    if (onNodeClick) {\n      const shouldPreventDefault = onNodeClick(sankeyNode)\n\n      if (shouldPreventDefault) {\n        return\n      }\n    }\n\n    if (state.selectedNode === getNodeId(sankeyNode)) {\n      linkPath.attr(\&quot;display\&quot;, null).style(\&quot;opacity\&quot;, null)\n      state.selectedNode = \&quot;\&quot;\n    } else {\n      state.isInTransition = true\n\n      if (state.selectedNode) {\n        linkPath\n          .style(\&quot;opacity\&quot;, (sankeyLink) =&gt;\n            [\n              getNodeId(sankeyLink.source as ChartSankeyNode),\n              getNodeId(sankeyLink.target as ChartSankeyNode),\n            ].includes(state.selectedNode)\n              ? null\n              : 0\n          )\n          .attr(\&quot;display\&quot;, null)\n      }\n\n      requestAnimationFrame(() =&gt; {\n        linkPath\n          .transition()\n          .duration(500)\n          .style(\&quot;opacity\&quot;, (sankeyLink) =&gt;\n            [\n              getNodeId(sankeyLink.source as ChartSankeyNode),\n              getNodeId(sankeyLink.target as ChartSankeyNode),\n            ].includes(getNodeId(sankeyNode))\n              ? null\n              : 0\n          )\n          .on(\&quot;end\&quot;, () =&gt; {\n            state.isInTransition = false\n            linkPath.attr(\&quot;display\&quot;, (sankeyLink) =&gt;\n              [\n                getNodeId(sankeyLink.source as ChartSankeyNode),\n                getNodeId(sankeyLink.target as ChartSankeyNode),\n              ].includes(getNodeId(sankeyNode))\n                ? null\n                : \&quot;none\&quot;\n            )\n          })\n\n        state.selectedNode = getNodeId(sankeyNode)\n      })\n    }\n  }\n\n  const node = nodeG\n    .selectAll(\&quot;rect\&quot;)\n    .data&lt;ChartSankeyNode&gt;(nodes)\n    .join(\&quot;rect\&quot;)\n    .attr(\&quot;class\&quot;, styles.chartNode)\n    .attr(\&quot;x\&quot;, (sankeyNode: ChartSankeyNode) =&gt; sankeyNode.x0!)\n    .attr(\&quot;y\&quot;, (sankeyNode: ChartSankeyNode) =&gt; sankeyNode.y0!)\n    .attr(\n      \&quot;height\&quot;,\n      (sankeyNode: ChartSankeyNode) =&gt; sankeyNode.y1! - sankeyNode.y0!\n    )\n    .attr(\n      \&quot;width\&quot;,\n      (sankeyNode: ChartSankeyNode) =&gt; sankeyNode.x1! - sankeyNode.x0!\n    )\n    .attr(\&quot;fill\&quot;, color)\n    .on(\&quot;mouseenter\&quot;, function () {\n      lastAnime()\n\n      const animationFirst = anime({\n        direction: \&quot;alternate\&quot;,\n        duration: 1000,\n        easing: \&quot;easeInOutSine\&quot;,\n        loop: false,\n        strokeDashoffset: [anime.setDashoffset, 0],\n        targets: this,\n      })\n      const animationSecond = anime({\n        direction: \&quot;alternate\&quot;,\n        duration: 2000,\n        easing: \&quot;spring(1, 80, 10, 0)\&quot;,\n        loop: true,\n        opacity: [0.6, 1, 0.6],\n        targets: this,\n      })\n\n      lastAnime = () =&gt; {\n        animationFirst.seek(animationFirst.duration)\n        animationSecond.seek(0)\n        anime.remove(this)\n        lastAnime = () =&gt; {}\n      }\n    })\n    .on(\&quot;mouseleave\&quot;, () =&gt; {\n      lastAnime()\n    })\n    .on(\&quot;click\&quot;, (...[, sankeyNode]) =&gt;\n      nodeClickHandler({\n        linkPath, // eslint-disable-line @typescript-eslint/no-use-before-define\n        sankeyNode,\n      })\n    )\n\n  node.attr(\&quot;title\&quot;, (sankeyNode) =&gt;\n    chartConfig.getNodeTitle({\n      nodeValue: sankeyNode.value!,\n      sankeyNode,\n    })\n  )\n\n  $(`.${styles.chartNode}`).tooltip({\n    track: true,\n  })\n\n  const link = svg\n    .append(\&quot;g\&quot;)\n    .attr(\&quot;fill\&quot;, \&quot;none\&quot;)\n    .selectAll(\&quot;g\&quot;)\n    .data&lt;ChartSankeyLink&gt;(links)\n    .join(\&quot;g\&quot;)\n    .attr(\&quot;class\&quot;, styles.chartLinkG)\n\n  const linkPathGenerator = sankeyLinkHorizontal()\n  const addedGradients: AddedGradients = {}\n\n  const linkPath = link\n    .append(\&quot;path\&quot;)\n    .attr(\&quot;d\&quot;, (sankeyLink: ChartSankeyLink) =&gt; {\n      const isHorizontalLine = sankeyLink.y0 === sankeyLink.y1\n\n      return linkPathGenerator(\n        // this is necessary for the default gradientUnits (objectBoundingBox) to work\n        // https://stackoverflow.com/a/34687362\n        isHorizontalLine\n          ? {\n              ...sankeyLink,\n              y1: sankeyLink.y1! + 0.1,\n            }\n          : sankeyLink\n      )\n    })\n    .attr(\&quot;stroke\&quot;, (sankeyLink) =&gt; {\n      const fromColor = color(sankeyLink.source as NodeData)\n      const toColor = color(sankeyLink.target as NodeData)\n\n      const id = createGradients({\n        addedGradients,\n        fromColor,\n        svg,\n        toColor,\n      })\n\n      return `url(#${id})`\n    })\n    .attr(\&quot;class\&quot;, styles.chartLink)\n    .attr(\&quot;stroke-width\&quot;, (sankeyLink) =&gt; Math.max(1, sankeyLink.width!))\n    .on(\&quot;click\&quot;, function () {\n      if (state.isInTransition) {\n        return\n      }\n\n      const currentLink = select(this)\n\n      if (state.linkSelected) {\n        linkPath.attr(\&quot;display\&quot;, null).style(\&quot;opacity\&quot;, null)\n      } else {\n        linkPath.attr(\&quot;display\&quot;, \&quot;none\&quot;)\n        currentLink.attr(\&quot;display\&quot;, null)\n      }\n\n      state.selectedNode = \&quot;\&quot;\n      state.linkSelected = !state.linkSelected\n    })\n\n  link.attr(\&quot;title\&quot;, (sankeyLink) =&gt;\n    chartConfig.getLinkTitle({\n      sankeyLink,\n      sankeyLinkSource: sankeyLink.source as ChartSankeyNode,\n      sankeyLinkTarget: sankeyLink.target as ChartSankeyNode,\n    })\n  )\n\n  $(`.${styles.chartLink}`).tooltip({\n    track: true,\n  })\n\n  nodeG.each(function (this) {\n    const parentEl = this.parentNode as HTMLElement\n\n    parentEl.appendChild(this)\n  })\n\n  svg\n    .append(\&quot;g\&quot;)\n    .attr(\&quot;font-family\&quot;, \&quot;sans-serif\&quot;)\n    .selectAll(\&quot;text\&quot;)\n    .data(nodes)\n    .join(\&quot;text\&quot;)\n    .attr(\&quot;x\&quot;, (sankeyNode) =&gt;\n      sankeyNode.x0! &lt; width / 2 ? sankeyNode.x1! + 6 : sankeyNode.x0! - 6\n    )\n    .attr(\&quot;y\&quot;, (sankeyNode) =&gt; (sankeyNode.y1! + sankeyNode.y0!) / 2)\n    .attr(\&quot;dy\&quot;, \&quot;0.35em\&quot;)\n    .style(\&quot;font-size\&quot;, \&quot;16px\&quot;)\n    .attr(\&quot;text-anchor\&quot;, (sankeyNode) =&gt;\n      sankeyNode.x0! &lt; width / 2 ? \&quot;start\&quot; : \&quot;end\&quot;\n    )\n    .text(chartConfig.getNodeText)\n}\n&quot;,&quot;fileName&quot;:&quot;energy-sankey-chart&quot;}],&quot;page&quot;:{&quot;content&quot;:&quot;import React from \&quot;react\&quot;\n\nimport { DemoPageProps } from \&quot;@/common\&quot;\n\nimport Demo from \&quot;@/components/demo\&quot;\n\nimport main from \&quot;@/demos/energy-sankey/energy-sankey\&quot;\n\nconst EnergySankey = ({ pageContext }: DemoPageProps) =&gt; (\n  &lt;Demo\n    links={[\&quot;/vendors/jquery-ui/themes/base/jquery-ui.min.css\&quot;]}\n    main={main}\n    pageContext={pageContext}\n    scripts={[\&quot;/vendors/jquery-ui/jquery-ui.min.js\&quot;]}\n  &gt;\n    &lt;div id=\&quot;chart\&quot; /&gt;\n  &lt;/Demo&gt;\n)\n\nexport default EnergySankey\n&quot;,&quot;type&quot;:&quot;tsx&quot;}},&quot;key&quot;:&quot;energy-sankey&quot;},&quot;meta&quot;:{&quot;description&quot;:&quot;Sankey diagram with multiple interactive parts and animations. It handles the results alignments.&quot;}}},&quot;staticQueryHashes&quot;:[]}</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Sun, 29 Aug 2021 14:34:48 GMT</p>
    </body>
  </html>
  