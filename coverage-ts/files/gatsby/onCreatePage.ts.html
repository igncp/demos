
  <!DOCTYPE html>
  <html>
    <head>
      <title>onCreatePage.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">gatsby/onCreatePage.ts</td><td class="">99.55%</td><td class="">95%</td><td class="">222</td><td class="">221</td><td class="">1</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import fs from &quot;fs&quot;
import { GatsbyNode } from &quot;gatsby&quot;

import {
  DemoBase,
  DemoPageProps,
  DemoSummary,
  IndexPageProps,
} from &quot;../src/common&quot;

import d3Data from &quot;./info/d3js&quot;
import raphaelData from &quot;./info/raphael&quot;
import metas from &quot;./info/metas&quot;

import { ROOT_PATH } from &quot;./constants&quot;

const categoryToData = {
  d3js: d3Data,
  raphael: raphaelData,
}

type Category = keyof typeof categoryToData

const readIfExists = (filePath: string) =&gt; {
  try {
    return fs.readFileSync(filePath, &quot;utf-8&quot;)
  } catch (_) {
    return &quot;&quot;
  }
}

const getDemoFiles = (demoName: string) =&gt; {
  const extraFiles = fs
    .readdirSync(`${__dirname}/../src/demos/${demoName}`)
    .filter((file) =&gt; /\.ts$/.test(file))
    .map((file) =&gt; file.replace(/\.ts$/, &quot;&quot;))
    .filter((file) =&gt; !file.includes(&quot;.css&quot;) &amp;&amp; file !== demoName)

  return [
    {
      content: readIfExists(`src/demos/${demoName}/${demoName}.ts`),
      fileName: demoName,
    },
  ]
    .concat(
      extraFiles.map((fileName) =&gt; ({
        content: readIfExists(`src/demos/${demoName}/${fileName}.ts`),
        fileName,
      }))
    )
    .filter((d) =&gt; !!d.content)
}

const getPage = (demoName: string, category: string) =&gt; ({
  content: readIfExists(`src/pages/${category}/${demoName}.tsx`),
  type: &quot;tsx&quot;,
})

const getDemoInfo = (slugs: string[]) =&gt; {
  const [category, demoName] = slugs
  const { [category as Category]: categoryData } = categoryToData

  if (!(categoryData as unknown) || !demoName) {
    return null
  }

  const demoFiles = getDemoFiles(demoName)
  const page = getPage(demoName, category)

  type DemoKey = keyof typeof categoryData

  const demoBase = categoryData[demoName as DemoKey] as DemoBase

  return {
    ...demoBase,
    category,
    files: {
      cssModule: readIfExists(`src/demos/${demoName}/${demoName}.module.css`),
      demo: demoFiles,
      page,
    },
    key: demoName,
  }
}

const d3jsDemosSummaries: DemoSummary[] = []
const raphaelDemosSummaries: DemoSummary[] = []

for (const item in d3Data) {
  const demoSummary: DemoSummary = {
    ...d3Data[item as keyof typeof d3Data],
    category: &quot;d3js&quot;,
    key: item,
    route: `${ROOT_PATH}d3js/${item}`,
  }

  d3jsDemosSummaries.push(demoSummary)
}

for (const item in raphaelData) {
  const demoSummary = {
    ...raphaelData[item as keyof typeof raphaelData],
    category: &quot;raphael&quot;,
    key: item,
    route: `${ROOT_PATH}raphael/${item}`,
  }

  raphaelDemosSummaries.push(demoSummary)
}

const demosSummaries = d3jsDemosSummaries
  .concat(raphaelDemosSummaries)
  .sort((a, b) =&gt; {
    if (a.name === b.name) return 0

    return a.name &lt; b.name ? -1 : 1
  })

const onCreatePage: GatsbyNode[&quot;onCreatePage&quot;] = ({ actions, page }) =&gt; {
  const slugs = page.path.split(&quot;/&quot;).filter(Boolean)
  const demoInfo = getDemoInfo(slugs)

  const { createPage, deletePage } = actions

  if (page.path === &quot;/&quot;) {
    deletePage(page)

    const numberPerGroup = Math.ceil(demosSummaries.length / 2)
    const groupedDemos = [
      demosSummaries.slice(0, numberPerGroup),
      demosSummaries.slice(numberPerGroup, demosSummaries.length),
    ]

    const context: IndexPageProps[&quot;pageContext&quot;] = {
      groupedDemos,
      meta: metas.home,
      numberPerGroup,
    }

    createPage({
      ...page,
      context,
    })
  } else if (demoInfo) {
    deletePage(page)

    const { [demoInfo.category as Category]: categoryMetas } = metas

    const context: DemoPageProps[&quot;pageContext&quot;] = {
      demoInfo,
      meta: categoryMetas[demoInfo.key as keyof typeof categoryMetas],
    }

    createPage({
      ...page,
      context,
    })
  }
}

export { onCreatePage }
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;gatsby/onCreatePage.ts&quot;,&quot;line&quot;:26,&quot;character&quot;:11,&quot;text&quot;:&quot;_&quot;,&quot;kind&quot;:1}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Sun, 15 Aug 2021 21:52:37 GMT</p>
    </body>
  </html>
  