
  <!DOCTYPE html>
  <html>
    <head>
      <title>onCreatePage.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">gatsby/onCreatePage.ts</td><td class="">100.00%</td><td class="">95%</td><td class="">336</td><td class="">336</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import fs from &quot;fs&quot;
import { GatsbyNode } from &quot;gatsby&quot;
import path from &quot;path&quot;
import Prism from &quot;prismjs&quot;
// https://prismjs.com/#supported-languages
import &quot;prismjs/components/prism-jsx&quot;
import &quot;prismjs/components/prism-scss&quot;
import &quot;prismjs/components/prism-typescript&quot;

import {
  DemoBase,
  DemoPageProps,
  DemoSummary,
  IndexPageProps,
  SPECIAL_DEMO_KEYS,
} from &quot;../src/common&quot;

import { ROOT_PATH } from &quot;./constants&quot;
import d3Data from &quot;./info/d3js&quot;
import metas from &quot;./info/metas&quot;
import raphaelData from &quot;./info/raphael&quot;

const categoryToData = {
  d3js: d3Data,
  raphael: raphaelData,
}

type Category = keyof typeof categoryToData

const readIfExists = (filePath: string) =&gt; {
  try {
    return fs.readFileSync(filePath, &quot;utf-8&quot;)
  } catch (_) {
    return &quot;&quot;
  }
}

const getFilesRecursiveSync = (dir: string): string[] =&gt; {
  const filesList: string[] = []
  const list = fs.readdirSync(dir)

  list.forEach((fileName) =&gt; {
    const file = `${dir}/${fileName}`
    const stat = fs.statSync(file)

    if (stat.isDirectory()) {
      const newResults = getFilesRecursiveSync(file)

      filesList.push(...newResults)
    } else {
      filesList.push(file)
    }
  })

  return filesList
    .map((filePath) =&gt; path.resolve(filePath).replace(`${process.cwd()}/`, &quot;&quot;))
    .sort()
}

const getDemoTSFiles = (demoName: string) =&gt; {
  const tsFiles = getFilesRecursiveSync(`${__dirname}/../src/demos/${demoName}`)
    .filter((file) =&gt; /\.ts$/.test(file))
    .filter(
      (file) =&gt;
        !file.includes(&quot;.css&quot;) &amp;&amp; file !== demoName &amp;&amp; !file.includes(&quot;/tests/&quot;)
    )
  const mainStr = &quot;export default main&quot; // move the main demo file to the top

  return tsFiles
    .map((filePath) =&gt; ({
      content: readIfExists(filePath),
      filePath,
    }))
    .filter((file) =&gt; !!file.content)
    .sort((...[fileA, fileB]) =&gt; {
      if (fileA.content.includes(mainStr)) {
        return -1
      }

      return fileB.content.includes(mainStr) ? 1 : 0
    })
    .map((file) =&gt; ({
      ...file,
      content: Prism.highlight(
        file.content,
        Prism.languages.typescript,
        &quot;typescript&quot;
      ),
    }))
}

const getDemoCSSFiles = (demoName: string) =&gt; {
  const cssFiles = getFilesRecursiveSync(
    `${__dirname}/../src/demos/${demoName}`
  ).filter((file) =&gt; /\.css$/.test(file))

  return cssFiles
    .map((filePath) =&gt; ({
      content: readIfExists(filePath),
      filePath,
    }))
    .filter((file) =&gt; !!file.content)
    .map((file) =&gt; ({
      ...file,
      content: Prism.highlight(file.content, Prism.languages.scss, &quot;scss&quot;),
    }))
}

const getPage = ({
  category,
  demoName,
}: {
  category: Category
  demoName: string
}) =&gt; {
  const rawContent = readIfExists(`src/pages/${category}/${demoName}.tsx`)

  return {
    content: Prism.highlight(rawContent, Prism.languages.jsx, &quot;jsx&quot;),
    type: &quot;tsx&quot;,
  }
}

const getDemoInfo = (slugs: string[]) =&gt; {
  const [category, demoName] = slugs as [Category, string]
  const { [category]: categoryData } = categoryToData

  if (!(categoryData as unknown) || !demoName) {
    return null
  }

  const page = getPage({ category, demoName })

  type DemoKey = keyof typeof categoryData

  const demoBase = categoryData[demoName as DemoKey] as DemoBase

  return {
    ...demoBase,
    category,
    files: {
      demoCSS: getDemoCSSFiles(demoName),
      demoTS: getDemoTSFiles(demoName),
      page,
    },
    key: demoName,
  }
}

const d3jsDemosSummaries: DemoSummary[] = []
const raphaelDemosSummaries: DemoSummary[] = []

for (const d3DemoName in d3Data) {
  const demoSummary: DemoSummary = {
    ...d3Data[d3DemoName as keyof typeof d3Data],
    category: &quot;d3js&quot;,
    key: d3DemoName,
    route: `${ROOT_PATH}d3js/${d3DemoName}`,
  }

  d3jsDemosSummaries.push(demoSummary)
}

for (const raphaelDemoName in raphaelData) {
  const demoSummary = {
    ...raphaelData[raphaelDemoName as keyof typeof raphaelData],
    category: &quot;raphael&quot;,
    key: raphaelDemoName,
    route: `${ROOT_PATH}raphael/${raphaelDemoName}`,
  }

  raphaelDemosSummaries.push(demoSummary)
}

const storybookSummary = {
  category: SPECIAL_DEMO_KEYS.STORYBOOK,
  key: SPECIAL_DEMO_KEYS.STORYBOOK,
  name: &quot;Storybook Demos&quot;,
  route: `${ROOT_PATH}storybook`,
}

const testsSummary = {
  category: SPECIAL_DEMO_KEYS.TESTING,
  key: SPECIAL_DEMO_KEYS.TESTING,
  name: &quot;Testing Page&quot;,
  route: `${ROOT_PATH}testing`,
}

const demosSummaries = d3jsDemosSummaries
  .concat(raphaelDemosSummaries)
  .sort((...[demoSummaryA, demoSummaryB]) =&gt; {
    if (demoSummaryA.name === demoSummaryB.name) {
      return 0
    }

    return demoSummaryA.name &lt; demoSummaryB.name ? -1 : 1
  })
  .concat([storybookSummary, testsSummary])

const onCreatePage: GatsbyNode[&quot;onCreatePage&quot;] = ({ actions, page }) =&gt; {
  const slugs = page.path.split(&quot;/&quot;).filter(Boolean)
  const demoInfo = getDemoInfo(slugs)

  const { createPage, deletePage } = actions

  if (page.path === &quot;/&quot;) {
    deletePage(page)

    const numberPerGroup = Math.ceil(demosSummaries.length / 2)
    const groupedDemos = [
      demosSummaries.slice(0, numberPerGroup),
      demosSummaries.slice(numberPerGroup, demosSummaries.length),
    ]

    const context: IndexPageProps[&quot;pageContext&quot;] = {
      groupedDemos,
      meta: metas.home,
      numberPerGroup,
    }

    createPage({
      ...page,
      context,
    })
  } else if (demoInfo) {
    deletePage(page)

    const { [demoInfo.category]: categoryMetas } = metas

    const context: DemoPageProps[&quot;pageContext&quot;] = {
      demoInfo,
      meta: categoryMetas[demoInfo.key as keyof typeof categoryMetas],
    }

    createPage({
      ...page,
      context,
    })
  }
}

export { onCreatePage }
</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Tue, 22 Feb 2022 22:59:31 GMT</p>
    </body>
  </html>
  