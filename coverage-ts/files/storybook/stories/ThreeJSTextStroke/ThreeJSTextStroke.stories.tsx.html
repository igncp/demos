
  <!DOCTYPE html>
  <html>
    <head>
      <title>ThreeJSTextStroke.stories.tsx</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">storybook/stories/ThreeJSTextStroke/ThreeJSTextStroke.stories.tsx</td><td class="">99.27%</td><td class="">95%</td><td class="">273</td><td class="">271</td><td class="">2</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import React from &quot;react&quot;
import {
  Color,
  DoubleSide,
  Font,
  Group,
  Mesh,
  MeshBasicMaterial,
  Path,
  PerspectiveCamera,
  Scene,
  ShapeGeometry,
  WebGLRenderer,
} from &quot;three&quot;
import FontData from &quot;three/examples/fonts/helvetiker_regular.typeface.json&quot;
import { OrbitControls } from &quot;three/examples/jsm/controls/OrbitControls.js&quot;
import { SVGLoader } from &quot;three/examples/jsm/loaders/SVGLoader.js&quot;

import { StoryInfo, TemplateType } from &quot;../common&quot;

const ROOT_ID = &quot;examples&quot;

type State = {
  isStopped: boolean
}

type Simulation = {
  camera: PerspectiveCamera
  props: Props
  renderer: WebGLRenderer
  scene: Scene
  stop: () =&gt; void
}

const font = new Font(FontData)

export const demo = (
  props: Props,
  prevSimulation: Simulation | null
): Simulation =&gt; {
  const { text: message } = props
  const container = document.getElementById(ROOT_ID) as HTMLElement
  const { width } = container.getBoundingClientRect()
  const height = 500

  const state: State = {
    isStopped: false,
  }

  const scene = prevSimulation?.scene ?? new Scene()
  const camera =
    prevSimulation?.camera ??
    new PerspectiveCamera(45, width / height, 1, 10000)
  const renderer =
    prevSimulation?.renderer ?? new WebGLRenderer({ antialias: true })

  const createSimulation = () =&gt; ({
    camera,
    props,
    renderer,
    scene,
    stop: () =&gt; {
      state.isStopped = true
    },
  })

  scene.background = new Color(0xffffff)

  const color = new Color(0x006699)

  const matDark = new MeshBasicMaterial({
    color,
    side: DoubleSide,
  })

  const matLite = new MeshBasicMaterial({
    color,
    opacity: 0.4,
    side: DoubleSide,
    transparent: true,
  })

  const generateText = () =&gt; {
    scene.clear()

    const shapes = font.generateShapes(message, 100)
    const geometry = new ShapeGeometry(shapes)

    geometry.computeBoundingBox()

    const xMid =
      -0.5 * (geometry.boundingBox!.max.x - geometry.boundingBox!.min.x)

    geometry.translate(xMid, 0, 0)

    const text = new Mesh(geometry, matLite)

    text.position.z = -150
    scene.add(text)

    const holeShapes: Path[] = []

    shapes.forEach((shape) =&gt; {
      if ((shape.holes.length || 0) &gt; 0) {
        shape.holes.forEach((hole) =&gt; {
          holeShapes.push(hole)
        })
      }
    })
    ;(shapes as any).push.apply(shapes, holeShapes)

    const style = SVGLoader.getStrokeStyle(5, color.getStyle())

    const strokeText = new Group()

    shapes.forEach((shape) =&gt; {
      const points = shape.getPoints()

      const svgGeo = SVGLoader.pointsToStroke(points as any, style)

      svgGeo.translate(xMid, 0, 0)

      const strokeMesh = new Mesh(svgGeo, matDark)

      strokeText.add(strokeMesh)
    })

    scene.add(strokeText)
  }

  const animate = () =&gt; {
    if (state.isStopped) {
      return
    }

    requestAnimationFrame(animate)

    renderer.render(scene, camera)
  }

  if (prevSimulation) {
    prevSimulation.stop()

    generateText()
    animate()

    return createSimulation()
  }

  camera.position.set(0, -400, 600)

  generateText()

  renderer.setPixelRatio(window.devicePixelRatio)
  renderer.setSize(width, height)

  container.innerHTML = &quot;&quot;
  container.appendChild(renderer.domElement)

  const controls = new OrbitControls(camera, renderer.domElement)

  controls.target.set(0, 0, 0)
  controls.update()

  animate()

  return createSimulation()
}

type Props = {
  text: string
}

const ThreeJSTextStroke = (props: Props) =&gt; {
  const [prevSimulation, setPrevSimulation] = React.useState&lt;Simulation | null&gt;(
    null
  )

  React.useEffect(() =&gt; {
    const newSimulation = demo(props, prevSimulation)

    setPrevSimulation(newSimulation)
  }, [props])

  return (
    &lt;div&gt;
      &lt;StoryInfo
        docs={[]}
        source=&quot;https://threejs.org/examples/?q=text#webgl_geometry_text_stroke&quot;
        sourceText=&quot;Source (official example, ported to TS)&quot;
        storyName=&quot;ThreeJSTextStroke&quot;
      /&gt;
      &lt;div id={ROOT_ID} /&gt;
    &lt;/div&gt;
  )
}

const Template = ((props: Props) =&gt; (
  &lt;ThreeJSTextStroke {...props} /&gt;
)) as TemplateType&lt;Props&gt;

export const Common = Template.bind({})

const args: Props = {
  text: &quot;Demos\nExample&quot;,
}

Common.args = args

export default {
  argTypes: {},
  component: ThreeJSTextStroke,
  title: &quot;ThreeJS/Text Stroke&quot;,
}
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;storybook/stories/ThreeJSTextStroke/ThreeJSTextStroke.stories.tsx&quot;,&quot;line&quot;:109,&quot;character&quot;:21,&quot;text&quot;:&quot;push&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;storybook/stories/ThreeJSTextStroke/ThreeJSTextStroke.stories.tsx&quot;,&quot;line&quot;:109,&quot;character&quot;:26,&quot;text&quot;:&quot;apply&quot;,&quot;kind&quot;:1}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Wed, 18 Aug 2021 22:45:40 GMT</p>
    </body>
  </html>
  