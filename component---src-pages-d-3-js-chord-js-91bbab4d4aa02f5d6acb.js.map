{"version":3,"sources":["webpack://demos/./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","webpack://demos/./src/demos/chord/chord.ts","webpack://demos/./src/pages/d3js/chord.js"],"names":["asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","this","args","arguments","apply","err","undefined","fetchData","d3","ROOT_PATH","list","fullList","countries","debits","credits","id","country","countryName","name","parsedList","map","d","creditor","debtor","risk","Array","from","length","forEach","_","idx","_2","idx2","addDropShadowFilter","charts","deviation","slope","filter","append","attr","colours","margin","height","renderChart","rootElId","data","width","document","getElementById","getBoundingClientRect","r1","Math","min","r0","formatCurrency","arc","innerRadius","outerRadius","svg","selectAll","enter","style","String","leftChart","_d","i","rightChart","setLabel","chart","label","text","colorDomain","domain","range","heatmapColour","fill","each","dataMatrix","chartIndex","svgComp","numberMatrix","row","item","amount","chordData","sortGroups","sortSubgroups","sortChords","ribbonLayout","radius","target","index","originalColor","darker","formatHex","sourceData","source","targetData","g","groups","demoInfo","pageContext","main","className"],"mappings":"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","file":"component---src-pages-d-3-js-chord-js-91bbab4d4aa02f5d6acb.js","sourcesContent":["function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}","import * as d3 from \"d3\"\n\ntype CSVDataItem = {\n  amount: string\n  creditor: string\n  debtor: string\n  risk: string\n}\n\ntype Country = {\n  name: string\n  id: number\n}\n\ntype Creditor = Country\ntype Debtor = Country & { risk: string }\n\ntype CSVParsedItem = {\n  amount: string\n  creditor: Creditor\n  debtor: Debtor\n  risk: string\n}\n\ntype Debits = (CSVParsedItem | null)[][]\ntype Credits = (CSVParsedItem | null)[][]\n\ntype Data = {\n  fullList: Country[]\n  debits: Debits\n  credits: Credits\n}\n\nconst fetchData = async () => {\n  const list = (await d3.csv(\n    `${ROOT_PATH}data/d3js/chord/data.csv`\n  )) as CSVDataItem[]\n\n  const fullList: Country[] = []\n  const countries: Record<string, Country> = {}\n  const debits: Debits = []\n  const credits: Credits = []\n\n  let id = 0\n\n  const country = function (countryName: string): Country {\n    if (!countries[countryName]) {\n      countries[countryName] = {\n        id: id++,\n        name: countryName,\n      }\n    }\n\n    return countries[countryName]\n  }\n\n  const parsedList: CSVParsedItem[] = list.map((d) => ({\n    ...d,\n    creditor: country(d.creditor),\n    debtor: {\n      ...country(d.debtor),\n      risk: d.risk,\n    },\n  }))\n\n  Array.from({ length: id }).forEach((_, idx) => {\n    debits[idx] = []\n    credits[idx] = []\n\n    Array.from({ length: id }).forEach((_2, idx2) => {\n      debits[idx][idx2] = null\n      credits[idx][idx2] = null\n    })\n  })\n\n  parsedList.forEach((d) => {\n    debits[d.creditor.id][d.debtor.id] = d\n    credits[d.debtor.id][d.creditor.id] = d\n    fullList[d.creditor.id] = d.creditor\n    fullList[d.debtor.id] = d.debtor\n  })\n\n  return {\n    credits,\n    debits,\n    fullList,\n  }\n}\n\nconst addDropShadowFilter = function <A>(\n  charts: d3.Selection<d3.BaseType, A, d3.BaseType, unknown>,\n  name: string,\n  deviation: number,\n  slope: number\n) {\n  const defs = charts.append(\"defs\")\n  const filter = defs.append(\"filter\").attr(\"id\", `drop-shadow-${name}`)\n\n  filter\n    .append(\"feOffset\")\n    .attr(\"dx\", 0.5)\n    .attr(\"dy\", 0.5)\n    .attr(\"in\", \"SourceGraphic\")\n    .attr(\"result\", \"offOut\")\n\n  filter\n    .append(\"feGaussianBlur\")\n    .attr(\"in\", \"offOut\")\n    .attr(\"result\", \"blurOut\")\n    .attr(\"stdDeviation\", deviation)\n\n  filter\n    .append(\"feBlend\")\n    .attr(\"in\", \"SourceGraphic\")\n    .attr(\"in2\", \"blurOut\")\n    .attr(\"mode\", \"normal\")\n\n  filter\n    .append(\"feComponentTransfer\")\n    .append(\"feFuncA\")\n    .attr(\"slope\", slope)\n    .attr(\"type\", \"linear\")\n}\n\nconst colours = [\n  \"#39B347\",\n  \"#C92E47\",\n  \"#DB704D\",\n  \"#FFA22C\",\n  \"#5E92AA\",\n  \"#F8EDD3\",\n]\n\nconst margin = {\n  bottom: 20,\n  top: 50,\n}\nconst height = 500\n\ntype RenderChart = (o: { rootElId: string; data: Data }) => void\n\nconst renderChart: RenderChart = ({ rootElId, data }) => {\n  const width =\n    (document.getElementById(rootElId) as HTMLElement).getBoundingClientRect()\n      .width /\n      2 -\n    20\n\n  const r1 = Math.min(width, height) / 2 - 4\n  const r0 = r1 - 20\n  const formatCurrency = d3.format(\",.3r\")\n\n  const arc = d3.arc().innerRadius(r0).outerRadius(r1)\n  const svg = d3.select(`#${rootElId}`)\n\n  const { debits, credits, fullList } = data\n\n  const charts = svg\n    .selectAll(\"div\")\n    .data([debits, credits])\n    .enter()\n    .append(\"div\")\n    .style(\"display\", \"inline-block\")\n    .style(\"width\", `${width}px`)\n    .style(\"height\", `${height + margin.top + margin.bottom}px`)\n    .append(\"svg:svg\")\n    .attr(\"width\", width)\n    .attr(\"height\", height + margin.top + margin.bottom)\n    .append(\"svg:g\")\n    .attr(\n      \"transform\",\n      `translate(${width / 2},${String(height / 2 + margin.top)})`\n    )\n\n  const leftChart = charts.filter((_d, i) => i === 0)\n  const rightChart = charts.filter((_d, i) => i === 1)\n\n  const setLabel = function (\n    chart: d3.Selection<d3.BaseType, Debits, d3.BaseType, unknown>,\n    label: string\n  ) {\n    return chart\n      .append(\"text\")\n      .text(label)\n      .attr(\"transform\", `translate(0,${(-1 * height) / 2 - 10})`)\n      .attr(\"class\", \"chart-title\")\n      .attr(\"text-anchor\", \"middle\")\n  }\n\n  setLabel(leftChart, \"Debits\")\n  setLabel(rightChart, \"Credits\")\n\n  addDropShadowFilter(charts, \"chords\", 2, 0.4)\n  addDropShadowFilter(charts, \"headings\", 3, 0.5)\n\n  const colorDomain = d3\n    .scaleLinear()\n    .domain(d3.extent([0, fullList.length - 1]) as [number, number])\n    .range([0, 1])\n\n  const heatmapColour = d3\n    .scaleLinear<string>()\n    .domain(d3.range(0, 1, 1.0 / colours.length))\n    .range(colours)\n\n  const fill = function (d: number) {\n    return heatmapColour(colorDomain(d))\n  }\n\n  charts.each(function (dataMatrix, chartIndex) {\n    const svgComp = d3.select(this)\n    const numberMatrix = dataMatrix.map((row) =>\n      row.map((item) => (item ? +item.amount : 0))\n    )\n\n    const chordData = d3\n      .chord()\n      .sortGroups(d3.descending)\n      .sortSubgroups(d3.descending)\n      .sortChords(d3.descending)(numberMatrix)\n\n    const ribbonLayout = d3.ribbon().radius(r0)\n\n    svgComp\n      .selectAll(\"path.chord\")\n      .data(chordData)\n      .enter()\n      .append(\"svg:path\")\n      .attr(\"class\", \"chord\")\n      .style(\"fill\", (d) => fill(d.target.index))\n      .style(\"filter\", \"url(#drop-shadow-chords)\")\n      .style(\"stroke\", (d) => {\n        const originalColor = fill(d.target.index)\n        const newColor = d3.rgb(originalColor).darker()\n\n        return newColor.formatHex()\n      })\n      .style(\"stroke-width\", 2)\n      .attr(\"d\", ribbonLayout as any)\n      .append(\"svg:title\")\n      .text((d) => {\n        const sourceData = fullList[d.source.index]\n        const targetData = fullList[d.target.index]\n\n        return `${sourceData.name} owes ${targetData.name} $${formatCurrency(\n          d.source.value\n        )}B.`\n      })\n\n    const g = svgComp\n      .selectAll(\"g.group\")\n      .data(chordData.groups)\n      .enter()\n      .append(\"svg:g\")\n      .attr(\"class\", \"group\")\n\n    g.append(\"svg:path\")\n      .style(\"fill\", (d) => fill(d.index))\n      .attr(\"id\", (d) => `group${d.index}-${chartIndex}`)\n      .attr(\"d\", arc as any)\n      .style(\"filter\", () => \"url(#drop-shadow-headings)\")\n      .append(\"svg:title\")\n      .text(\n        (d) =>\n          `${fullList[d.index].name} ${\n            chartIndex ? \"owes\" : \"is owed\"\n          } $${formatCurrency(d.value)}B.`\n      )\n\n    g.append(\"svg:text\")\n      .attr(\"x\", 6)\n      .attr(\"dy\", 15)\n      .filter((d) => d.value > 150)\n      .append(\"svg:textPath\")\n      .attr(\"xlink:href\", (d) => `#group${d.index}-${chartIndex}`)\n      .text((d) => fullList[d.index].name)\n      .attr(\"class\", \"heading-title\")\n  })\n}\n\nconst main = async () => {\n  const data = await fetchData()\n\n  renderChart({\n    data,\n    rootElId: \"chart\",\n  })\n}\n\nexport default main\n","import React from \"react\"\n\nimport Demo from \"@/components/demo\"\n\nimport main from \"@/demos/chord/chord\"\n\nimport \"@/demos/chord/chord.styl\"\n\nconst Chord = ({ pageContext: { demoInfo } }) => (\n  <Demo demoInfo={demoInfo} main={main}>\n    <div className=\"chord-chart\" id=\"chart\" />\n  </Demo>\n)\n\nexport default Chord\n"],"sourceRoot":""}