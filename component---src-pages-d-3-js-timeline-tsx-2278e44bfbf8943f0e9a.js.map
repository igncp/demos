{"version":3,"sources":["webpack://demos/./src/demos/_utils/d3utils.ts","webpack://demos/./src/demos/timeline/timeline.ts","webpack://demos/./src/pages/d3js/timeline.tsx"],"names":["d3utils","colorsScale","colors","extent","c","d3","domain","range","colorScale","length","p","filterBlackOpacity","id","svg","deviation","slope","filter","append","attr","feMerge","filterColor","extra","middleTitle","width","text","top","String","style","selector","height","margin","bottom","left","right","tooltip","customOpts","opts","merge","elementSelector","followElement","followMouse","leftOffst","tOpts","container","viewport","topOffst","$","hover","e","css","pageX","pageY","position","parseDate","dateString","date","format","year","isNaN","Number","replace","Date","setUTCFullYear","toYear","getUTCFullYear","toString","Math","abs","Timeline","rootElId","rootEl","document","getElementById","classList","add","outerWidth","getBoundingClientRect","this","bandY","bandNum","dataContent","components","bands","on","chart","data","timelineItems","today","tracks","items","compareAscending","item1","item2","result","start","end","compareDescending","forEach","item","getTime","instant","sortOrder","timeOrder","sort","track","i","_i","_ref","calculateTracks","nTracks","minDate","d","maxDate","xAxis","bandName","band","axis","xScale","tickSize","tickFormat","y","h","redraw","call","parts","push","createTooltip","sizeFactor","x","w","trackOffset","trackHeight","min","itemHeight","instantWidth","yScale","yearsScale","g","selectAll","enter","label","intervals","instants","addActions","actions","action","select","maxLetters","substr","part","labels","labelTop","labelDefs","_min","max","bandLabels","brush","targetNames","selectionScale","newDomain","selection","component","ROOT_PATH","dataset","demoInfo","pageContext","links","main","scripts"],"mappings":"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","file":"component---src-pages-d-3-js-timeline-tsx-2278e44bfbf8943f0e9a.js","sourcesContent":["import * as d3 from \"d3\"\nimport merge from \"lodash/merge\"\n\ntype Margin = {\n  bottom: number\n  left: number\n  right: number\n  top: number\n}\n\ntype SVG = d3.Selection<SVGGElement, unknown, HTMLElement, unknown>\n\n// @TODO: remove when no longer used\n\nconst d3utils = {\n  colorsScale<P extends number = any>(colors: any, extent: any) {\n    const c = d3.scaleLinear().domain(extent).range([0, 1])\n    const colorScale = d3\n      .scaleLinear()\n      .domain(d3.range(0, 1, 1.0 / colors.length))\n      .range(colors)\n\n    return function (p: P) {\n      return colorScale(c(p))\n    }\n  },\n  filterBlackOpacity(id: string, svg: SVG, deviation: number, slope: number) {\n    const defs = svg.append(\"defs\")\n    const filter = defs\n      .append(\"filter\")\n      .attr(\"height\", \"500%\")\n      .attr(\"id\", `drop-shadow-${id}`)\n      .attr(\"width\", \"500%\")\n      .attr(\"x\", \"-200%\")\n      .attr(\"y\", \"-200%\")\n\n    filter\n      .append(\"feGaussianBlur\")\n      .attr(\"in\", \"SourceAlpha\")\n      .attr(\"stdDeviation\", deviation)\n\n    filter.append(\"feOffset\").attr(\"dx\", 1).attr(\"dy\", 1)\n    filter\n      .append(\"feComponentTransfer\")\n      .append(\"feFuncA\")\n      .attr(\"slope\", slope)\n      .attr(\"type\", \"linear\")\n\n    const feMerge = filter.append(\"feMerge\")\n\n    feMerge.append(\"feMergeNode\")\n\n    return feMerge.append(\"feMergeNode\").attr(\"in\", \"SourceGraphic\")\n  },\n  filterColor(\n    id: string,\n    svg: SVG,\n    deviation: number,\n    slope: number,\n    extra?: any\n  ) {\n    if (extra == null) {\n      extra = false\n    }\n\n    const defs = svg.append(\"defs\")\n    const filter = defs.append(\"filter\").attr(\"id\", `drop-shadow-${id}`)\n\n    if (extra) {\n      filter\n        .attr(\"height\", \"500%\")\n        .attr(\"width\", \"500%\")\n        .attr(\"x\", \"-200%\")\n        .attr(\"y\", \"-200%\")\n    }\n\n    filter\n      .append(\"feOffset\")\n      .attr(\"dx\", 0.5)\n      .attr(\"dy\", 0.5)\n      .attr(\"in\", \"SourceGraphic\")\n      .attr(\"result\", \"offOut\")\n\n    filter\n      .append(\"feGaussianBlur\")\n      .attr(\"in\", \"offOut\")\n      .attr(\"result\", \"blurOut\")\n      .attr(\"stdDeviation\", deviation)\n\n    filter\n      .append(\"feBlend\")\n      .attr(\"in\", \"SourceGraphic\")\n      .attr(\"in2\", \"blurOut\")\n      .attr(\"mode\", \"normal\")\n\n    return filter\n      .append(\"feComponentTransfer\")\n      .append(\"feFuncA\")\n      .attr(\"slope\", slope)\n      .attr(\"type\", \"linear\")\n  },\n\n  middleTitle(svg: SVG, width: number, text: string, top: number | null) {\n    if (top == null) {\n      top = -15\n    }\n\n    svg\n      .append(\"text\")\n      .attr(\"class\", \"chart-title\")\n      .attr(\"text-anchor\", \"middle\")\n      .attr(\"transform\", `translate(${String(width / 2)},${top})`)\n      .text(text)\n      .style(\"font-weight\", \"bold\")\n  },\n  svg(selector: string, width: number, height: number, margin: Margin) {\n    return d3\n      .select(selector)\n      .text(\"\")\n      .append(\"svg\")\n      .attr(\"height\", height + margin.top + margin.bottom)\n      .attr(\"width\", width + margin.left + margin.right)\n      .append(\"g\")\n      .attr(\"transform\", `translate(${margin.left},${margin.top})`)\n  },\n  tooltip(selector: string, customOpts: any) {\n    if (customOpts == null) {\n      customOpts = {}\n    }\n\n    const defaultOpts = {\n      elementSelector: \"\",\n      followElement: false,\n      followMouse: false,\n      leftOffst: 60,\n      tOpts: {\n        container: \"body\",\n        viewport: {\n          selector: \"#chart svg\",\n        },\n      },\n      topOffst: 40,\n    }\n\n    const opts = merge(defaultOpts, customOpts)\n\n    const sel: any = $(selector)\n\n    sel.tooltip(opts.tOpts)\n\n    if (opts.followMouse) {\n      $(selector).hover((e) =>\n        $(\".tooltip\").css({\n          left: `${String(e.pageX - opts.leftOffst)}px`,\n          top: `${String(e.pageY - opts.topOffst)}px`,\n        })\n      )\n    } else if (opts.followElement) {\n      $(selector).hover(() =>\n        $(\".tooltip\").css({\n          left: `${String(\n            $(opts.elementSelector).position().left - opts.leftOffst\n          )}px`,\n          top: `${String(\n            $(opts.elementSelector).position().top - opts.topOffst\n          )}px`,\n        })\n      )\n    }\n  },\n}\n\nexport default d3utils\n","import * as d3 from \"d3\"\n\nimport d3utils from \"@/demos/_utils/d3utils\"\n\nimport \"./timeline.styl\"\n\ntype DataItem = {\n  end: Date\n  instant: boolean\n  label: string\n  start: Date\n  track: number\n}\n\nconst fetchData = () =>\n  (d3.csv(`${ROOT_PATH}data/d3js/timeline/data.csv`) as unknown) as DataItem[]\n\nconst margin = {\n  bottom: 0,\n  left: 20,\n  right: 20,\n  top: 60,\n}\n\nconst outerHeight = 700\nconst height = outerHeight - margin.top - margin.bottom\nconst bandGap = 25\n\nconst parseDate = function (dateString: string) {\n  const format = d3.timeParse(\"%Y-%m-%d\")\n\n  let date = format(dateString)\n\n  if (date !== null) {\n    return date\n  }\n\n  const year = isNaN(Number(dateString))\n    ? -dateString.replace(/[^0-9]/g, \"\")\n    : +dateString\n\n  if (year < 0 || year > 99) {\n    date = new Date(year, 6, 1)\n  } else if (year === 0) {\n    date = new Date(-1, 6, 1)\n  } else {\n    date = new Date(year, 6, 1)\n    date.setUTCFullYear(year)\n  }\n\n  return date\n}\n\nconst toYear = (date: Date) => {\n  const bcString = \" BC\"\n  const year = date.getUTCFullYear()\n\n  if (year >= 0) {\n    return year.toString()\n  }\n\n  return bcString + Math.abs(year)\n}\n\nclass Timeline {\n  private chart: any\n  private bandY: number\n  private bandNum: number\n  private dataContent: any\n  private components: any\n  private bands: any\n  private width: number\n\n  public constructor({ rootElId }: { rootElId: string }) {\n    const rootEl = document.getElementById(rootElId) as HTMLElement\n\n    rootEl.classList.add(\"timeline-chart\")\n\n    const outerWidth = rootEl.getBoundingClientRect().width\n\n    this.width = outerWidth - margin.left - margin.right\n\n    this.bandY = 0\n    this.bandNum = 0\n\n    this.dataContent = {}\n    this.components = []\n    this.bands = {}\n\n    const svg = d3utils.svg(`#${rootElId}`, outerWidth, outerHeight, margin)\n\n    d3utils.middleTitle(svg, outerWidth, \"Philosophers through History\", -20)\n    d3utils.filterBlackOpacity(\"intervals\", svg, 1, 0.2)\n\n    svg\n      .append(\"clipPath\")\n      .attr(\"id\", \"chart-area\")\n      .append(\"rect\")\n      .attr(\"width\", this.width)\n      .attr(\"height\", height)\n\n    svg.on(\"mouseup\", () =>\n      d3\n        .selectAll(\".interval rect\")\n        .style(\"filter\", \"url(#drop-shadow-intervals)\")\n    )\n\n    this.chart = svg\n      .append(\"g\")\n      .attr(\"class\", \"chart\")\n      .attr(\"clip-path\", \"url(#chart-area)\")\n  }\n\n  public data(timelineItems: DataItem[]) {\n    const today = new Date()\n\n    const tracks: any = []\n    const yearMillis = 31622400000\n    const instantOffset = 100 * yearMillis\n\n    this.dataContent.items = timelineItems\n\n    const compareAscending = function (item1: any, item2: any) {\n      let result = item1.start - item2.start\n\n      if (result < 0) {\n        return -1\n      }\n\n      if (result > 0) {\n        return 1\n      }\n\n      result = item2.end - item1.end\n\n      if (result < 0) {\n        return -1\n      }\n\n      if (result > 0) {\n        return 1\n      }\n\n      return 0\n    }\n\n    const compareDescending = function (item1: any, item2: any) {\n      let result = item1.start - item2.start\n\n      if (result < 0) {\n        return 1\n      }\n\n      if (result > 0) {\n        return -1\n      }\n\n      result = item2.end - item1.end\n\n      if (result < 0) {\n        return 1\n      }\n\n      if (result > 0) {\n        return -1\n      }\n\n      return 0\n    }\n\n    const calculateTracks = (items: any, sortOrder: any, timeOrder: any) => {\n      sortOrder = sortOrder || \"descending\"\n      timeOrder = timeOrder || \"backward\"\n\n      const sortBackward = () =>\n        items.forEach((item: any) => {\n          let track = 0\n\n          for (\n            let i = 0, _i = 0, _ref = tracks.length;\n            0 <= _ref ? _i < _ref : _i > _ref;\n            i = 0 <= _ref ? ++_i : --_i\n          ) {\n            if (item.end < tracks[i]) {\n              break\n            }\n\n            track++\n          }\n\n          item.track = track\n\n          tracks[track] = item.start\n        })\n\n      const sortForward = function () {\n        return items.forEach((item: any) => {\n          let track = 0\n\n          for (\n            let i = 0, _i = 0, _ref = tracks.length;\n            0 <= _ref ? _i < _ref : _i > _ref;\n            i = 0 <= _ref ? ++_i : --_i\n          ) {\n            if (item.start > tracks[i]) {\n              break\n            }\n\n            track++\n          }\n\n          item.track = track\n\n          tracks[track] = item.end\n        })\n      }\n\n      if (sortOrder === \"ascending\") {\n        this.dataContent.items.sort(compareAscending)\n      } else {\n        this.dataContent.items.sort(compareDescending)\n      }\n\n      if (timeOrder === \"forward\") {\n        return sortForward()\n      }\n\n      return sortBackward()\n    }\n\n    this.dataContent.items.forEach((item: any) => {\n      item.start = parseDate(item.start)\n\n      if (item.end === \"\") {\n        item.end = new Date(item.start.getTime() + instantOffset)\n        item.instant = true\n      } else {\n        item.end = parseDate(item.end)\n        item.instant = false\n      }\n\n      if (item.end > today) {\n        item.end = today\n      }\n    })\n\n    calculateTracks(this.dataContent.items, \"descending\", \"backward\")\n\n    this.dataContent.nTracks = tracks.length\n    this.dataContent.minDate = d3.min(\n      this.dataContent.items,\n      (d: any) => d.start\n    )\n    this.dataContent.maxDate = d3.max(this.dataContent.items, (d: any) => d.end)\n\n    return this\n  }\n\n  public xAxis(bandName: any) {\n    const band = this.bands[bandName]\n\n    const axis = (d3 as any)\n      .axisBottom(band.xScale)\n      .tickSize(6, 0)\n      .tickFormat((d: any) => toYear(d))\n\n    const xAxis: any = this.chart\n      .append(\"g\")\n      .attr(\"class\", \"axis\")\n      .attr(\"transform\", `translate(0,${band.y + band.h})`)\n\n    xAxis.redraw = function () {\n      return xAxis.call(axis)\n    }\n\n    band.parts.push(xAxis)\n    this.components.push(xAxis)\n\n    return this\n  }\n\n  public createTooltip() {\n    d3utils.tooltip(\".part.instant, .part.interval\", {\n      followMouse: true,\n      leftOffst: 80,\n    })\n\n    return this\n  }\n\n  public band(bandName: any, sizeFactor: any) {\n    const band: any = {}\n\n    band.id = `band${this.bandNum}`\n    band.x = 0\n    band.y = this.bandY\n    band.w = this.width\n    band.h = height * (sizeFactor || 1)\n    band.trackOffset = 0\n    band.trackHeight = Math.min(\n      (band.h - band.trackOffset) / this.dataContent.nTracks,\n      20\n    )\n    band.itemHeight = band.trackHeight * 0.7\n    band.parts = []\n    band.instantWidth = 100\n    band.xScale = d3\n      .scaleTime()\n      .domain([this.dataContent.minDate, this.dataContent.maxDate])\n      .range([0, band.w])\n\n    band.yScale = (track: any) => band.trackOffset + track * band.trackHeight\n\n    band.yearsScale =\n      this.dataContent.maxDate.getUTCFullYear() -\n      this.dataContent.minDate.getUTCFullYear()\n    band.g = this.chart\n      .append(\"g\")\n      .attr(\"id\", band.id)\n      .attr(\"transform\", `translate(0,${band.y})`)\n    band.g\n      .append(\"rect\")\n      .attr(\"class\", \"band\")\n      .attr(\"width\", band.w)\n      .attr(\"height\", band.h)\n\n    const items = band.g\n      .selectAll(\"g\")\n      .data(this.dataContent.items)\n      .enter()\n      .append(\"svg\")\n      .attr(\"y\", (d: DataItem) => band.yScale(d.track))\n      .attr(\"height\", band.itemHeight)\n      .attr(\"data-title\", (d: DataItem) => {\n        if (d.instant) {\n          return `${d.label}: ${toYear(d.start)}`\n        }\n\n        return `${d.label}: ${toYear(d.start)} - ${toYear(d.end)}`\n      })\n      .attr(\"class\", (d: DataItem) => {\n        if (d.instant) {\n          return \"part instant\"\n        }\n\n        return \"part interval\"\n      })\n\n    const intervals = d3.select(`#band${this.bandNum}`).selectAll(\".interval\")\n\n    intervals\n      .append(\"rect\")\n      .attr(\"height\", \"80%\")\n      .attr(\"width\", \"80%\")\n      .attr(\"x\", \"1px\")\n      .attr(\"y\", \".5px\")\n      .style(\"filter\", \"url(#drop-shadow-intervals)\")\n\n    intervals\n      .append(\"text\")\n      .attr(\"class\", \"intervalLabel\")\n      .attr(\"x\", 3)\n      .attr(\"y\", 9.5)\n\n    const instants = d3.select(`#band${this.bandNum}`).selectAll(\".instant\")\n\n    instants\n      .append(\"circle\")\n      .attr(\"cx\", band.itemHeight / 2)\n      .attr(\"cy\", band.itemHeight / 2)\n      .attr(\"r\", 5)\n    instants\n      .append(\"text\")\n      .attr(\"class\", \"instantLabel\")\n      .attr(\"x\", 15)\n      .attr(\"y\", 10)\n\n    band.addActions = function (actions: any) {\n      return actions.forEach((action: any) => items.on(action[0], action[1]))\n    }\n\n    band.redraw = function () {\n      items\n        .attr(\"x\", (d: any) => band.xScale(d.start))\n        .attr(\"width\", (d: any) => band.xScale(d.end) - band.xScale(d.start))\n        .select(\"text\")\n        .text((d: any) => {\n          const scale = band.xScale(d.end) - band.xScale(d.start)\n          const maxLetters = scale / 9\n\n          if (d.label.length > maxLetters) {\n            return `${d.label.substr(0, maxLetters - 1)}..`\n          }\n\n          return d.label\n        })\n\n      return band.parts.forEach((part: any) => part.redraw())\n    }\n\n    this.bands[bandName] = band\n    this.components.push(band)\n    this.bandY += band.h + bandGap\n    this.bandNum += 1\n\n    return this\n  }\n\n  public labels(bandName: any) {\n    const band = this.bands[bandName]\n    const labelWidth = 46\n    const labelHeight = 20\n    const labelTop = band.y + band.h - 10\n    const yText = 15\n    const labelDefs = [\n      [\n        \"start\",\n        \"bandMinMaxLabel\",\n        0,\n        4,\n        function (min: any) {\n          return toYear(min)\n        },\n        \"Start of the selected interval\",\n        band.x + 30,\n        labelTop,\n      ],\n      [\n        \"end\",\n        \"bandMinMaxLabel\",\n        band.w - labelWidth,\n        band.w - 4,\n        function (_min: any, max: any) {\n          return toYear(max)\n        },\n        \"End of the selected interval\",\n        band.x + band.w - 152,\n        labelTop,\n      ],\n      [\n        \"middle\",\n        \"bandMidLabel\",\n        (band.w - labelWidth) / 2,\n        band.w / 2,\n        function (min: any, max: any) {\n          const result = max.getUTCFullYear() - min.getUTCFullYear()\n\n          return result\n        },\n        \"Length of the selected interval\",\n        band.x + band.w / 2 - 75,\n        labelTop,\n      ],\n    ]\n    const bandLabels = this.chart\n      .append(\"g\")\n      .attr(\"id\", `${bandName}Labels`)\n      .attr(\"transform\", `translate(0,${band.y + band.h + 1})`)\n      .selectAll(`#${bandName}Labels`)\n      .data(labelDefs)\n      .enter()\n      .append(\"g\")\n\n    bandLabels\n      .append(\"rect\")\n      .attr(\"class\", \"bandLabel\")\n      .attr(\"x\", (d: any) => d[2])\n      .attr(\"width\", labelWidth)\n      .attr(\"height\", labelHeight)\n      .style(\"opacity\", 1)\n\n    const labels: any = bandLabels\n      .append(\"text\")\n      .attr(\"class\", (d: any) => d[1])\n      .attr(\"id\", (d: any) => d[0])\n      .attr(\"x\", (d: any) => d[3])\n      .attr(\"y\", yText)\n      .attr(\"text-anchor\", (d: any) => d[0])\n\n    labels.redraw = function () {\n      const min = band.xScale.domain()[0]\n      const max = band.xScale.domain()[1]\n\n      return labels.text((d: any) => d[4](min, max))\n    }\n\n    band.parts.push(labels)\n    this.components.push(labels)\n\n    return this\n  }\n\n  public brush(bandName: any, targetNames: any) {\n    const band = this.bands[bandName]\n    const brush = d3.brushX()\n\n    const selectionScale = d3\n      .scaleTime()\n      .domain([0, 1000])\n      .range([\n        this.dataContent.minDate.getTime(),\n        this.dataContent.maxDate.getTime(),\n      ])\n\n    brush.on(\"brush\", (e) => {\n      let newDomain = band.xScale.domain()\n\n      if (e.selection) {\n        newDomain = [\n          selectionScale(e.selection[0]),\n          selectionScale(e.selection[1]),\n        ]\n      }\n\n      d3.selectAll(\".interval rect\").style(\"filter\", \"none\")\n\n      targetNames.forEach((d: any) => {\n        this.bands[d].xScale.domain(newDomain)\n\n        this.bands[d].redraw()\n      })\n    })\n\n    const xBrush = band.g.append(\"svg\").attr(\"class\", \"x brush\").call(brush)\n\n    xBrush\n      .selectAll(\"rect\")\n      .attr(\"y\", 1)\n      .attr(\"height\", band.h - 1)\n\n    return this\n  }\n\n  public redraw() {\n    return this.components.forEach((component: any) => component.redraw())\n  }\n}\n\nconst main = async () => {\n  const dataset = await fetchData()\n\n  new Timeline({ rootElId: \"chart\" })\n    .data(dataset)\n    .band(\"mainBand\", 0.82)\n    .band(\"naviBand\", 0.08)\n    .xAxis(\"mainBand\")\n    .xAxis(\"naviBand\")\n    .labels(\"mainBand\")\n    .labels(\"naviBand\")\n    .brush(\"naviBand\", [\"mainBand\"])\n    .createTooltip()\n    .redraw()\n}\n\nexport default main\n","import React from \"react\"\n\nimport { DemoPageProps } from \"@/common\"\n\nimport Demo from \"@/components/demo\"\n\n// @ts-ignore\nimport main from \"@/demos/timeline/timeline\"\n\nconst Timeline = ({ pageContext: { demoInfo } }: DemoPageProps) => (\n  <Demo\n    demoInfo={demoInfo}\n    links={[\"/vendors/jquery-ui/themes/base/jquery-ui.min.css\"]}\n    main={main}\n    scripts={[\"/vendors/jquery-ui/jquery-ui.min.js\"]}\n  >\n    <div id=\"chart\" />\n  </Demo>\n)\n\nexport default Timeline\n"],"sourceRoot":""}