{"version":3,"sources":["webpack://demos/./src/demos/chord/chord.js","webpack://demos/./src/pages/d3js/chord.js"],"names":["height","width","document","getElementById","getBoundingClientRect","margin","r1","Math","min","r0","format","d3","debits","credits","arc","svg","innerRadius","outerRadius","chord","radius","charts","select","selectAll","data","enter","append","style","attr","String","leftChart","filter","_d","i","rightChart","setLabel","chart","label","text","csv","ROOT_PATH","countries","array","n","country","d","id","name","value","this","amount","forEach","creditor","debtor","risk","valueOf","_i","j","_j","layout","sortGroups","descending","sortSubgroups","sortChords","padding","addDropShadowFilter","deviation","slope","colours","c","scale","linear","domain","extent","range","heatmapColour","length","fill","each","matrix","jj","svgComp","chords","target","index","rgb","darker","source","g","groups","demoInfo","pageContext","main","scripts","className"],"mappings":"uKAgOA,EAhOa,WACX,IACMA,EAAS,IACTC,EACJC,SAASC,eAAe,SAASC,wBAAwBH,MAAQ,EAAI,GACjEI,EACI,GADJA,EAEC,GAGDC,EAAKC,KAAKC,IAAIP,EAAOD,GAAU,EAAI,EACnCS,EAAKH,EAAK,GACVI,EAASC,GAAGD,OAAO,QACnBE,EAAS,GACTC,EAAU,GAEVC,EAAMH,GAAGI,IAAID,MAAME,YAAYP,GAAIQ,YAAYX,GAC/CY,EAAQP,GAAGI,IAAIG,QAAQC,OAAOV,GAG9BW,EAFMT,GAAGU,OAAH,UAGTC,UAAU,OACVC,KAAK,CAACX,EAAQC,IACdW,QACAC,OAAO,OACPC,MAAM,UAAW,gBACjBA,MAAM,QAAYzB,EANN,MAOZyB,MAAM,SAAa1B,EAASK,EAAaA,EAP7B,MAQZoB,OAAO,WACPE,KAAK,QAAS1B,GACd0B,KAAK,SAAU3B,EAASK,EAAaA,GACrCoB,OAAO,SACPE,KACC,YAbW,aAcE1B,EAAQ,EAdV,IAce2B,OAAO5B,IAAaK,GAdnC,KAiBTwB,EAAYT,EAAOU,QAAO,SAACC,EAAIC,GAAL,OAAiB,IAANA,KACrCC,EAAab,EAAOU,QAAO,SAACC,EAAIC,GAAL,OAAiB,IAANA,KAEtCE,EAAW,SAAUC,EAAOC,GAChC,OAAOD,EACJV,OAAO,QACPY,KAAKD,GACLT,KAAK,YAHD,qBAIJA,KAAK,QAAS,eACdA,KAAK,cAAe,WAGzBO,EAASL,EAAW,UACpBK,EAASD,EAAY,WAErBtB,GAAG2B,IAAOC,mCAAqC,SAAChB,GAC9C,IAAMiB,EAAY,GACZC,EAAQ,GAEVC,EAAI,EAEFC,EAAU,SAAUC,GAQxB,OAPKJ,EAAUI,KACbJ,EAAUI,GAAK,CACbC,GAAIH,IACJI,KAAMF,IAIHJ,EAAUI,IAGbG,EAAQ,WACZ,OAAQC,KAAKC,QAGf1B,EAAK2B,SAAQ,SAACN,GACZA,EAAEO,SAAWR,EAAQC,EAAEO,UACvBP,EAAEQ,OAAST,EAAQC,EAAEQ,QACrBR,EAAEQ,OAAOC,KAAOT,EAAES,KAClBT,EAAEU,QAAUP,KAGd,IACE,IAAIf,EAAI,EAAGuB,EAAK,EAChB,GAAKb,EAAIa,EAAKb,EAAIa,EAAKb,EACvBV,EAAI,GAAKU,IAAMa,IAAOA,EACtB,CACA3C,EAAOoB,GAAK,GACZnB,EAAQmB,GAAK,GAEb,IACE,IAAIwB,EAAI,EAAGC,EAAK,EAChB,GAAKf,EAAIe,EAAKf,EAAIe,EAAKf,EACvBc,EAAI,GAAKd,IAAMe,IAAOA,EAEtB7C,EAAOoB,GAAGwB,GAAK,EACf3C,EAAQmB,GAAGwB,GAAK,EAIpBjC,EAAK2B,SAAQ,SAACN,GACZhC,EAAOgC,EAAEO,SAASN,IAAID,EAAEQ,OAAOP,IAAMD,EACrC/B,EAAQ+B,EAAEQ,OAAOP,IAAID,EAAEO,SAASN,IAAMD,EACtCH,EAAMG,EAAEO,SAASN,IAAMD,EAAEO,SACzBV,EAAMG,EAAEQ,OAAOP,IAAMD,EAAEQ,UAGzB,IAAMM,EAAS/C,GAAG+C,OACfxC,QACAyC,WAAWhD,GAAGiD,YACdC,cAAclD,GAAGiD,YACjBE,WAAWnD,GAAGiD,YACdG,QAAQ,KAELC,EAAsB,SAAUnB,EAAIoB,EAAWC,GACnD,IACMpC,EADOV,EAAOK,OAAO,QACPA,OAAO,UAAUE,KAAK,KAA3B,eAAgDkB,GAE/Df,EACGL,OAAO,YACPE,KAAK,KAAM,IACXA,KAAK,KAAM,IACXA,KAAK,KAAM,iBACXA,KAAK,SAAU,UAElBG,EACGL,OAAO,kBACPE,KAAK,KAAM,UACXA,KAAK,SAAU,WACfA,KAAK,eAAgBsC,GAExBnC,EACGL,OAAO,WACPE,KAAK,KAAM,iBACXA,KAAK,MAAO,WACZA,KAAK,OAAQ,UAEhBG,EACGL,OAAO,uBACPA,OAAO,WACPE,KAAK,QAASuC,GACdvC,KAAK,OAAQ,WAGlBqC,EAAoB,SAAU,EAAG,IACjCA,EAAoB,WAAY,EAAG,IAEnC,IAAMG,EAAU,CACd,UACA,UACA,UACA,UACA,UACA,WAGIC,EAAIzD,GAAG0D,MACVC,SACAC,OAAO5D,GAAG6D,OAAO,CAAC,EAAG9B,EAAI,KACzB+B,MAAM,CAAC,EAAG,IAEPC,EAAgB/D,GAAG0D,MACtBC,SACAC,OAAO5D,GAAG8D,MAAM,EAAG,EAAG,EAAMN,EAAQQ,SACpCF,MAAMN,GAEHS,EAAO,SAAUhC,GACrB,OAAO8B,EAAcN,EAAExB,KAGzB,OAAOxB,EAAOyD,MAAK,SAAUC,EAAQC,GACnC,IAAMC,EAAUrE,GAAGU,OAAO2B,MAE1BU,EAAOoB,OAAOA,GAEdE,EACG1D,UAAU,cACVC,KAAKmC,EAAOuB,QACZzD,QACAC,OAAO,YACPE,KAAK,QAAS,SACdD,MAAM,QAAQ,SAACkB,GAAD,OAAOgC,EAAKhC,EAAEsC,OAAOC,UACnCzD,MAAM,SAAU,4BAChBA,MAAM,UAAU,SAACkB,GAAD,OAAOjC,GAAGyE,IAAIR,EAAKhC,EAAEsC,OAAOC,QAAQE,YACpD3D,MAAM,eAAgB,GACtBC,KAAK,IAAKT,GACVO,OAAO,aACPY,MACC,SAACO,GAAD,OACKA,EAAE0C,OAAOvC,MAAMK,OAAON,KAD3B,SAEIF,EAAE0C,OAAOvC,MAAMI,SAASL,KAF5B,KAGOpC,EAAOkC,EAAE0C,OAAOvC,OAHvB,QAMJ,IAAMwC,EAAIP,EACP1D,UAAU,WACVC,KAAKmC,EAAO8B,QACZhE,QACAC,OAAO,SACPE,KAAK,QAAS,SAEjB4D,EAAE9D,OAAO,YACNC,MAAM,QAAQ,SAACkB,GAAD,OAAOgC,EAAKhC,EAAEuC,UAC5BxD,KAAK,MAAM,SAACiB,GAAD,cAAeA,EAAEuC,MAAjB,IAA0BJ,KACrCpD,KAAK,IAAKb,GACVY,MAAM,UAAU,iBAAM,gCACtBD,OAAO,aACPY,MACC,SAACO,GAAD,OACKH,EAAMG,EAAEuC,OAAOrC,KADpB,KAC4BiC,EAAK,OAAS,WAD1C,KACwDrE,EACpDkC,EAAEG,OAFN,QAMJwC,EAAE9D,OAAO,YACNE,KAAK,IAAK,GACVA,KAAK,KAAM,IACXG,QAAO,SAACc,GAAD,OAAOA,EAAEG,MAAQ,OACxBtB,OAAO,gBACPE,KAAK,cAAc,SAACiB,GAAD,eAAgBA,EAAEuC,MAAlB,IAA2BJ,KAC9C1C,MAAK,SAACO,GAAD,OAAOH,EAAMG,EAAEuC,OAAOrC,QAC3BnB,KAAK,QAAS,wBC7MvB,EANc,SAAC,GAAD,IAAkB8D,EAAlB,EAAGC,YAAeD,SAAlB,OACZ,gBAAC,IAAD,CAAMA,SAAUA,EAAUE,KAAMA,EAAMC,QAAS,CAAC,0BAC9C,uBAAKC,UAAU,cAAchD,GAAG","file":"component---src-pages-d-3-js-chord-js-06e53af23a2300ad6d95.js","sourcesContent":["const main = () => {\n  const rootElId = \"chart\"\n  const height = 500\n  const width =\n    document.getElementById(\"chart\").getBoundingClientRect().width / 2 - 20\n  const margin = {\n    bottom: 20,\n    top: 50,\n  }\n\n  const r1 = Math.min(width, height) / 2 - 4\n  const r0 = r1 - 20\n  const format = d3.format(\",.3r\")\n  const debits = []\n  const credits = []\n\n  const arc = d3.svg.arc().innerRadius(r0).outerRadius(r1)\n  const chord = d3.svg.chord().radius(r0)\n  const svg = d3.select(`#${rootElId}`)\n\n  const charts = svg\n    .selectAll(\"div\")\n    .data([debits, credits])\n    .enter()\n    .append(\"div\")\n    .style(\"display\", \"inline-block\")\n    .style(\"width\", `${width}px`)\n    .style(\"height\", `${height + margin.top + margin.bottom}px`)\n    .append(\"svg:svg\")\n    .attr(\"width\", width)\n    .attr(\"height\", height + margin.top + margin.bottom)\n    .append(\"svg:g\")\n    .attr(\n      \"transform\",\n      `translate(${width / 2},${String(height / 2 + margin.top)})`\n    )\n\n  const leftChart = charts.filter((_d, i) => i === 0)\n  const rightChart = charts.filter((_d, i) => i === 1)\n\n  const setLabel = function (chart, label) {\n    return chart\n      .append(\"text\")\n      .text(label)\n      .attr(\"transform\", `translate(0,${(-1 * height) / 2 - 10})`)\n      .attr(\"class\", \"chart-title\")\n      .attr(\"text-anchor\", \"middle\")\n  }\n\n  setLabel(leftChart, \"Debits\")\n  setLabel(rightChart, \"Credits\")\n\n  d3.csv(`${ROOT_PATH}data/d3js/chord/data.csv`, (data) => {\n    const countries = {}\n    const array = []\n\n    let n = 0\n\n    const country = function (d) {\n      if (!countries[d]) {\n        countries[d] = {\n          id: n++,\n          name: d,\n        }\n      }\n\n      return countries[d]\n    }\n\n    const value = function () {\n      return +this.amount\n    }\n\n    data.forEach((d) => {\n      d.creditor = country(d.creditor)\n      d.debtor = country(d.debtor)\n      d.debtor.risk = d.risk\n      d.valueOf = value\n    })\n\n    for (\n      let i = 0, _i = 0;\n      0 <= n ? _i < n : _i > n;\n      i = 0 <= n ? ++_i : --_i\n    ) {\n      debits[i] = []\n      credits[i] = []\n\n      for (\n        let j = 0, _j = 0;\n        0 <= n ? _j < n : _j > n;\n        j = 0 <= n ? ++_j : --_j\n      ) {\n        debits[i][j] = 0\n        credits[i][j] = 0\n      }\n    }\n\n    data.forEach((d) => {\n      debits[d.creditor.id][d.debtor.id] = d\n      credits[d.debtor.id][d.creditor.id] = d\n      array[d.creditor.id] = d.creditor\n      array[d.debtor.id] = d.debtor\n    })\n\n    const layout = d3.layout\n      .chord()\n      .sortGroups(d3.descending)\n      .sortSubgroups(d3.descending)\n      .sortChords(d3.descending)\n      .padding(0.04)\n\n    const addDropShadowFilter = function (id, deviation, slope) {\n      const defs = charts.append(\"defs\")\n      const filter = defs.append(\"filter\").attr(\"id\", `drop-shadow-${id}`)\n\n      filter\n        .append(\"feOffset\")\n        .attr(\"dx\", 0.5)\n        .attr(\"dy\", 0.5)\n        .attr(\"in\", \"SourceGraphic\")\n        .attr(\"result\", \"offOut\")\n\n      filter\n        .append(\"feGaussianBlur\")\n        .attr(\"in\", \"offOut\")\n        .attr(\"result\", \"blurOut\")\n        .attr(\"stdDeviation\", deviation)\n\n      filter\n        .append(\"feBlend\")\n        .attr(\"in\", \"SourceGraphic\")\n        .attr(\"in2\", \"blurOut\")\n        .attr(\"mode\", \"normal\")\n\n      filter\n        .append(\"feComponentTransfer\")\n        .append(\"feFuncA\")\n        .attr(\"slope\", slope)\n        .attr(\"type\", \"linear\")\n    }\n\n    addDropShadowFilter(\"chords\", 2, 0.4)\n    addDropShadowFilter(\"headings\", 3, 0.5)\n\n    const colours = [\n      \"#39B347\",\n      \"#C92E47\",\n      \"#DB704D\",\n      \"#FFA22C\",\n      \"#5E92AA\",\n      \"#F8EDD3\",\n    ]\n\n    const c = d3.scale\n      .linear()\n      .domain(d3.extent([0, n - 1]))\n      .range([0, 1])\n\n    const heatmapColour = d3.scale\n      .linear()\n      .domain(d3.range(0, 1, 1.0 / colours.length))\n      .range(colours)\n\n    const fill = function (d) {\n      return heatmapColour(c(d))\n    }\n\n    return charts.each(function (matrix, jj) {\n      const svgComp = d3.select(this)\n\n      layout.matrix(matrix)\n\n      svgComp\n        .selectAll(\"path.chord\")\n        .data(layout.chords)\n        .enter()\n        .append(\"svg:path\")\n        .attr(\"class\", \"chord\")\n        .style(\"fill\", (d) => fill(d.target.index))\n        .style(\"filter\", \"url(#drop-shadow-chords)\")\n        .style(\"stroke\", (d) => d3.rgb(fill(d.target.index)).darker())\n        .style(\"stroke-width\", 2)\n        .attr(\"d\", chord)\n        .append(\"svg:title\")\n        .text(\n          (d) =>\n            `${d.source.value.debtor.name} owes ${\n              d.source.value.creditor.name\n            } $${format(d.source.value)}B.`\n        )\n\n      const g = svgComp\n        .selectAll(\"g.group\")\n        .data(layout.groups)\n        .enter()\n        .append(\"svg:g\")\n        .attr(\"class\", \"group\")\n\n      g.append(\"svg:path\")\n        .style(\"fill\", (d) => fill(d.index))\n        .attr(\"id\", (d) => `group${d.index}-${jj}`)\n        .attr(\"d\", arc)\n        .style(\"filter\", () => \"url(#drop-shadow-headings)\")\n        .append(\"svg:title\")\n        .text(\n          (d) =>\n            `${array[d.index].name} ${jj ? \"owes\" : \"is owed\"} $${format(\n              d.value\n            )}B.`\n        )\n\n      g.append(\"svg:text\")\n        .attr(\"x\", 6)\n        .attr(\"dy\", 15)\n        .filter((d) => d.value > 150)\n        .append(\"svg:textPath\")\n        .attr(\"xlink:href\", (d) => `#group${d.index}-${jj}`)\n        .text((d) => array[d.index].name)\n        .attr(\"class\", \"heading-title\")\n    })\n  })\n}\n\nexport default main\n","import React from \"react\"\n\nimport Demo from \"@/components/demo\"\n\nimport main from \"@/demos/chord/chord\"\n\nimport \"@/demos/chord/chord.styl\"\n\nconst Chord = ({ pageContext: { demoInfo } }) => (\n  <Demo demoInfo={demoInfo} main={main} scripts={[\"/vendors/d3/d3.min.js\"]}>\n    <div className=\"chord-chart\" id=\"chart\" />\n  </Demo>\n)\n\nexport default Chord\n"],"sourceRoot":""}