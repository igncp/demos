{"version":3,"sources":["webpack://demos/./src/demos/timeline/timeline.js","webpack://demos/./src/pages/d3js/timeline.js"],"names":["d3","csv","dataset","margin","bottom","left","right","top","outerWidth","$","innerWidth","width","height","bandY","bandNum","timeline","data","components","bands","svg","d3utils","middleTitle","filterBlackOpacity","append","attr","on","selectAll","style","filter","chart","parseDate","dateString","date","time","format","parse","year","isNaN","replace","Date","setUTCFullYear","slice","toYear","bcString","getUTCFullYear","toString","timelineItems","today","tracks","items","timeOrder","compareAscending","item1","item2","result","start","end","compareDescending","forEach","item","getTime","instant","sort","track","i","_i","_ref","length","nTracks","minDate","min","d","maxDate","max","tooltip","create","followMouse","leftOffst","band","bandName","sizeFactor","id","x","y","w","h","trackOffset","trackHeight","Math","itemHeight","parts","instantWidth","xScale","scale","domain","range","yScale","yearsScale","g","enter","label","intervals","select","instants","addActions","actions","action","redraw","text","maxLetters","substr","part","push","labels","labelTop","labelDefs","_min","bandLabels","xAxis","orientation","axis","orient","tickSize","tickFormat","call","brush","targetNames","empty","extent","component","createTimeline","demoInfo","pageContext","main","scripts","className"],"mappings":"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","file":"component---src-pages-d-3-js-timeline-js-66cde10f82eb0414f0d0.js","sourcesContent":["const main = () => {\n  const createTimeline = function () {\n    const margin = {\n      bottom: 0,\n      left: 20,\n      right: 20,\n      top: 60,\n    }\n\n    const outerWidth = $(\"#chart\").innerWidth()\n    const outerHeight = 700\n    const width = outerWidth - margin.left - margin.right\n    const height = outerHeight - margin.top - margin.bottom\n    const bandGap = 25\n\n    let bandY = 0\n    let bandNum = 0\n\n    const timeline = {}\n    const data = {}\n    const components = []\n\n    const bands = {}\n    const svg = d3utils.svg(\"#chart\", outerWidth, outerHeight, margin)\n\n    d3utils.middleTitle(svg, outerWidth, \"Philosophers through History\", -20)\n    d3utils.filterBlackOpacity(\"intervals\", svg, 1, 0.2)\n\n    svg\n      .append(\"clipPath\")\n      .attr(\"id\", \"chart-area\")\n      .append(\"rect\")\n      .attr(\"width\", width)\n      .attr(\"height\", height)\n\n    svg.on(\"mouseup\", () =>\n      d3.selectAll(\".interval rect\").style({\n        filter: \"url(#drop-shadow-intervals)\",\n      })\n    )\n\n    const chart = svg\n      .append(\"g\")\n      .attr(\"class\", \"chart\")\n      .attr(\"clip-path\", \"url(#chart-area)\")\n\n    const parseDate = function (dateString) {\n      const format = d3.time.format(\"%Y-%m-%d\")\n\n      let date = format.parse(dateString)\n\n      if (date !== null) {\n        return date\n      }\n\n      let year = null\n\n      if (isNaN(dateString)) {\n        year = -dateString.replace(/[^0-9]/g, \"\")\n      } else {\n        year = +dateString\n      }\n\n      if (year < 0 || year > 99) {\n        date = new Date(year, 6, 1)\n      } else if (year === 0) {\n        date = new Date(-1, 6, 1)\n      } else {\n        date = new Date(year, 6, 1)\n        date.setUTCFullYear(`0000${year}`.slice(-4))\n      }\n\n      return date\n    }\n\n    const toYear = function (date, bcString) {\n      bcString = bcString || \" BC\"\n\n      const year = date.getUTCFullYear()\n\n      if (year > 0) {\n        return year.toString()\n      }\n\n      if (bcString[0] === \"-\") {\n        return bcString + -year\n      }\n\n      return -year + bcString\n    }\n\n    timeline.data = function (timelineItems) {\n      const today = new Date()\n\n      const tracks = []\n      const yearMillis = 31622400000\n      const instantOffset = 100 * yearMillis\n\n      data.items = timelineItems\n\n      const compareAscending = function (item1, item2) {\n        let result = item1.start - item2.start\n\n        if (result < 0) {\n          return -1\n        }\n\n        if (result > 0) {\n          return 1\n        }\n\n        result = item2.end - item1.end\n\n        if (result < 0) {\n          return -1\n        }\n\n        if (result > 0) {\n          return 1\n        }\n\n        return 0\n      }\n\n      const compareDescending = function (item1, item2) {\n        let result = item1.start - item2.start\n\n        if (result < 0) {\n          return 1\n        }\n\n        if (result > 0) {\n          return -1\n        }\n\n        result = item2.end - item1.end\n\n        if (result < 0) {\n          return 1\n        }\n\n        if (result > 0) {\n          return -1\n        }\n\n        return 0\n      }\n\n      const calculateTracks = function (items, sortOrder, timeOrder) {\n        sortOrder = sortOrder || \"descending\"\n        timeOrder = timeOrder || \"backward\"\n\n        const sortBackward = function () {\n          return items.forEach((item) => {\n            let track = 0\n\n            for (\n              let i = 0, _i = 0, _ref = tracks.length;\n              0 <= _ref ? _i < _ref : _i > _ref;\n              i = 0 <= _ref ? ++_i : --_i\n            ) {\n              if (item.end < tracks[i]) {\n                break\n              }\n\n              track++\n            }\n\n            item.track = track\n\n            tracks[track] = item.start\n          })\n        }\n\n        const sortForward = function () {\n          return items.forEach((item) => {\n            let track = 0\n\n            for (\n              let i = 0, _i = 0, _ref = tracks.length;\n              0 <= _ref ? _i < _ref : _i > _ref;\n              i = 0 <= _ref ? ++_i : --_i\n            ) {\n              if (item.start > tracks[i]) {\n                break\n              }\n\n              track++\n            }\n\n            item.track = track\n\n            tracks[track] = item.end\n          })\n        }\n\n        if (sortOrder === \"ascending\") {\n          data.items.sort(compareAscending)\n        } else {\n          data.items.sort(compareDescending)\n        }\n\n        if (timeOrder === \"forward\") {\n          return sortForward()\n        }\n\n        return sortBackward()\n      }\n\n      data.items.forEach((item) => {\n        item.start = parseDate(item.start)\n\n        if (item.end === \"\") {\n          item.end = new Date(item.start.getTime() + instantOffset)\n          item.instant = true\n        } else {\n          item.end = parseDate(item.end)\n          item.instant = false\n        }\n\n        if (item.end > today) {\n          item.end = today\n        }\n      })\n      calculateTracks(data.items, \"descending\", \"backward\")\n      data.nTracks = tracks.length\n      data.minDate = d3.min(data.items, (d) => d.start)\n      data.maxDate = d3.max(data.items, (d) => d.end)\n\n      return timeline\n    }\n\n    timeline.tooltip = {\n      create() {\n        d3utils.tooltip(\".part.instant, .part.interval\", {\n          followMouse: true,\n          leftOffst: 80,\n        })\n\n        return timeline\n      },\n    }\n\n    timeline.band = function (bandName, sizeFactor) {\n      const band = {}\n\n      band.id = `band${bandNum}`\n      band.x = 0\n      band.y = bandY\n      band.w = width\n      band.h = height * (sizeFactor || 1)\n      band.trackOffset = 0\n      band.trackHeight = Math.min(\n        (band.h - band.trackOffset) / data.nTracks,\n        20\n      )\n      band.itemHeight = band.trackHeight * 0.7\n      band.parts = []\n      band.instantWidth = 100\n      band.xScale = d3.time\n        .scale()\n        .domain([data.minDate, data.maxDate])\n        .range([0, band.w])\n\n      band.yScale = function (track) {\n        return band.trackOffset + track * band.trackHeight\n      }\n\n      band.yearsScale =\n        data.maxDate.getUTCFullYear() - data.minDate.getUTCFullYear()\n      band.g = chart\n        .append(\"g\")\n        .attr(\"id\", band.id)\n        .attr(\"transform\", `translate(0,${band.y})`)\n      band.g\n        .append(\"rect\")\n        .attr(\"class\", \"band\")\n        .attr(\"width\", band.w)\n        .attr(\"height\", band.h)\n\n      const items = band.g\n        .selectAll(\"g\")\n        .data(data.items)\n        .enter()\n        .append(\"svg\")\n        .attr(\"y\", (d) => band.yScale(d.track))\n        .attr(\"height\", band.itemHeight)\n        .attr(\"data-title\", (d) => {\n          if (d.instant) {\n            return `${d.label}: ${toYear(d.start)}`\n          }\n\n          return `${d.label}: ${toYear(d.start)} - ${toYear(d.end)}`\n        })\n        .attr(\"class\", (d) => {\n          if (d.instant) {\n            return \"part instant\"\n          }\n\n          return \"part interval\"\n        })\n\n      const intervals = d3.select(`#band${bandNum}`).selectAll(\".interval\")\n\n      intervals\n        .append(\"rect\")\n        .attr({\n          height: \"80%\",\n          width: \"80%\",\n          x: \"1px\",\n          y: \".5px\",\n        })\n        .style({\n          filter: \"url(#drop-shadow-intervals)\",\n        })\n      intervals\n        .append(\"text\")\n        .attr(\"class\", \"intervalLabel\")\n        .attr(\"x\", 3)\n        .attr(\"y\", 9.5)\n\n      const instants = d3.select(`#band${bandNum}`).selectAll(\".instant\")\n\n      instants\n        .append(\"circle\")\n        .attr(\"cx\", band.itemHeight / 2)\n        .attr(\"cy\", band.itemHeight / 2)\n        .attr(\"r\", 5)\n      instants\n        .append(\"text\")\n        .attr(\"class\", \"instantLabel\")\n        .attr(\"x\", 15)\n        .attr(\"y\", 10)\n\n      band.addActions = function (actions) {\n        return actions.forEach((action) => items.on(action[0], action[1]))\n      }\n\n      band.redraw = function () {\n        items\n          .attr(\"x\", (d) => band.xScale(d.start))\n          .attr(\"width\", (d) => band.xScale(d.end) - band.xScale(d.start))\n          .select(\"text\")\n          .text((d) => {\n            const scale = band.xScale(d.end) - band.xScale(d.start)\n            const maxLetters = scale / 9\n\n            if (d.label.length > maxLetters) {\n              return `${d.label.substr(0, maxLetters - 1)}..`\n            }\n\n            return d.label\n          })\n\n        return band.parts.forEach((part) => part.redraw())\n      }\n\n      bands[bandName] = band\n      components.push(band)\n      bandY += band.h + bandGap\n      bandNum += 1\n\n      return timeline\n    }\n\n    timeline.labels = function (bandName) {\n      const band = bands[bandName]\n      const labelWidth = 46\n      const labelHeight = 20\n      const labelTop = band.y + band.h - 10\n      const yText = 15\n      const labelDefs = [\n        [\n          \"start\",\n          \"bandMinMaxLabel\",\n          0,\n          4,\n          function (min) {\n            return toYear(min)\n          },\n          \"Start of the selected interval\",\n          band.x + 30,\n          labelTop,\n        ],\n        [\n          \"end\",\n          \"bandMinMaxLabel\",\n          band.w - labelWidth,\n          band.w - 4,\n          function (_min, max) {\n            return toYear(max)\n          },\n          \"End of the selected interval\",\n          band.x + band.w - 152,\n          labelTop,\n        ],\n        [\n          \"middle\",\n          \"bandMidLabel\",\n          (band.w - labelWidth) / 2,\n          band.w / 2,\n          function (min, max) {\n            return max.getUTCFullYear() - min.getUTCFullYear()\n          },\n          \"Length of the selected interval\",\n          band.x + band.w / 2 - 75,\n          labelTop,\n        ],\n      ]\n      const bandLabels = chart\n        .append(\"g\")\n        .attr(\"id\", `${bandName}Labels`)\n        .attr(\"transform\", `translate(0,${band.y + band.h + 1})`)\n        .selectAll(`#${bandName}Labels`)\n        .data(labelDefs)\n        .enter()\n        .append(\"g\")\n\n      bandLabels\n        .append(\"rect\")\n        .attr(\"class\", \"bandLabel\")\n        .attr(\"x\", (d) => d[2])\n        .attr(\"width\", labelWidth)\n        .attr(\"height\", labelHeight)\n        .style(\"opacity\", 1)\n\n      const labels = bandLabels\n        .append(\"text\")\n        .attr(\"class\", (d) => d[1])\n        .attr(\"id\", (d) => d[0])\n        .attr(\"x\", (d) => d[3])\n        .attr(\"y\", yText)\n        .attr(\"text-anchor\", (d) => d[0])\n\n      labels.redraw = function () {\n        const min = band.xScale.domain()[0]\n        const max = band.xScale.domain()[1]\n\n        return labels.text((d) => d[4](min, max))\n      }\n\n      band.parts.push(labels)\n      components.push(labels)\n\n      return timeline\n    }\n\n    timeline.xAxis = function (bandName, orientation) {\n      const band = bands[bandName]\n      const axis = d3.svg\n        .axis()\n        .scale(band.xScale)\n        .orient(orientation || \"bottom\")\n        .tickSize(6, 0)\n        .tickFormat((d) => toYear(d))\n      const xAxis = chart\n        .append(\"g\")\n        .attr(\"class\", \"axis\")\n        .attr(\"transform\", `translate(0,${band.y + band.h})`)\n\n      xAxis.redraw = function () {\n        return xAxis.call(axis)\n      }\n\n      band.parts.push(xAxis)\n      components.push(xAxis)\n\n      return timeline\n    }\n\n    timeline.brush = function (bandName, targetNames) {\n      const band = bands[bandName]\n      const brush = d3.svg.brush().x(band.xScale.range([0, band.w]))\n\n      brush.on(\"brush\", () => {\n        const domain = brush.empty() ? band.xScale.domain() : brush.extent()\n\n        d3.selectAll(\".interval rect\").style({\n          filter: \"none\",\n        })\n\n        targetNames.forEach((d) => {\n          bands[d].xScale.domain(domain)\n\n          bands[d].redraw()\n        })\n      })\n\n      const xBrush = band.g.append(\"svg\").attr(\"class\", \"x brush\").call(brush)\n\n      xBrush\n        .selectAll(\"rect\")\n        .attr(\"y\", 1)\n        .attr(\"height\", band.h - 1)\n\n      return timeline\n    }\n\n    timeline.redraw = function () {\n      return components.forEach((component) => component.redraw())\n    }\n\n    return timeline\n  }\n\n  d3.csv(\"/data/d3js/timeline/data.csv\", (dataset) =>\n    createTimeline()\n      .data(dataset)\n      .band(\"mainBand\", 0.82)\n      .band(\"naviBand\", 0.08)\n      .xAxis(\"mainBand\")\n      .xAxis(\"naviBand\")\n      .labels(\"mainBand\")\n      .labels(\"naviBand\")\n      .brush(\"naviBand\", [\"mainBand\"])\n      .tooltip[\"create\"]()\n      .redraw()\n  )\n}\n\nexport default main\n","import React from \"react\"\n\nimport Demo from \"@/components/demo\"\n\nimport main from \"@/demos/timeline/timeline\"\n\nimport \"@/demos/timeline/timeline.styl\"\n\nconst Timeline = ({ pageContext: { demoInfo } }) => (\n  <Demo\n    demoInfo={demoInfo}\n    main={main}\n    scripts={[\"/vendors/d3/d3.min.js\", \"/js/d3js-utils.js\"]}\n  >\n    <div className=\"timeline-chart\" id=\"chart\" />\n  </Demo>\n)\n\nexport default Timeline\n"],"sourceRoot":""}