<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta content="ie=edge" http-equiv="x-ua-compatible"/><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/><script src="/demos/vendors/jquery/dist/jquery.min.js" type="text/javascript"></script><script src="/demos/vendors/bootstrap/dist/js/bootstrap.min.js" type="text/javascript"></script><script src="/demos/vendors/angular/angular.min.js" type="text/javascript"></script><script src="/demos/vendors/lodash/dist/lodash.min.js" type="text/javascript"></script><script src="/demos/vendors/async/lib/async.js" type="text/javascript"></script><link href="/demos/vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/><link href="/demos/vendors/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css"/><link href="/demos/vendors/highlightjs/styles/default.css" rel="stylesheet" type="text/css"/><link href="/demos/favicon.png" rel="shortcut icon" type="image/png"/><link href="https://fonts.googleapis.com/css?family=Lobster" rel="stylesheet" type="text/css"/><script src="/demos/vendors/highlightjs/highlight.pack.js" type="text/javascript"></script><style data-href="/demos/styles.2d6159d62e1edf771fb8.css" id="gatsby-global-css">body{color:red}::selection{background-color:transparent;color:#ccc}a:focus,a:hover{text-decoration:none}body{color:#6d6d77}body .tooltip.top{margin-left:20px;opacity:.9;z-index:10}body .tooltip.top .tooltip-inner{background-color:#fff;border:1px solid #ccc;box-shadow:0 0 5px .5px #ddd;color:#000}body .tooltip.top .tooltip-arrow{display:none}form{text-align:center}form input[type=radio]{margin-left:20px}ul{list-style-type:circle}.bullet{font-size:30px;text-shadow:.5px .5px 1px #444}.bullet.d3js{color:#9ac99d}.bullet.raphael{color:#7fa2be}.home-demo-name-link{color:#67777a}.home-demo-number{font-weight:700}.page-header{font-family:Lobster,cursive}.page-header a{color:#324297}.page-header h1{font-size:4em;text-shadow:1px 1px 1px #ddd}.page-header small{color:#9bb9a8;font-size:.5em}.row{margin:0}.source-number{color:#b91515;font-weight:700}#chart{border-radius:10px;box-shadow:0 0 20px .1px #ddd;margin-bottom:20px;overflow:hidden}#code pre{border:1px solid #3a9e4a;box-shadow:inset 0 0 8px .1px #ddd}#data-list,#sources-list{margin-bottom:30px}#demos-legend{text-align:center}#demos-legend ul{display:inline-block;list-style-type:none;margin-top:10px;padding:10px 20px 10px 30px;text-align:left}#demos-legend li{display:inline-block;position:relative}#demos-legend li:first-child{margin-right:30px}#demos-legend .bullet{left:-15px;position:absolute;top:-10px}#demos-lists{font-size:1.1em;letter-spacing:1px;margin-top:15px}#demos-lists a{background-color:rgba(145,145,145,.08);padding-left:20px;transition:all .5s linear}#demos-lists a:hover{background-color:rgba(145,172,196,.3);padding-left:25px}#demos-lists a .bullet{left:-30px;position:absolute;top:0}#demo-title{margin-bottom:20px}#main-source{color:#bbb}#notes{margin-bottom:30px}#notes,#sources-list{margin-top:30px}.bs-callout{border:1px solid #eee;border-left-width:5px;border-radius:3px;margin:20px 0;padding:20px}.bs-callout h4{margin-top:0}.bs-callout p:last-child{margin-bottom:0}.bs-callout .highlight,.bs-callout code{background-color:#fff}.bs-callout-success{border-color:#93b193}.bs-callout-warning{border-color:#f1e7bc}.bs-callout-info{border-color:#d0e3f0}.bs-callout-primary{border-color:#768ca0}pre{margin-bottom:30px}.hljs,pre{background:#fff}.hljs .hljs-string{color:#4d97f5}.hljs .hljs-keyword{color:#2cbd72}.hljs .hljs-title{color:#dd2323}.hljs .hljs-number{color:#db1fb6;font-weight:700}.hljs .vbscript{color:#228b37}.hljs .hljs-value,.hljs .hljs-value .hljs-number{color:#50b43d}.hljs .hljs-hexcolor{color:#4762ce}.hljs .hljs-class,.hljs .hljs-id,.hljs .hljs-tag{color:#c59c44}.hljs .hljs-attribute{color:#cf3d48}body,html{height:100%}#container{margin-bottom:-60px;min-height:100%}#container:after{content:"";display:block}#container:after,footer{height:60px}footer p{margin-top:20px;text-align:center;text-shadow:1px 1px 1px #ccc}.area-chart path.line{fill:none;stroke:#25a6fc;stroke-width:3.5px}.area-chart path.area{fill:#6e6ea7;opacity:.5}.area-chart text{text-shadow:1px 1px 1px #ddd}.area-chart .axis{shape-rendering:crispEdges;fill:#333}.area-chart .chart-title{font-weight:700}.area-chart .x.axis .minor{fill:#000}.area-chart .axis line,.area-chart .axis path{fill:none;stroke:#ccc;shape-rendering:crispEdges}.area-chart .x.axis line,.area-chart .x.axis path,.area-chart .y.axis line,.area-chart .y.axis path{fill:none;stroke:#ccc}.area-chart .voronoi{stroke-width:.1;opacity:0}.area-chart .point{fill:#69d895;display:none}.bars-chart rect{stroke:#fff}.bars-chart .axis path{fill:none;stroke:#777;stroke-width:1px}.bars-chart .axis .tick line{stroke:#777}.bubbles-chart .nvd3 .nv-axis.nv-x path.domain{stroke-opacity:.75}.bubbles-chart .nvd3 .nv-axis line{stroke-opacity:.4}.chord-chart path.chord{stroke-width:.75;fill-opacity:.75}.chord-chart .chart-title{font-weight:700}.chord-chart .group text{font:11px sans-serif;pointer-events:none}.chord-chart .group path{stroke:#000}.chord-chart .heading-title{font-size:15px;font-weight:700}.collapsible-tree-chart .node{cursor:pointer}.collapsible-tree-chart .node circle{fill:#fff;stroke:#4682b4;stroke-width:1.5px}.collapsible-tree-chart .node text{font:10px sans-serif}.collapsible-tree-chart .link{fill:none;stroke:#ccc;stroke-width:1.5px}.fish-eye-chart text{font:10px sans-serif;text-shadow:1px 1px 1px #ccc}.fish-eye-chart .axis line,.fish-eye-chart .axis path{fill:none;stroke:#eee;shape-rendering:crispEdges}.fish-eye-chart .background{fill:none;pointer-events:all}.fish-eye-chart .chart-title{font-size:14px}.fish-eye-chart .pointer{fill:#7aae61;font-size:15px;opacity:0}.force-chart path.link{fill:none;stroke:#666;stroke-width:1.5px}.force-chart circle{fill:#9c9;stroke:#fff;stroke-width:1.5px}.force-chart text{fill:#999;font:10px sans-serif;pointer-events:none}.force-chart .node text{fill:#000;font-size:12px}.icosahedron-chart path{fill:#f88e22;stroke:#fff;stroke-width:2px}.map-distorsions-chart svg{font-family:sans-serif;text-shadow:1px 1px 1px #ddd}.map-distorsions-chart .background path{fill:none;stroke:none;stroke-width:20px;pointer-events:stroke}.map-distorsions-chart .foreground path{fill:none;stroke-width:1.5px}.map-distorsions-chart .axis{font-size:12px}.map-distorsions-chart .axis .title{font-family:Times New Roman;font-size:11px;font-weight:700;text-transform:uppercase}.map-distorsions-chart .axis line,.map-distorsions-chart .axis path{fill:none;stroke:#000;shape-rendering:crispEdges}.map-distorsions-chart .label{-webkit-transition:fill 125ms linear}.map-distorsions-chart .label.inactive{fill:#ccc!important}.map-distorsions-chart .active .label:not(.inactive){font-weight:700}.map-distorsions-chart .foreground path.inactive{stroke:#ccc!important;stroke-opacity:.5;stroke-width:1px}.mareys-schedule-chart svg{font:10px sans-serif}.mareys-schedule-chart .axis path{display:none}.mareys-schedule-chart .axis line{stroke:#000;shape-rendering:crispEdges}.mareys-schedule-chart .chart-title{font-size:15px}.mareys-schedule-chart .station line{stroke:#ddd;stroke-dasharray:1,1;shape-rendering:crispEdges}.mareys-schedule-chart .station text{text-anchor:end}.mareys-schedule-chart .train path{fill:none;stroke-width:2.5px}.mareys-schedule-chart .train circle{stroke:#fff}.mareys-schedule-chart .train .N path{stroke:#222}.mareys-schedule-chart .train .N circle{fill:#222}.mareys-schedule-chart .train .L path{stroke:#b77409}.mareys-schedule-chart .train .L circle{fill:#b77409}.mareys-schedule-chart .train .B path{stroke:#c03e1d}.mareys-schedule-chart .train .B circle{fill:#c03e1d}.multiline-voronoi-chart .axis line,.multiline-voronoi-chart .axis path{fill:none;stroke:#000;shape-rendering:crispEdges}.multiline-voronoi-chart .cities{fill:none;stroke:#aaa;stroke-linejoin:round;stroke-linecap:round;stroke-width:1.5px}.multiline-voronoi-chart .city--hover{stroke:#000}.multiline-voronoi-chart .focus text{text-anchor:middle;text-shadow:0 1px 0 #fff,1px 0 0 #fff,0 -1px 0 #fff,-1px 0 0 #fff}.multiline-voronoi-chart .voronoi path{fill:none;pointer-events:all}.multiline-voronoi-chart .voronoi--show path{stroke:red;stroke-opacity:.2}.multiline-voronoi-chart #form{position:absolute;right:30px;top:20px}.timeline-chart text{text-shadow:.5px .5px .5px #ccc}.timeline-chart .axis{fill:grey;font-family:sans-serif;font-size:10px}.timeline-chart .axis line,.timeline-chart .axis path{stroke-width:1;stroke:grey;shape-rendering:crispEdges}.timeline-chart .band{fill:#fff}.timeline-chart .bandLabel{fill:#f0f0f0;font:10px sans-serif;font-weight:700}.timeline-chart .bandMinMaxLabel{fill:#11aa6a;font:10px sans-serif;font-weight:700}.timeline-chart .bandMidLabel{fill:#bc79c5;cursor:default;font:10px sans-serif;font-style:italic;font-weight:700}.timeline-chart .brush .extent{stroke:grey;fill:#71d7e5;fill-opacity:.1}.timeline-chart .chart{fill:#eee}.timeline-chart .interval{fill:#ecf7f7;cursor:default;pointer-events:true}.timeline-chart .interval rect{stroke-width:.5px;stroke:#000}.timeline-chart .instant{fill:#afcae7;cursor:default}.timeline-chart .instantLabel{fill:#7e7e7e;shape-rendering:crispEdges;font:10px sans-serif}.timeline-chart .intervalLabel{fill:#000;shape-rendering:crispEdges;font:10px sans-serif}.timeline-chart .item{cursor:default;pointer-events:auto}.trend-line-chart .axis{font:10px sans-serif}.trend-line-chart .axis path,.trend-line-chart line{fill:none;stroke:#000;shape-rendering:crispEdges}.trend-line-chart .line{fill:none;stroke:#4682b4;stroke-width:1.5px}.trend-line-chart .rline{fill:none;stroke:red;stroke-dasharray:5,5;stroke-width:1.5px}.vectors-chart svg{background-color:#fff;cursor:default;-webkit-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none}.vectors-chart svg:not(.active):not(.ctrl){cursor:crosshair}.vectors-chart path.link{fill:none;stroke:#888;stroke-width:3px;cursor:default}.vectors-chart svg:not(.active):not(.ctrl) path.link{cursor:pointer}.vectors-chart path.link.selected{stroke-dasharray:10,2}.vectors-chart path.link.dragline{pointer-events:none}.vectors-chart path.link.hidden{stroke-width:0}.vectors-chart circle.node{stroke-width:0px;fill:#fff;cursor:pointer}.vectors-chart text{font:14px sans-serif;pointer-events:none}.vectors-chart text.id{text-anchor:middle;font-weight:700}.weekly-heatmap-chart rect.bordered{stroke:#e6e6e6;stroke-width:2px}.weekly-heatmap-chart text.mono{fill:#aaa;font-family:Consolas,courier;font-size:9pt}.weekly-heatmap-chart text.axis-worktime,.weekly-heatmap-chart text.axis-workweek{fill:#000}.bars-3dimensional-chart{padding:50px}.circular-arcs-chart{color:#fff}.circular-arcs-chart svg{margin-left:30px}.moving-line-chart path{stroke:#000;fill:none}.moving-line-chart .point{fill:#87b189}</style><meta name="generator" content="Gatsby 3.6.2"/><title data-react-helmet="true">Timeline | demos igncp</title><script data-react-helmet="true" src="/demos/vendors/d3/d3.min.js" type="text/javascript"></script><script data-react-helmet="true" src="/demos/js/d3js-utils.js" type="text/javascript"></script><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link as="script" rel="preload" href="/demos/webpack-runtime-e56b2c618e13f4cbc5cb.js"/><link as="script" rel="preload" href="/demos/framework-1f78429ab6fb93434b07.js"/><link as="script" rel="preload" href="/demos/app-6a630258070fb16a5327.js"/><link as="script" rel="preload" href="/demos/40253593f9913a7f13fa78c8c713ea552ed82d8a-cb2c0702fb0cd3f059e6.js"/><link as="script" rel="preload" href="/demos/component---src-pages-d-3-js-timeline-js-ca6a001da1860c231289.js"/><link as="fetch" rel="preload" href="/demos/page-data/d3js/timeline/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/demos/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="row" id="container"><div class="col-lg-offset-1 col-lg-10"><div class="page-header"><h1 class="row"><span class="col-lg-8"><a href="/demos/">Demos</a> <small>interactive data visualization examples</small></span><span class="col-lg-4"><iframe allowtransparency="true" frameBorder="0" height="20" scrolling="0" src="https://ghbtns.com/github-btn.html?user=igncp&amp;repo=demos&amp;type=watch" width="62"></iframe><iframe allowtransparency="true" frameBorder="0" height="20" scrolling="0" src="https://ghbtns.com/github-btn.html?user=igncp&amp;repo=demos&amp;type=follow" width="119"></iframe><iframe allowtransparency="true" frameBorder="0" height="20" scrolling="0" src="https://ghbtns.com/github-btn.html?user=igncp&amp;repo=demos&amp;type=fork" width="62"></iframe></span></h1></div><h2 class="row" id="demo-title"><span class="col-lg-10">Timeline<!-- --> Chart<!-- --> <small id="main-source">main source: <a href="http://bl.ocks.org/rengel-de/5603464">···</a></small></span><span class="col-lg-2 back-home"><a class="btn btn-default" href="/demos/"><span class="glyphicon glyphicon-home"></span> Home</a></span></h2><div class="timeline-chart" id="chart"></div><div><div class="bs-callout bs-callout-info" id="notes"><p><strong>Notes:</strong></p><ul><li>Change to bootstrap tooltip</li><li>Add dynamic text lengths (adding two dots)</li><li>Improve performance (a lot) removing the drop-shadow while brushing</li></ul></div><div class="bs-callout bs-callout-primary" id="sources-list"><p><strong>Sources:</strong></p><ul><li><span class="source-number">[<!-- -->1<!-- -->]</span>:<!-- --> <a href="http://bl.ocks.org/rengel-de/5603464">http://bl.ocks.org/rengel-de/5603464</a></li></ul></div><div class="bs-callout bs-callout-warning" id="data-list"><p><strong>Data: </strong><a href="/demos/data/d3js/timeline/data.csv">data.csv</a></p></div><div class="bs-callout bs-callout-success" id="code"><p><strong>Code:</strong></p><ul><li><p>timeline.js</p><pre><code class="javascript">import d3utils from &quot;@/demos/_utils/d3utils&quot;

const main = () =&gt; {
  const createTimeline = function () {
    const margin = {
      bottom: 0,
      left: 20,
      right: 20,
      top: 60,
    }

    const outerWidth = $(&quot;#chart&quot;).innerWidth()
    const outerHeight = 700
    const width = outerWidth - margin.left - margin.right
    const height = outerHeight - margin.top - margin.bottom
    const bandGap = 25

    let bandY = 0
    let bandNum = 0

    const timeline = {}
    const data = {}
    const components = []

    const bands = {}
    const svg = d3utils.svg(&quot;#chart&quot;, outerWidth, outerHeight, margin)

    d3utils.middleTitle(svg, outerWidth, &quot;Philosophers through History&quot;, -20)
    d3utils.filterBlackOpacity(&quot;intervals&quot;, svg, 1, 0.2)

    svg
      .append(&quot;clipPath&quot;)
      .attr(&quot;id&quot;, &quot;chart-area&quot;)
      .append(&quot;rect&quot;)
      .attr(&quot;width&quot;, width)
      .attr(&quot;height&quot;, height)

    svg.on(&quot;mouseup&quot;, () =&gt;
      d3.selectAll(&quot;.interval rect&quot;).style({
        filter: &quot;url(#drop-shadow-intervals)&quot;,
      })
    )

    const chart = svg
      .append(&quot;g&quot;)
      .attr(&quot;class&quot;, &quot;chart&quot;)
      .attr(&quot;clip-path&quot;, &quot;url(#chart-area)&quot;)

    const parseDate = function (dateString) {
      const format = d3.time.format(&quot;%Y-%m-%d&quot;)

      let date = format.parse(dateString)

      if (date !== null) {
        return date
      }

      let year = null

      if (isNaN(dateString)) {
        year = -dateString.replace(/[^0-9]/g, &quot;&quot;)
      } else {
        year = +dateString
      }

      if (year &lt; 0 || year &gt; 99) {
        date = new Date(year, 6, 1)
      } else if (year === 0) {
        date = new Date(-1, 6, 1)
      } else {
        date = new Date(year, 6, 1)
        date.setUTCFullYear(`0000${year}`.slice(-4))
      }

      return date
    }

    const toYear = function (date, bcString) {
      bcString = bcString || &quot; BC&quot;

      const year = date.getUTCFullYear()

      if (year &gt; 0) {
        return year.toString()
      }

      if (bcString[0] === &quot;-&quot;) {
        return bcString + -year
      }

      return -year + bcString
    }

    timeline.data = function (timelineItems) {
      const today = new Date()

      const tracks = []
      const yearMillis = 31622400000
      const instantOffset = 100 * yearMillis

      data.items = timelineItems

      const compareAscending = function (item1, item2) {
        let result = item1.start - item2.start

        if (result &lt; 0) {
          return -1
        }

        if (result &gt; 0) {
          return 1
        }

        result = item2.end - item1.end

        if (result &lt; 0) {
          return -1
        }

        if (result &gt; 0) {
          return 1
        }

        return 0
      }

      const compareDescending = function (item1, item2) {
        let result = item1.start - item2.start

        if (result &lt; 0) {
          return 1
        }

        if (result &gt; 0) {
          return -1
        }

        result = item2.end - item1.end

        if (result &lt; 0) {
          return 1
        }

        if (result &gt; 0) {
          return -1
        }

        return 0
      }

      const calculateTracks = function (items, sortOrder, timeOrder) {
        sortOrder = sortOrder || &quot;descending&quot;
        timeOrder = timeOrder || &quot;backward&quot;

        const sortBackward = function () {
          return items.forEach((item) =&gt; {
            let track = 0

            for (
              let i = 0, _i = 0, _ref = tracks.length;
              0 &lt;= _ref ? _i &lt; _ref : _i &gt; _ref;
              i = 0 &lt;= _ref ? ++_i : --_i
            ) {
              if (item.end &lt; tracks[i]) {
                break
              }

              track++
            }

            item.track = track

            tracks[track] = item.start
          })
        }

        const sortForward = function () {
          return items.forEach((item) =&gt; {
            let track = 0

            for (
              let i = 0, _i = 0, _ref = tracks.length;
              0 &lt;= _ref ? _i &lt; _ref : _i &gt; _ref;
              i = 0 &lt;= _ref ? ++_i : --_i
            ) {
              if (item.start &gt; tracks[i]) {
                break
              }

              track++
            }

            item.track = track

            tracks[track] = item.end
          })
        }

        if (sortOrder === &quot;ascending&quot;) {
          data.items.sort(compareAscending)
        } else {
          data.items.sort(compareDescending)
        }

        if (timeOrder === &quot;forward&quot;) {
          return sortForward()
        }

        return sortBackward()
      }

      data.items.forEach((item) =&gt; {
        item.start = parseDate(item.start)

        if (item.end === &quot;&quot;) {
          item.end = new Date(item.start.getTime() + instantOffset)
          item.instant = true
        } else {
          item.end = parseDate(item.end)
          item.instant = false
        }

        if (item.end &gt; today) {
          item.end = today
        }
      })
      calculateTracks(data.items, &quot;descending&quot;, &quot;backward&quot;)
      data.nTracks = tracks.length
      data.minDate = d3.min(data.items, (d) =&gt; d.start)
      data.maxDate = d3.max(data.items, (d) =&gt; d.end)

      return timeline
    }

    timeline.tooltip = {
      create() {
        d3utils.tooltip(&quot;.part.instant, .part.interval&quot;, {
          followMouse: true,
          leftOffst: 80,
        })

        return timeline
      },
    }

    timeline.band = function (bandName, sizeFactor) {
      const band = {}

      band.id = `band${bandNum}`
      band.x = 0
      band.y = bandY
      band.w = width
      band.h = height * (sizeFactor || 1)
      band.trackOffset = 0
      band.trackHeight = Math.min(
        (band.h - band.trackOffset) / data.nTracks,
        20
      )
      band.itemHeight = band.trackHeight * 0.7
      band.parts = []
      band.instantWidth = 100
      band.xScale = d3.time
        .scale()
        .domain([data.minDate, data.maxDate])
        .range([0, band.w])

      band.yScale = function (track) {
        return band.trackOffset + track * band.trackHeight
      }

      band.yearsScale =
        data.maxDate.getUTCFullYear() - data.minDate.getUTCFullYear()
      band.g = chart
        .append(&quot;g&quot;)
        .attr(&quot;id&quot;, band.id)
        .attr(&quot;transform&quot;, `translate(0,${band.y})`)
      band.g
        .append(&quot;rect&quot;)
        .attr(&quot;class&quot;, &quot;band&quot;)
        .attr(&quot;width&quot;, band.w)
        .attr(&quot;height&quot;, band.h)

      const items = band.g
        .selectAll(&quot;g&quot;)
        .data(data.items)
        .enter()
        .append(&quot;svg&quot;)
        .attr(&quot;y&quot;, (d) =&gt; band.yScale(d.track))
        .attr(&quot;height&quot;, band.itemHeight)
        .attr(&quot;data-title&quot;, (d) =&gt; {
          if (d.instant) {
            return `${d.label}: ${toYear(d.start)}`
          }

          return `${d.label}: ${toYear(d.start)} - ${toYear(d.end)}`
        })
        .attr(&quot;class&quot;, (d) =&gt; {
          if (d.instant) {
            return &quot;part instant&quot;
          }

          return &quot;part interval&quot;
        })

      const intervals = d3.select(`#band${bandNum}`).selectAll(&quot;.interval&quot;)

      intervals
        .append(&quot;rect&quot;)
        .attr({
          height: &quot;80%&quot;,
          width: &quot;80%&quot;,
          x: &quot;1px&quot;,
          y: &quot;.5px&quot;,
        })
        .style({
          filter: &quot;url(#drop-shadow-intervals)&quot;,
        })
      intervals
        .append(&quot;text&quot;)
        .attr(&quot;class&quot;, &quot;intervalLabel&quot;)
        .attr(&quot;x&quot;, 3)
        .attr(&quot;y&quot;, 9.5)

      const instants = d3.select(`#band${bandNum}`).selectAll(&quot;.instant&quot;)

      instants
        .append(&quot;circle&quot;)
        .attr(&quot;cx&quot;, band.itemHeight / 2)
        .attr(&quot;cy&quot;, band.itemHeight / 2)
        .attr(&quot;r&quot;, 5)
      instants
        .append(&quot;text&quot;)
        .attr(&quot;class&quot;, &quot;instantLabel&quot;)
        .attr(&quot;x&quot;, 15)
        .attr(&quot;y&quot;, 10)

      band.addActions = function (actions) {
        return actions.forEach((action) =&gt; items.on(action[0], action[1]))
      }

      band.redraw = function () {
        items
          .attr(&quot;x&quot;, (d) =&gt; band.xScale(d.start))
          .attr(&quot;width&quot;, (d) =&gt; band.xScale(d.end) - band.xScale(d.start))
          .select(&quot;text&quot;)
          .text((d) =&gt; {
            const scale = band.xScale(d.end) - band.xScale(d.start)
            const maxLetters = scale / 9

            if (d.label.length &gt; maxLetters) {
              return `${d.label.substr(0, maxLetters - 1)}..`
            }

            return d.label
          })

        return band.parts.forEach((part) =&gt; part.redraw())
      }

      bands[bandName] = band
      components.push(band)
      bandY += band.h + bandGap
      bandNum += 1

      return timeline
    }

    timeline.labels = function (bandName) {
      const band = bands[bandName]
      const labelWidth = 46
      const labelHeight = 20
      const labelTop = band.y + band.h - 10
      const yText = 15
      const labelDefs = [
        [
          &quot;start&quot;,
          &quot;bandMinMaxLabel&quot;,
          0,
          4,
          function (min) {
            return toYear(min)
          },
          &quot;Start of the selected interval&quot;,
          band.x + 30,
          labelTop,
        ],
        [
          &quot;end&quot;,
          &quot;bandMinMaxLabel&quot;,
          band.w - labelWidth,
          band.w - 4,
          function (_min, max) {
            return toYear(max)
          },
          &quot;End of the selected interval&quot;,
          band.x + band.w - 152,
          labelTop,
        ],
        [
          &quot;middle&quot;,
          &quot;bandMidLabel&quot;,
          (band.w - labelWidth) / 2,
          band.w / 2,
          function (min, max) {
            return max.getUTCFullYear() - min.getUTCFullYear()
          },
          &quot;Length of the selected interval&quot;,
          band.x + band.w / 2 - 75,
          labelTop,
        ],
      ]
      const bandLabels = chart
        .append(&quot;g&quot;)
        .attr(&quot;id&quot;, `${bandName}Labels`)
        .attr(&quot;transform&quot;, `translate(0,${band.y + band.h + 1})`)
        .selectAll(`#${bandName}Labels`)
        .data(labelDefs)
        .enter()
        .append(&quot;g&quot;)

      bandLabels
        .append(&quot;rect&quot;)
        .attr(&quot;class&quot;, &quot;bandLabel&quot;)
        .attr(&quot;x&quot;, (d) =&gt; d[2])
        .attr(&quot;width&quot;, labelWidth)
        .attr(&quot;height&quot;, labelHeight)
        .style(&quot;opacity&quot;, 1)

      const labels = bandLabels
        .append(&quot;text&quot;)
        .attr(&quot;class&quot;, (d) =&gt; d[1])
        .attr(&quot;id&quot;, (d) =&gt; d[0])
        .attr(&quot;x&quot;, (d) =&gt; d[3])
        .attr(&quot;y&quot;, yText)
        .attr(&quot;text-anchor&quot;, (d) =&gt; d[0])

      labels.redraw = function () {
        const min = band.xScale.domain()[0]
        const max = band.xScale.domain()[1]

        return labels.text((d) =&gt; d[4](min, max))
      }

      band.parts.push(labels)
      components.push(labels)

      return timeline
    }

    timeline.xAxis = function (bandName, orientation) {
      const band = bands[bandName]
      const axis = d3.svg
        .axis()
        .scale(band.xScale)
        .orient(orientation || &quot;bottom&quot;)
        .tickSize(6, 0)
        .tickFormat((d) =&gt; toYear(d))
      const xAxis = chart
        .append(&quot;g&quot;)
        .attr(&quot;class&quot;, &quot;axis&quot;)
        .attr(&quot;transform&quot;, `translate(0,${band.y + band.h})`)

      xAxis.redraw = function () {
        return xAxis.call(axis)
      }

      band.parts.push(xAxis)
      components.push(xAxis)

      return timeline
    }

    timeline.brush = function (bandName, targetNames) {
      const band = bands[bandName]
      const brush = d3.svg.brush().x(band.xScale.range([0, band.w]))

      brush.on(&quot;brush&quot;, () =&gt; {
        const domain = brush.empty() ? band.xScale.domain() : brush.extent()

        d3.selectAll(&quot;.interval rect&quot;).style({
          filter: &quot;none&quot;,
        })

        targetNames.forEach((d) =&gt; {
          bands[d].xScale.domain(domain)

          bands[d].redraw()
        })
      })

      const xBrush = band.g.append(&quot;svg&quot;).attr(&quot;class&quot;, &quot;x brush&quot;).call(brush)

      xBrush
        .selectAll(&quot;rect&quot;)
        .attr(&quot;y&quot;, 1)
        .attr(&quot;height&quot;, band.h - 1)

      return timeline
    }

    timeline.redraw = function () {
      return components.forEach((component) =&gt; component.redraw())
    }

    return timeline
  }

  d3.csv(&quot;/data/d3js/timeline/data.csv&quot;, (dataset) =&gt;
    createTimeline()
      .data(dataset)
      .band(&quot;mainBand&quot;, 0.82)
      .band(&quot;naviBand&quot;, 0.08)
      .xAxis(&quot;mainBand&quot;)
      .xAxis(&quot;naviBand&quot;)
      .labels(&quot;mainBand&quot;)
      .labels(&quot;naviBand&quot;)
      .brush(&quot;naviBand&quot;, [&quot;mainBand&quot;])
      .tooltip[&quot;create&quot;]()
      .redraw()
  )
}

export default main
</code></pre></li><li><p>d3utils.js</p><pre><code class="javascript">const d3utils = {
  colorsScale(colors, extent) {
    const c = d3.scale.linear().domain(extent).range([0, 1])
    const colorScale = d3.scale
      .linear()
      .domain(d3.range(0, 1, 1.0 / colors.length))
      .range(colors)

    return function (p) {
      return colorScale(c(p))
    }
  },
  filterBlackOpacity(id, svg, deviation, slope) {
    const defs = svg.append(&quot;defs&quot;)
    const filter = defs.append(&quot;filter&quot;).attr({
      height: &quot;500%&quot;,
      id: `drop-shadow-${id}`,
      width: &quot;500%&quot;,
      x: &quot;-200%&quot;,
      y: &quot;-200%&quot;,
    })

    filter.append(&quot;feGaussianBlur&quot;).attr({
      in: &quot;SourceAlpha&quot;,
      stdDeviation: deviation,
    })
    filter.append(&quot;feOffset&quot;).attr({
      dx: 1,
      dy: 1,
    })
    filter.append(&quot;feComponentTransfer&quot;).append(&quot;feFuncA&quot;).attr({
      slope,
      type: &quot;linear&quot;,
    })

    const feMerge = filter.append(&quot;feMerge&quot;)

    feMerge.append(&quot;feMergeNode&quot;)

    return feMerge.append(&quot;feMergeNode&quot;).attr(&quot;in&quot;, &quot;SourceGraphic&quot;)
  },
  filterColor(id, svg, deviation, slope, extra) {
    if (extra == null) {
      extra = false
    }

    const defs = svg.append(&quot;defs&quot;)
    const filter = defs.append(&quot;filter&quot;).attr({
      id: `drop-shadow-${id}`,
    })

    if (extra) {
      filter.attr({
        height: &quot;500%&quot;,
        width: &quot;500%&quot;,
        x: &quot;-200%&quot;,
        y: &quot;-200%&quot;,
      })
    }

    filter.append(&quot;feOffset&quot;).attr({
      dx: 0.5,
      dy: 0.5,
      in: &quot;SourceGraphic&quot;,
      result: &quot;offOut&quot;,
    })
    filter.append(&quot;feGaussianBlur&quot;).attr({
      in: &quot;offOut&quot;,
      result: &quot;blurOut&quot;,
      stdDeviation: deviation,
    })
    filter.append(&quot;feBlend&quot;).attr({
      in: &quot;SourceGraphic&quot;,
      in2: &quot;blurOut&quot;,
      mode: &quot;normal&quot;,
    })

    return filter.append(&quot;feComponentTransfer&quot;).append(&quot;feFuncA&quot;).attr({
      slope,
      type: &quot;linear&quot;,
    })
  },
  middleTitle(svg, width, text, top) {
    if (top == null) {
      top = -15
    }

    svg
      .append(&quot;text&quot;)
      .attr({
        class: &quot;chart-title&quot;,
        &quot;text-anchor&quot;: &quot;middle&quot;,
        transform: `translate(${String(width / 2)},${top})`,
      })
      .text(text)
      .style({
        &quot;font-weight&quot;: &quot;bold&quot;,
      })
  },
  svg(selector, width, height, margin) {
    return d3
      .select(selector)
      .text(&quot;&quot;)
      .append(&quot;svg&quot;)
      .attr({
        height: height + margin.top + margin.bottom,
        width: width + margin.left + margin.right,
      })
      .append(&quot;g&quot;)
      .attr({
        transform: `translate(${margin.left},${margin.top})`,
      })
  },
  tooltip(selector, customOpts) {
    if (customOpts == null) {
      customOpts = {}
    }

    const defaultOpts = {
      elementSelector: &quot;&quot;,
      followElement: false,
      followMouse: false,
      leftOffst: 60,
      tOpts: {
        container: &quot;body&quot;,
        viewport: {
          selector: &quot;#chart svg&quot;,
        },
      },
      topOffst: 40,
    }

    const opts = _.merge(defaultOpts, customOpts)

    $(selector).tooltip(opts.tOpts)

    if (opts.followMouse) {
      $(selector).hover((e) =&gt;
        $(&quot;.tooltip&quot;).css({
          left: `${String(e.pageX - opts.leftOffst)}px`,
          top: `${String(e.pageY - opts.topOffst)}px`,
        })
      )
    } else if (opts.followElement) {
      $(selector).hover(() =&gt;
        $(&quot;.tooltip&quot;).css({
          left: `${String(
            $(opts.elementSelector).position().left - opts.leftOffst
          )}px`,
          top: `${String(
            $(opts.elementSelector).position().top - opts.topOffst
          )}px`,
        })
      )
    }
  },
}

export default d3utils
</code></pre></li><li><p>pages/d3js/timeline.js</p><pre><code class="javascript">import React from &quot;react&quot;

import Demo from &quot;@/components/demo&quot;

import main from &quot;@/demos/timeline/timeline&quot;

import &quot;@/demos/timeline/timeline.styl&quot;

const Timeline = ({ pageContext: { demoInfo } }) =&gt; (
  &lt;Demo
    demoInfo={demoInfo}
    main={main}
    scripts={[&quot;/vendors/d3/d3.min.js&quot;, &quot;/js/d3js-utils.js&quot;]}
  &gt;
    &lt;div className=&quot;timeline-chart&quot; id=&quot;chart&quot; /&gt;
  &lt;/Demo&gt;
)

export default Timeline
</code></pre></li><li><p>timeline.styl</p><pre><code>.timeline-chart
  text
    text-shadow: .5px .5px .5px #ccc;
  .axis
    fill: #808080;
    font-family: sans-serif;
    font-size: 10px;

  .axis line
    stroke-width : 1;
    stroke: grey;
    shape-rendering: crispEdges;

  .axis path
    stroke-width : 1;
    stroke: grey;
    shape-rendering: crispEdges;

  .band
    fill: #FFFFFF;

  .bandLabel
    fill: #F0F0F0;
    font: 10px sans-serif;
    font-weight: bold;

  .bandMinMaxLabel
    fill: #11AA6A;
    font: 10px sans-serif;
    font-weight: bold;

  .bandMidLabel
    cursor: default;
    fill: #BC79C5;
    font: 10px sans-serif;
    font-style: italic;
    font-weight: bold;

  .brush .extent
    stroke: gray;
    fill: #71D7E5;
    fill-opacity: .1;

  .chart
    fill: #EEEEEE;

  .interval
    fill: #ECF7F7;
    cursor : default;
    pointer-events: true;
    rect
      stroke-width: .5px;
      stroke: black;

  .instant
    fill: #AFCAE7;
    cursor : default;

  .instantLabel
    fill : #7E7E7E;
    font: 10px sans-serif;
    shape-rendering: crispEdges;

  .intervalLabel
    fill : black;
    font: 10px sans-serif;
    shape-rendering: crispEdges;

  .item
    cursor : default;
    pointer-events: auto;</code></pre></li></ul></div></div></div></div><footer class="row"><p>2021</p></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/d3js/timeline/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-dfb1072a7bf3bc69d7fe.js"],"app":["/app-6a630258070fb16a5327.js"],"component---src-pages-404-js":["/component---src-pages-404-js-270adbbd899e574208d7.js"],"component---src-pages-d-3-js-area-js":["/component---src-pages-d-3-js-area-js-fb8fa49201f40c82a4a1.js"],"component---src-pages-d-3-js-bars-js":["/component---src-pages-d-3-js-bars-js-396e30724d1bb997e616.js"],"component---src-pages-d-3-js-bubbles-js":["/component---src-pages-d-3-js-bubbles-js-0142096cccec83c2ab13.js"],"component---src-pages-d-3-js-chord-js":["/component---src-pages-d-3-js-chord-js-549c569b718e1eff6aa1.js"],"component---src-pages-d-3-js-collapsible-tree-js":["/component---src-pages-d-3-js-collapsible-tree-js-73965f0bc2e743bed8fe.js"],"component---src-pages-d-3-js-concentric-circles-js":["/component---src-pages-d-3-js-concentric-circles-js-b5cbbd1b3a331135282b.js"],"component---src-pages-d-3-js-fish-eye-js":["/component---src-pages-d-3-js-fish-eye-js-c8423912ad349b164af9.js"],"component---src-pages-d-3-js-force-js":["/component---src-pages-d-3-js-force-js-01d5c4baeb81f87b7c55.js"],"component---src-pages-d-3-js-icosahedron-js":["/component---src-pages-d-3-js-icosahedron-js-44d55381bdf99fe2a98b.js"],"component---src-pages-d-3-js-map-distorsions-js":["/component---src-pages-d-3-js-map-distorsions-js-f316a98cc9f0f37d6615.js"],"component---src-pages-d-3-js-mareys-schedule-js":["/component---src-pages-d-3-js-mareys-schedule-js-13102644626add017e79.js"],"component---src-pages-d-3-js-multiline-voronoi-js":["/component---src-pages-d-3-js-multiline-voronoi-js-8bb1a3e98ab642575801.js"],"component---src-pages-d-3-js-partition-js":["/component---src-pages-d-3-js-partition-js-87d3e2a7b25508b13a53.js"],"component---src-pages-d-3-js-pie-js":["/component---src-pages-d-3-js-pie-js-296d336a7979ecbefbcd.js"],"component---src-pages-d-3-js-spain-map-js":["/component---src-pages-d-3-js-spain-map-js-41f2571a291e713e2828.js"],"component---src-pages-d-3-js-timeline-js":["/component---src-pages-d-3-js-timeline-js-ca6a001da1860c231289.js"],"component---src-pages-d-3-js-trend-line-js":["/component---src-pages-d-3-js-trend-line-js-5a687d19eb107b9c2a49.js"],"component---src-pages-d-3-js-vectors-js":["/component---src-pages-d-3-js-vectors-js-6c7056f96fe1807bf6da.js"],"component---src-pages-d-3-js-weekly-heatmap-js":["/component---src-pages-d-3-js-weekly-heatmap-js-70497231970d365391cc.js"],"component---src-pages-d-3-js-world-map-js":["/component---src-pages-d-3-js-world-map-js-857981ea316d4f51c1dd.js"],"component---src-pages-index-js":["/component---src-pages-index-js-7368e4493881777b4f36.js"],"component---src-pages-raphael-bars-3-dimensional-js":["/component---src-pages-raphael-bars-3-dimensional-js-c2a07c6820dc9d511436.js"],"component---src-pages-raphael-circular-arcs-js":["/component---src-pages-raphael-circular-arcs-js-93cf1f1eb0f210874076.js"],"component---src-pages-raphael-moving-line-js":["/component---src-pages-raphael-moving-line-js-353e9c4fdf41076fe30b.js"],"component---src-pages-testing-js":["/component---src-pages-testing-js-c75dc00849c259daeaee.js"]};/*]]>*/</script><script src="/demos/polyfill-dfb1072a7bf3bc69d7fe.js" nomodule=""></script><script src="/demos/component---src-pages-d-3-js-timeline-js-ca6a001da1860c231289.js" async=""></script><script src="/demos/40253593f9913a7f13fa78c8c713ea552ed82d8a-cb2c0702fb0cd3f059e6.js" async=""></script><script src="/demos/app-6a630258070fb16a5327.js" async=""></script><script src="/demos/framework-1f78429ab6fb93434b07.js" async=""></script><script src="/demos/webpack-runtime-e56b2c618e13f4cbc5cb.js" async=""></script></body></html>