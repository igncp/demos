"use strict";(self.webpackChunkdemos=self.webpackChunkdemos||[]).push([[147],{6215:function(e,t,n){n.r(t),n.d(t,{default:function(){return N}});var r=n(7294),a=n(1745),i=n(8634),o=n(2656),l=n.n(o),u=n(8558),s=n(581),c=n(8747),p=n.n(c),f=n(7956),m=n(3873),d=n.n(m),g="population-circles-module--radio--d7ab8",v="population-circles-module--slider--4b739",h="population-circles-module--circle--25c38";"undefined"!=typeof window&&n(5356);var y="dropShadowBase",x=0,I=70,w=400,k=function(){function e(e){this.config=e;var t,n,r,a,i=(0,u.Ys)("#"+e.rootElId).append("svg").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor","middle");n=(t={deviation:2,name:y,slope:.5,svg:i}).deviation,r=t.name,a=t.slope,t.svg.append("filter").html('\n<filter id="'+r+'" height="130%">\n  <feGaussianBlur in="SourceAlpha" stdDeviation="'+n+'"/>\n  <feOffset dx="2" dy="2" result="offsetblur"/>\n  <feComponentTransfer>\n    <feFuncA type="linear" slope="'+a+'"/>\n  </feComponentTransfer>\n  <feMerge>\n    <feMergeNode/>\n    <feMergeNode in="SourceGraphic"/>\n  </feMerge>\n</filter>\n');var o=i.append("text").attr("class","population-circles-module--header--396bb").text(""),l=i.append("g");this.elements={header:o,svg:i,svgContent:l},this.setupZoom(),this.update()}var t=e.prototype;return t.update=function(){var e=this.config,t=this.elements,n=this.getWidth(),r=t.header,a=t.svgContent,i=e.getChartItems(),o={};t.svg.attr("viewBox",[0,0,n,w+I].join(", ")),t.header.attr("transform","translate("+n/2+", 50)"),t.svgContent.attr("transform","translate("+x+", "+I+")");var l=(0,u.bT9)(Object.assign({},e.getEmptyItem(),{children:i})).sum(e.getItemMetric),s=e.getIsSmall(),c=(0,u.P2p)().size(s?[n/2,200]:[n,w]).padding(3)(l).leaves();r.text(e.getHeaderText({chartItems:i}));var m=function(t){return e.getItemId(t.data)},g=a.selectAll(".leaf").data(c,m);g.exit().remove();var v=function(t){return e.getItemTitle({circleData:t.data})};g.attr("title",v).transition().duration(1e3).ease(u.sq$).attr("transform",(function(e){return s?"translate("+(e.x+n/4)+","+(e.y+100)+")":"translate("+(e.x+1)+","+(e.y+1)+")"}));var y=g.enter().append("g").attr("class","leaf").attr("title",v).attr("transform",(function(e){return"translate("+(e.x+1)+","+(e.y+1)+")"})).on("mouseenter",(function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=n[1],i=(0,u.Ys)(this).select("."+h);(0,u.Ys)(this).select(".letter").attr("filter","url(#dropShadowBase)");var l=e.getItemId(a.data),s=(0,f.Z)({complete:function(){o[l]=null},strokeWidth:"5px",targets:[i.node()]});o[l]=s})).on("mouseleave",(function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=n[1],i=(0,u.Ys)(this).select("."+h);(0,u.Ys)(this).select(".letter").attr("filter",null);var l=e.getItemId(a.data),s=o[l];s&&(s.seek(0),f.Z.remove(i.node()),o[l]=null),(0,f.Z)({strokeWidth:"0px",targets:[i.node()]})})).on("click",(function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=n[1];e.onClick(a.data)})),k=(0,u.PKp)().domain(e.colorDomain).range(u.UCG),b=function(t){return k(e.getStringForColor(t.data))},T=function(e){var t=b(e);return d()(t).darken(1.5).hex()},E=function(t){t.text((function(t){return e.getItemLabel(t.data)})).style("font-size",(function(e){return e.r.toFixed(0)+"px"})).attr("dy",(function(e){return e.r/3})).attr("fill",T)},C=function(e){e.attr("r",(function(e){return e.r})).attr("fill",b).attr("stroke",T)};C(y.append("circle").attr("class",h)),E(y.append("text").attr("class","letter"));var A=function(e){return e},R=g.selectAll("."+h).data(A,m),F=g.selectAll(".letter").data(A,m);C(R.transition().duration(1e3).ease(u.vaZ)),E(F.transition().duration(1e3).ease(u.vaZ)),p()(".leaf").tooltip({track:!0})},t.getWidth=function(){var e=this.config;return document.getElementById(e.rootElId).getBoundingClientRect().width},t.setupZoom=function(){var e=this.elements.svg,t=this.getWidth(),n={k:1,x:0,y:0};var r=(0,u.sPX)().extent([[0,0],[t/2,200]]).on("end",(function(e){var t=(0,u.Ys)(this).transition().duration(150),r=e.transform,a=r.x,i=r.y,o=e.transform.k;o!==n.k&&(a=n.x,i=n.y),t.attr("transform","translate("+a+", "+i+") scale("+o+")"),n.k=o,n.x=a,n.y=i}));e.call(r)},e}();function b(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}var T=n(2203),E="chart",C=["values"],A=function(){var e=(0,i.Z)(l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.AVB)("/demos/data/d3js/population-circles/data.json");case 2:return t=e.sent,e.abrupt("return",t.map((function(e){var t=e.values,n=b(e,C);return Object.assign({},n,{metrics:t})})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=function(e){return Number(e.toFixed(0)).toLocaleString(void 0,{maximumFractionDigits:0,minimumFractionDigits:0})},F={females:"females",males:"males",total:"people"},Z=function(e){return new Date(e).getFullYear()},M=function(e){var t=e.municipalities,n=e.state;return{colorDomain:t.map((function(e){return e.name})),getChartItems:function(){var e=n.populationRange,r=n.populationType,a=n.timeRangeIndex,i=t.filter((function(e){return!!e.metrics[r][a]})),o=i.map((function(e){return e.metrics[r][a].count})),l=o.reduce((function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=n[0],i=n[1],o=n[2];return a[i]=null!==(e=a[o])&&void 0!==e?e:[],a[i].push(o),a}),{}),u=o.sort((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],a=t[1];return r-a})),s=u.reduce((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],a=t[1],i=t[2],o=i/u.length,s=l[a];return s.forEach((function(e){r[e]=o})),r}),[]);return i.filter((function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=n[1],i=s[a];return"number"==typeof i&&i>=e[0]&&i<=e[1]}))},getEmptyItem:function(){return{metrics:{females:[],males:[],total:[]},name:""}},getHeaderText:function(e){var t=e.chartItems,r=t[0].metrics[n.populationType][n.timeRangeIndex].date,a=Z(r),i=t.reduce((function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=t[0],i=t[1];return a+i.metrics[n.populationType][n.timeRangeIndex].count}),0),o=R(i)+" "+F[n.populationType],l=t.filter((function(e){return e.metrics[n.populationType].length>=n.timeRangeIndex+1})).length;return"Population in Malaga: "+a+" - "+o+(0===n.populationRange[0]&&1===n.populationRange[1]?"":" - From "+(100*n.populationRange[0]).toFixed(0)+" percentile to "+(100*n.populationRange[1]).toFixed(0)+" percentile")+" - "+l+" municipalities"},getIsSmall:function(){return"total"!==n.populationType},getItemId:function(e){return e.name},getItemLabel:function(e){return e.name[0]},getItemMetric:function(e){if(!e.metrics)return 1;var t=e.metrics[n.populationType][n.timeRangeIndex];return t?t.count:0},getItemTitle:function(e){var t=e.circleData,r=t.metrics[n.populationType][n.timeRangeIndex];if(!r)return"";var a=F[n.populationType];return t.name+" - "+R(r.count)+" "+a+" - "+Z(r.date)},getStringForColor:function(e){return e.name},onClick:function(e){s.Z.isPressed("control")&&window.open("https://www.google.com/search?"+T.stringify({q:"Malaga "+e.name}))},rootElId:E}};"undefined"!=typeof window&&n(7252);var S=function(){var e=(0,i.Z)(l().mark((function e(){var t,n,r,a,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,s.Z)("control",(function(){})),e.next=3,A();case 3:t=e.sent,r=M({municipalities:t,state:n={populationRange:[0,1],populationType:"total",timeRangeIndex:0}}),a=new k(r),(0,u.Ys)("form").on("change",(function(e){n.populationType=e.target.value,a.update()})),p()(".population-slider").slider({change:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var i=t[1].values,o=i.map((function(e){return e/100}));n.populationRange=o,a.update()},range:!0,values:[0,100]}),i=t[0].metrics.total.length-1,p()(".time-slider").slider({change:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var i=t[1].value;n.timeRangeIndex=i,a.update()},max:i,min:0,value:0});case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=S,N=function(e){var t=e.pageContext;return r.createElement(a.Z,{main:D,pageContext:t},r.createElement("form",null,[{id:"total",label:"Total"},{id:"males",label:"Males"},{id:"females",label:"Females"}].map((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=t[0],i=a.id,o=a.label,l=t[1];return r.createElement("div",{className:g,key:i},r.createElement("input",{defaultChecked:0===l,id:i,name:"type",type:"radio",value:i}),r.createElement("label",{htmlFor:i},o))}))),r.createElement("div",{className:v},r.createElement("p",null,"Time"),r.createElement("div",{className:"time-slider"})),r.createElement("div",{className:v},r.createElement("p",null,"Population Percentile"),r.createElement("div",{className:"population-slider"})),r.createElement("div",{id:E}))}}}]);
//# sourceMappingURL=component---src-pages-d-3-js-population-circles-tsx-c5d0b76a6b4007a3db3e.js.map