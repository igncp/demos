(self.webpackChunkdemos=self.webpackChunkdemos||[]).push([[257],{8926:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return b}});var n=r(7294),a=r(4275),o=r(2137),i=r(7757),s=r.n(i),c=r(2245),l=r(7956),u=r(2203),d="meteorites-map-module--meteorite--1d0Jo",m="meteorites-map-module--modal--2rmkA",p=function(){var e=(0,o.Z)(s().mark((function e(){var t,r,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([(0,c.AVB)("/demos/data/d3js/meteorites-map/world_countries.json"),(0,c.AVB)("/demos/data/d3js/meteorites-map/meteorites.json")]);case 2:return t=e.sent,r=t[0],n=t[1],e.abrupt("return",{countries:r,meteorites:n});case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),f=0,h=0,g=1e3-0-0,v=function(e){var t=e.meteoritesEls,r=e.modal,n=e.state;n.isDuringAnimation||(n.selectedMeteorite=null,t.attr("class",d),(0,l.Z)({targets:"."+d,translateX:0,translateY:0}),n.isDuringAnimation=!0,(0,l.Z)({complete:function(){n.isDuringAnimation=!1,r.text("")},targets:"."+m,translateY:0}))},y="Meteorite landings in Earth",w=function(e){var t=e.clickedMeteorite,r=e.meteoritesEls,n=e.meteoritesParsed,a=e.modal,o=e.projectionFn,i=e.rootElId,s=e.state;if(!s.isDuringAnimation)if(s.selectedMeteorite!==t.id){s.selectedMeteorite=t.id;var p=(0,c.i$Z)("%Y")(new Date(t.year)),f=(new Intl.NumberFormat).format(t.mass);a.html(("\n<h1>"+t.name+"</h1>\n<p>Year: "+p+", Class: "+t.recclass+"</p>\n<p>"+(f?"Mass: "+f+"g, ":"")+"Name: "+t.nametype+'</p>\n<p><a href="https://www.google.com/search?'+u.stringify({q:t.name+" Meteorite "+p})+'" target="_blank">Click here to search</a></p>\n').trim());var h=function(e){var t=e.allMeteorites,r=e.projectionFn,n=e.targetMeteorite,a=r(n.geometry.coordinates),o=t.slice(0).filter((function(e){return!!e.geometry})).map((function(e){var t=e.geometry.coordinates,n=r(t),o=[n[0]-a[0],n[1]-a[1]],i=Math.sqrt(Math.pow(o[0],2)+Math.pow(o[1],2));return Object.assign({},e,{vector:o,vectorLength:i})})).filter((function(e){return e.vectorLength<20&&0!==e.vectorLength})).map((function(e){return Object.assign({},e,{vectorNormalized:[e.vector[0]/e.vectorLength,e.vector[1]/e.vectorLength]})})),i=new Set(o.map((function(e){return e.id}))),s=o.reduce((function(e,t){return e[t.id]=t.vectorNormalized,e}),{});return{nearMeteorites:o,nearMeteoritesSet:i,vectorsMap:s}}({allMeteorites:n,projectionFn:o,targetMeteorite:t}),g=h.nearMeteoritesSet,y=h.vectorsMap;r.attr("class",(function(e){return g.has(e.id)?"meteorites-map-module--moved--1Atuq "+d:e.id===t.id?"meteorites-map-module--active--3vr62 "+d:d}));var w=function(e){return function(r,a){if(function(e){var r=n[e];return r.id===t.id||!g.has(r.id)}(a))return 0;var o=n[a];return 20*y[o.id][e]}};(0,l.Z)({targets:"."+d,translateX:w(0),translateY:w(1)});var k=document.getElementById(i).getBoundingClientRect().top;(0,l.Z)({targets:"."+m,translateY:250+k+window.scrollY})}else v({meteoritesEls:r,modal:a,state:s})},k=function(e){var t=e.countries,r=e.meteorites,n=e.rootElId,a=document.getElementById(n).getBoundingClientRect().width-f-h,o=(0,c.mw4)().translate([a/2,g/2]),i=(0,c.l49)().projection(o),s={isDuringAnimation:!1,selectedMeteorite:null},l=function(){v({meteoritesEls:b,modal:p,state:s})},u=r.map((function(e){return Object.assign({},e,{geometry:e.geolocation,type:"Feature"})})),p=(0,c.Ys)("#"+n).append("div").attr("class",m).style("top","-200px"),k=(0,c.Ys)("#"+n).append("svg").attr("width",a).attr("height",g-250).on("click",l),M=k.append("g").attr("class","map");k.append("text").text(y).attr("text-anchor","middle").style("font-size","20px").attr("transform","translate("+a/2+",40)").style("font-weight","bold"),function(e){var t=e.svg,r=e.width,n=t.append("g").attr("transform","translate("+(r-50)+",50)").attr("cursor","pointer");t.append("g").html('\n<filter id="pulse" x="0" y="0" width="100%" height="100%">\n  <feTurbulence result="cloud" baseFrequency=".01" seed="1"  type="fractalNoise" numOctaves="2">\n  <animate attributeName="baseFrequency" calcMode="paced" begin="0s" dur="12s" values=".01;.13;.01;" repeatCount="indefinite"/>\n  </feTurbulence>\n  <feComposite operator="in" in="cloud" in2="SourceGraphic"/>\n</filter>\n    '),(0,c.Ys)(document.body).append("div").attr("id","info-dialog").html("\n<p>The green circles refer to meteorites which were moved in the map to allow seeing the selected meteorite (red).</p>\n".trim()),$("#info-dialog").dialog({autoOpen:!1,modal:!0,resizable:!1}),n.append("circle").attr("fill","#fff").attr("stroke","#ccc").attr("r","20").attr("filter","url(#pulse)"),n.append("text").text("?").attr("text-anchor","middle").style("font-size",20).attr("transform","translate(0,5)"),n.on("click",(function(){$("#info-dialog").dialog("open")}))}({svg:k,width:a}),M.append("g").attr("class","countries").selectAll("path").data(t.features).enter().append("path").attr("d",i).attr("fill","#ccc").style("stroke","white").style("stroke-width",1.5).style("opacity",.8).style("stroke","white").style("stroke-width",.3).on("click",l);var b=M.append("g").on("click",l).selectAll("path").data(u).enter().append("path").attr("d",i).attr("class",d).style("stroke","white").style("cursor","pointer").style("stroke-width",1.5).style("opacity",.8).attr("title",(function(e){return e.name})).on("click",(function(e,t){e.stopPropagation(),w({clickedMeteorite:t,meteoritesEls:b,meteoritesParsed:u,modal:p,projectionFn:o,rootElId:n,state:s})}));$("."+d).tooltip({track:!0})},M=function(){var e=(0,o.Z)(s().mark((function e(){var t,r,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p();case 2:t=e.sent,r=t.countries,n=t.meteorites,k({countries:r,meteorites:n,rootElId:"chart"});case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),b=function(e){var t=e.pageContext;return n.createElement(a.Z,{links:["/vendors/jquery-ui/themes/base/jquery-ui.min.css"],main:M,pageContext:t,scripts:["/vendors/jquery-ui/jquery-ui.min.js"]},n.createElement("div",{id:"chart"}))}}}]);
//# sourceMappingURL=component---src-pages-d-3-js-meteorites-map-tsx-a93df8ccc6dc02ecefc8.js.map