"use strict";(self.webpackChunkdemos=self.webpackChunkdemos||[]).push([[907],{9646:function(e,t,n){var r;n.d(t,{Z:function(){return h}});var a=new Uint8Array(16);function o(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(a)}var i=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var s=function(e){return"string"==typeof e&&i.test(e)},c=[],u=0;u<256;++u)c.push((u+256).toString(16).substr(1));var l,d,f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!s(n))throw TypeError("Stringified UUID is invalid");return n},p=0,g=0;var h=function(e,t,n){var r=t&&n||0,a=t||new Array(16),i=(e=e||{}).node||l,s=void 0!==e.clockseq?e.clockseq:d;if(null==i||null==s){var c=e.random||(e.rng||o)();null==i&&(i=l=[1|c[0],c[1],c[2],c[3],c[4],c[5]]),null==s&&(s=d=16383&(c[6]<<8|c[7]))}var u=void 0!==e.msecs?e.msecs:Date.now(),h=void 0!==e.nsecs?e.nsecs:g+1,m=u-p+(h-g)/1e4;if(m<0&&void 0===e.clockseq&&(s=s+1&16383),(m<0||u>p)&&void 0===e.nsecs&&(h=0),h>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=u,g=h,d=s;var v=(1e4*(268435455&(u+=122192928e5))+h)%4294967296;a[r++]=v>>>24&255,a[r++]=v>>>16&255,a[r++]=v>>>8&255,a[r++]=255&v;var y=u/4294967296*1e4&268435455;a[r++]=y>>>8&255,a[r++]=255&y,a[r++]=y>>>24&15|16,a[r++]=y>>>16&255,a[r++]=s>>>8|128,a[r++]=255&s;for(var x=0;x<6;++x)a[r+x]=i[x];return t||f(a)}},7426:function(e,t,n){n.r(t),n.d(t,{default:function(){return G}});var r=n(7294),a=n(1745),o=n(8634),i=n(2656),s=n.n(i),c=n(8126),u=n(8747),l=n.n(u),d=n(9646),f="expenses-chord-module--chordGroup--b443f",p="expenses-chord-module--groupText--a0329",g="expenses-chord-module--ribbon--8347d";"undefined"!=typeof window&&n(5356);var h,m;!function(e){e.Source="source",e.Target="target"}(h||(h={})),function(e){e.Arrow="arrow",e.Common="common"}(m||(m={}));var v=1e3,y=c.XeF,x=function(e){e.style("opacity",.7).on("mouseenter",(function(){(0,c.Ys)(this).style("opacity",1)})).on("mouseleave",(function(){(0,c.Ys)(this).style("opacity",.7)}))},A=function(e){var t=e.rootElId,n={lastFocused:null},r=e.chordGroupsIds,a=(0,c.PKp)(r,c.K2I),o=document.getElementById(t).getBoundingClientRect().width,i=.5*Math.min(o,800)-20,s=i+20,u=function(e){return e.radius(i-.5).padAngle(1/i)},A=u((0,c.tQZ)()),w=u((0,c.N22)()),k=(0,c.Ys)("#"+t).attr("class","expenses-chord-module--chartWrapper--f066b").append("svg").attr("width",o).attr("height",850);!function(e){var t=e.deviation,n=e.id,r=e.slope,a=e.svg.append("defs").append("filter").attr("height","500%").attr("id","drop-shadow-"+n).attr("width","500%").attr("x","-200%").attr("y","-200%");a.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",t),a.append("feOffset").attr("dx",1).attr("dy",1),a.append("feComponentTransfer").append("feFuncA").attr("slope",r).attr("type","linear");var o=a.append("feMerge");o.append("feMergeNode"),o.append("feMergeNode").attr("in","SourceGraphic")}({deviation:2,id:"groups",slope:.5,svg:k});var C=k.append("g").attr("transform","translate("+o/2+", 425)").append("g").attr("class","svg-drag");!function(e){var t=e.svgDrag,n=e.svgTop,r={s:1,x:0,y:0},a=function(){t.attr("transform","translate("+r.x+","+r.y+") scale("+r.s+")")},o=(0,c.ohM)().on("drag",(function(e){r.x+=e.dx,r.y+=e.dy,a()}));a(),n.style("cursor","move").call(o).on("wheel",(function(e){e.preventDefault(),r.s+=-e.deltaY/1e3,a()}))}({svgDrag:C,svgTop:k}),C.append("rect").attr("fill","#fff").attr("width",o).attr("height",800).attr("transform","translate(-"+o/2+", -425)");var b=(0,d.Z)(),I=(0,c.rKe)().padAngle(12/i).sortSubgroups(c.$1i).sortChords(c.$1i);C.append("path").attr("fill","none").attr("id",b).attr("d",(0,c.Nb1)()({endAngle:2*Math.PI,innerRadius:0,outerRadius:s,startAngle:0}));var R=(0,c.Nb1)().innerRadius(i).outerRadius(s),E=C.append("g"),L=C.append("g").attr("font-family","sans-serif").attr("font-size",10),T=function(e){return e.source.index+"_"+e.target.index},D=function(){var t=e.getRibbonType()===m.Common?w:A,o=e.getChordMatrix(),i=I(o),u=E.selectAll("."+g).data().reduce((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],a=t[1];return r[T(a)]=a,r}),{}),d=function(t){return a(e.getRibbonGroupIdColor(r[t.source.index],r[t.target.index]))},k=E.selectAll("."+g).data(i,(function(e){return T(e)})).join((function(e){var n=e.append("path").attr("class",g).attr("fill",d);return x(n),n.transition().duration(v).attrTween("d",(function(e){var n={endAngle:0,startAngle:0},r={endAngle:0,startAngle:0},a=(0,c.sXR)(n,e.source),o=(0,c.sXR)(r,e.target);return function(e){var n={source:a(e),target:o(e)};return t(n)}}))}),(function(e){return e.transition().duration(v).attr("fill",d).attrTween("d",(function(e){var n=u[T(e)];if(!n)return function(){return t(e)};var r=(0,c.sXR)(n.source,e.source),a=(0,c.sXR)(n.target,e.target);return function(e){var n={source:r(e),target:a(e)};return t(n)}})),e}));k.attr("title",(function(t){return e.getChordTitle(t.source.index,t.target.index,t.source.value,t.target.value)})).on("click",(function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];var o=t[1],i=(0,c.Ys)(this),s=r[o.source.index]+"_"+r[o.target.index];n.lastFocused===s?(k.attr("display","block"),n.lastFocused=null):(k.attr("display","none"),i.attr("display","block"),n.lastFocused=s)})),l()("."+g).tooltip({track:!0});var C=function(t){return t.endAngle-t.startAngle<.07?"":e.getChordGroupTitle(r[t.index])},D=L.selectAll("."+f).data();L.selectAll("."+f).data(i.groups,(function(e){return e.index})).join((function(t){var o=t.append("g").attr("class",f).attr("title",(function(t){return e.getChordGroupTitle(r[t.index])})).style("filter","url(#drop-shadow-groups)");return x(o),o.append("path").attr("class","group-path").transition().duration(v).ease(y).attrTween("d",(function(e){var t=(0,c.sXR)(Object.assign({},e,{endAngle:0,startAngle:0}),e);return function(e){return R(t(e))}})).attr("fill",(function(e){return a(r[e.index])})).attr("stroke","#fff"),o.append("text").attr("dy",-3).append("textPath").attr("xlink:href","#"+b).attr("class",p).text(C).transition().duration(v).ease(y).attr("startOffset",(function(e){return e.startAngle*s})),o.on("click",(function(){for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];var i=a[1],s=r[i.index],c=E.selectAll("."+g);if(n.lastFocused===s)return c.attr("display",(function(){return"block"})),void(n.lastFocused=null);n.lastFocused=s,e.getDisplayTypeOnGroupClick(s)!==h.Source?c.attr("display",(function(e){return e.target.index===i.index?"block":"none"})):c.attr("display",(function(e){return e.source.index===i.index?"block":"none"}))})),l()("."+f).tooltip({track:!0}),o}),(function(e){return e.select(".group-path").transition().duration(v).attrTween("d",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],a=t[1],o=D[a],i=(0,c.sXR)(o,r);return function(e){return R(i(e))}})),e.select("."+p).text(C).transition().duration(v).attr("startOffset",(function(e){return e.startAngle*s})),e}),(function(e){return e.remove()})).attr("class",f)};return D(),{renderItems:D}},w=function(){function e(e){var t,n=Object.keys(e).sort();this.countries=n,this.regions=(t=n.reduce((function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=n[0],o=n[1];return Object.keys(e[o]).forEach((function(e){a.add(e)})),a}),new Set),Array.from(t).sort()),this.expensesData=e,this.names=n.concat(this.regions)}e.fetchAndCreate=function(){var t=(0,o.Z)(s().mark((function t(){var n;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,c.AVB)("/demos/data/d3js/expenses-chord/data.json");case 2:return n=t.sent,t.abrupt("return",new e(n));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();var t=e.prototype;return t.getRelationsMatrix=function(t){var n=t.countryFilter,r=t.regionFilter,a=t.timeIndexFilter,o=this.expensesData,i=this.names;return i.map((function(t){return o[t]&&[e.ALL_ID,t].includes(n)?i.map((function(n){var i,s=o[t][n];return s&&[e.ALL_ID,n].includes(r)&&null!==(i=s[a].value)&&void 0!==i?i:0})):i.map((function(){return 0}))}))},t.getTimeFramesNumber=function(){var e=this.countries,t=this.expensesData,n=this.regions;return t[e[0]][n[0]].length-1},t.getCountriesList=function(){return this.countries.slice()},t.getRegionsList=function(){return this.regions.slice()},t.getAllNames=function(){return this.names.slice()},e}();w.ALL_ID="All";var k="chart";"undefined"!=typeof window&&n(7252);var C="automatic-time",b="slider-time",I="countries-select",R="regions-select",E=function(){function e(e){var t=e.onChecked,n=e.onUnchecked;this.onChecked=t,this.onUnchecked=n,this.checkbox=document.getElementById(C)}var t=e.prototype;return t.init=function(){var e=this;this.checkbox.setAttribute("checked","checked"),this.onChecked(),this.checkbox.addEventListener("change",(function(){e.checkbox.checked?e.onChecked():e.onUnchecked()}))},t.uncheck=function(){this.checkbox.checked=!1,this.onUnchecked()},e}(),L=function(e){var t=e.expenses,n=e.state,r=t.getAllNames();return{chordGroupsIds:r,getChordGroupTitle:function(e){return e},getChordMatrix:function(){return t.getRelationsMatrix({countryFilter:n.selectedCountry,regionFilter:n.selectedRegion,timeIndexFilter:n.timeIndex})},getChordTitle:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=t[0],o=t[1],i=t[2];return'People from "'+r[a]+'" spend into "'+r[o]+'": '+i},getDisplayTypeOnGroupClick:function(e){return t.getCountriesList().includes(e)?h.Source:h.Target},getRibbonGroupIdColor:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=t[0],o=t[1];return n.selectedRegion===w.ALL_ID?o:a},getRibbonType:function(){return n.selectedCountry!==w.ALL_ID&&n.selectedRegion!==w.ALL_ID?m.Common:m.Arrow},rootElId:k}},T=function(e){var t=e.expenses,n=e.renderItems,r=e.state,a=t.getTimeFramesNumber();l()("#slider-time").slider({change:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];var o=t[1].value;3!==o&&(r.timeIndex=o,n())},max:a,min:0});var o=function(e){var t=e.id,n=e.onChange,r=e.selectOptions,a=document.getElementById(t);[w.ALL_ID].concat(r).forEach((function(e){var t=document.createElement("option");t.setAttribute("value",e),t.innerText=e,a.appendChild(t)})),a.addEventListener("change",(function(){n(a.value)}))};o({id:I,onChange:function(e){r.selectedCountry=e,n()},selectOptions:t.getCountriesList()}),o({id:R,onChange:function(e){r.selectedRegion=e,n()},selectOptions:t.getRegionsList()});var i=null,s=new E({onChecked:function(){clearInterval(i),i=window.setInterval((function(){var e=l()("#slider-time").slider("value")+1;l()("#slider-time").slider("value",e),e>=a&&s.uncheck()}),2e3)},onUnchecked:function(){clearInterval(i)}});s.init()},D=function(){var e=(0,o.Z)(s().mark((function e(){var t,n,r,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.fetchAndCreate();case 2:t=e.sent,n={selectedCountry:w.ALL_ID,selectedRegion:w.ALL_ID,timeIndex:0},r=L({expenses:t,state:n}),a=A(r),o=a.renderItems,T({expenses:t,renderItems:o,state:n});case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),N=D,F="expenses-page-module--label--0c13f",G=function(e){var t=e.pageContext;return r.createElement(a.Z,{main:N,pageContext:t},r.createElement("div",{className:"expenses-page-module--sliderRow--fa29f"},r.createElement("div",{className:F},"Time Item:"),r.createElement("div",{className:"expenses-page-module--sliderTime--aa98e",id:b})),r.createElement("div",{className:"expenses-page-module--selectRow--55763"},r.createElement("span",null,r.createElement("span",{className:F},"Countries:"),r.createElement("select",{className:"form-select",id:I})),r.createElement("span",null,r.createElement("span",{className:F},"Regions:"),r.createElement("select",{className:"form-select",id:R})),r.createElement("span",null,r.createElement("span",{className:F},"Automatic Time Change:"),r.createElement("input",{className:"form-check-input",id:C,type:"checkbox"}))),r.createElement("div",{id:k}))}}}]);
//# sourceMappingURL=component---src-pages-d-3-js-expenses-chord-tsx-6ab5788b4501821ac674.js.map