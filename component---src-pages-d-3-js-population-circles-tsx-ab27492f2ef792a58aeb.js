/*! For license information please see component---src-pages-d-3-js-population-circles-tsx-ab27492f2ef792a58aeb.js.LICENSE.txt */
(self.webpackChunkdemos=self.webpackChunkdemos||[]).push([[147],{581:function(e,t){"use strict";var n="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function r(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on".concat(t),(function(){n(window.event)}))}function a(e,t){for(var n=t.slice(0,t.length-1),r=0;r<n.length;r++)n[r]=e[n[r].toLowerCase()];return n}function o(e){"string"!=typeof e&&(e="");for(var t=(e=e.replace(/\s/g,"")).split(","),n=t.lastIndexOf("");n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}for(var i={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":n?173:189,"=":n?61:187,";":n?59:186,"'":222,"[":219,"]":221,"\\":220},l={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},u={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},c={16:!1,18:!1,17:!1,91:!1},s={},p=1;p<20;p++)i["f".concat(p)]=111+p;var f=[],d="all",m=[],y=function(e){return i[e.toLowerCase()]||l[e.toLowerCase()]||e.toUpperCase().charCodeAt(0)};function v(e){d=e||"all"}function h(){return d||"all"}var g=function(e){var t=e.key,n=e.scope,r=e.method,i=e.splitKey,u=void 0===i?"+":i;o(t).forEach((function(e){var t=e.split(u),o=t.length,i=t[o-1],c="*"===i?"*":y(i);if(s[c]){n||(n=h());var p=o>1?a(l,t):[];s[c]=s[c].map((function(e){return(!r||e.method===r)&&e.scope===n&&function(e,t){for(var n=e.length>=t.length?e:t,r=e.length>=t.length?t:e,a=!0,o=0;o<n.length;o++)-1===r.indexOf(n[o])&&(a=!1);return a}(e.mods,p)?{}:e}))}}))};function x(e,t,n){var r;if(t.scope===n||"all"===t.scope){for(var a in r=t.mods.length>0,c)Object.prototype.hasOwnProperty.call(c,a)&&(!c[a]&&t.mods.indexOf(+a)>-1||c[a]&&-1===t.mods.indexOf(+a))&&(r=!1);(0!==t.mods.length||c[16]||c[18]||c[17]||c[91])&&!r&&"*"!==t.shortcut||!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}function w(e){var t=s["*"],n=e.keyCode||e.which||e.charCode;if(k.filter.call(this,e)){if(93!==n&&224!==n||(n=91),-1===f.indexOf(n)&&229!==n&&f.push(n),["ctrlKey","altKey","shiftKey","metaKey"].forEach((function(t){var n=u[t];e[t]&&-1===f.indexOf(n)?f.push(n):!e[t]&&f.indexOf(n)>-1?f.splice(f.indexOf(n),1):"metaKey"===t&&e[t]&&3===f.length&&(e.ctrlKey||e.shiftKey||e.altKey||(f=f.slice(f.indexOf(n))))})),n in c){for(var r in c[n]=!0,l)l[r]===n&&(k[r]=!0);if(!t)return}for(var a in c)Object.prototype.hasOwnProperty.call(c,a)&&(c[a]=e[u[a]]);e.getModifierState&&(!e.altKey||e.ctrlKey)&&e.getModifierState("AltGraph")&&(-1===f.indexOf(17)&&f.push(17),-1===f.indexOf(18)&&f.push(18),c[17]=!0,c[18]=!0);var o=h();if(t)for(var i=0;i<t.length;i++)t[i].scope===o&&("keydown"===e.type&&t[i].keydown||"keyup"===e.type&&t[i].keyup)&&x(e,t[i],o);if(n in s)for(var p=0;p<s[n].length;p++)if(("keydown"===e.type&&s[n][p].keydown||"keyup"===e.type&&s[n][p].keyup)&&s[n][p].key){for(var d=s[n][p],m=d.splitKey,v=d.key.split(m),g=[],w=0;w<v.length;w++)g.push(y(v[w]));g.sort().join("")===f.sort().join("")&&x(e,d,o)}}}function k(e,t,n){f=[];var i=o(e),u=[],p="all",d=document,v=0,h=!1,g=!0,x="+";for(void 0===n&&"function"==typeof t&&(n=t),"[object Object]"===Object.prototype.toString.call(t)&&(t.scope&&(p=t.scope),t.element&&(d=t.element),t.keyup&&(h=t.keyup),void 0!==t.keydown&&(g=t.keydown),"string"==typeof t.splitKey&&(x=t.splitKey)),"string"==typeof t&&(p=t);v<i.length;v++)u=[],(e=i[v].split(x)).length>1&&(u=a(l,e)),(e="*"===(e=e[e.length-1])?"*":y(e))in s||(s[e]=[]),s[e].push({keyup:h,keydown:g,scope:p,mods:u,shortcut:i[v],method:n,key:i[v],splitKey:x});void 0!==d&&!function(e){return m.indexOf(e)>-1}(d)&&window&&(m.push(d),r(d,"keydown",(function(e){w(e)})),r(window,"focus",(function(){f=[]})),r(d,"keyup",(function(e){w(e),function(e){var t=e.keyCode||e.which||e.charCode,n=f.indexOf(t);if(n>=0&&f.splice(n,1),e.key&&"meta"===e.key.toLowerCase()&&f.splice(0,f.length),93!==t&&224!==t||(t=91),t in c)for(var r in c[t]=!1,l)l[r]===t&&(k[r]=!1)}(e)})))}var E={setScope:v,getScope:h,deleteScope:function(e,t){var n,r;for(var a in e||(e=h()),s)if(Object.prototype.hasOwnProperty.call(s,a))for(n=s[a],r=0;r<n.length;)n[r].scope===e?n.splice(r,1):r++;h()===e&&v(t||"all")},getPressedKeyCodes:function(){return f.slice(0)},isPressed:function(e){return"string"==typeof e&&(e=y(e)),-1!==f.indexOf(e)},filter:function(e){var t=e.target||e.srcElement,n=t.tagName,r=!0;return!t.isContentEditable&&("INPUT"!==n&&"TEXTAREA"!==n&&"SELECT"!==n||t.readOnly)||(r=!1),r},unbind:function(e){if(e){if(Array.isArray(e))e.forEach((function(e){e.key&&g(e)}));else if("object"==typeof e)e.key&&g(e);else if("string"==typeof e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n[0],o=n[1];"function"==typeof a&&(o=a,a=""),g({key:e,scope:a,method:o,splitKey:"+"})}}else Object.keys(s).forEach((function(e){return delete s[e]}))}};for(var b in E)Object.prototype.hasOwnProperty.call(E,b)&&(k[b]=E[b]);if("undefined"!=typeof window){var C=window.hotkeys;k.noConflict=function(e){return e&&window.hotkeys===k&&(window.hotkeys=C),k},window.hotkeys=k}t.Z=k},8502:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return h}});var r=n(7294),a=n(4275),o=n(2137),i=n(7757),l=n.n(i),u=n(8061),c=n(7956),s=n(581),p=n(2203),f=0,d=70,m=function(e){var t=e.municipalities,n=e.rootElId,r=document.getElementById(n).getBoundingClientRect().width,a=400,o={populationRange:[0,1],prop:"total",valueIdx:0},i=(0,u.PKp)(t.map((function(e,t){return t})),u.Cn1),l=(0,u.Ys)("#"+n).append("svg").attr("viewBox",[0,0,r,a+d]).attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor","middle"),m=l.append("text").text("").attr("transform","translate("+r/2+", 50)").style("font-size","20px").style("text-anchor","right"),y=l.append("g").attr("transform","translate("+f+", "+d+")"),v=function(){var e=t.filter((function(e){return!!e.values[o.prop][o.valueIdx]})),n=e.map((function(e){var t=e.values[o.prop][o.valueIdx];return t?t.count:null})),l=n.reduce((function(e,t,n){return null===t||(e[t]=e[t]||[],e[t].push(n)),e}),{}),f=n.sort((function(e,t){return e-t})),d=f.reduce((function(e,t,n){var r=n/f.length;return l[t].forEach((function(t){e[t]=r})),e}),[]),v=e.filter((function(e,t){var n=d[t];return"number"==typeof n&&n>=o.populationRange[0]&&n<=o.populationRange[1]})),h=(0,u.bT9)({children:v}).sum((function(e){if(!e.values)return 1;var t=e.values[o.prop][o.valueIdx];return t?t.count:0})),g=(0,u.P2p)().size("total"===o.prop?[r,a]:[r/2,200]).padding(3)(h).leaves(),x=function(e){return new Date(e).getFullYear()},w=g[0].data.values[o.prop][o.valueIdx].date,k=x(w),E=g.filter((function(e){return e.data.values[o.prop].length>=o.valueIdx+1})).length;m.text("Population in Malaga: "+k+(0===o.populationRange[0]&&1===o.populationRange[1]?"":" - From "+(100*o.populationRange[0]).toFixed(0)+" percentile to "+(100*o.populationRange[1]).toFixed(0)+" percentile")+" - "+E+" municipalities");var b=y.selectAll(".leaf").data(g);b.exit().remove();var C=function(e){var t=e.data.values[o.prop][o.valueIdx];if(!t)return"";var n,r={females:"females",males:"males",total:"people"}[o.prop];return e.data.name+" - "+(n=t.count,Number(n.toFixed(0)).toLocaleString(void 0,{maximumFractionDigits:0,minimumFractionDigits:0})+" ")+r+" - "+x(t.date)};b.attr("title",C).transition().duration(1e3).ease(u.sq$).attr("transform",(function(e){return"total"!==o.prop?"translate("+(e.x+r/4)+","+(e.y+100)+")":"translate("+(e.x+1)+","+(e.y+1)+")"}));var O=b.enter().append("g").attr("class","leaf").attr("title",C).attr("transform",(function(e){return"translate("+(e.x+1)+","+(e.y+1)+")"})).on("mouseenter",(function(e,t){var n=(0,u.Ys)(this).select(".circle"),r=(0,c.Z)({complete:function(){t.anim=null},strokeWidth:"5px",targets:[n.node()]});t.anim=r})).on("mouseleave",(function(e,t){var n=(0,u.Ys)(this).select(".circle");t.anim&&(t.anim.seek(0),t.anim.remove(n.node()),t.anim=null),(0,c.Z)({strokeWidth:"0px",targets:[n.node()]})})).on("click",(function(e,t){s.Z.isPressed("control")&&window.open("https://www.google.com/search?"+p.stringify({q:"Malaga "+t.data.name}))}));O.append("circle").attr("r",(function(e){return e.r})).attr("class","circle").attr("fill-opacity",.7).attr("fill",(function(e,t){return i(t)})).attr("stroke-width","0px").attr("stroke","green");var K=function(e){e.text((function(e){return e.data.name[0]})).style("font-size",(function(e){return e.r.toFixed(0)+"px"})).attr("dy",(function(e){return e.r/3}))};K(O.append("text").attr("class","letter"));var P=b.selectAll(".circle").data((function(e){return e})),j=b.selectAll(".letter").data((function(e){return e}));P.transition().duration(1e3).ease(u.vaZ).attr("r",(function(e){return e.r})),K(j.transition().duration(1e3).ease(u.vaZ)),$(".leaf").tooltip({track:!0})};return v(),{onPopulationPercentilesChange:function(e){o.populationRange=e,v()},onTimeSeriesChange:function(e){o.valueIdx=e,v()},onTypeChange:function(e){o.prop=e,v()}}},y=function(){var e=(0,o.Z)(l().mark((function e(){var t,n,r,a,o,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,s.Z)("control",(function(){})),e.next=3,(0,u.AVB)("/demos/data/d3js/population-circles/data.json");case 3:t=e.sent,n=m({municipalities:t,rootElId:"chart"}),r=n.onPopulationPercentilesChange,a=n.onTimeSeriesChange,o=n.onTypeChange,(0,u.Ys)("form").on("change",(function(e){o(e.target.value)})),$(".population-slider").slider({change:function(e,t){var n=t.values.map((function(e){return e/100}));r(n)},range:!0,values:[0,100]}),i=t[0].values.total.length-1,$(".time-slider").slider({change:function(e,t){a(t.value)},max:i,min:0,value:0});case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),v="population-circles-module--slider--3hzyU",h=function(e){var t=e.pageContext;return r.createElement(a.Z,{links:["/vendors/jquery-ui/themes/base/jquery-ui.min.css"],main:y,pageContext:t,scripts:["/vendors/jquery-ui/jquery-ui.min.js"]},r.createElement("form",null,[{id:"total",label:"Total"},{id:"males",label:"Males"},{id:"females",label:"Females"}].map((function(e,t){var n=e.id,a=e.label;return r.createElement("div",{className:"population-circles-module--radio--1S8Dr",key:n},r.createElement("input",{defaultChecked:0===t,id:n,name:"type",type:"radio",value:n}),r.createElement("label",{htmlFor:n},a))}))),r.createElement("div",{className:v},r.createElement("p",null,"Time"),r.createElement("div",{className:"time-slider"})),r.createElement("div",{className:v},r.createElement("p",null,"Population Percentile"),r.createElement("div",{className:"population-slider"})),r.createElement("div",{id:"chart"}))}}}]);
//# sourceMappingURL=component---src-pages-d-3-js-population-circles-tsx-ab27492f2ef792a58aeb.js.map