"use strict";(self.webpackChunkdemos=self.webpackChunkdemos||[]).push([[175],{9646:function(t,e,r){var n;r.d(e,{Z:function(){return h}});var a=new Uint8Array(16);function i(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(a)}var s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var o=function(t){return"string"==typeof t&&s.test(t)},l=[],c=0;c<256;++c)l.push((c+256).toString(16).substr(1));var u,d,p=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(l[t[e+0]]+l[t[e+1]]+l[t[e+2]]+l[t[e+3]]+"-"+l[t[e+4]]+l[t[e+5]]+"-"+l[t[e+6]]+l[t[e+7]]+"-"+l[t[e+8]]+l[t[e+9]]+"-"+l[t[e+10]]+l[t[e+11]]+l[t[e+12]]+l[t[e+13]]+l[t[e+14]]+l[t[e+15]]).toLowerCase();if(!o(r))throw TypeError("Stringified UUID is invalid");return r},f=0,g=0;var h=function(t,e,r){var n=e&&r||0,a=e||new Array(16),s=(t=t||{}).node||u,o=void 0!==t.clockseq?t.clockseq:d;if(null==s||null==o){var l=t.random||(t.rng||i)();null==s&&(s=u=[1|l[0],l[1],l[2],l[3],l[4],l[5]]),null==o&&(o=d=16383&(l[6]<<8|l[7]))}var c=void 0!==t.msecs?t.msecs:Date.now(),h=void 0!==t.nsecs?t.nsecs:g+1,v=c-f+(h-g)/1e4;if(v<0&&void 0===t.clockseq&&(o=o+1&16383),(v<0||c>f)&&void 0===t.nsecs&&(h=0),h>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");f=c,g=h,d=o;var m=(1e4*(268435455&(c+=122192928e5))+h)%4294967296;a[n++]=m>>>24&255,a[n++]=m>>>16&255,a[n++]=m>>>8&255,a[n++]=255&m;var y=c/4294967296*1e4&268435455;a[n++]=y>>>8&255,a[n++]=255&y,a[n++]=y>>>24&15|16,a[n++]=y>>>16&255,a[n++]=o>>>8|128,a[n++]=255&o;for(var w=0;w<6;++w)a[n+w]=s[w];return e||p(a)}},3884:function(t,e,r){r.r(e),r.d(e,{default:function(){return z}});var n,a,i=r(7294),s=r(1745),o=r(8634),l=r(2656),c=r.n(l),u=r(8558),d=r(8747),p=r.n(d),f=r(9646),g="crossing-lines-chart-module--axis--6022c",h="chart";"undefined"!=typeof window&&r(5356),function(t){t.Black="Black",t.Orange="Orange",t.Red="Red"}(a||(a={}));var v=((n={})[a.Red]="crossing-lines-chart-module--redLine--c046b",n[a.Orange]="crossing-lines-chart-module--orangeLine--16216",n[a.Black]="crossing-lines-chart-module--blackLine--957c7",n),m=50,y=120,w=50,x=80,k=600-x-m,A=function(){function t(t){var e=this;this.handleResize=function(){e.refresh(e.latesTimeRange)},this.config=t;var r=t.rootElId;document.getElementById(r).classList.add("crossing-lines-chart-module--mareysScheduleChart--629f6"),this.selectors={clipId:"clip-"+(0,f.Z)().slice(0,6),filterId:"lines-"+(0,f.Z)().slice(0,6),linePathClass:"line-"+(0,f.Z)().slice(0,6),pointCircleClass:"point-"+(0,f.Z)().slice(0,6)};var n=(0,u.Ys)("#"+r).append("svg"),a=n.append("g"),i=a.append("g"),s=i.append("text"),o=i.append("defs").append("clipPath").attr("id",this.selectors.clipId).append("rect"),l=i.append("g").attr("class","crossing-lines-chart-module--horizontalMarker--7c37e"),c=i.append("g").attr("class","x top "+g),d=i.append("g").attr("class","x bottom "+g),p=i.append("g");!function(t){var e=t.deviation,r=t.id,n=t.slope,a=t.svg.append("defs").append("filter").attr("height","500%").attr("id","drop-shadow-"+r).attr("width","500%").attr("x","-200%").attr("y","-200%");a.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",e),a.append("feOffset").attr("dx",1).attr("dy",1),a.append("feComponentTransfer").append("feFuncA").attr("slope",n).attr("type","linear");var i=a.append("feMerge");i.append("feMergeNode"),i.append("feMergeNode").attr("in","SourceGraphic")}({deviation:2,id:this.selectors.filterId,slope:.2,svg:i}),this.elements={chartTitle:s,clipPath:o,horizongalAxis:l,linesWrapper:p,svg:n,svgDrag:a,svgG:i,xAxisBottom:d,xAxisTop:c},this.dragX=0,this.latesTimeRange=[new Date,new Date],window.addEventListener("resize",this.handleResize)}var e=t.prototype;return e.refresh=function(t){this.latesTimeRange=t;var e=t[0],r=t[1],n=this.config,a=n.crossingLinesData,i=n.rootElId,s=this.config,o=this.elements,l=o.chartTitle,c=o.clipPath,d=o.horizongalAxis,f=o.linesWrapper,g=o.svg,h=o.svgG,A=o.xAxisBottom,T=o.xAxisTop,M=this.selectors,C=M.clipId,b=M.filterId,D=M.linePathClass,S=M.pointCircleClass,L=a.horizontalMarkers,I=a.lines,R=document.getElementById(i).getBoundingClientRect().width-y-w,z=Math.max(R,710),E=(0,u.Xf)().domain([e,r]).range([0,z]),B=(0,u.BYU)().range([0,k]),X=(0,u.F5q)(E).ticks(8).tickFormat(s.getXAxisLabel),P=(0,u.LLu)(E).ticks(8).tickFormat(s.getXAxisLabel);g.attr("height",k+x+m).attr("width",z+y+w),h.attr("transform","translate("+y+","+x+")"),l.attr("class","crossing-lines-chart-module--chartTitle--26c62").attr("text-anchor","middle").attr("transform","translate("+z/2+",-40)").text(s.chartTitle).style("font-weight","bold"),c.attr("y",-x).attr("width",z).attr("height",k+x+m),B.domain((0,u.Wem)(L,(function(t){return t.position})));var Z=d.selectAll("g").data(L).enter().append("g").attr("transform",(function(t){return"translate(0,"+B(t.position)+")"}));Z.append("text").attr("x",-6).attr("dy",".35em").text((function(t){return t.label})),Z.append("line").attr("x2",z),T.call(X),A.attr("transform","translate(0,"+k+")").call(P);var q=f.attr("class","crossing-lines-chart-module--line--be274").attr("clip-path","url(#"+C+")").selectAll("g").data(I).enter().append("g").attr("class",(function(t){var e=s.getLineStyle(t);return v[e]+" line-"+t.id})).on("mouseover",(function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=e[1];(0,u.Ys)(".line-"+n.id).select("path").style("stroke-width","5px")})).on("mouseleave",(function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=e[1];(0,u.Ys)(".line-"+n.id).select("path").style("stroke-width","2.5px")})),N=(0,u.jvg)().x((function(t){return E(t.x)})).y((function(t){return B(t.horizontalMarker.position)}));q.append("path");var O=f.selectAll("g");O.selectAll("path").attr("d",(function(t){return N(t.points)})).attr("class",D).attr("title",s.getLineTitle),q.selectAll("circle").data((function(t){return t.points})).enter().append("circle").style("cursor","pointer").on("click",(function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=e[1];s.onPointClick(n)})).style("filter","url(#drop-shadow-"+b+")").attr("r","5px").attr("class",S),O.selectAll("circle").attr("transform",(function(t){return"translate("+E(t.x)+","+B(t.horizontalMarker.position)+")"})).attr("title",(function(t){return s.getPointTitle(t)})),p()("."+D).tooltip({track:!0}),p()("."+S).tooltip({track:!0}),this.setupDrag(R)},e.setupDrag=function(t){var e=this,r=this.elements,n=t<710,a=function(){n?(e.dragX=Math.min(0,e.dragX),e.dragX=Math.max(t-710,e.dragX)):e.dragX=0,e.elements.svgDrag.attr("transform","translate("+e.dragX+",0)")},i=function(t){n&&(e.dragX+=t.dx,a())},s=(0,u.ohM)().on("drag",i);r.svg.style("cursor",n?"move":"default").call(s).on("drag",i),a()},t}(),T=r(2203),M="%I:%M%p",C=function(t){var e=(0,u.Z1g)(M)(t);return null!==e&&e.getHours()<3&&e.setDate(e.getDate()+1),e},b=function(){function t(t){this.schedulesData=t}t.fetchAndCreateSchedules=function(){var e=(0,o.Z)(c().mark((function e(){var r,n,a,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.pvA)("/demos/data/d3js/mareys-schedule/data.tsv");case 2:return r=e.sent,n=[],a=r.map((function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var a=e[0],i=e[1];if(0===i)for(var s in a)if(/^stop\|/.test(s)){var o=s.split("|");n.push({distance:+o[2],key:s,name:o[1],zone:+o[3]})}return{direction:a.direction,id:i,number:a.number,stops:n.map((function(t){return{station:t,time:C(a[t.key]),trainId:i}})).filter((function(t){return null!==t.time})),type:a.type}})).filter((function(t){return/[NLB]/.test(t.type)})),i={stations:n,trains:a},e.abrupt("return",new t(i));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),t.convertDateToString=function(t){return(0,u.i$Z)(M)(t)},t.convertStringToDate=function(t){return C(t)},t.getTrainTitle=function(t){var e=t.stops,r=[e[0],e[t.stops.length-1]].map((function(t){return t.station.name}));return"S"===t.direction&&r.reverse(),r[1]+" -> "+r[0]};var e=t.prototype;return e.getStations=function(){return this.schedulesData.stations.slice()},e.getTrains=function(){return this.schedulesData.trains.slice()},e.getTrainsMap=function(){return this.schedulesData.trains.reduce((function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=e[0],a=e[1];return n[a.id]=a,n}),{})},t}(),D=function(t){var e=t.getStations().map((function(t){return{key:t.key,label:t.name,position:t.distance}})),r=e.reduce((function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=e[0],a=e[1];return n[a.key]=a,n}),{}),n=t.getTrains().map((function(t){return{id:t.id,points:t.stops.map((function(t){return{horizontalMarker:r[t.station.key],lineId:t.trainId,x:t.time}}))}})),i=t.getTrainsMap();return{chartTitle:"E.J. Mareyâ€™s graphical train schedule (4:30AM - 1:30AM)",crossingLinesData:{horizontalMarkers:e,lines:n},getLineStyle:function(t){switch(i[t.id].type){case"B":default:return a.Red;case"L":return a.Black;case"N":return a.Orange}},getLineTitle:function(t){var e=i[t.id];return b.getTrainTitle(e)},getPointTitle:function(t){var e=i[t.lineId];return b.getTrainTitle(e)+"\n"+t.horizontalMarker.label+" at "+function(t){var e=t.getHours(),r=e>=12?"PM":"AM";e=(e%=12)||12;var n=t.getMinutes();return e+":"+(n<10?"0"+n:n.toString())+" "+r}(t.x)},getXAxisLabel:function(t){return b.convertDateToString(t)},onPointClick:function(t){window.open("https://www.google.com/search?"+T.stringify({q:"Station California "+t.horizontalMarker.label}))},rootElId:h}};"undefined"!=typeof window&&r(7252);var S="schedule-range",L=function(t){var e=p()("#"+S);e.slider({change:function(){var r=function(t){var e=[];return t.forEach((function(t){var r=t/100*1200,n="AM",a=Math.floor(r/60),i=Math.floor(r%60);i>30?(i-=30,a+=1):i+=30,(a+=4)>23?a-=24===a?12:24:a>11&&(n="PM",12!==a&&(a-=12));var s=a+":"+(i<10?"0"+i:i.toString())+n;return e.push(s)})),e}(e.slider("values")).map(b.convertStringToDate);t(r)},range:!0}),e.slider("values",[10,50])},I=function(){var t=(0,o.Z)(c().mark((function t(){var e,r,n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b.fetchAndCreateSchedules();case 2:e=t.sent,r=D(e),n=new A(r),L((function(t){n.refresh(t)}));case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),R=I,z=function(t){var e=t.pageContext;return i.createElement(s.Z,{main:R,pageContext:e},i.createElement("div",{className:"mareys-schedule-page-module--slider--aac0e",id:S}),i.createElement("div",{id:h}))}}}]);
//# sourceMappingURL=component---src-pages-d-3-js-mareys-schedule-tsx-131a52b45de3e09c612b.js.map