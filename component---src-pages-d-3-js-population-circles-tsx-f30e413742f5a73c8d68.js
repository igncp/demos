(self.webpackChunkdemos=self.webpackChunkdemos||[]).push([[147],{8502:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return w}});var a=n(7294),r=n(4275),i=n(2137),o=n(7757),l=n.n(o),u=n(6660),s=n(7956),c=n(581),p=n(2203),d=n(3873),m=n.n(d),f="population-circles-module--slider--3hzyU",v="population-circles-module--circle--Q63YD",g="dropShadowBase",h=0,x=70,y=400,T=function(e){return Number(e.toFixed(0)).toLocaleString(void 0,{maximumFractionDigits:0,minimumFractionDigits:0})},k={females:"females",males:"males",total:"people"},R=function(e){return new Date(e).getFullYear()},C=function(e){var t=e.municipalities,n=e.onClick,a=e.rootElId,r=document.getElementById(a).getBoundingClientRect().width,i={lastPosition:{k:1,x:0,y:0},populationRange:[0,1],populationType:"total",timeRangeIndex:0},o=(0,u.PKp)().domain(t.map((function(e){return e.name}))).range(u.UCG),l=(0,u.sPX)().extent([[0,0],[r/2,200]]).on("end",(function(e){var t=(0,u.Ys)(this).transition().duration(150),n=i.lastPosition,a=e.transform,r=a.x,o=a.y,l=e.transform.k;l!==i.lastPosition.k&&(r=n.x,o=n.y),t.attr("transform","translate("+r+", "+o+") scale("+l+")"),n.k=l,n.x=r,n.y=o})),c=(0,u.Ys)("#"+a).append("svg").attr("viewBox",[0,0,r,y+x].join(", ")).attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor","middle").call(l);E(c,g,.5,2);var p=c.append("text").attr("class","population-circles-module--header--1mim1").text("").attr("transform","translate("+r/2+", 50)"),d=c.append("g").attr("transform","translate("+h+", "+x+")"),f=function(){var e=t.filter((function(e){return!!e.values[i.populationType][i.timeRangeIndex]})),a=e.map((function(e){return e.values[i.populationType][i.timeRangeIndex].count})),l=a.reduce((function(e,t,n){var a;return e[t]=null!==(a=e[t])&&void 0!==a?a:[],e[t].push(n),e}),{}),c=a.sort((function(e,t){return e-t})),f=c.reduce((function(e,t,n){var a=n/c.length;return l[t].forEach((function(t){e[t]=a})),e}),[]),g=e.filter((function(e,t){var n=f[t];return"number"==typeof n&&n>=i.populationRange[0]&&n<=i.populationRange[1]})),h=(0,u.bT9)({children:g,name:"",values:{females:[],males:[],total:[]}}).sum((function(e){if(!e.values)return 1;var t=e.values[i.populationType][i.timeRangeIndex];return t?t.count:0})),x=(0,u.P2p)().size("total"===i.populationType?[r,y]:[r/2,200]).padding(3)(h).leaves(),C=x[0].data.values[i.populationType][i.timeRangeIndex].date,E=R(C),b=g.reduce((function(e,t){return e+t.values[i.populationType][i.timeRangeIndex].count}),0),w=T(b)+" "+k[i.populationType],P=x.filter((function(e){return e.data.values[i.populationType].length>=i.timeRangeIndex+1})).length;p.text("Population in Malaga: "+E+" - "+w+(0===i.populationRange[0]&&1===i.populationRange[1]?"":" - From "+(100*i.populationRange[0]).toFixed(0)+" percentile to "+(100*i.populationRange[1]).toFixed(0)+" percentile")+" - "+P+" municipalities");var I=function(e){return e.data.name},F=d.selectAll(".leaf").data(x,I);F.exit().remove();var j=function(e){var t=e.data.values[i.populationType][i.timeRangeIndex];if(!t)return"";var n=k[i.populationType];return e.data.name+" - "+T(t.count)+" "+n+" - "+R(t.date)};F.attr("title",j).transition().duration(1e3).ease(u.sq$).attr("transform",(function(e){return"total"!==i.populationType?"translate("+(e.x+r/4)+","+(e.y+100)+")":"translate("+(e.x+1)+","+(e.y+1)+")"}));var A=F.enter().append("g").attr("class","leaf").attr("title",j).attr("transform",(function(e){return"translate("+(e.x+1)+","+(e.y+1)+")"})).on("mouseenter",(function(e,t){var n=(0,u.Ys)(this).select("."+v);(0,u.Ys)(this).select(".letter").attr("filter","url(#dropShadowBase)");var a=(0,s.Z)({complete:function(){t.data.hoverAnimation=null},strokeWidth:"5px",targets:[n.node()]});t.data=Object.assign({},t.data,{hoverAnimation:a})})).on("mouseleave",(function(e,t){var n=(0,u.Ys)(this).select("."+v);(0,u.Ys)(this).select(".letter").attr("filter",null);var a=t.data.hoverAnimation;a&&(a.seek(0),s.Z.remove(n.node()),t.data=Object.assign({},t.data,{hoverAnimation:null})),(0,s.Z)({strokeWidth:"0px",targets:[n.node()]})})).on("click",(function(e,t){n(t.data)})),Y=function(e){return o(e.data.name)},Z=function(e){var t=Y(e);return m()(t).darken(1.5).hex()},N=function(e){e.text((function(e){return e.data.name[0]})).style("font-size",(function(e){return e.r.toFixed(0)+"px"})).attr("dy",(function(e){return e.r/3})).attr("fill",Z)},S=function(e){e.attr("r",(function(e){return e.r})).attr("fill",Y).attr("stroke",Z)};S(A.append("circle").attr("class",v)),N(A.append("text").attr("class","letter"));var B=function(e){return e},M=F.selectAll("."+v).data(B,I),q=F.selectAll(".letter").data(B,I);S(M.transition().duration(1e3).ease(u.vaZ)),N(q.transition().duration(1e3).ease(u.vaZ)),$(".leaf").tooltip({track:!0})};return f(),{onPopulationPercentilesChange:function(e){i.populationRange=e,f()},onTimeSeriesChange:function(e){i.timeRangeIndex=e,f()},onTypeChange:function(e){i.populationType=e,f()}}},E=function(e,t,n,a){e.append("filter").html('\n<filter id="'+t+'" height="130%">\n  <feGaussianBlur in="SourceAlpha" stdDeviation="'+a+'"/>\n  <feOffset dx="2" dy="2" result="offsetblur"/>\n  <feComponentTransfer>\n    <feFuncA type="linear" slope="'+n+'"/>\n  </feComponentTransfer>\n  <feMerge>\n    <feMergeNode/>\n    <feMergeNode in="SourceGraphic"/>\n  </feMerge>\n</filter>\n')},b=function(){var e=(0,i.Z)(l().mark((function e(){var t,n,a,r,i,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,c.Z)("control",(function(){})),e.next=3,(0,u.AVB)("/demos/data/d3js/population-circles/data.json");case 3:t=e.sent,n=C({municipalities:t,onClick:function(e){c.Z.isPressed("control")&&window.open("https://www.google.com/search?"+p.stringify({q:"Malaga "+e.name}))},rootElId:"chart"}),a=n.onPopulationPercentilesChange,r=n.onTimeSeriesChange,i=n.onTypeChange,(0,u.Ys)("form").on("change",(function(e){i(e.target.value)})),$(".population-slider").slider({change:function(e,t){var n=t.values.map((function(e){return e/100}));a(n)},range:!0,values:[0,100]}),o=t[0].values.total.length-1,$(".time-slider").slider({change:function(e,t){var n=t.value;r(n)},max:o,min:0,value:0});case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),w=function(e){var t=e.pageContext;return a.createElement(r.Z,{links:["/vendors/jquery-ui/themes/base/jquery-ui.min.css"],main:b,pageContext:t,scripts:["/vendors/jquery-ui/jquery-ui.min.js"]},a.createElement("form",null,[{id:"total",label:"Total"},{id:"males",label:"Males"},{id:"females",label:"Females"}].map((function(e,t){var n=e.id,r=e.label;return a.createElement("div",{className:"population-circles-module--radio--1S8Dr",key:n},a.createElement("input",{defaultChecked:0===t,id:n,name:"type",type:"radio",value:n}),a.createElement("label",{htmlFor:n},r))}))),a.createElement("div",{className:f},a.createElement("p",null,"Time"),a.createElement("div",{className:"time-slider"})),a.createElement("div",{className:f},a.createElement("p",null,"Population Percentile"),a.createElement("div",{className:"population-slider"})),a.createElement("div",{id:"chart"}))}}}]);
//# sourceMappingURL=component---src-pages-d-3-js-population-circles-tsx-f30e413742f5a73c8d68.js.map