{"componentChunkName":"component---src-pages-d-3-js-pie-tsx","path":"/d3js/pie/","result":{"pageContext":{"demoInfo":{"data":["data.json"],"docs":[],"isCompleted":true,"name":"Pie","notes":["Added the animation (transition) by changing a random slice data by a random integer between range"],"sources":["http://codepen.io/nishidh41/pen/Frzhq"],"summary":[],"category":"d3js","files":{"cssModule":"","demo":[{"content":"import {\n  DefaultArcObject,\n  PieArcDatum,\n  Selection,\n  arc as arcD3,\n  easeBack,\n  interpolate,\n  pie as pieD3,\n  scaleOrdinal,\n  schemePastel2,\n  select,\n} from \"d3\"\nimport cloneDeep from \"lodash/cloneDeep\"\n\nconst fetchData = async () => {\n  const pieRawData = await fetch(`${ROOT_PATH}data/d3js/pie/data.json`)\n  const pieJsonData = await pieRawData.json()\n\n  return pieJsonData\n}\n\ntype Slice = {\n  arbitraryValue: number\n  ea0?: PieArcDatum<Slice>\n  label: string\n}\n\ntype SliceArc = PieArcDatum<Slice>\n\nconst height = 300\nconst outerRadius = 100\n\nconst stashArcs = (arcItem: SliceArc) => {\n  arcItem.data.ea0 = cloneDeep(arcItem)\n}\n\nconst arc = arcD3<SliceArc>().outerRadius(outerRadius).innerRadius(0)\n\ntype ArcDatum = Omit<DefaultArcObject & SliceArc, \"innerRadius\" | \"outerRadius\">\n\nconst textTransform = (arcData: ArcDatum): string => {\n  const centroidD = {\n    ...arcData,\n    innerRadius: outerRadius / 2,\n    outerRadius,\n  }\n\n  return `translate(${arc.centroid(centroidD)})`\n}\n\nconst pie = pieD3<Slice>()\n  .sort(null)\n  .value((slice: Slice) => slice.arbitraryValue)\n\nconst colorScale = scaleOrdinal(schemePastel2)\nconst easeFn = easeBack\nconst transitionDuration = 3000\n\nconst arcTween = (finalSlice: SliceArc) => {\n  const {\n    data: { ea0: initialSlice },\n  } = finalSlice\n  const interpolateFn = interpolate(initialSlice, finalSlice)\n\n  finalSlice.data.ea0 = interpolateFn(0)\n\n  return (normalizedTime: number) => arc(interpolateFn(normalizedTime))!\n}\n\ntype PieChartOpts = {\n  pieSlices: Slice[]\n  rootElId: string\n}\n\ntype ChartPaths = Selection<SVGPathElement, SliceArc, SVGGElement, unknown>\ntype ChartLabels = Selection<SVGTextElement, SliceArc, SVGGElement, unknown>\n\nclass PieChart {\n  private readonly rootElId: string\n  private readonly slices: Slice[]\n  private paths: ChartPaths | null\n  private labels: ChartLabels | null\n\n  public constructor({ pieSlices, rootElId }: PieChartOpts) {\n    this.slices = pieSlices\n    this.rootElId = rootElId\n\n    this.paths = null\n    this.labels = null\n\n    this.render()\n  }\n\n  public update(newSliceValue: number) {\n    const { labels, paths, slices } = this\n    const sliceIndex = Math.floor(Math.random() * slices.length)\n\n    slices[sliceIndex].arbitraryValue = newSliceValue\n    ;(paths as ChartPaths)\n      .data(pie(slices))\n      .transition()\n      .duration(transitionDuration)\n      .ease(easeFn)\n      .attrTween(\"d\", arcTween)\n    ;(labels as ChartLabels)\n      .data(pie(slices))\n      .transition()\n      .duration(transitionDuration)\n      .ease(easeFn)\n      .attr(\"transform\", textTransform)\n      .each(function (slice) {\n        select(this).text(slice.data.arbitraryValue)\n      })\n  }\n\n  private render() {\n    const { rootElId, slices } = this\n    const { width } = (document.getElementById(\n      rootElId\n    ) as HTMLElement).getBoundingClientRect()\n\n    const svg = select(`#${rootElId}`)\n      .append(\"svg:svg\")\n      .attr(\"height\", height)\n      .attr(\"width\", width)\n      .append(\"g\")\n      .attr(\"transform\", `translate(${width / 2},${height / 2})`)\n\n    const slicesEls = svg\n      .selectAll(\".slice\")\n      .data(pie(slices))\n      .enter()\n      .append(\"g\")\n      .attr(\"class\", \"slice\")\n\n    this.paths = slicesEls\n      .append(\"path\")\n      .attr(\"d\", arc)\n      .attr(\"fill\", (_slice, sliceIndex) => colorScale(sliceIndex.toString()))\n      .each(stashArcs)\n\n    this.labels = slicesEls\n      .filter((slice: SliceArc) => slice.endAngle - slice.startAngle > 0.2)\n      .append(\"text\")\n      .attr(\"text-anchor\", \"middle\")\n      .attr(\"dy\", \".35em\")\n      .attr(\"transform\", textTransform)\n      .style(\"fill\", \"black\")\n      .style(\"font\", \"bold 12px Arial\")\n      .text((slice) => slice.data.arbitraryValue)\n\n    slicesEls.append(\"title\").text((slice) => slice.data.label)\n  }\n}\n\nconst main = async () => {\n  const pieJsonData = await fetchData()\n\n  const chart = new PieChart({\n    pieSlices: pieJsonData,\n    rootElId: \"chart\",\n  })\n\n  ;(document.getElementById(\"change-data\") as HTMLElement).addEventListener(\n    \"click\",\n    () => {\n      const newSliceValue = Math.floor(Math.random() * 44) + 2\n\n      chart.update(newSliceValue)\n    }\n  )\n}\n\nexport default main\n","fileName":"pie"}],"page":{"content":"import React from \"react\"\n\nimport { DemoPageProps } from \"@/common\"\n\nimport Demo from \"@/components/demo\"\n\nimport main from \"@/demos/pie/pie\"\n\nconst Pie = ({ pageContext }: DemoPageProps) => (\n  <Demo main={main} pageContext={pageContext}>\n    <form>\n      <button className=\"btn btn-success\" id=\"change-data\" type=\"button\">\n        Change\n      </button>\n    </form>\n    <div id=\"chart\" />\n  </Demo>\n)\n\nexport default Pie\n","type":"tsx"}},"key":"pie"},"meta":{"description":"Pie chart example using D3.js, with an animated transition and a random change of values to show how to animate between states."}}},"staticQueryHashes":[]}