{"componentChunkName":"component---src-pages-d-3-js-bubbles-tsx","path":"/d3js/bubbles/","result":{"pageContext":{"demoInfo":{"dataFiles":["data.json"],"docs":[],"isCompleted":true,"name":"Bubbles","notes":["Using the <a href=\"https://github.com/novus/nvd3\" target=\"_blank\">NV3D</a> extension for D3JS","Data taken from the Nike API (via the Codepen)","You can click the \"Maginify\" button and click a point to zoom the chart"],"sources":["http://codepen.io/linghzang3/pen/GFdzh"],"summary":[],"category":"d3js","files":{"demoCSS":[{"content":".bubblesChart {\n  /* stylelint-disable selector-class-pattern */\n\n  :global .nvd3 :global .nv-axis.nv-x path.domain {\n    stroke-opacity: 0.75;\n  }\n\n  :global .nvd3 :global .nv-axis line {\n    stroke-opacity: 0.4;\n  }\n\n  /* stylelint-enable selector-class-pattern */\n}\n","fileName":"bubbles.module.css"}],"demoTS":[{"content":"import * as styles from \"./bubbles.module.css\"\n\nconst CONTAINER_ID = \"chart\"\n\nconst fetchScript = (src: string) =>\n  new Promise((resolve) => {\n    const script = document.createElement(\"script\")\n\n    script.setAttribute(\"type\", \"text/javascript\")\n    script.setAttribute(\"src\", src)\n    script.onload = resolve\n\n    document.body.appendChild(script)\n  })\n\nconst fetchLink = (href: string) =>\n  new Promise((resolve) => {\n    const link = document.createElement(\"link\")\n\n    link.onload = resolve\n\n    link.href = href\n    link.setAttribute(\"rel\", \"stylesheet\")\n    link.setAttribute(\"type\", \"text/css\")\n\n    document.head.appendChild(link)\n  })\n\nconst fetchDependencies = async () => {\n  await Promise.all([\n    fetchLink(`${ROOT_PATH}vendors/nvd3/nv.d3.min.css`),\n    (async () => {\n      await fetchScript(`${ROOT_PATH}vendors/d3/d3.min.js`)\n      await fetchScript(`${ROOT_PATH}vendors/nvd3/nv.d3.min.js`)\n    })(),\n  ])\n}\n\ntype JsonData = Array<{\n  activityId: string\n  activityTimeZone: string\n  activityType: string\n  deviceType: string\n  links: unknown\n  metricSummary: {\n    calories: string\n    distance: string\n    duration: string\n    fuel: string\n    steps: string\n  }\n  metrics: unknown\n  startTime: string\n  status: string\n  tags: unknown\n}>\n\nconst durationToMinutes = (str: string) => {\n  const strParts = str.split(\":\")\n\n  return (\n    60 * Number(strParts[0]) + Number(strParts[1]) + Number(strParts[2]) / 60\n  )\n}\n\nconst margin = {\n  bottom: 100,\n  left: 100,\n  right: 100,\n  top: 100,\n}\n\nconst fetchData = async () => {\n  const response = await fetch(`${ROOT_PATH}data/d3js/bubbles/data.json`)\n  const jsonData = await response.json()\n\n  return jsonData.data\n}\n\ntype RenderChart = (o: { jsonData: JsonData; rootElId: string }) => void\n\nconst renderChart: RenderChart = ({ jsonData, rootElId }) => {\n  const { d3, nv } = window as any // eslint-disable-line @typescript-eslint/no-explicit-any\n\n  const rootEl = document.getElementById(rootElId) as HTMLElement\n\n  rootEl.classList.add(styles.bubblesChart)\n\n  const { width } = rootEl.getBoundingClientRect()\n\n  const color = d3.scale.category20b()\n\n  const chartData = [\n    {\n      key: \"Data\",\n      // eslint-disable-next-line id-denylist\n      values: jsonData.map((...[jsonItem, jsonItemIndex]) => {\n        const distance = +jsonItem.metricSummary.distance\n        const time = durationToMinutes(jsonItem.metricSummary.duration)\n        const pace = time / distance\n\n        return {\n          color: color(distance),\n          jsonItem,\n          size: distance,\n          x: jsonData.length - jsonItemIndex,\n          y: pace,\n        }\n      }),\n    },\n  ]\n\n  type ChartData = typeof chartData\n  type ChartDataItem = ChartData[0][\"values\"][0]\n\n  const chart = nv.models.scatterChart()\n\n  chart.margin(margin)\n\n  nv.utils.windowResize(chart.update)\n\n  chart.forceY([4.5, 6.5]).forceX([0, 135])\n\n  chart.tooltipContent(\n    (...[, , , obj]: [unknown, unknown, unknown, { point: ChartDataItem }]) =>\n      `${obj.point.size.toFixed(1)} km - ${obj.point.jsonItem.deviceType}`\n  )\n  chart.xAxis\n    .axisLabelDistance(45)\n    .tickFormat(d3.format(\"f\"))\n    .axisLabel(\"Person Number\")\n  chart.yAxis\n    .tickFormat(d3.format(\".2f\"))\n    .axisLabelDistance(10)\n    .axisLabel(\"Pace (min/km)\")\n\n  d3.select(`#${rootElId}`)\n    .append(\"svg\")\n    .attr(\"width\", width)\n    .datum(chartData)\n    .call(chart)\n}\n\nconst main = async () => {\n  const [jsonData] = await Promise.all([fetchData(), fetchDependencies()])\n\n  renderChart({\n    jsonData,\n    rootElId: CONTAINER_ID,\n  })\n}\n\nexport { CONTAINER_ID }\n\nexport default main\n","fileName":"bubbles.ts"}],"page":{"content":"import React from \"react\"\n\nimport { DemoPageProps } from \"@/common\"\n\nimport Demo from \"@/components/demo\"\n\nimport main, { CONTAINER_ID } from \"@/demos/bubbles/bubbles\"\n\nconst Bubbles = ({ pageContext }: DemoPageProps) => (\n  <Demo main={main} pageContext={pageContext}>\n    <div id={CONTAINER_ID} style={{ height: 600 }} />\n  </Demo>\n)\n\nexport default Bubbles\n","type":"tsx"}},"key":"bubbles"},"meta":{"description":"Bubbles Chart example with NV3D as D3.js extension, using data from the Nike API, and with a depurated style, an horizontal axis and other color scheme."}}},"staticQueryHashes":[]}