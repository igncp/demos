{
    "componentChunkName": "component---src-pages-d-3-js-energy-sankey-tsx",
    "path": "/d3js/energy-sankey/",
    "result": {"pageContext":{"demoInfo":{"dataFiles":["data.json"],"docs":[["d3-sankey API reference","https://github.com/d3/d3-sankey#api-reference"],["d3-sankey Types","https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/d3-sankey/index.d.ts"],["mix-blend-mode CSS property","https://developer.mozilla.org/en-US/docs/Web/CSS/mix-blend-mode"],["gradientUnits SVG attribute","https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/gradientUnits"],["chroma-js API reference","https://vis4.net/chromajs/#api"],["chroma-js Types","https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/chroma-js/index.d.ts"],["animejs API reference","https://animejs.com/documentation/"],["animejs Types","https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/animejs/index.d.ts"],["hotkeys API reference","https://github.com/jaywcjlove/hotkeys#api-reference"],["hotkeys Types","https://github.com/jaywcjlove/hotkeys/blob/master/index.d.ts"]],"isCompleted":true,"name":"Energy Sankey","notes":["Added interaction on click","You can click a rect while pressing control to Google Search"],"sources":["https://observablehq.com/@d3/sankey-diagram","https://www.gov.uk/guidance/2050-pathways-analysis","https://designmodo.com/animate-svg-gradients/"],"summary":[],"category":"d3js","files":{"demoCSS":[{"content":"<span class=\"token selector\">.chartNode </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">cursor</span><span class=\"token punctuation\">:</span> pointer<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.chartLinkG </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">mix-blend-mode</span><span class=\"token punctuation\">:</span> multiply<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.chartLink </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">cursor</span><span class=\"token punctuation\">:</span> pointer<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">stroke-opacity</span><span class=\"token punctuation\">:</span> 0.7<span class=\"token punctuation\">;</span>\n\n  <span class=\"token selector\"><span class=\"token parent important\">&amp;</span>:hover </span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">stroke-opacity</span><span class=\"token punctuation\">:</span> 0.9<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n","filePath":"src/demos/energy-sankey/energy-sankey.module.css"}],"demoTS":[{"content":"<span class=\"token keyword\">import</span> hotkeys <span class=\"token keyword\">from</span> <span class=\"token string\">\"hotkeys-js\"</span>\n<span class=\"token keyword\">import</span> qs <span class=\"token keyword\">from</span> <span class=\"token string\">\"query-string\"</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createChartConfig<span class=\"token punctuation\">,</span> fetchData <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./energy-sankey-chart-data\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> SankeyChart <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./sankey-chart\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">CONTAINER_ID</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./ui-constants\"</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">main</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">hotkeys</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"control\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> energySankeyData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> chartConfig <span class=\"token operator\">=</span> <span class=\"token function\">createChartConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    energySankeyData<span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">onNodeClick</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>hotkeys<span class=\"token punctuation\">.</span><span class=\"token function\">isPressed</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"control\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span>\n      <span class=\"token punctuation\">}</span>\n\n      window<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span>\n        <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://www.google.com/search?</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>qs<span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          ie<span class=\"token operator\">:</span> <span class=\"token string\">\"UTF-8\"</span><span class=\"token punctuation\">,</span>\n          q<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Energy </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>node<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n      <span class=\"token punctuation\">)</span>\n\n      <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">new</span> <span class=\"token class-name\">SankeyChart</span><span class=\"token punctuation\">(</span>chartConfig<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">CONTAINER_ID</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> main\n","filePath":"src/demos/energy-sankey/energy-sankey.ts"},{"content":"<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> format <span class=\"token keyword\">as</span> formatD3<span class=\"token punctuation\">,</span> json <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"d3\"</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ChartConfig <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./sankey-chart\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">CONTAINER_ID</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./ui-constants\"</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">EnergyDataLink</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  source<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n  target<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n  value<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token comment\">// eslint-disable-line id-denylist</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">EnergyDataNode</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  category<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n  name<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">EnergyData</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  links<span class=\"token operator\">:</span> EnergyDataLink<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  nodes<span class=\"token operator\">:</span> EnergyDataNode<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  units<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fetchData</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  <span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">ROOT_PATH</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">data/d3js/energy-sankey/data.json</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>EnergyData<span class=\"token operator\">></span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">Config</span> <span class=\"token operator\">=</span> ChartConfig<span class=\"token operator\">&lt;</span>EnergyDataNode<span class=\"token punctuation\">,</span> EnergyDataLink<span class=\"token operator\">></span>\n\n<span class=\"token keyword\">const</span> getNodeId<span class=\"token operator\">:</span> Config<span class=\"token punctuation\">[</span><span class=\"token string\">\"getNodeId\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>energyNode<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> energyNode<span class=\"token punctuation\">.</span>name\n<span class=\"token keyword\">const</span> getNodeText<span class=\"token operator\">:</span> Config<span class=\"token punctuation\">[</span><span class=\"token string\">\"getNodeText\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>energyNode<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> energyNode<span class=\"token punctuation\">.</span>name\n\n<span class=\"token keyword\">const</span> createChartConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  energySankeyData<span class=\"token punctuation\">,</span>\n  onNodeClick<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  energySankeyData<span class=\"token operator\">:</span> EnergyData\n  onNodeClick<span class=\"token operator\">:</span> Config<span class=\"token punctuation\">[</span><span class=\"token string\">\"onNodeClick\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Config <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">format</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>numberValue<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> formatFn <span class=\"token operator\">=</span> <span class=\"token function\">formatD3</span><span class=\"token punctuation\">(</span><span class=\"token string\">\",.0f\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">formatFn</span><span class=\"token punctuation\">(</span>numberValue<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>energySankeyData<span class=\"token punctuation\">.</span>units<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> getNodeTitle<span class=\"token operator\">:</span> Config<span class=\"token punctuation\">[</span><span class=\"token string\">\"getNodeTitle\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> nodeValue<span class=\"token punctuation\">,</span> sankeyNode <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token punctuation\">[</span>\n      sankeyNode<span class=\"token punctuation\">.</span>category <span class=\"token operator\">===</span> sankeyNode<span class=\"token punctuation\">.</span>name <span class=\"token operator\">?</span> <span class=\"token string\">\"\"</span> <span class=\"token operator\">:</span> sankeyNode<span class=\"token punctuation\">.</span>category<span class=\"token punctuation\">,</span>\n      sankeyNode<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span>\n      <span class=\"token function\">format</span><span class=\"token punctuation\">(</span>nodeValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>Boolean<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> getLinkTitle<span class=\"token operator\">:</span> Config<span class=\"token punctuation\">[</span><span class=\"token string\">\"getLinkTitle\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    sankeyLink<span class=\"token punctuation\">,</span>\n    sankeyLinkSource<span class=\"token punctuation\">,</span>\n    sankeyLinkTarget<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>sankeyLinkSource<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> → </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>sankeyLinkTarget<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\n</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span>\n      sankeyLink<span class=\"token punctuation\">.</span>value\n    <span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    chartLinks<span class=\"token operator\">:</span> energySankeyData<span class=\"token punctuation\">.</span>links<span class=\"token punctuation\">,</span>\n    chartNodes<span class=\"token operator\">:</span> energySankeyData<span class=\"token punctuation\">.</span>nodes<span class=\"token punctuation\">,</span>\n    getLinkTitle<span class=\"token punctuation\">,</span>\n    getNodeId<span class=\"token punctuation\">,</span>\n    getNodeText<span class=\"token punctuation\">,</span>\n    getNodeTitle<span class=\"token punctuation\">,</span>\n    onNodeClick<span class=\"token punctuation\">,</span>\n    rootElId<span class=\"token operator\">:</span> <span class=\"token constant\">CONTAINER_ID</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span> createChartConfig<span class=\"token punctuation\">,</span> fetchData <span class=\"token punctuation\">}</span>\n","filePath":"src/demos/energy-sankey/energy-sankey-chart-data.ts"},{"content":"<span class=\"token keyword\">import</span> anime <span class=\"token keyword\">from</span> <span class=\"token string\">\"animejs\"</span>\n<span class=\"token keyword\">import</span> chroma <span class=\"token keyword\">from</span> <span class=\"token string\">\"chroma-js\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Selection<span class=\"token punctuation\">,</span> scaleOrdinal<span class=\"token punctuation\">,</span> schemePastel2<span class=\"token punctuation\">,</span> select <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"d3\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  SankeyLink<span class=\"token punctuation\">,</span>\n  SankeyNode<span class=\"token punctuation\">,</span>\n  sankey <span class=\"token keyword\">as</span> sankeyD3<span class=\"token punctuation\">,</span>\n  sankeyLeft<span class=\"token punctuation\">,</span>\n  sankeyLinkHorizontal<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"d3-sankey\"</span>\n<span class=\"token keyword\">import</span> $ <span class=\"token keyword\">from</span> <span class=\"token string\">\"jquery\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"jquery-ui/themes/base/all.css\"</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> styles <span class=\"token keyword\">from</span> <span class=\"token string\">\"./energy-sankey.module.css\"</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> window <span class=\"token operator\">!==</span> <span class=\"token string\">\"undefined\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jquery-ui/ui/widgets/tooltip\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">AddedGradients</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">State</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  addedGradients<span class=\"token operator\">:</span> AddedGradients\n  isInTransition<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span>\n  linkSelected<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span>\n  selectedNode<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> getRandomInt <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> max<span class=\"token punctuation\">,</span> min <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> max<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span> min<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> minRound <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">ceil</span><span class=\"token punctuation\">(</span>min<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> maxRound <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>max<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>maxRound <span class=\"token operator\">-</span> minRound <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> minRound\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> createGradients <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  addedGradients<span class=\"token punctuation\">,</span>\n  fromColor<span class=\"token punctuation\">,</span>\n  svg<span class=\"token punctuation\">,</span>\n  toColor<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  addedGradients<span class=\"token operator\">:</span> AddedGradients\n  fromColor<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n  svg<span class=\"token operator\">:</span> Selection<span class=\"token operator\">&lt;</span>SVGSVGElement<span class=\"token punctuation\">,</span> <span class=\"token builtin\">unknown</span><span class=\"token punctuation\">,</span> HTMLElement<span class=\"token punctuation\">,</span> <span class=\"token builtin\">unknown</span><span class=\"token operator\">></span>\n  toColor<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">link-gradient-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>fromColor<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>toColor<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">#</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>id <span class=\"token keyword\">in</span> addedGradients<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> id\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> duration <span class=\"token operator\">=</span> <span class=\"token function\">getRandomInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    max<span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n    min<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> colorScale <span class=\"token operator\">=</span> chroma<span class=\"token punctuation\">.</span><span class=\"token function\">scale</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>fromColor<span class=\"token punctuation\">,</span> toColor<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> text <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n&lt;linearGradient id=\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\">\n  &lt;stop offset=\"0%\" stop-color=\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>fromColor<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\" />\n  &lt;stop offset=\"50%\" stop-color=\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">colorScale</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\">\n    &lt;animate attributeName=\"offset\"\n      values=\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>offsetValue<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">.</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>offsetValue<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\";\"</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"\n      dur=\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>duration<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">s\"\n      repeatCount=\"indefinite\" />\n  &lt;/stop>\n  &lt;stop offset=\"100%\" stop-color=\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>toColor<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\" />\n&lt;/linearGradient>\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  svg<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"defs\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n\n  addedGradients<span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n\n  <span class=\"token keyword\">return</span> id\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> sankeyHeight <span class=\"token operator\">=</span> <span class=\"token number\">1000</span>\n<span class=\"token keyword\">const</span> legendHeight <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">const</span> svgHeight <span class=\"token operator\">=</span> sankeyHeight <span class=\"token operator\">+</span> legendHeight\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">ChartConfig<span class=\"token operator\">&lt;</span>NodeData<span class=\"token punctuation\">,</span> LinkData<span class=\"token operator\">></span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  chartLinks<span class=\"token operator\">:</span> LinkData<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  chartNodes<span class=\"token operator\">:</span> NodeData<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token function-variable function\">getLinkTitle</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>linkInfo<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    sankeyLink<span class=\"token operator\">:</span> LinkData\n    sankeyLinkSource<span class=\"token operator\">:</span> NodeData\n    sankeyLinkTarget<span class=\"token operator\">:</span> NodeData\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">string</span>\n  <span class=\"token function-variable function\">getNodeId</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>node<span class=\"token operator\">:</span> NodeData<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">string</span>\n  <span class=\"token function-variable function\">getNodeText</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>node<span class=\"token operator\">:</span> NodeData<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">string</span>\n  <span class=\"token function-variable function\">getNodeTitle</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>nodeInfo<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    nodeValue<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span>\n    sankeyNode<span class=\"token operator\">:</span> NodeData\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">string</span>\n  onNodeClick<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>node<span class=\"token operator\">:</span> NodeData<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">boolean</span>\n  rootElId<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">ChartElements</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  linkG<span class=\"token operator\">:</span> Selection<span class=\"token operator\">&lt;</span>SVGGElement<span class=\"token punctuation\">,</span> <span class=\"token builtin\">unknown</span><span class=\"token punctuation\">,</span> HTMLElement<span class=\"token punctuation\">,</span> <span class=\"token builtin\">unknown</span><span class=\"token operator\">></span>\n  nodeG<span class=\"token operator\">:</span> Selection<span class=\"token operator\">&lt;</span>SVGGElement<span class=\"token punctuation\">,</span> <span class=\"token builtin\">unknown</span><span class=\"token punctuation\">,</span> HTMLElement<span class=\"token punctuation\">,</span> <span class=\"token builtin\">unknown</span><span class=\"token operator\">></span>\n  svg<span class=\"token operator\">:</span> Selection<span class=\"token operator\">&lt;</span>SVGSVGElement<span class=\"token punctuation\">,</span> <span class=\"token builtin\">unknown</span><span class=\"token punctuation\">,</span> HTMLElement<span class=\"token punctuation\">,</span> <span class=\"token builtin\">unknown</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">SankeyChart<span class=\"token operator\">&lt;</span>NodeData<span class=\"token punctuation\">,</span> LinkData<span class=\"token operator\">></span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> config<span class=\"token operator\">:</span> ChartConfig<span class=\"token operator\">&lt;</span>NodeData<span class=\"token punctuation\">,</span> LinkData<span class=\"token operator\">></span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> state<span class=\"token operator\">:</span> State <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    addedGradients<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    isInTransition<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    linkSelected<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    selectedNode<span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> elements<span class=\"token operator\">:</span> ChartElements\n\n  <span class=\"token keyword\">public</span> <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>chartConfig<span class=\"token operator\">:</span> ChartConfig<span class=\"token operator\">&lt;</span>NodeData<span class=\"token punctuation\">,</span> LinkData<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>config <span class=\"token operator\">=</span> chartConfig\n\n    <span class=\"token keyword\">const</span> svg <span class=\"token operator\">=</span> <span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">#</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>chartConfig<span class=\"token punctuation\">.</span>rootElId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"svg\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> nodeG <span class=\"token operator\">=</span> svg<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"g\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stroke\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#000\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> linkG <span class=\"token operator\">=</span> svg<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"g\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fill\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"none\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>elements <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      linkG<span class=\"token punctuation\">,</span>\n      nodeG<span class=\"token punctuation\">,</span>\n      svg<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n      config<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> chartLinks<span class=\"token punctuation\">,</span> chartNodes<span class=\"token punctuation\">,</span> getNodeId<span class=\"token punctuation\">,</span> onNodeClick<span class=\"token punctuation\">,</span> rootElId <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      config<span class=\"token operator\">:</span> chartConfig<span class=\"token punctuation\">,</span>\n      elements<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span>\n\n    <span class=\"token keyword\">const</span> container <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span>rootElId<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> HTMLElement\n\n    <span class=\"token keyword\">const</span> color <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> colorFn <span class=\"token operator\">=</span> <span class=\"token function\">scaleOrdinal</span><span class=\"token punctuation\">(</span>schemePastel2<span class=\"token punctuation\">)</span>\n\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>sankeyNode<span class=\"token operator\">:</span> NodeData<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">colorFn</span><span class=\"token punctuation\">(</span><span class=\"token function\">getNodeId</span><span class=\"token punctuation\">(</span>sankeyNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> width <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> container<span class=\"token punctuation\">.</span><span class=\"token function\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    elements<span class=\"token punctuation\">.</span>svg<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"height\"</span><span class=\"token punctuation\">,</span> svgHeight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"width\"</span><span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> sankeyVal <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">sankeyD3</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>NodeData<span class=\"token punctuation\">,</span> LinkData<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">nodeId</span><span class=\"token punctuation\">(</span>getNodeId<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">nodeAlign</span><span class=\"token punctuation\">(</span>sankeyLeft<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">nodeWidth</span><span class=\"token punctuation\">(</span><span class=\"token number\">15</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">nodePadding</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">extent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">[</span>width <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> sankeyHeight <span class=\"token operator\">-</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> links<span class=\"token punctuation\">,</span> nodes <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">sankeyVal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      links<span class=\"token operator\">:</span> chartLinks<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>sankeyLink<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n        Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> sankeyLink<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">unknown</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span>SankeyLink<span class=\"token operator\">&lt;</span>NodeData<span class=\"token punctuation\">,</span> LinkData<span class=\"token operator\">>></span><span class=\"token punctuation\">,</span>\n      nodes<span class=\"token operator\">:</span> chartNodes<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>sankeyNode<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n        Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> sankeyNode<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> NodeData<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">let</span> <span class=\"token function-variable function\">lastAnime</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">nodeClickHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      linkPath<span class=\"token punctuation\">,</span>\n      sankeyNode<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      linkPath<span class=\"token operator\">:</span> Selection<span class=\"token operator\">&lt;</span>\n        SVGPathElement<span class=\"token punctuation\">,</span>\n        SankeyLink<span class=\"token operator\">&lt;</span>NodeData<span class=\"token punctuation\">,</span> LinkData<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n        SVGGElement<span class=\"token punctuation\">,</span>\n        <span class=\"token builtin\">unknown</span>\n      <span class=\"token operator\">></span>\n      sankeyNode<span class=\"token operator\">:</span> SankeyNode<span class=\"token operator\">&lt;</span>NodeData<span class=\"token punctuation\">,</span> LinkData<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>isInTransition<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>onNodeClick<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> shouldPreventDefault <span class=\"token operator\">=</span> <span class=\"token function\">onNodeClick</span><span class=\"token punctuation\">(</span>sankeyNode<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>shouldPreventDefault<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>selectedNode <span class=\"token operator\">===</span> <span class=\"token function\">getNodeId</span><span class=\"token punctuation\">(</span>sankeyNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        linkPath<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"display\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"opacity\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>selectedNode <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>isInTransition <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>selectedNode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          linkPath\n            <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"opacity\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>sankeyLink<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n              <span class=\"token punctuation\">[</span>\n                <span class=\"token function\">getNodeId</span><span class=\"token punctuation\">(</span>sankeyLink<span class=\"token punctuation\">.</span>source <span class=\"token keyword\">as</span> NodeData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token function\">getNodeId</span><span class=\"token punctuation\">(</span>sankeyLink<span class=\"token punctuation\">.</span>target <span class=\"token keyword\">as</span> NodeData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>selectedNode<span class=\"token punctuation\">)</span>\n                <span class=\"token operator\">?</span> <span class=\"token keyword\">null</span>\n                <span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n            <span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"display\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          linkPath\n            <span class=\"token punctuation\">.</span><span class=\"token function\">transition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">duration</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"opacity\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>sankeyLink<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n              <span class=\"token punctuation\">[</span>\n                <span class=\"token function\">getNodeId</span><span class=\"token punctuation\">(</span>sankeyLink<span class=\"token punctuation\">.</span>source <span class=\"token keyword\">as</span> NodeData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token function\">getNodeId</span><span class=\"token punctuation\">(</span>sankeyLink<span class=\"token punctuation\">.</span>target <span class=\"token keyword\">as</span> NodeData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token function\">getNodeId</span><span class=\"token punctuation\">(</span>sankeyNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token operator\">?</span> <span class=\"token keyword\">null</span>\n                <span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n            <span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"end\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>isInTransition <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n              linkPath<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"display\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>sankeyLink<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n                <span class=\"token punctuation\">[</span>\n                  <span class=\"token function\">getNodeId</span><span class=\"token punctuation\">(</span>sankeyLink<span class=\"token punctuation\">.</span>source <span class=\"token keyword\">as</span> NodeData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                  <span class=\"token function\">getNodeId</span><span class=\"token punctuation\">(</span>sankeyLink<span class=\"token punctuation\">.</span>target <span class=\"token keyword\">as</span> NodeData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token function\">getNodeId</span><span class=\"token punctuation\">(</span>sankeyNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token operator\">?</span> <span class=\"token keyword\">null</span>\n                  <span class=\"token operator\">:</span> <span class=\"token string\">\"none\"</span>\n              <span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>selectedNode <span class=\"token operator\">=</span> <span class=\"token function\">getNodeId</span><span class=\"token punctuation\">(</span>sankeyNode<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> node <span class=\"token operator\">=</span> elements<span class=\"token punctuation\">.</span>nodeG\n      <span class=\"token punctuation\">.</span><span class=\"token function\">selectAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rect\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">data</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>SankeyNode<span class=\"token operator\">&lt;</span>NodeData<span class=\"token punctuation\">,</span> LinkData<span class=\"token operator\">>></span></span></span><span class=\"token punctuation\">(</span>nodes<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rect\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"class\"</span><span class=\"token punctuation\">,</span> styles<span class=\"token punctuation\">.</span>chartNode<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>sankeyNode<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> sankeyNode<span class=\"token punctuation\">.</span>x0<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"y\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>sankeyNode<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> sankeyNode<span class=\"token punctuation\">.</span>y0<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"height\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>sankeyNode<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> sankeyNode<span class=\"token punctuation\">.</span>y1<span class=\"token operator\">!</span> <span class=\"token operator\">-</span> sankeyNode<span class=\"token punctuation\">.</span>y0<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"width\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>sankeyNode<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> sankeyNode<span class=\"token punctuation\">.</span>x1<span class=\"token operator\">!</span> <span class=\"token operator\">-</span> sankeyNode<span class=\"token punctuation\">.</span>x0<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fill\"</span><span class=\"token punctuation\">,</span> color<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mouseenter\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token function\">onMouseEnter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">lastAnime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">const</span> animationFirst <span class=\"token operator\">=</span> <span class=\"token function\">anime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          direction<span class=\"token operator\">:</span> <span class=\"token string\">\"alternate\"</span><span class=\"token punctuation\">,</span>\n          duration<span class=\"token operator\">:</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span>\n          easing<span class=\"token operator\">:</span> <span class=\"token string\">\"easeInOutSine\"</span><span class=\"token punctuation\">,</span>\n          loop<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n          strokeDashoffset<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>anime<span class=\"token punctuation\">.</span>setDashoffset<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n          targets<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">const</span> animationSecond <span class=\"token operator\">=</span> <span class=\"token function\">anime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          direction<span class=\"token operator\">:</span> <span class=\"token string\">\"alternate\"</span><span class=\"token punctuation\">,</span>\n          duration<span class=\"token operator\">:</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">,</span>\n          easing<span class=\"token operator\">:</span> <span class=\"token string\">\"spring(1, 80, 10, 0)\"</span><span class=\"token punctuation\">,</span>\n          loop<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n          opacity<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0.6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.6</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n          targets<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token function-variable function\">lastAnime</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          animationFirst<span class=\"token punctuation\">.</span><span class=\"token function\">seek</span><span class=\"token punctuation\">(</span>animationFirst<span class=\"token punctuation\">.</span>duration<span class=\"token punctuation\">)</span>\n          animationSecond<span class=\"token punctuation\">.</span><span class=\"token function\">seek</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n          anime<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n          <span class=\"token function-variable function\">lastAnime</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mouseleave\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">lastAnime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> sankeyNode<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">nodeClickHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          linkPath<span class=\"token punctuation\">,</span> <span class=\"token comment\">// eslint-disable-line @typescript-eslint/no-use-before-define</span>\n          sankeyNode<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    node<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>sankeyNode<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n      chartConfig<span class=\"token punctuation\">.</span><span class=\"token function\">getNodeTitle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        nodeValue<span class=\"token operator\">:</span> sankeyNode<span class=\"token punctuation\">.</span>value<span class=\"token operator\">!</span><span class=\"token punctuation\">,</span>\n        sankeyNode<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\n\n    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">.</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>styles<span class=\"token punctuation\">.</span>chartNode<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">tooltip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      track<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> link <span class=\"token operator\">=</span> elements<span class=\"token punctuation\">.</span>linkG\n      <span class=\"token punctuation\">.</span><span class=\"token function\">selectAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"g\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">data</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>SankeyLink<span class=\"token operator\">&lt;</span>NodeData<span class=\"token punctuation\">,</span> LinkData<span class=\"token operator\">>></span></span></span><span class=\"token punctuation\">(</span>links<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"g\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"class\"</span><span class=\"token punctuation\">,</span> styles<span class=\"token punctuation\">.</span>chartLinkG<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> linkPathGenerator <span class=\"token operator\">=</span> <span class=\"token function\">sankeyLinkHorizontal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> state <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span>\n\n    <span class=\"token keyword\">const</span> linkPath <span class=\"token operator\">=</span> link\n      <span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>sankeyLink<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> isHorizontalLine <span class=\"token operator\">=</span> sankeyLink<span class=\"token punctuation\">.</span>y0 <span class=\"token operator\">===</span> sankeyLink<span class=\"token punctuation\">.</span>y1\n\n        <span class=\"token keyword\">return</span> <span class=\"token function\">linkPathGenerator</span><span class=\"token punctuation\">(</span>\n          <span class=\"token comment\">// this is necessary for the default gradientUnits (objectBoundingBox) to work</span>\n          <span class=\"token comment\">// https://stackoverflow.com/a/34687362</span>\n          isHorizontalLine\n            <span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token operator\">...</span>sankeyLink<span class=\"token punctuation\">,</span>\n                y1<span class=\"token operator\">:</span> sankeyLink<span class=\"token punctuation\">.</span>y1<span class=\"token operator\">!</span> <span class=\"token operator\">+</span> <span class=\"token number\">0.1</span><span class=\"token punctuation\">,</span>\n              <span class=\"token punctuation\">}</span>\n            <span class=\"token operator\">:</span> sankeyLink\n        <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stroke\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>sankeyLink<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> fromColor <span class=\"token operator\">=</span> <span class=\"token function\">color</span><span class=\"token punctuation\">(</span>sankeyLink<span class=\"token punctuation\">.</span>source <span class=\"token keyword\">as</span> NodeData<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">const</span> toColor <span class=\"token operator\">=</span> <span class=\"token function\">color</span><span class=\"token punctuation\">(</span>sankeyLink<span class=\"token punctuation\">.</span>target <span class=\"token keyword\">as</span> NodeData<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> <span class=\"token function\">createGradients</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          addedGradients<span class=\"token operator\">:</span> state<span class=\"token punctuation\">.</span>addedGradients<span class=\"token punctuation\">,</span>\n          fromColor<span class=\"token punctuation\">,</span>\n          svg<span class=\"token operator\">:</span> elements<span class=\"token punctuation\">.</span>svg<span class=\"token punctuation\">,</span>\n          toColor<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">url(#</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)</span><span class=\"token template-punctuation string\">`</span></span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"class\"</span><span class=\"token punctuation\">,</span> styles<span class=\"token punctuation\">.</span>chartLink<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stroke-width\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>sankeyLink<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> sankeyLink<span class=\"token punctuation\">.</span>width<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token function\">onLinkClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">.</span>isInTransition<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">const</span> currentLink <span class=\"token operator\">=</span> <span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">.</span>linkSelected<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          linkPath<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"display\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"opacity\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n          linkPath<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"display\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"none\"</span><span class=\"token punctuation\">)</span>\n          currentLink<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"display\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n\n        state<span class=\"token punctuation\">.</span>selectedNode <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\n        state<span class=\"token punctuation\">.</span>linkSelected <span class=\"token operator\">=</span> <span class=\"token operator\">!</span>state<span class=\"token punctuation\">.</span>linkSelected\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    link<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>sankeyLink<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n      chartConfig<span class=\"token punctuation\">.</span><span class=\"token function\">getLinkTitle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        sankeyLink<span class=\"token punctuation\">,</span>\n        sankeyLinkSource<span class=\"token operator\">:</span> sankeyLink<span class=\"token punctuation\">.</span>source <span class=\"token keyword\">as</span> NodeData<span class=\"token punctuation\">,</span>\n        sankeyLinkTarget<span class=\"token operator\">:</span> sankeyLink<span class=\"token punctuation\">.</span>target <span class=\"token keyword\">as</span> NodeData<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\n\n    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">.</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>styles<span class=\"token punctuation\">.</span>chartLink<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">tooltip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      track<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    elements<span class=\"token punctuation\">.</span>nodeG<span class=\"token punctuation\">.</span><span class=\"token function\">each</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token function\">appendOnEnd</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> parentEl <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>parentNode <span class=\"token keyword\">as</span> HTMLElement\n\n      parentEl<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    elements<span class=\"token punctuation\">.</span>svg\n      <span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"g\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"font-family\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"sans-serif\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">selectAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"text\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span>nodes<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"text\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>sankeyNode<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n        sankeyNode<span class=\"token punctuation\">.</span>x0<span class=\"token operator\">!</span> <span class=\"token operator\">&lt;</span> width <span class=\"token operator\">/</span> <span class=\"token number\">2</span> <span class=\"token operator\">?</span> sankeyNode<span class=\"token punctuation\">.</span>x1<span class=\"token operator\">!</span> <span class=\"token operator\">+</span> <span class=\"token number\">6</span> <span class=\"token operator\">:</span> sankeyNode<span class=\"token punctuation\">.</span>x0<span class=\"token operator\">!</span> <span class=\"token operator\">-</span> <span class=\"token number\">6</span>\n      <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"y\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>sankeyNode<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>sankeyNode<span class=\"token punctuation\">.</span>y1<span class=\"token operator\">!</span> <span class=\"token operator\">+</span> sankeyNode<span class=\"token punctuation\">.</span>y0<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dy\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"0.35em\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"font-size\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"16px\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"text-anchor\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>sankeyNode<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n        sankeyNode<span class=\"token punctuation\">.</span>x0<span class=\"token operator\">!</span> <span class=\"token operator\">&lt;</span> width <span class=\"token operator\">/</span> <span class=\"token number\">2</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"start\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"end\"</span>\n      <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span>chartConfig<span class=\"token punctuation\">.</span>getNodeText<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span> SankeyChart<span class=\"token punctuation\">,</span> ChartConfig <span class=\"token punctuation\">}</span>\n","filePath":"src/demos/energy-sankey/sankey-chart.ts"},{"content":"<span class=\"token keyword\">const</span> <span class=\"token constant\">CONTAINER_ID</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"chart\"</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">CONTAINER_ID</span> <span class=\"token punctuation\">}</span>\n","filePath":"src/demos/energy-sankey/ui-constants.ts"}],"page":{"content":"<span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> DemoPageProps <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@/common\"</span>\n\n<span class=\"token keyword\">import</span> Demo <span class=\"token keyword\">from</span> <span class=\"token string\">\"@/components/demo\"</span>\n\n<span class=\"token keyword\">import</span> main<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">CONTAINER_ID</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@/demos/energy-sankey/energy-sankey\"</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">EnergySankey</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> pageContext <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> DemoPageProps</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Demo</span></span> <span class=\"token attr-name\">main</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>main<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">pageContext</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>pageContext<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token constant\">CONTAINER_ID</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Demo</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> EnergySankey\n","type":"tsx"}},"key":"energy-sankey"},"meta":{"description":"Sankey diagram with multiple interactive parts and animations. It handles the results alignments."}}},
    "staticQueryHashes": []}