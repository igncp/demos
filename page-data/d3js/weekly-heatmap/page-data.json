{
    "componentChunkName": "component---src-pages-d-3-js-weekly-heatmap-tsx",
    "path": "/d3js/weekly-heatmap/",
    "result": {"pageContext":{"demoInfo":{"dataFiles":["data.tsv"],"docs":[["d3-selection API reference","https://github.com/d3/d3-selection#api-reference"],["d3-selection Types","https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/d3-selection/index.d.ts"],["d3-scale API reference","https://github.com/d3/d3-scale#api-reference"],["d3-scale Types","https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/d3-scale/index.d.ts"],["d3-fetch API reference","https://github.com/d3/d3-fetch#api-reference"],["d3-fetch Types","https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/d3-fetch/index.d.ts"]],"isCompleted":true,"name":"Weekly Heatmap","notes":[],"sources":["http://bl.ocks.org/tjdecke/5558084"],"summary":["This chart is a grid of days and hours using a quantile to group the data values by nine colors. The number of groups is directly tied to the colors array, so removing or adding colors to the array also affects the number of groups."],"category":"d3js","files":{"demoCSS":[{"content":".weeklyHeatmapChart {\n  rect.bordered {\n    stroke: #e6e6e6;\n    stroke-width: 2px;\n  }\n\n  text.mono {\n    fill: #aaa;\n    font-family: Consolas, courier, sans-serif;\n    font-size: 9pt;\n  }\n\n  text.axisBold {\n    fill: #333;\n    font-weight: bold;\n  }\n}\n","fileName":"weekly-heatmap.module.css"}],"demoTS":[{"content":"import { renderChart } from \"./weekly-heatmap-chart\"\nimport {\n  CONTAINER_ID,\n  TimeItem,\n  createChartConfig,\n  fetchData,\n} from \"./weekly-heatmap-data\"\n\nconst main = async () => {\n  const weeklyData = await fetchData()\n  const chartConfig = createChartConfig(weeklyData)\n\n  renderChart<TimeItem>(chartConfig)\n}\n\nexport { CONTAINER_ID }\n\nexport default main\n","fileName":"weekly-heatmap.ts"},{"content":"import { max as maxD3, scaleQuantile, select } from \"d3\"\n\nimport * as styles from \"./weekly-heatmap.module.css\"\n\nconst colors = [\n  \"#ffffd9\",\n  \"#edf8b1\",\n  \"#c7e9b4\",\n  \"#7fcdbb\",\n  \"#41b6c4\",\n  \"#1d91c0\",\n  \"#225ea8\",\n  \"#253494\",\n  \"#081d58\",\n]\nconst { length: buckets } = colors\n\nconst margin = {\n  bottom: 100,\n  left: 50,\n  right: 50,\n  top: 50,\n}\n\nconst rectRadiusSize = 100\nconst extraHeight = 60\nconst axisOffset = -6\n\nconst legendStroke = \"#ccc\"\n\nexport type ChartConfig<ChartData> = {\n  getIsHorizontalLabelBold: (label: string, labelIndex: number) => boolean\n  getIsVerticalLabelBold: (label: string, labelIndex: number) => boolean\n  getItemHorizontalIndex: (cell: ChartData) => number\n  getItemTooltip: (cell: ChartData) => string\n  getItemValue: (cell: ChartData) => number\n  getItemVerticalIndex: (cell: ChartData) => number\n  getLegendText: (cellValue: number) => string\n  horizontalLabels: string[]\n  rootElId: string\n  verticalLabels: string[]\n  weeklyData: ChartData[]\n}\n\nexport const renderChart = <ChartData>(chartConfig: ChartConfig<ChartData>) => {\n  const { rootElId, weeklyData } = chartConfig\n  const rootEl = document.getElementById(rootElId) as HTMLElement\n\n  rootEl.classList.add(styles.weeklyHeatmapChart)\n\n  const { horizontalLabels, verticalLabels } = chartConfig\n\n  const width =\n    rootEl.getBoundingClientRect().width - margin.left - margin.right\n  const height =\n    Math.ceil((width * 10) / horizontalLabels.length) -\n    margin.top -\n    margin.bottom +\n    extraHeight\n  const cellSize = Math.floor(width / horizontalLabels.length)\n  const legendElementWidth = cellSize * 2\n\n  const max = maxD3(weeklyData, (cell) => chartConfig.getItemValue(cell))\n\n  const colorScale = scaleQuantile<string>()\n    .domain([0, buckets - 1, max])\n    .range(colors)\n\n  const svg = select(`#${rootElId}`)\n    .append(\"svg\")\n    .attr(\"height\", height + margin.top + margin.bottom)\n    .attr(\"width\", width + margin.left + margin.right)\n    .append(\"g\")\n    .attr(\"transform\", `translate(${margin.left},${margin.top})`)\n\n  svg\n    .selectAll(\".verticalLabel\")\n    .data(verticalLabels)\n    .enter()\n    .append(\"text\")\n    .text((label) => label)\n    .attr(\n      \"class\",\n      (...[label, labelIndex]) =>\n        `verticalLabel ${styles.mono} axis${\n          chartConfig.getIsVerticalLabelBold(label, labelIndex)\n            ? ` ${styles.axisBold}`\n            : \"\"\n        }`\n    )\n    .attr(\"transform\", `translate(${axisOffset},${cellSize / 1.5})`)\n    .attr(\"x\", 0)\n    .attr(\"y\", (...[, labelIndex]) => labelIndex * cellSize)\n    .style(\"text-anchor\", \"end\")\n\n  svg\n    .selectAll(\".horizontalLabel\")\n    .data(horizontalLabels)\n    .enter()\n    .append(\"text\")\n    .text((label) => label)\n    .attr(\n      \"class\",\n      (...[label, labelIndex]) =>\n        `horizontalLabel ${styles.mono} axis${\n          chartConfig.getIsHorizontalLabelBold(label, labelIndex)\n            ? ` ${styles.axisBold}`\n            : \"\"\n        }`\n    )\n    .attr(\"transform\", `translate(${cellSize / 2}, ${axisOffset})`)\n    .attr(\"x\", (...[, labelIndex]) => labelIndex * cellSize)\n    .attr(\"y\", 0)\n    .style(\"text-anchor\", \"middle\")\n\n  const heatMap = svg\n    .selectAll(\".cell\")\n    .data(weeklyData)\n    .enter()\n    .append(\"rect\")\n    .attr(\"class\", `cell ${styles.bordered}`)\n    .attr(\"height\", cellSize)\n    .attr(\"rx\", rectRadiusSize)\n    .attr(\"ry\", rectRadiusSize)\n    .attr(\"width\", cellSize)\n    .attr(\n      \"x\",\n      (cellItem) => chartConfig.getItemHorizontalIndex(cellItem) * cellSize\n    )\n    .attr(\n      \"y\",\n      (cellItem) => chartConfig.getItemVerticalIndex(cellItem) * cellSize\n    )\n    .attr(\"title\", chartConfig.getItemTooltip)\n    .style(\"fill\", colors[0])\n\n  heatMap\n    .transition()\n    .duration(6000)\n    .style(\"fill\", (cellItem) => colorScale(chartConfig.getItemValue(cellItem)))\n\n  $(\".cell\").tooltip()\n\n  const legend = svg\n    .selectAll(\".legend\")\n    .data(\n      [0].concat(colorScale.quantiles()),\n      (legendValue) => legendValue as number\n    )\n    .enter()\n    .append(\"g\")\n    .attr(\"class\", \"legend\")\n\n  legend\n    .append(\"rect\")\n    .attr(\"x\", (...[, valueIndex]) => legendElementWidth * valueIndex)\n    .attr(\"y\", height)\n    .attr(\"width\", legendElementWidth)\n    .attr(\"height\", cellSize / 2)\n    .style(\"fill\", (...[, valueIndex]) => colors[valueIndex])\n    .style(\"stroke\", legendStroke)\n\n  legend\n    .append(\"text\")\n    .attr(\"class\", styles.mono)\n    .text(chartConfig.getLegendText)\n    .style(\"text-anchor\", \"middle\")\n    .attr(\n      \"x\",\n      (...[, valueIndex]) =>\n        legendElementWidth * valueIndex + legendElementWidth / 2\n    )\n    .attr(\"y\", height + cellSize)\n}\n","fileName":"weekly-heatmap-chart.ts"},{"content":"import { tsv } from \"d3\"\n\nimport { ChartConfig } from \"./weekly-heatmap-chart\"\n\nconst CONTAINER_ID = \"chart\"\n\ntype TimeItem = {\n  arbitraryMetric: number\n  day: number\n  hour: number\n}\n\ntype TimeItemOriginal = {\n  day: number\n  hour: number\n  value: number // eslint-disable-line id-denylist\n}\n\nconst days = [\"Mo\", \"Tu\", \"We\", \"Th\", \"Fr\", \"Sa\", \"Su\"]\n\nconst hours = Array.from({ length: 24 }).map(\n  (...[, hourIndex]: [unknown, number]) => {\n    const normalizedHour = hourIndex % 12\n\n    return `${normalizedHour + 1} ${\n      hourIndex >= 11 && hourIndex !== 23 ? \"pm\" : \"am\"\n    }`\n  }\n)\n\nconst workingHourMin = 7\nconst workingHourMax = 16\nconst workingDayMin = 0\nconst workingDayMax = 4\n\nconst fetchData = async (): Promise<TimeItem[]> => {\n  const weeklyTSVData = (await tsv(\n    `${ROOT_PATH}data/d3js/weekly-heatmap/data.tsv`\n  )) as unknown as TimeItemOriginal[]\n\n  return weeklyTSVData.map((timeItem) => ({\n    arbitraryMetric: +timeItem.value,\n    day: +timeItem.day,\n    hour: +timeItem.hour,\n  }))\n}\n\ntype Config = ChartConfig<TimeItem>\n\nconst getItemValue: Config[\"getItemValue\"] = (timeItem) =>\n  timeItem.arbitraryMetric\nconst getItemTooltip: Config[\"getItemTooltip\"] = (timeItem) =>\n  `Arbitrary Metric: ${timeItem.arbitraryMetric}`\nconst getItemHorizontalIndex: Config[\"getItemHorizontalIndex\"] = (timeItem) =>\n  timeItem.hour - 1\nconst getItemVerticalIndex: Config[\"getItemVerticalIndex\"] = (timeItem) =>\n  timeItem.day - 1\nconst getIsHorizontalLabelBold: Config[\"getIsHorizontalLabelBold\"] = (\n  ...[, hourIndex]\n) => hourIndex >= workingHourMin && hourIndex <= workingHourMax\n\nconst getIsVerticalLabelBold: Config[\"getIsVerticalLabelBold\"] = (\n  ...[, dayIndex]\n) => dayIndex >= workingDayMin && dayIndex <= workingDayMax\n\nconst getLegendText: Config[\"getLegendText\"] = (arbitraryMetric) =>\n  `â‰¥ ${arbitraryMetric.toFixed(2)}`\n\nconst createChartConfig = (weeklyData: TimeItem[]): Config => ({\n  getIsHorizontalLabelBold,\n  getIsVerticalLabelBold,\n  getItemHorizontalIndex,\n  getItemTooltip,\n  getItemValue,\n  getItemVerticalIndex,\n  getLegendText,\n  horizontalLabels: hours,\n  rootElId: CONTAINER_ID,\n  verticalLabels: days,\n  weeklyData,\n})\n\nexport { CONTAINER_ID, TimeItem, createChartConfig, fetchData }\n","fileName":"weekly-heatmap-data.ts"}],"page":{"content":"import React from \"react\"\n\nimport { DemoPageProps, JQUERYUI } from \"@/common\"\n\nimport Demo from \"@/components/demo\"\n\nimport main, { CONTAINER_ID } from \"@/demos/weekly-heatmap/weekly-heatmap\"\n\nconst WeeklyHeatmap = ({ pageContext }: DemoPageProps) => (\n  <Demo\n    links={[JQUERYUI.STYLE]}\n    main={main}\n    pageContext={pageContext}\n    scripts={[JQUERYUI.SCRIPT]}\n  >\n    <div id={CONTAINER_ID} />\n  </Demo>\n)\n\nexport default WeeklyHeatmap\n","type":"tsx"}},"key":"weekly-heatmap"},"meta":{"description":"Heatmap chart example using D3.js, very similar to the one displayed in the GitHub site, with a few additions from the original."}}},
    "staticQueryHashes": []}