{"version":3,"sources":["webpack://demos/./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","webpack://demos/./src/demos/partition/partition.ts","webpack://demos/./src/pages/d3js/partition.tsx"],"names":["asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","this","args","arguments","apply","err","undefined","CONTAINER_ID","easeFn","easeBounce","addTitle","selector","append","text","node","data","name","getNodeText","Math","abs","x0","x1","parent","length","getDataHierarchy","partitionType","radius","rootData","dataHierarchySize","hierarchy","sum","size","dataHierarchyCount","partitionD3","PI","partition","descendants","extractTweenObj","depth","y0","y1","getInterpolatorFn","initialData","finalNode","nodeIndex","initialNode","interpolateFn","interpolate","t","transitientState","renderChart","rootElId","width","document","getElementById","getBoundingClientRect","min","colorScale","scaleOrdinal","schemePastel2","color","children","svg","select","attr","filter","feMerge","addFilter","arc","arcD3","startAngle","endAngle","innerRadius","outerRadius","textsTransform","rotation","centroid","join","renderDescendants","usedDescendants","pathSel","selectAll","pathInitialData","path","exit","remove","pathEnter","enter","style","transition","duration","ease","attrTween","textsSel","textsInitialData","texts","textsEnter","forEach","set","on","updatePartition","newPartitionType","newDescendants","json","ROOT_PATH","formEl","getCurrentSelectedRadio","Array","from","elements","find","formElement","checked","addEventListener","pageContext","main","id","type","defaultChecked"],"mappings":"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","file":"component---src-pages-d-3-js-partition-tsx-a126d15103d55ea22913.js","sourcesContent":["function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}","import {\n  HierarchyRectangularNode,\n  Selection,\n  arc as arcD3,\n  easeBounce,\n  hierarchy,\n  interpolate,\n  json,\n  partition as partitionD3,\n  scaleOrdinal,\n  schemePastel2,\n  select,\n} from \"d3\"\n\nconst CONTAINER_ID = \"chart\"\n\ntype DataNode = {\n  children: DataNode[]\n  name: string\n  size?: number\n}\n\ntype HierarchyRectNode = HierarchyRectangularNode<DataNode>\ntype PartitionType = \"count\" | \"size\"\n\nconst fetchData = () =>\n  (json(\n    `${ROOT_PATH}data/d3js/partition/flare.json`\n  ) as unknown) as Promise<DataNode>\n\nconst height = 700\nconst overColor = \"#de7c03\"\nconst transitionDuration = 2000\nconst easeFn = easeBounce\n\nconst addTitle = <SVGComp extends SVGElement, SVGParent extends SVGElement>(\n  selector: Selection<SVGComp, HierarchyRectNode, SVGParent, unknown>\n) => {\n  selector.append(\"title\").text((node) => `${node.data.name}\\n${node.value}`)\n}\n\nconst getNodeText = (node: HierarchyRectNode) => {\n  const dx = Math.abs(node.x0 - node.x1)\n\n  if (dx > 0.07 && node.parent && node.data.name.length < 10) {\n    return node.data.name\n  }\n\n  return \"\"\n}\n\ntype RenderChart = (o: {\n  partitionType: PartitionType\n  rootData: DataNode\n  rootElId: string\n}) => {\n  updatePartition: (partitionType: PartitionType) => void\n}\n\nconst getDataHierarchy = ({\n  partitionType,\n  radius,\n  rootData,\n}: {\n  partitionType: PartitionType\n  radius: number\n  rootData: DataNode\n}) => {\n  const dataHierarchySize = hierarchy(rootData).sum(\n    (node: DataNode) => node.size ?? 0\n  )\n  const dataHierarchyCount = hierarchy(rootData).sum(() => 1)\n  const partition = partitionD3<DataNode>().size([2 * Math.PI, radius])\n\n  const hierarchyResult = partition(\n    partitionType === \"size\" ? dataHierarchySize : dataHierarchyCount\n  )\n\n  return hierarchyResult.descendants()\n}\n\nconst extractTweenObj = (node: HierarchyRectNode) => ({\n  depth: node.depth,\n  x0: node.x0,\n  x1: node.x1,\n  y0: node.y0,\n  y1: node.y1,\n})\n\nconst getInterpolatorFn = ({\n  fn,\n  initialData,\n}: {\n  fn: (node: HierarchyRectNode) => string | null\n  initialData: HierarchyRectNode[]\n}) => (...[finalNode, nodeIndex]: [HierarchyRectNode, number]) => {\n  const { [nodeIndex]: initialNode } = initialData\n\n  const interpolateFn = interpolate(\n    extractTweenObj(initialNode),\n    extractTweenObj(finalNode)\n  )\n\n  return (t: number) => {\n    const transitientState = interpolateFn(t)\n\n    return fn(transitientState as HierarchyRectNode)!\n  }\n}\n\nconst addFilter = (\n  svg: Selection<SVGGElement, unknown, HTMLElement, unknown>\n) => {\n  const defs = svg.append(\"defs\")\n  const filter = defs.append(\"filter\")\n\n  filter.attr(\"id\", \"drop-shadow\")\n  filter\n    .append(\"feGaussianBlur\")\n    .attr(\"in\", \"SourceAlpha\")\n    .attr(\"stdDeviation\", 9)\n  filter.append(\"feOffset\").attr(\"dx\", 2).attr(\"dy\", 5)\n  filter\n    .append(\"feComponentTransfer\")\n    .append(\"feFuncA\")\n    .attr(\"slope\", \".5\")\n    .attr(\"type\", \"linear\")\n\n  const feMerge = filter.append(\"feMerge\")\n\n  feMerge.append(\"feMergeNode\")\n  feMerge.append(\"feMergeNode\").attr(\"in\", \"SourceGraphic\")\n}\n\nconst renderChart: RenderChart = ({ partitionType, rootData, rootElId }) => {\n  const { width } = (document.getElementById(\n    rootElId\n  ) as HTMLElement).getBoundingClientRect()\n  const radius = Math.min(width, height) / 2\n  const colorScale = scaleOrdinal(schemePastel2)\n\n  const color = (node: HierarchyRectNode) =>\n    node.children\n      ? colorScale(node.data.name)\n      : colorScale(node.parent!.data.name)\n\n  const svg = select(`#${rootElId}`)\n    .append(\"svg\")\n    .text(\"\")\n    .attr(\"width\", width)\n    .attr(\"height\", height)\n    .append(\"g\")\n    .attr(\"transform\", `translate(${width / 2},${height * 0.52})`)\n\n  addFilter(svg)\n\n  const descendants = getDataHierarchy({\n    partitionType,\n    radius,\n    rootData,\n  })\n\n  const arc = arcD3<HierarchyRectNode>()\n    .startAngle((node) => node.x0)\n    .endAngle((node) => node.x1)\n    .innerRadius((node) => node.y0)\n    .outerRadius((node) => node.y1)\n\n  const textsTransform = (node: HierarchyRectNode) => {\n    if (!node.depth) {\n      return \"\"\n    }\n\n    const centroid = arc.centroid(node)\n    const rotationDeg = (() => {\n      const rotation =\n        90 + ((node.x0 + (node.x1 - node.x0) / 2) * 180) / Math.PI\n\n      return rotation > 90 && rotation < 270 ? rotation - 180 : rotation\n    })()\n\n    return [\n      `rotate(${rotationDeg},${centroid[0]},${centroid[1]})`,\n      `translate(${centroid[0]},${centroid[1]})`,\n    ].join(\" \")\n  }\n\n  const renderDescendants = (\n    usedDescendants: Array<HierarchyRectangularNode<DataNode>>\n  ) => {\n    const pathSel = svg.selectAll<SVGPathElement, HierarchyRectNode>(\"path\")\n    const pathInitialData = pathSel.data()\n    const path = pathSel.data(usedDescendants)\n\n    path.exit().remove()\n\n    const pathEnter = path\n      .enter()\n      .append(\"path\")\n      .attr(\"display\", (node) => (node.depth ? null : \"none\"))\n      .attr(\"data-index\", (...[, nodeIndex]) => nodeIndex)\n      .style(\"stroke\", \"#000\")\n      .style(\"stroke-width\", \"0.5px\")\n      .style(\"stroke-dasharray\", \"1,3\")\n      .style(\"fill\", color)\n      .style(\"filter\", (...[, nodeIndex]) =>\n        // not adding drop-shadow in all to avoid too much saturation\n        nodeIndex % 3 !== 0 ? \"url(#drop-shadow)\" : null\n      )\n      .attr(\"d\", arc)\n\n    path\n      .transition()\n      .duration(transitionDuration)\n      .ease(easeFn)\n      .attrTween(\n        \"d\",\n        getInterpolatorFn({ fn: arc, initialData: pathInitialData })\n      )\n\n    const textsSel = svg.selectAll<SVGTextElement, HierarchyRectNode>(\"text\")\n    const textsInitialData = textsSel.data()\n    const texts = textsSel.data(usedDescendants)\n\n    texts.exit().remove()\n\n    const textsEnter = texts\n      .enter()\n      .append(\"text\")\n      .text(getNodeText)\n      .attr(\"transform\", textsTransform)\n      .attr(\"data-index\", (...[, nodeIndex]) => nodeIndex)\n      .style(\"fill\", \"#333\")\n      .attr(\"text-anchor\", \"middle\")\n      .style(\"font\", \"bold 12px Arial\")\n      .style(\"cursor\", \"default\")\n      .attr(\"transform\", textsTransform)\n\n    texts\n      .transition()\n      .duration(transitionDuration)\n      .ease(easeFn)\n      .attrTween(\n        \"transform\",\n        getInterpolatorFn({ fn: textsTransform, initialData: textsInitialData })\n      )\n\n    const updatedGroups = [pathEnter, textsEnter]\n\n    updatedGroups.forEach((set) => {\n      set.on(\"mouseover\", function () {\n        const nodeIndex = select(this).attr(\"data-index\")\n\n        select(`path[data-index=\"${nodeIndex}\"]`).style(\"fill\", overColor)\n        select(`text[data-index=\"${nodeIndex}\"]`).style(\"fill\", \"white\")\n      })\n\n      set.on(\"mouseout\", function () {\n        const nodeIndex = select(this).attr(\"data-index\")\n\n        select<SVGPathElement, HierarchyRectNode>(\n          `path[data-index=\"${nodeIndex}\"]`\n        ).style(\"fill\", color)\n        select(`text[data-index=\"${nodeIndex}\"]`).style(\"fill\", \"#000\")\n      })\n    })\n\n    addTitle(path)\n    addTitle(texts)\n  }\n\n  renderDescendants(descendants)\n\n  return {\n    updatePartition: (newPartitionType: PartitionType) => {\n      const newDescendants = getDataHierarchy({\n        partitionType: newPartitionType,\n        radius,\n        rootData,\n      })\n\n      renderDescendants(newDescendants)\n    },\n  }\n}\n\nconst main = async () => {\n  const rootData = await fetchData()\n\n  const formEl = document.getElementById(\"type-form\") as HTMLFormElement\n\n  const getCurrentSelectedRadio = (): PartitionType => {\n    const selectedRadio = Array.from(\n      (formEl.elements as unknown) as HTMLInputElement[]\n    ).find((formElement: HTMLInputElement) => formElement.checked)\n\n    return selectedRadio!.value as PartitionType\n  }\n\n  const partitionType = getCurrentSelectedRadio()\n\n  const { updatePartition } = renderChart({\n    partitionType,\n    rootData,\n    rootElId: CONTAINER_ID,\n  })\n\n  formEl.addEventListener(\"change\", () => {\n    const newPartitionType = getCurrentSelectedRadio()\n\n    updatePartition(newPartitionType)\n  })\n}\n\nexport { CONTAINER_ID }\n\nexport default main\n","import React from \"react\"\n\nimport { DemoPageProps } from \"@/common\"\n\nimport Demo from \"@/components/demo\"\n\nimport main, { CONTAINER_ID } from \"@/demos/partition/partition\"\n\nconst Partition = ({ pageContext }: DemoPageProps) => (\n  <Demo main={main} pageContext={pageContext}>\n    <form id=\"type-form\">\n      <label>\n        <input name=\"mode\" type=\"radio\" value=\"size\" /> Size\n      </label>\n      <label>\n        <input defaultChecked name=\"mode\" type=\"radio\" value=\"count\" /> Count\n      </label>\n    </form>\n    <div id={CONTAINER_ID} />\n  </Demo>\n)\n\nexport default Partition\n"],"sourceRoot":""}