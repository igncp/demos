(self.webpackChunkdemos=self.webpackChunkdemos||[]).push([[147],{7102:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return b}});var a=n(7294),r=n(4275),o=n(2137),i=n(7757),l=n.n(i),u=n(7723),s=n(581),c=n(7956),p=n(3873),m=n.n(p),d="population-circles-module--radio--1S8Dr",f="population-circles-module--slider--3hzyU",g="population-circles-module--circle--Q63YD",v="dropShadowBase",h=0,y=70,x=400,I=function(e){var t,n,a,r,o=document.getElementById(e.rootElId).getBoundingClientRect().width,i={k:1,x:0,y:0},l=(0,u.PKp)().domain(e.colorDomain).range(u.UCG),s=(0,u.sPX)().extent([[0,0],[o/2,200]]).on("end",(function(e){var t=(0,u.Ys)(this).transition().duration(150),n=e.transform,a=n.x,r=n.y,o=e.transform.k;o!==i.k&&(a=i.x,r=i.y),t.attr("transform","translate("+a+", "+r+") scale("+o+")"),i.k=o,i.x=a,i.y=r})),p=(0,u.Ys)("#"+e.rootElId).append("svg").attr("viewBox",[0,0,o,x+y].join(", ")).attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor","middle").call(s);n=(t={deviation:2,name:v,slope:.5,svg:p}).deviation,a=t.name,r=t.slope,t.svg.append("filter").html('\n<filter id="'+a+'" height="130%">\n  <feGaussianBlur in="SourceAlpha" stdDeviation="'+n+'"/>\n  <feOffset dx="2" dy="2" result="offsetblur"/>\n  <feComponentTransfer>\n    <feFuncA type="linear" slope="'+r+'"/>\n  </feComponentTransfer>\n  <feMerge>\n    <feMergeNode/>\n    <feMergeNode in="SourceGraphic"/>\n  </feMerge>\n</filter>\n');var d=p.append("text").attr("class","population-circles-module--header--1mim1").text("").attr("transform","translate("+o/2+", 50)"),f=p.append("g").attr("transform","translate("+h+", "+y+")"),I=function(){var t=e.getChartItems(),n={},a=(0,u.bT9)(Object.assign({},e.getEmptyItem(),{children:t})).sum(e.getItemMetric),r=e.getIsSmall(),i=(0,u.P2p)().size(r?[o/2,200]:[o,x]).padding(3)(a).leaves();d.text(e.getHeaderText({chartItems:t}));var s=function(t){return e.getItemId(t.data)},p=f.selectAll(".leaf").data(i,s);p.exit().remove();var v=function(t){return e.getItemTitle({circleData:t.data})};p.attr("title",v).transition().duration(1e3).ease(u.sq$).attr("transform",(function(e){return r?"translate("+(e.x+o/4)+","+(e.y+100)+")":"translate("+(e.x+1)+","+(e.y+1)+")"}));var h=p.enter().append("g").attr("class","leaf").attr("title",v).attr("transform",(function(e){return"translate("+(e.x+1)+","+(e.y+1)+")"})).on("mouseenter",(function(){for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];var o=a[1],i=(0,u.Ys)(this).select("."+g);(0,u.Ys)(this).select(".letter").attr("filter","url(#dropShadowBase)");var l=e.getItemId(o.data),s=(0,c.Z)({complete:function(){n[l]=null},strokeWidth:"5px",targets:[i.node()]});n[l]=s})).on("mouseleave",(function(){for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];var o=a[1],i=(0,u.Ys)(this).select("."+g);(0,u.Ys)(this).select(".letter").attr("filter",null);var l=e.getItemId(o.data),s=n[l];s&&(s.seek(0),c.Z.remove(i.node()),n[l]=null),(0,c.Z)({strokeWidth:"0px",targets:[i.node()]})})).on("click",(function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];var r=n[1];e.onClick(r.data)})),y=function(t){return l(e.getStringForColor(t.data))},I=function(e){var t=y(e);return m()(t).darken(1.5).hex()},k=function(t){t.text((function(t){return e.getItemLabel(t.data)})).style("font-size",(function(e){return e.r.toFixed(0)+"px"})).attr("dy",(function(e){return e.r/3})).attr("fill",I)},w=function(e){e.attr("r",(function(e){return e.r})).attr("fill",y).attr("stroke",I)};w(h.append("circle").attr("class",g)),k(h.append("text").attr("class","letter"));var T=function(e){return e},E=p.selectAll("."+g).data(T,s),C=p.selectAll(".letter").data(T,s);w(E.transition().duration(1e3).ease(u.vaZ)),k(C.transition().duration(1e3).ease(u.vaZ)),$(".leaf").tooltip({track:!0})};return I(),{updateChart:I}},k=n(2203),w=function(e){return Number(e.toFixed(0)).toLocaleString(void 0,{maximumFractionDigits:0,minimumFractionDigits:0})},T={females:"females",males:"males",total:"people"},E=function(e){return new Date(e).getFullYear()},C=function(e,t){return{colorDomain:e.map((function(e){return e.name})),getChartItems:function(){var n=t.populationRange,a=t.populationType,r=t.timeRangeIndex,o=e.filter((function(e){return!!e.values[a][r]})),i=o.map((function(e){return e.values[a][r].count})),l=i.reduce((function(e,t,n){var a;return e[t]=null!==(a=e[t])&&void 0!==a?a:[],e[t].push(n),e}),{}),u=i.sort((function(e,t){return e-t})),s=u.reduce((function(e,t,n){var a=n/u.length;return l[t].forEach((function(t){e[t]=a})),e}),[]);return o.filter((function(e,t){var a=s[t];return"number"==typeof a&&a>=n[0]&&a<=n[1]}))},getEmptyItem:function(){return{name:"",values:{females:[],males:[],total:[]}}},getHeaderText:function(e){var n=e.chartItems,a=n[0].values[t.populationType][t.timeRangeIndex].date,r=E(a),o=n.reduce((function(e,n){return e+n.values[t.populationType][t.timeRangeIndex].count}),0),i=w(o)+" "+T[t.populationType],l=n.filter((function(e){return e.values[t.populationType].length>=t.timeRangeIndex+1})).length;return"Population in Malaga: "+r+" - "+i+(0===t.populationRange[0]&&1===t.populationRange[1]?"":" - From "+(100*t.populationRange[0]).toFixed(0)+" percentile to "+(100*t.populationRange[1]).toFixed(0)+" percentile")+" - "+l+" municipalities"},getIsSmall:function(){return"total"!==t.populationType},getItemId:function(e){return e.name},getItemLabel:function(e){return e.name[0]},getItemMetric:function(e){if(!e.values)return 1;var n=e.values[t.populationType][t.timeRangeIndex];return n?n.count:0},getItemTitle:function(e){var n=e.circleData,a=n.values[t.populationType][t.timeRangeIndex];if(!a)return"";var r=T[t.populationType];return n.name+" - "+w(a.count)+" "+r+" - "+E(a.date)},getStringForColor:function(e){return e.name},onClick:function(e){s.Z.isPressed("control")&&window.open("https://www.google.com/search?"+k.stringify({q:"Malaga "+e.name}))},rootElId:"chart"}},R=function(){var e=(0,o.Z)(l().mark((function e(){var t,n,a,r,o,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,s.Z)("control",(function(){})),e.next=3,(0,u.AVB)("/demos/data/d3js/population-circles/data.json");case 3:t=e.sent,a=C(t,n={populationRange:[0,1],populationType:"total",timeRangeIndex:0}),r=I(a),o=r.updateChart,(0,u.Ys)("form").on("change",(function(e){n.populationType=e.target.value,o()})),$(".population-slider").slider({change:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];var r=t[1].values,i=r.map((function(e){return e/100}));n.populationRange=i,o()},range:!0,values:[0,100]}),i=t[0].values.total.length-1,$(".time-slider").slider({change:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];var r=t[1].value;n.timeRangeIndex=r,o()},max:i,min:0,value:0});case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),b=function(e){var t=e.pageContext;return a.createElement(r.Z,{links:["/vendors/jquery-ui/themes/base/jquery-ui.min.css"],main:R,pageContext:t,scripts:["/vendors/jquery-ui/jquery-ui.min.js"]},a.createElement("form",null,[{id:"total",label:"Total"},{id:"males",label:"Males"},{id:"females",label:"Females"}].map((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],o=r.id,i=r.label,l=t[1];return a.createElement("div",{className:d,key:o},a.createElement("input",{defaultChecked:0===l,id:o,name:"type",type:"radio",value:o}),a.createElement("label",{htmlFor:o},i))}))),a.createElement("div",{className:f},a.createElement("p",null,"Time"),a.createElement("div",{className:"time-slider"})),a.createElement("div",{className:f},a.createElement("p",null,"Population Percentile"),a.createElement("div",{className:"population-slider"})),a.createElement("div",{id:"chart"}))}}}]);
//# sourceMappingURL=component---src-pages-d-3-js-population-circles-tsx-e4cbfc9149095e39b18b.js.map