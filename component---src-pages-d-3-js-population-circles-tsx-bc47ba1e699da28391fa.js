(self.webpackChunkdemos=self.webpackChunkdemos||[]).push([[147],{2602:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return j}});var r=n(7294),a=n(4275),i=n(2137),o=n(7757),l=n.n(o),u=n(7723),s=n(581),c=n(7956),m=n(3873),p=n.n(m),f="population-circles-module--radio--1S8Dr",d="population-circles-module--slider--3hzyU",g="population-circles-module--circle--Q63YD",v="dropShadowBase",h=0,y=70,x=400,I=function(e){var t,n,r,a,i=document.getElementById(e.rootElId).getBoundingClientRect().width,o={k:1,x:0,y:0},l=(0,u.PKp)().domain(e.colorDomain).range(u.UCG),s=(0,u.sPX)().extent([[0,0],[i/2,200]]).on("end",(function(e){var t=(0,u.Ys)(this).transition().duration(150),n=e.transform,r=n.x,a=n.y,i=e.transform.k;i!==o.k&&(r=o.x,a=o.y),t.attr("transform","translate("+r+", "+a+") scale("+i+")"),o.k=i,o.x=r,o.y=a})),m=(0,u.Ys)("#"+e.rootElId).append("svg").attr("viewBox",[0,0,i,x+y].join(", ")).attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor","middle").call(s);n=(t={deviation:2,name:v,slope:.5,svg:m}).deviation,r=t.name,a=t.slope,t.svg.append("filter").html('\n<filter id="'+r+'" height="130%">\n  <feGaussianBlur in="SourceAlpha" stdDeviation="'+n+'"/>\n  <feOffset dx="2" dy="2" result="offsetblur"/>\n  <feComponentTransfer>\n    <feFuncA type="linear" slope="'+a+'"/>\n  </feComponentTransfer>\n  <feMerge>\n    <feMergeNode/>\n    <feMergeNode in="SourceGraphic"/>\n  </feMerge>\n</filter>\n');var f=m.append("text").attr("class","population-circles-module--header--1mim1").text("").attr("transform","translate("+i/2+", 50)"),d=m.append("g").attr("transform","translate("+h+", "+y+")"),I=function(){var t=e.getChartItems(),n={},r=(0,u.bT9)(Object.assign({},e.getEmptyItem(),{children:t})).sum(e.getItemMetric),a=e.getIsSmall(),o=(0,u.P2p)().size(a?[i/2,200]:[i,x]).padding(3)(r).leaves();f.text(e.getHeaderText({chartItems:t}));var s=function(t){return e.getItemId(t.data)},m=d.selectAll(".leaf").data(o,s);m.exit().remove();var v=function(t){return e.getItemTitle({circleData:t.data})};m.attr("title",v).transition().duration(1e3).ease(u.sq$).attr("transform",(function(e){return a?"translate("+(e.x+i/4)+","+(e.y+100)+")":"translate("+(e.x+1)+","+(e.y+1)+")"}));var h=m.enter().append("g").attr("class","leaf").attr("title",v).attr("transform",(function(e){return"translate("+(e.x+1)+","+(e.y+1)+")"})).on("mouseenter",(function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];var i=r[1],o=(0,u.Ys)(this).select("."+g);(0,u.Ys)(this).select(".letter").attr("filter","url(#dropShadowBase)");var l=e.getItemId(i.data),s=(0,c.Z)({complete:function(){n[l]=null},strokeWidth:"5px",targets:[o.node()]});n[l]=s})).on("mouseleave",(function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];var i=r[1],o=(0,u.Ys)(this).select("."+g);(0,u.Ys)(this).select(".letter").attr("filter",null);var l=e.getItemId(i.data),s=n[l];s&&(s.seek(0),c.Z.remove(o.node()),n[l]=null),(0,c.Z)({strokeWidth:"0px",targets:[o.node()]})})).on("click",(function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=n[1];e.onClick(a.data)})),y=function(t){return l(e.getStringForColor(t.data))},I=function(e){var t=y(e);return p()(t).darken(1.5).hex()},w=function(t){t.text((function(t){return e.getItemLabel(t.data)})).style("font-size",(function(e){return e.r.toFixed(0)+"px"})).attr("dy",(function(e){return e.r/3})).attr("fill",I)},k=function(e){e.attr("r",(function(e){return e.r})).attr("fill",y).attr("stroke",I)};k(h.append("circle").attr("class",g)),w(h.append("text").attr("class","letter"));var T=function(e){return e},E=m.selectAll("."+g).data(T,s),b=m.selectAll(".letter").data(T,s);k(E.transition().duration(1e3).ease(u.vaZ)),w(b.transition().duration(1e3).ease(u.vaZ)),$(".leaf").tooltip({track:!0})};return I(),{updateChart:I}};function w(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}var k=n(2203),T=["values"],E=function(){var e=(0,i.Z)(l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.AVB)("/demos/data/d3js/population-circles/data.json");case 2:return t=e.sent,e.abrupt("return",t.map((function(e){var t=e.values,n=w(e,T);return Object.assign({},n,{metrics:t})})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),b=function(e){return Number(e.toFixed(0)).toLocaleString(void 0,{maximumFractionDigits:0,minimumFractionDigits:0})},A={females:"females",males:"males",total:"people"},C=function(e){return new Date(e).getFullYear()},R=function(e){var t=e.municipalities,n=e.state;return{colorDomain:t.map((function(e){return e.name})),getChartItems:function(){var e=n.populationRange,r=n.populationType,a=n.timeRangeIndex,i=t.filter((function(e){return!!e.metrics[r][a]})),o=i.map((function(e){return e.metrics[r][a].count})),l=o.reduce((function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=n[0],i=n[1],o=n[2];return a[i]=null!==(e=a[o])&&void 0!==e?e:[],a[i].push(o),a}),{}),u=o.sort((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],a=t[1];return r-a})),s=u.reduce((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],a=t[1],i=t[2],o=i/u.length,s=l[a];return s.forEach((function(e){r[e]=o})),r}),[]);return i.filter((function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=n[1],i=s[a];return"number"==typeof i&&i>=e[0]&&i<=e[1]}))},getEmptyItem:function(){return{metrics:{females:[],males:[],total:[]},name:""}},getHeaderText:function(e){var t=e.chartItems,r=t[0].metrics[n.populationType][n.timeRangeIndex].date,a=C(r),i=t.reduce((function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=t[0],i=t[1];return a+i.metrics[n.populationType][n.timeRangeIndex].count}),0),o=b(i)+" "+A[n.populationType],l=t.filter((function(e){return e.metrics[n.populationType].length>=n.timeRangeIndex+1})).length;return"Population in Malaga: "+a+" - "+o+(0===n.populationRange[0]&&1===n.populationRange[1]?"":" - From "+(100*n.populationRange[0]).toFixed(0)+" percentile to "+(100*n.populationRange[1]).toFixed(0)+" percentile")+" - "+l+" municipalities"},getIsSmall:function(){return"total"!==n.populationType},getItemId:function(e){return e.name},getItemLabel:function(e){return e.name[0]},getItemMetric:function(e){if(!e.metrics)return 1;var t=e.metrics[n.populationType][n.timeRangeIndex];return t?t.count:0},getItemTitle:function(e){var t=e.circleData,r=t.metrics[n.populationType][n.timeRangeIndex];if(!r)return"";var a=A[n.populationType];return t.name+" - "+b(r.count)+" "+a+" - "+C(r.date)},getStringForColor:function(e){return e.name},onClick:function(e){s.Z.isPressed("control")&&window.open("https://www.google.com/search?"+k.stringify({q:"Malaga "+e.name}))},rootElId:"chart"}},F=function(){var e=(0,i.Z)(l().mark((function e(){var t,n,r,a,i,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,s.Z)("control",(function(){})),e.next=3,E();case 3:t=e.sent,r=R({municipalities:t,state:n={populationRange:[0,1],populationType:"total",timeRangeIndex:0}}),a=I(r),i=a.updateChart,(0,u.Ys)("form").on("change",(function(e){n.populationType=e.target.value,i()})),$(".population-slider").slider({change:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=t[1].values,o=a.map((function(e){return e/100}));n.populationRange=o,i()},range:!0,values:[0,100]}),o=t[0].metrics.total.length-1,$(".time-slider").slider({change:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=t[1].value;n.timeRangeIndex=a,i()},max:o,min:0,value:0});case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),j=function(e){var t=e.pageContext;return r.createElement(a.Z,{links:["/vendors/jquery-ui/themes/base/jquery-ui.min.css"],main:F,pageContext:t,scripts:["/vendors/jquery-ui/jquery-ui.min.js"]},r.createElement("form",null,[{id:"total",label:"Total"},{id:"males",label:"Males"},{id:"females",label:"Females"}].map((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=t[0],i=a.id,o=a.label,l=t[1];return r.createElement("div",{className:f,key:i},r.createElement("input",{defaultChecked:0===l,id:i,name:"type",type:"radio",value:i}),r.createElement("label",{htmlFor:i},o))}))),r.createElement("div",{className:d},r.createElement("p",null,"Time"),r.createElement("div",{className:"time-slider"})),r.createElement("div",{className:d},r.createElement("p",null,"Population Percentile"),r.createElement("div",{className:"population-slider"})),r.createElement("div",{id:"chart"}))}}}]);
//# sourceMappingURL=component---src-pages-d-3-js-population-circles-tsx-bc47ba1e699da28391fa.js.map