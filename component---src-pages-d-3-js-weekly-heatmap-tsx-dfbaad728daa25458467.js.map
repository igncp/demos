{"version":3,"file":"component---src-pages-d-3-js-weekly-heatmap-tsx-dfbaad728daa25458467.js","mappings":"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","sources":["webpack://demos/./src/common.ts","webpack://demos/./src/demos/weekly-heatmap/weekly-heatmap.module.css","webpack://demos/./src/demos/weekly-heatmap/weekly-heatmap-chart.ts","webpack://demos/./src/demos/weekly-heatmap/weekly-heatmap-data.ts","webpack://demos/./src/demos/weekly-heatmap/weekly-heatmap.ts","webpack://demos/./src/pages/d3js/weekly-heatmap.tsx","webpack://demos/./node_modules/gatsby/node_modules/@babel/runtime/regenerator/index.js","webpack://demos/./node_modules/gatsby/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"],"sourcesContent":["type DocName = string\ntype DocLink = string\n\nexport type Meta = {\n  description: string\n}\n\nexport type DemoBase = {\n  dataFiles: string[]\n  docs: Array<[DocName, DocLink]>\n  isCompleted: boolean\n  name: string\n  notes: string[]\n  sources: string[]\n  summary: string[]\n}\n\ntype DemoFile = {\n  content: string\n  fileName: string\n}\n\nexport type DemoInfo = DemoBase & {\n  category: string\n  files: {\n    demoCSS: DemoFile[]\n    demoTS: DemoFile[]\n    page: {\n      content: string\n      type: string\n    }\n  }\n  key: string\n}\n\nexport type DemoSummary = {\n  category: string\n  key: string\n  name: DemoBase[\"name\"]\n  route: string\n}\n\nexport type IndexPageProps = {\n  pageContext: {\n    groupedDemos: DemoSummary[][]\n    meta: Meta\n    numberPerGroup: number\n  }\n}\n\nexport type DemoPageProps = {\n  pageContext: {\n    demoInfo: DemoInfo\n    meta: Meta\n  }\n}\n\nexport const STORYBOOK_DEMO_KEY = \"storybook\"\n\nexport const JQUERYUI = {\n  SCRIPT: \"/vendors/jquery-ui/jquery-ui.min.js\",\n  STYLE: \"/vendors/jquery-ui/themes/base/jquery-ui.min.css\",\n}\n","// extracted by mini-css-extract-plugin\nexport var weeklyHeatmapChart = \"weekly-heatmap-module--weeklyHeatmapChart--3k92Q\";\nexport var bordered = \"weekly-heatmap-module--bordered--2Vfqv\";\nexport var mono = \"weekly-heatmap-module--mono--1FY_w\";\nexport var axisBold = \"weekly-heatmap-module--axisBold--ymVm3\";","import { max as maxD3, scaleQuantile, select } from \"d3\"\n\nimport * as styles from \"./weekly-heatmap.module.css\"\n\nconst colors = [\n  \"#ffffd9\",\n  \"#edf8b1\",\n  \"#c7e9b4\",\n  \"#7fcdbb\",\n  \"#41b6c4\",\n  \"#1d91c0\",\n  \"#225ea8\",\n  \"#253494\",\n  \"#081d58\",\n]\nconst { length: buckets } = colors\n\nconst margin = {\n  bottom: 100,\n  left: 50,\n  right: 50,\n  top: 50,\n}\n\nconst rectRadiusSize = 100\nconst extraHeight = 60\nconst axisOffset = -6\n\nconst legendStroke = \"#ccc\"\n\nexport type ChartConfig<ChartData> = {\n  getIsHorizontalLabelBold: (label: string, labelIndex: number) => boolean\n  getIsVerticalLabelBold: (label: string, labelIndex: number) => boolean\n  getItemHorizontalIndex: (cell: ChartData) => number\n  getItemTooltip: (cell: ChartData) => string\n  getItemValue: (cell: ChartData) => number\n  getItemVerticalIndex: (cell: ChartData) => number\n  getLegendText: (cellValue: number) => string\n  horizontalLabels: string[]\n  rootElId: string\n  verticalLabels: string[]\n  weeklyData: ChartData[]\n}\n\nexport const renderChart = <ChartData>(chartConfig: ChartConfig<ChartData>) => {\n  const { rootElId, weeklyData } = chartConfig\n  const rootEl = document.getElementById(rootElId) as HTMLElement\n\n  rootEl.classList.add(styles.weeklyHeatmapChart)\n\n  const { horizontalLabels, verticalLabels } = chartConfig\n\n  const width =\n    rootEl.getBoundingClientRect().width - margin.left - margin.right\n  const height =\n    Math.ceil((width * 10) / horizontalLabels.length) -\n    margin.top -\n    margin.bottom +\n    extraHeight\n  const cellSize = Math.floor(width / horizontalLabels.length)\n  const legendElementWidth = cellSize * 2\n\n  const max = maxD3(weeklyData, (cell) => chartConfig.getItemValue(cell))\n\n  const colorScale = scaleQuantile<string>()\n    .domain([0, buckets - 1, max])\n    .range(colors)\n\n  const svg = select(`#${rootElId}`)\n    .append(\"svg\")\n    .attr(\"height\", height + margin.top + margin.bottom)\n    .attr(\"width\", width + margin.left + margin.right)\n    .append(\"g\")\n    .attr(\"transform\", `translate(${margin.left},${margin.top})`)\n\n  svg\n    .selectAll(\".verticalLabel\")\n    .data(verticalLabels)\n    .enter()\n    .append(\"text\")\n    .text((label) => label)\n    .attr(\n      \"class\",\n      (...[label, labelIndex]) =>\n        `verticalLabel ${styles.mono} axis${\n          chartConfig.getIsVerticalLabelBold(label, labelIndex)\n            ? ` ${styles.axisBold}`\n            : \"\"\n        }`\n    )\n    .attr(\"transform\", `translate(${axisOffset},${cellSize / 1.5})`)\n    .attr(\"x\", 0)\n    .attr(\"y\", (...[, labelIndex]) => labelIndex * cellSize)\n    .style(\"text-anchor\", \"end\")\n\n  svg\n    .selectAll(\".horizontalLabel\")\n    .data(horizontalLabels)\n    .enter()\n    .append(\"text\")\n    .text((label) => label)\n    .attr(\n      \"class\",\n      (...[label, labelIndex]) =>\n        `horizontalLabel ${styles.mono} axis${\n          chartConfig.getIsHorizontalLabelBold(label, labelIndex)\n            ? ` ${styles.axisBold}`\n            : \"\"\n        }`\n    )\n    .attr(\"transform\", `translate(${cellSize / 2}, ${axisOffset})`)\n    .attr(\"x\", (...[, labelIndex]) => labelIndex * cellSize)\n    .attr(\"y\", 0)\n    .style(\"text-anchor\", \"middle\")\n\n  const heatMap = svg\n    .selectAll(\".cell\")\n    .data(weeklyData)\n    .enter()\n    .append(\"rect\")\n    .attr(\"class\", `cell ${styles.bordered}`)\n    .attr(\"height\", cellSize)\n    .attr(\"rx\", rectRadiusSize)\n    .attr(\"ry\", rectRadiusSize)\n    .attr(\"width\", cellSize)\n    .attr(\n      \"x\",\n      (cellItem) => chartConfig.getItemHorizontalIndex(cellItem) * cellSize\n    )\n    .attr(\n      \"y\",\n      (cellItem) => chartConfig.getItemVerticalIndex(cellItem) * cellSize\n    )\n    .attr(\"title\", chartConfig.getItemTooltip)\n    .style(\"fill\", colors[0])\n\n  heatMap\n    .transition()\n    .duration(6000)\n    .style(\"fill\", (cellItem) => colorScale(chartConfig.getItemValue(cellItem)))\n\n  $(\".cell\").tooltip()\n\n  const legend = svg\n    .selectAll(\".legend\")\n    .data(\n      [0].concat(colorScale.quantiles()),\n      (legendValue) => legendValue as number\n    )\n    .enter()\n    .append(\"g\")\n    .attr(\"class\", \"legend\")\n\n  legend\n    .append(\"rect\")\n    .attr(\"x\", (...[, valueIndex]) => legendElementWidth * valueIndex)\n    .attr(\"y\", height)\n    .attr(\"width\", legendElementWidth)\n    .attr(\"height\", cellSize / 2)\n    .style(\"fill\", (...[, valueIndex]) => colors[valueIndex])\n    .style(\"stroke\", legendStroke)\n\n  legend\n    .append(\"text\")\n    .attr(\"class\", styles.mono)\n    .text(chartConfig.getLegendText)\n    .style(\"text-anchor\", \"middle\")\n    .attr(\n      \"x\",\n      (...[, valueIndex]) =>\n        legendElementWidth * valueIndex + legendElementWidth / 2\n    )\n    .attr(\"y\", height + cellSize)\n}\n","import { tsv } from \"d3\"\n\nimport { ChartConfig } from \"./weekly-heatmap-chart\"\n\nexport const CONTAINER_ID = \"chart\"\n\nexport type TimeItem = {\n  arbitraryMetric: number\n  day: number\n  hour: number\n}\n\ntype TimeItemOriginal = {\n  day: number\n  hour: number\n  value: number // eslint-disable-line id-denylist\n}\n\nconst days = [\"Mo\", \"Tu\", \"We\", \"Th\", \"Fr\", \"Sa\", \"Su\"]\n\nconst hours = Array.from({ length: 24 }).map(\n  (...[, hourIndex]: [unknown, number]) => {\n    const normalizedHour = hourIndex % 12\n\n    return `${normalizedHour + 1} ${\n      hourIndex >= 11 && hourIndex !== 23 ? \"pm\" : \"am\"\n    }`\n  }\n)\n\nconst workingHourMin = 7\nconst workingHourMax = 16\nconst workingDayMin = 0\nconst workingDayMax = 4\n\nexport const fetchData = async (): Promise<TimeItem[]> => {\n  const weeklyTSVData = (await tsv(\n    `${ROOT_PATH}data/d3js/weekly-heatmap/data.tsv`\n  )) as unknown as TimeItemOriginal[]\n\n  return weeklyTSVData.map((timeItem) => ({\n    arbitraryMetric: +timeItem.value,\n    day: +timeItem.day,\n    hour: +timeItem.hour,\n  }))\n}\n\ntype Config = ChartConfig<TimeItem>\n\nconst getItemValue: Config[\"getItemValue\"] = (timeItem) =>\n  timeItem.arbitraryMetric\nconst getItemTooltip: Config[\"getItemTooltip\"] = (timeItem) =>\n  `Arbitrary Metric: ${timeItem.arbitraryMetric}`\nconst getItemHorizontalIndex: Config[\"getItemHorizontalIndex\"] = (timeItem) =>\n  timeItem.hour - 1\nconst getItemVerticalIndex: Config[\"getItemVerticalIndex\"] = (timeItem) =>\n  timeItem.day - 1\nconst getIsHorizontalLabelBold: Config[\"getIsHorizontalLabelBold\"] = (\n  ...[, hourIndex]\n) => hourIndex >= workingHourMin && hourIndex <= workingHourMax\n\nconst getIsVerticalLabelBold: Config[\"getIsVerticalLabelBold\"] = (\n  ...[, dayIndex]\n) => dayIndex >= workingDayMin && dayIndex <= workingDayMax\n\nconst getLegendText: Config[\"getLegendText\"] = (arbitraryMetric) =>\n  `≥ ${arbitraryMetric.toFixed(2)}`\n\nexport const createChartConfig = (weeklyData: TimeItem[]): Config => ({\n  getIsHorizontalLabelBold,\n  getIsVerticalLabelBold,\n  getItemHorizontalIndex,\n  getItemTooltip,\n  getItemValue,\n  getItemVerticalIndex,\n  getLegendText,\n  horizontalLabels: hours,\n  rootElId: CONTAINER_ID,\n  verticalLabels: days,\n  weeklyData,\n})\n","import { renderChart } from \"./weekly-heatmap-chart\"\nimport {\n  CONTAINER_ID,\n  TimeItem,\n  createChartConfig,\n  fetchData,\n} from \"./weekly-heatmap-data\"\n\nconst main = async () => {\n  const weeklyData = await fetchData()\n  const chartConfig = createChartConfig(weeklyData)\n\n  renderChart<TimeItem>(chartConfig)\n}\n\nexport { CONTAINER_ID }\n\nexport default main\n","import React from \"react\"\n\nimport { DemoPageProps, JQUERYUI } from \"@/common\"\n\nimport Demo from \"@/components/demo\"\n\nimport main, { CONTAINER_ID } from \"@/demos/weekly-heatmap/weekly-heatmap\"\n\nconst WeeklyHeatmap = ({ pageContext }: DemoPageProps) => (\n  <Demo\n    links={[JQUERYUI.STYLE]}\n    main={main}\n    pageContext={pageContext}\n    scripts={[JQUERYUI.SCRIPT]}\n  >\n    <div id={CONTAINER_ID} />\n  </Demo>\n)\n\nexport default WeeklyHeatmap\n","module.exports = require(\"regenerator-runtime\");\n","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}"],"names":["STORYBOOK_DEMO_KEY","JQUERYUI","SCRIPT","STYLE","mono","axisBold","colors","buckets","length","margin","renderChart","chartConfig","rootElId","weeklyData","rootEl","document","getElementById","classList","add","horizontalLabels","verticalLabels","width","getBoundingClientRect","height","Math","ceil","cellSize","floor","legendElementWidth","max","maxD3","cell","getItemValue","colorScale","scaleQuantile","domain","range","svg","select","append","attr","selectAll","data","enter","text","label","labelIndex","styles","getIsVerticalLabelBold","style","getIsHorizontalLabelBold","cellItem","getItemHorizontalIndex","getItemVerticalIndex","getItemTooltip","transition","duration","$","tooltip","legend","concat","quantiles","legendValue","valueIndex","getLegendText","CONTAINER_ID","days","hours","Array","from","map","hourIndex","normalizedHour","fetchData","tsv","ROOT_PATH","weeklyTSVData","timeItem","arbitraryMetric","value","day","hour","dayIndex","toFixed","createChartConfig","pageContext","links","main","scripts","id","module","exports","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","error","done","Promise","then","_asyncToGenerator","fn","self","this","args","arguments","apply","err","undefined"],"sourceRoot":""}